<!DOCTYPE html><html> <head><meta charset=UTF-8><meta name=viewport content="width=device-width, initial-scale=1"><meta name=robots context="index, archive"><!--  --><script>
      const versions_json = "../../../../../versions.json";
      const search_worker_js = "../../../../assets/javascript/search-worker.js";
      const search_index_json = "../../../../search/search_index.json";
      const base_url = '../../../..';
    </script><!-- Site title --><title>Aggregators - Fed-BioMed</title><link rel=icon type=image/x-icon href=../../../../favicon.ico><!-- Page description --><meta name=description content="Open, Transparent and Trusted Collaborative Learning for Real-world Healthcare Applications"><!-- Page keywords --><!-- Page author --><!-- Latest compiled and minified CSS --><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><!-- Bootstrap Icons --><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css><link href=../../../../assets/_mkdocstrings.css rel=stylesheet><link href=../../../../assets/css/style.css rel=stylesheet></head> <body> <header> <div class="container-fluid top-bar"> <div class=brand> <a href=/ > <img src=../../../../assets/img/fedbiomed-logo-small.png> </a> </div> <nav class=top> <ul> <li class> <a href=../../../..>Home</a> </li> <li class> <a href=../../../../getting-started/what-is-fedbiomed/ >User Documentation</a> </li> <li class> <a href=../../../../pages/about-us/ >About</a> </li> <li id=clicker class=has-sub> More <i class="bi bi-chevron-down"></i> <ul class=sub-nav-menu> <li class> <a href=../../../../#funding>Funding</a> </li> <li class> <a href=../../../../news/ >News</a> </li> <li class> <a href=../../../../#contributors>Contributors</a> </li> <li class> <a href=../../../../#users>Users</a> </li> <li class> <a href=../../../../pages/roadmap/ >Roadmap</a> </li> <li class> <a href=../../../../#contact-us>Contact Us</a> </li> </ul> </li> </ul> </nav> </div> <div class="container-fluid top-bar-mobile"> <div class=mobile-bar> <div class=brand> <a href=../../../../ > <img src=../../../../assets/img/fedbiomed-logo-small.png> </a> </div> <div class=hum-menu> <img class=open src=../../../../assets/img/menu.svg> <img class=close style=display:none src=../../../../assets/img/cancel.svg> </div> </div> <nav class=top-mobile> <ul> <li class> <a href=../../../..>Home</a> </li> <li class> <a href=../../../../getting-started/what-is-fedbiomed/ >User Documentation</a> </li> <li class> <a href=../../../../pages/about-us/ >About</a> </li> <li id=clicker class=has-sub> More <i class="bi bi-chevron-down"></i> <ul class=sub-nav-menu> <li class> <a href=../../../../#funding>Funding</a> </li> <li class> <a href=../../../../news/ >News</a> </li> <li class> <a href=../../../../#contributors>Contributors</a> </li> <li class> <a href=../../../../#users>Users</a> </li> <li class> <a href=../../../../pages/roadmap/ >Roadmap</a> </li> <li class> <a href=../../../../#contact-us>Contact Us</a> </li> </ul> </li> </ul> </nav> </div> </header> <div class=main> <!-- Home page --> <div class=container-fluid> <div class=doc-row> <div class=left-col> <div class=sidebar-doc> <nav class=sidebar-inner> <ul class="sidebar-menu-left sub"> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Getting Started <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../getting-started/what-is-fedbiomed/ class>What's Fed-BioMed</a> </li> <li class> <a href=../../../../getting-started/getting-started/ class>Basic Example</a> </li> <li class> <a href=../../../../getting-started/fedbiomed-architecture/ class>Fedbiomed Architecture</a> </li> <li class> <a href=../../../../getting-started/fedbiomed-workflow/ class>Fedbiomed Workflow</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Tutorials <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Installation <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/installation/0-basic-software-installation/ class>Software Installation</a> </li> <li class> <a href=../../../../tutorials/installation/1-setting-up-environment/ class>Setting Up Environment</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> PyTorch <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/pytorch/01_PyTorch_MNIST_Single_Node_Tutorial/ class>PyTorch MNIST Basic Example</a> </li> <li class> <a href=../../../../tutorials/pytorch/02_Create_Your_Custom_Training_Plan/ class>How to Create Your Custom PyTorch Training Plan</a> </li> <li class> <a href=../../../../tutorials/pytorch/03_PyTorch_Used_Cars_Dataset_Example/ class>PyTorch Used Cars Dataset Example</a> </li> <li class> <a href=../../../../tutorials/pytorch/04-Aggregation_in_Fed-BioMed/ class>PyTorch aggregation methods in Fed-BioMed</a> </li> <li class> <a href=../../../../tutorials/pytorch/05_Transfer-learning_tutorial_usingDenseNet-121/ class>Transfer-learning in Fed-BioMed tutorial</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> MONAI <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/monai/01_monai-2d-image-classification/ class>Federated 2d image classification with MONAI</a> </li> <li class> <a href=../../../../tutorials/monai/02_monai-2d-image-registration/ class>Federated 2d XRay registration with MONAI</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Scikit-Learn <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/scikit-learn/01_sklearn_MNIST_classification_tutorial/ class>MNIST classification with Scikit-Learn Classifier (Perceptron)</a> </li> <li class> <a href=../../../../tutorials/scikit-learn/02_sklearn_sgd_regressor_tutorial/ class>Fed-BioMed to train a federated SGD regressor model</a> </li> <li class> <a href=../../../../tutorials/scikit-learn/03-other-scikit-learn-models/ class>Implementing other Scikit Learn models for Federated Learning</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Optimizers <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/optimizers/01-fedopt-and-scaffold/ class>Advanced optimizers in Fed-BioMed</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> FLamby <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/flamby/flamby/ class>General Concepts</a> </li> <li class> <a href=../../../../tutorials/flamby/flamby-integration-into-fedbiomed/ class>FLamby integration in Fed-BioMed</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Advanced <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/advanced/in-depth-experiment-configuration/ class>In Depth Experiment Configuration</a> </li> <li class> <a href=../../../../tutorials/advanced/training-with-gpu/ class>PyTorch model training using a GPU</a> </li> <li class> <a href=../../../../tutorials/advanced/breakpoints/ class>Breakpoints</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Security <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/security/differential-privacy-with-opacus-on-fedbiomed/ class>Using Differential Privacy with OPACUS on Fed-BioMed</a> </li> <li class> <a href=../../../../tutorials/security/non-private-local-central-dp-monai-2d-image-registration/ class>Local and Central DP with Fed-BioMed: MONAI 2d image registration</a> </li> <li class> <a href=../../../../tutorials/security/training-with-approved-training-plans/ class>Training Process with Training Plan Management</a> </li> <li class> <a href=../../../../tutorials/security/secure-aggregation/ class>Training with Secure Aggregation</a> </li> <li class> <a href=../../../../tutorials/concrete-ml/concrete-ml/ class>End-to-end Privacy Preserving Training and Inference on Medical Data</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Biomedical data <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/medical/medical-image-segmentation-unet-library/ class>Brain Segmentation</a> </li> </ul> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> User Guide <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/glossary/ class>Glossary</a> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Deployment <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/deployment/deployment/ class>Introduction</a> </li> <li class> <a href=../../../../user-guide/deployment/deployment-vpn/ class>VPN Deployment</a> </li> <li class> <a href=../../../../user-guide/deployment/matrix/ class>Network matrix</a> </li> <li class> <a href=../../../../user-guide/deployment/security-model/ class>Security model</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Node <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/nodes/configuring-nodes/ class>Configuring Nodes</a> </li> <li class> <a href=../../../../user-guide/nodes/deploying-datasets/ class>Deploying Datasets</a> </li> <li class> <a href=../../../../user-guide/nodes/training-plan-security-manager/ class>Training Plan Management</a> </li> <li class> <a href=../../../../user-guide/nodes/using-gpu/ class>Using GPU</a> </li> <li class> <a href=../../../../user-guide/nodes/node-gui/ class>Node GUI</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Researcher <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/researcher/training-plan/ class>Training Plan</a> </li> <li class> <a href=../../../../user-guide/researcher/training-data/ class>Training Data</a> </li> <li class> <a href=../../../../user-guide/researcher/experiment/ class>Experiment</a> </li> <li class> <a href=../../../../user-guide/researcher/aggregation/ class>Aggregation</a> </li> <li class> <a href=../../../../user-guide/researcher/listing-datasets-and-selecting-nodes/ class>Listing Datasets and Selecting Nodes</a> </li> <li class> <a href=../../../../user-guide/researcher/model-testing-during-federated-training/ class>Model Validation on the Node Side</a> </li> <li class> <a href=../../../../user-guide/researcher/tensorboard/ class>Tensorboard</a> </li> </ul> </li> <li class> <a href=../../../../user-guide/advanced-optimization/ class>Optimization</a> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Secure Aggregation <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/secagg/introduction/ class>Introduction</a> </li> <li class> <a href=../../../../user-guide/secagg/configuration/ class>Configuration</a> </li> <li class> <a href=../../../../user-guide/secagg/researcher-interface/ class>Managing Secure Aggregation in Researcher</a> </li> </ul> </li> </ul> </li> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> Developer <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> API Reference <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Common <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../common/certificate_manager/ class>Certificate Manager</a> </li> <li class> <a href=../../common/cli/ class>CLI</a> </li> <li class> <a href=../../common/config/ class>Config</a> </li> <li class> <a href=../../common/constants/ class>Constants</a> </li> <li class> <a href=../../common/data/ class>Data</a> </li> <li class> <a href=../../common/db/ class>DB</a> </li> <li class> <a href=../../common/environ/ class>Environ</a> </li> <li class> <a href=../../common/exceptions/ class>Exceptions</a> </li> <li class> <a href=../../common/ipython/ class>IPython</a> </li> <li class> <a href=../../common/json/ class>Json</a> </li> <li class> <a href=../../common/logger/ class>Logger</a> </li> <li class> <a href=../../common/message/ class>Message</a> </li> <li class> <a href=../../common/metrics/ class>Metrics</a> </li> <li class> <a href=../../common/models/ class>Model</a> </li> <li class> <a class href=../../common/mpc_controller.md>MPC controller</a> </li> <li class> <a href=../../common/optimizers/ class>Optimizers</a> </li> <li class> <a href=../../common/privacy/ class>Privacy</a> </li> <li class> <a href=../../common/secagg/ class>Secagg</a> </li> <li class> <a href=../../common/secagg_manager/ class>Secagg Manager</a> </li> <li class> <a href=../../common/serializer/ class>Serializer</a> </li> <li class> <a href=../../common/singleton/ class>Singleton</a> </li> <li class> <a href=../../common/synchro/ class>Synchro</a> </li> <li class> <a href=../../common/tasks_queue/ class>TasksQueue</a> </li> <li class> <a href=../../common/training_plans/ class>TrainingPlans</a> </li> <li class> <a href=../../common/training_args/ class>TrainingArgs</a> </li> <li class> <a href=../../common/utils/ class>Utils</a> </li> <li class> <a href=../../common/validator/ class>Validator</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Node <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../node/cli/ class>CLI</a> </li> <li class> <a href=../../node/cli_utils/ class>CLI Utils</a> </li> <li class> <a href=../../node/config/ class>Config</a> </li> <li class> <a href=../../node/dataset_manager/ class>DatasetManager</a> </li> <li class> <a href=../../node/environ/ class>Environ</a> </li> <li class> <a href=../../node/history_monitor/ class>HistoryMonitor</a> </li> <li class> <a href=../../node/node/ class>Node</a> </li> <li class> <a href=../../node/node_state_manager/ class>NodeStateManager</a> </li> <li class> <a href=../../node/requests/ class>Requests</a> </li> <li class> <a href=../../node/round/ class>Round</a> </li> <li class> <a href=../../node/secagg/ class>Secagg</a> </li> <li class> <a href=../../node/secagg_manager/ class>Secagg Manager</a> </li> <li class> <a href=../../node/training_plan_security_manager/ class>TrainingPlanSecurityManager</a> </li> </ul> </li> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> Researcher <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li class=current> <a href=./ class="link current">Aggregators</a> </li> <li class> <a href=../cli/ class>CLI</a> </li> <li class> <a href=../config/ class>Config</a> </li> <li class> <a href=../datasets/ class>Datasets</a> </li> <li class> <a href=../environ/ class>Environ</a> </li> <li class> <a href=../federated_workflows/ class>Federated Workflows</a> </li> <li class> <a href=../filetools/ class>Filetools</a> </li> <li class> <a href=../jobs/ class>Jobs</a> </li> <li class> <a href=../monitor/ class>Monitor</a> </li> <li class> <a href=../node_state_agent/ class>NodeStateAgent</a> </li> <li class> <a href=../requests/ class>Requests</a> </li> <li class> <a href=../secagg/ class>Secagg</a> </li> <li class> <a href=../strategies/ class>Strategies</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Transport <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../transport/client/ class>Client</a> </li> <li class> <a href=../../transport/controller/ class>Controller</a> </li> <li class> <a href=../../transport/node_agent/ class>NodeAgent</a> </li> <li class> <a href=../../transport/server/ class>Server</a> </li> </ul> </li> </ul> </li> <li class> <a href=../../../usage_and_tools/ class>Usage and Tools</a> </li> <li class> <a href=../../../ci/ class>Continuous Integration</a> </li> <li class> <a href=../../../definition-of-done/ class>Definition of Done</a> </li> <li class> <a href=../../../testing-in-fedbiomed/ class>Testing in Fed-BioMed</a> </li> <li class> <a href=../../../messaging/ class>RPC Protocol and Messages</a> </li> </ul> </li> </ul> </nav> </div> </div> <div class=main-col> <main class=main-docs> <h1>Aggregators</h1> <article> <div class="doc doc-object doc-module"> <div class="doc doc-contents first"> <div class="doc doc-children"> <h2 id=fedbiomed.researcher.aggregators-classes>Classes</h2> <div class="doc doc-object doc-class"> <h3 id=fedbiomed.researcher.aggregators.Aggregator class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">Aggregator</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>Aggregator</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Defines methods for aggregating strategy (eg FedAvg, FedProx, SCAFFOLD, ...).</p> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/aggregator.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="29 "></span><span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=linenos data-linenos="30 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="31 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_fds</span><span class=p>:</span> <span class=n>FederatedDataSet</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="32 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_type</span><span class=p>:</span> <span class=n>TrainingPlans</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="33 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_secagg_crypter</span> <span class=o>=</span> <span class=n>SecaggCrypter</span><span class=p>()</span>
</code></pre></div> </details> <div class="doc doc-children"> <h4 id=fedbiomed.researcher.aggregators.Aggregator-functions>Functions</h4> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Aggregator.aggregate class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">aggregate</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>aggregate</span><span class=p>(</span><span class=n>model_params</span><span class=p>,</span> <span class=n>weights</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Strategy to aggregate models</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>model_params</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a></code> </td> <td> <div class=doc-md-description> <p>List of model parameters received from each node</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>weights</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a></code> </td> <td> <div class=doc-md-description> <p>Weight for each node-model-parameter set</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedAggregatorError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedAggregatorError">FedbiomedAggregatorError</a></code> </td> <td> <div class=doc-md-description> <p>If the method is not defined by inheritor</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/aggregator.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos=" 89 "></span><span class=k>def</span><span class=w> </span><span class=nf>aggregate</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>model_params</span><span class=p>:</span> <span class=nb>list</span><span class=p>,</span> <span class=n>weights</span><span class=p>:</span> <span class=nb>list</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
<span class=linenos data-linenos=" 90 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=linenos data-linenos=" 91 "></span><span class=sd>    Strategy to aggregate models</span>
<span class=linenos data-linenos=" 92 "></span>
<span class=linenos data-linenos=" 93 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos=" 94 "></span><span class=sd>        model_params: List of model parameters received from each node</span>
<span class=linenos data-linenos=" 95 "></span><span class=sd>        weights: Weight for each node-model-parameter set</span>
<span class=linenos data-linenos=" 96 "></span>
<span class=linenos data-linenos=" 97 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos=" 98 "></span><span class=sd>        FedbiomedAggregatorError: If the method is not defined by inheritor</span>
<span class=linenos data-linenos=" 99 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="100 "></span>    <span class=n>msg</span> <span class=o>=</span> <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB401</span><span class=o>.</span><span class=n>value</span> <span class=o>+</span> \
<span class=linenos data-linenos="101 "></span>        <span class=s2>&quot;: aggregate method should be overloaded by the choosen strategy&quot;</span>
<span class=linenos data-linenos="102 "></span>    <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="103 "></span>    <span class=k>raise</span> <span class=n>FedbiomedAggregatorError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Aggregator.check_values class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">check_values</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>check_values</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/aggregator.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="105 "></span><span class=k>def</span><span class=w> </span><span class=nf>check_values</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>True</span><span class=p>:</span>
<span class=linenos data-linenos="106 "></span>    <span class=k>return</span> <span class=kc>True</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Aggregator.create_aggregator_args class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">create_aggregator_args</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>create_aggregator_args</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Returns aggregator arguments that are expecting by the nodes</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>args</code></td> <td> </td> <td> <div class=doc-md-description> <p>ignored</p> </div> </td> <td> <code>()</code> </td> </tr> <tr class=doc-section-item> <td><code>kwargs</code></td> <td> </td> <td> <div class=doc-md-description> <p>ignored</p> </div> </td> <td> <code>{}</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></code> </td> <td> <div class=doc-md-description> <p>contains <code>Aggregator</code> parameters/argument that will be shared with the nodes</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/aggregator.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="116 "></span><span class=k>def</span><span class=w> </span><span class=nf>create_aggregator_args</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
<span class=linenos data-linenos="117 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns aggregator arguments that are expecting by the nodes</span>
<span class=linenos data-linenos="118 "></span>
<span class=linenos data-linenos="119 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="120 "></span><span class=sd>        args: ignored</span>
<span class=linenos data-linenos="121 "></span><span class=sd>        kwargs: ignored</span>
<span class=linenos data-linenos="122 "></span>
<span class=linenos data-linenos="123 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="124 "></span><span class=sd>        contains `Aggregator` parameters/argument that will be shared with the nodes </span>
<span class=linenos data-linenos="125 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="126 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span> <span class=ow>or</span> <span class=p>{}</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Aggregator.load_state_breakpoint class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">load_state_breakpoint</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>load_state_breakpoint</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>use for breakpoints. load the aggregator state</p> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/aggregator.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="160 "></span><span class=k>def</span><span class=w> </span><span class=nf>load_state_breakpoint</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>state</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="161 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=linenos data-linenos="162 "></span><span class=sd>    use for breakpoints. load the aggregator state</span>
<span class=linenos data-linenos="163 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="164 "></span>    <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=s2>&quot;parameters&quot;</span><span class=p>],</span> <span class=n>Dict</span><span class=p>):</span>
<span class=linenos data-linenos="165 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span> <span class=o>=</span> <span class=n>Serializer</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=s1>&#39;parameters&#39;</span><span class=p>])</span>
<span class=linenos data-linenos="166 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="167 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=s1>&#39;parameters&#39;</span><span class=p>]</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Aggregator.save_state_breakpoint class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">save_state_breakpoint</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>save_state_breakpoint</span><span class=p>(</span><span class=n>breakpoint_path</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=o>**</span><span class=n>aggregator_args_create</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>use for breakpoints. save the aggregator state</p> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/aggregator.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="128 "></span><span class=k>def</span><span class=w> </span><span class=nf>save_state_breakpoint</span><span class=p>(</span>
<span class=linenos data-linenos="129 "></span>    <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="130 "></span>    <span class=n>breakpoint_path</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="131 "></span>    <span class=o>**</span><span class=n>aggregator_args_create</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
<span class=linenos data-linenos="132 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<span class=linenos data-linenos="133 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=linenos data-linenos="134 "></span><span class=sd>    use for breakpoints. save the aggregator state</span>
<span class=linenos data-linenos="135 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="136 "></span>    <span class=n>aggregator_args</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_aggregator_args</span><span class=p>(</span><span class=o>**</span><span class=n>aggregator_args_create</span><span class=p>)</span>
<span class=linenos data-linenos="137 "></span>    <span class=k>if</span> <span class=n>aggregator_args</span><span class=p>:</span>
<span class=linenos data-linenos="138 "></span>
<span class=linenos data-linenos="139 "></span>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="140 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span> <span class=o>=</span> <span class=p>{}</span>
<span class=linenos data-linenos="141 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>aggregator_args</span><span class=p>)</span>
<span class=linenos data-linenos="142 "></span>
<span class=linenos data-linenos="143 "></span>    <span class=k>if</span> <span class=n>breakpoint_path</span><span class=p>:</span>
<span class=linenos data-linenos="144 "></span>        <span class=n>filename</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_save_arg_to_file</span><span class=p>(</span><span class=n>breakpoint_path</span><span class=p>,</span> <span class=s1>&#39;aggregator_args&#39;</span><span class=p>,</span> <span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>(),</span> <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span><span class=p>)</span>
<span class=linenos data-linenos="145 "></span>
<span class=linenos data-linenos="146 "></span>    <span class=n>state</span> <span class=o>=</span> <span class=p>{</span>
<span class=linenos data-linenos="147 "></span>        <span class=s2>&quot;class&quot;</span><span class=p>:</span> <span class=nb>type</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span>
<span class=linenos data-linenos="148 "></span>        <span class=s2>&quot;module&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=vm>__module__</span><span class=p>,</span>
<span class=linenos data-linenos="149 "></span>        <span class=s2>&quot;parameters&quot;</span><span class=p>:</span> <span class=n>filename</span> <span class=k>if</span> <span class=n>breakpoint_path</span> <span class=k>else</span> <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span>
<span class=linenos data-linenos="150 "></span>    <span class=p>}</span>
<span class=linenos data-linenos="151 "></span>
<span class=linenos data-linenos="152 "></span>    <span class=k>return</span> <span class=n>state</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Aggregator.secure_aggregation class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">secure_aggregation</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>secure_aggregation</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>encryption_factors</span><span class=p>,</span> <span class=n>secagg_random</span><span class=p>,</span> <span class=n>aggregation_round</span><span class=p>,</span> <span class=n>total_sample_size</span><span class=p>,</span> <span class=n>training_plan</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Apply aggregation for encrypted model parameters</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>params</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]]</code> </td> <td> <div class=doc-md-description> <p>List containing list of encrypted parameters of each node</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>encryption_factors</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]]]</code> </td> <td> <div class=doc-md-description> <p>List of encrypted integers to validate encryption</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>secagg_random</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code> </td> <td> <div class=doc-md-description> <p>Randomly generated float value to validate secure aggregation correctness</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>aggregation_round</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>The round of the aggregation.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>total_sample_size</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>Sum of sample sizes used for training</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>training_plan</code></td> <td> <code>BaseTrainingPlan</code> </td> <td> <div class=doc-md-description> <p>Training plan instance used for the training.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>aggregated model parameters</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/aggregator.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="35 "></span><span class=k>def</span><span class=w> </span><span class=nf>secure_aggregation</span><span class=p>(</span>
<span class=linenos data-linenos="36 "></span>        <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="37 "></span>        <span class=n>params</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]],</span>
<span class=linenos data-linenos="38 "></span>        <span class=n>encryption_factors</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]]],</span>
<span class=linenos data-linenos="39 "></span>        <span class=n>secagg_random</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
<span class=linenos data-linenos="40 "></span>        <span class=n>aggregation_round</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
<span class=linenos data-linenos="41 "></span>        <span class=n>total_sample_size</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
<span class=linenos data-linenos="42 "></span>        <span class=n>training_plan</span><span class=p>:</span> <span class=s1>&#39;BaseTrainingPlan&#39;</span>
<span class=linenos data-linenos="43 "></span><span class=p>):</span>
<span class=linenos data-linenos="44 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot; Apply aggregation for encrypted model parameters</span>
<span class=linenos data-linenos="45 "></span>
<span class=linenos data-linenos="46 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="47 "></span><span class=sd>        params: List containing list of encrypted parameters of each node</span>
<span class=linenos data-linenos="48 "></span><span class=sd>        encryption_factors: List of encrypted integers to validate encryption</span>
<span class=linenos data-linenos="49 "></span><span class=sd>        secagg_random: Randomly generated float value to validate secure aggregation correctness</span>
<span class=linenos data-linenos="50 "></span><span class=sd>        aggregation_round: The round of the aggregation.</span>
<span class=linenos data-linenos="51 "></span><span class=sd>        total_sample_size: Sum of sample sizes used for training</span>
<span class=linenos data-linenos="52 "></span><span class=sd>        training_plan: Training plan instance used for the training.</span>
<span class=linenos data-linenos="53 "></span>
<span class=linenos data-linenos="54 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="55 "></span><span class=sd>        aggregated model parameters</span>
<span class=linenos data-linenos="56 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="57 "></span>
<span class=linenos data-linenos="58 "></span>    <span class=c1># TODO: verify with secagg context number of parties</span>
<span class=linenos data-linenos="59 "></span>    <span class=n>num_nodes</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
<span class=linenos data-linenos="60 "></span>
<span class=linenos data-linenos="61 "></span>    <span class=c1># TODO: Use server key here</span>
<span class=linenos data-linenos="62 "></span>    <span class=n>key</span> <span class=o>=</span> <span class=o>-</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>params</span><span class=p>)</span> <span class=o>*</span> <span class=mi>10</span><span class=p>)</span>
<span class=linenos data-linenos="63 "></span>
<span class=linenos data-linenos="64 "></span>    <span class=c1># IMPORTANT = Keep this key for testing purposes</span>
<span class=linenos data-linenos="65 "></span>    <span class=n>key</span> <span class=o>=</span> <span class=o>-</span><span class=mi>4521514305280526329525552501850970498079782904248225896786295610941010325354834129826500373412436986239012584207113747347251251180530850751209537684586944643780840182990869969844131477709433555348941386442841023261287875379985666260596635843322044109172782411303407030194453287409138194338286254652273563418119335656859169132074431378389356392955315045979603414700450628308979043208779867835835935403213000649039155952076869962677675951924910959437120608553858253906942559260892494214955907017206115207769238347962438107202114814163305602442458693305475834199715587932463252324681290310458316249381037969151400784780</span>
<span class=linenos data-linenos="66 "></span>    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Securely aggregating model parameters...&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="67 "></span>
<span class=linenos data-linenos="68 "></span>    <span class=n>aggregate</span> <span class=o>=</span> <span class=n>functools</span><span class=o>.</span><span class=n>partial</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_secagg_crypter</span><span class=o>.</span><span class=n>aggregate</span><span class=p>,</span>
<span class=linenos data-linenos="69 "></span>                                  <span class=n>current_round</span><span class=o>=</span><span class=n>aggregation_round</span><span class=p>,</span>
<span class=linenos data-linenos="70 "></span>                                  <span class=n>num_nodes</span><span class=o>=</span><span class=n>num_nodes</span><span class=p>,</span>
<span class=linenos data-linenos="71 "></span>                                  <span class=n>key</span><span class=o>=</span><span class=n>key</span><span class=p>,</span>
<span class=linenos data-linenos="72 "></span>                                  <span class=n>total_sample_size</span><span class=o>=</span><span class=n>total_sample_size</span>
<span class=linenos data-linenos="73 "></span>                                  <span class=p>)</span>
<span class=linenos data-linenos="74 "></span>    <span class=c1># Validation</span>
<span class=linenos data-linenos="75 "></span>    <span class=n>encryption_factors</span> <span class=o>=</span> <span class=p>[</span><span class=n>f</span> <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>encryption_factors</span><span class=o>.</span><span class=n>items</span><span class=p>()]</span>
<span class=linenos data-linenos="76 "></span>    <span class=n>validation</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>aggregate</span><span class=p>(</span><span class=n>params</span><span class=o>=</span><span class=n>encryption_factors</span><span class=p>)</span>
<span class=linenos data-linenos="77 "></span>
<span class=linenos data-linenos="78 "></span>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>validation</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>1</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>math</span><span class=o>.</span><span class=n>isclose</span><span class=p>(</span><span class=n>validation</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>secagg_random</span><span class=p>,</span> <span class=n>abs_tol</span><span class=o>=</span><span class=mf>0.01</span><span class=p>):</span>
<span class=linenos data-linenos="79 "></span>        <span class=k>raise</span> <span class=n>FedbiomedAggregatorError</span><span class=p>(</span><span class=s2>&quot;Aggregation is failed due to incorrect decryption.&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="80 "></span>
<span class=linenos data-linenos="81 "></span>    <span class=n>aggregated_params</span> <span class=o>=</span> <span class=n>aggregate</span><span class=p>(</span><span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>)</span>
<span class=linenos data-linenos="82 "></span>
<span class=linenos data-linenos="83 "></span>    <span class=c1># Convert model params</span>
<span class=linenos data-linenos="84 "></span>    <span class=n>model</span> <span class=o>=</span> <span class=n>training_plan</span><span class=o>.</span><span class=n>get_model_wrapper_class</span><span class=p>()</span>
<span class=linenos data-linenos="85 "></span>    <span class=n>model_params</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>unflatten</span><span class=p>(</span><span class=n>aggregated_params</span><span class=p>)</span>
<span class=linenos data-linenos="86 "></span>
<span class=linenos data-linenos="87 "></span>    <span class=k>return</span> <span class=n>model_params</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Aggregator.set_fds class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">set_fds</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>set_fds</span><span class=p>(</span><span class=n>fds</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/aggregator.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="108 "></span><span class=k>def</span><span class=w> </span><span class=nf>set_fds</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>fds</span><span class=p>:</span> <span class=n>FederatedDataSet</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>FederatedDataSet</span><span class=p>:</span>
<span class=linenos data-linenos="109 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_fds</span> <span class=o>=</span> <span class=n>fds</span>
<span class=linenos data-linenos="110 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_fds</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Aggregator.set_training_plan_type class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">set_training_plan_type</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>set_training_plan_type</span><span class=p>(</span><span class=n>training_plan_type</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/aggregator.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="112 "></span><span class=k>def</span><span class=w> </span><span class=nf>set_training_plan_type</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>training_plan_type</span><span class=p>:</span> <span class=n>TrainingPlans</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>TrainingPlans</span><span class=p>:</span>
<span class=linenos data-linenos="113 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_type</span> <span class=o>=</span> <span class=n>training_plan_type</span>
<span class=linenos data-linenos="114 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_type</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fedbiomed.researcher.aggregators.FedAverage class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">FedAverage</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>FedAverage</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fedbiomed.researcher.aggregators.aggregator.Aggregator" href="#fedbiomed.researcher.aggregators.Aggregator">Aggregator</a></code></p> <p>Defines the Federated averaging strategy</p> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/fedavg.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="23 "></span><span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=linenos data-linenos="24 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Construct `FedAverage` object as an instance of [`Aggregator`]</span>
<span class=linenos data-linenos="25 "></span><span class=sd>    [fedbiomed.researcher.aggregators.Aggregator].</span>
<span class=linenos data-linenos="26 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="27 "></span>    <span class=nb>super</span><span class=p>(</span><span class=n>FedAverage</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
<span class=linenos data-linenos="28 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>aggregator_name</span> <span class=o>=</span> <span class=s2>&quot;FedAverage&quot;</span>
</code></pre></div> </details> <div class="doc doc-children"> <h4 id=fedbiomed.researcher.aggregators.FedAverage-attributes>Attributes</h4> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.aggregators.FedAverage.aggregator_name class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">aggregator_name</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=n>aggregator_name</span> <span class=o>=</span> <span class=s1>&#39;FedAverage&#39;</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <h4 id=fedbiomed.researcher.aggregators.FedAverage-functions>Functions</h4> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.FedAverage.aggregate class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">aggregate</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>aggregate</span><span class=p>(</span><span class=n>model_params</span><span class=p>,</span> <span class=n>weights</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Aggregates local models sent by participating nodes into a global model, following Federated Averaging strategy.</p> <p>weights is a list of single-item dictionaries, each dictionary has the node id as key, and the weight as value. model_params is a list of single-item dictionaries, each dictionary has the node is as key, and a framework-specific representation of the model parameters as value.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>model_params</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.Tensor" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor">Tensor</a>, <a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]]]</code> </td> <td> <div class=doc-md-description> <p>contains each model layers</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>weights</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]</code> </td> <td> <div class=doc-md-description> <p>contains all weights of a given layer.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.Tensor" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor">Tensor</a>, <a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]]</code> </td> <td> <div class=doc-md-description> <p>Aggregated parameters</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/fedavg.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="30 "></span><span class=k>def</span><span class=w> </span><span class=nf>aggregate</span><span class=p>(</span>
<span class=linenos data-linenos="31 "></span>        <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="32 "></span>        <span class=n>model_params</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=s1>&#39;torch.Tensor&#39;</span><span class=p>,</span> <span class=s1>&#39;numpy.ndarray&#39;</span><span class=p>]]],</span>
<span class=linenos data-linenos="33 "></span>        <span class=n>weights</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>],</span>
<span class=linenos data-linenos="34 "></span>        <span class=o>*</span><span class=n>args</span><span class=p>,</span>
<span class=linenos data-linenos="35 "></span>        <span class=o>**</span><span class=n>kwargs</span>
<span class=linenos data-linenos="36 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Mapping</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=s1>&#39;torch.Tensor&#39;</span><span class=p>,</span> <span class=s1>&#39;numpy.ndarray&#39;</span><span class=p>]]:</span>
<span class=linenos data-linenos="37 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot; Aggregates  local models sent by participating nodes into a global model, following Federated Averaging</span>
<span class=linenos data-linenos="38 "></span><span class=sd>    strategy.</span>
<span class=linenos data-linenos="39 "></span>
<span class=linenos data-linenos="40 "></span><span class=sd>    weights is a list of single-item dictionaries, each dictionary has the node id as key, and the weight as value.</span>
<span class=linenos data-linenos="41 "></span><span class=sd>    model_params is a list of single-item dictionaries, each dictionary has the node is as key,</span>
<span class=linenos data-linenos="42 "></span><span class=sd>    and a framework-specific representation of the model parameters as value.</span>
<span class=linenos data-linenos="43 "></span>
<span class=linenos data-linenos="44 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="45 "></span><span class=sd>        model_params: contains each model layers</span>
<span class=linenos data-linenos="46 "></span><span class=sd>        weights: contains all weights of a given layer.</span>
<span class=linenos data-linenos="47 "></span>
<span class=linenos data-linenos="48 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="49 "></span><span class=sd>        Aggregated parameters</span>
<span class=linenos data-linenos="50 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="51 "></span>
<span class=linenos data-linenos="52 "></span>    <span class=n>model_params_processed</span> <span class=o>=</span> <span class=p>[]</span>
<span class=linenos data-linenos="53 "></span>    <span class=n>weights_processed</span> <span class=o>=</span> <span class=p>[]</span>
<span class=linenos data-linenos="54 "></span>
<span class=linenos data-linenos="55 "></span>    <span class=k>for</span> <span class=n>node_id</span><span class=p>,</span> <span class=n>params</span> <span class=ow>in</span> <span class=n>model_params</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<span class=linenos data-linenos="56 "></span>
<span class=linenos data-linenos="57 "></span>        <span class=k>if</span> <span class=n>node_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>weights</span><span class=p>:</span>
<span class=linenos data-linenos="58 "></span>            <span class=k>raise</span> <span class=n>FedbiomedAggregatorError</span><span class=p>(</span>
<span class=linenos data-linenos="59 "></span>                <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB401</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>. Can not find corresponding calculated weight for the &quot;</span>
<span class=linenos data-linenos="60 "></span>                <span class=sa>f</span><span class=s2>&quot;node </span><span class=si>{</span><span class=n>node_id</span><span class=si>}</span><span class=s2>. Aggregation is aborted.&quot;</span>
<span class=linenos data-linenos="61 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="62 "></span>
<span class=linenos data-linenos="63 "></span>        <span class=n>weight</span> <span class=o>=</span> <span class=n>weights</span><span class=p>[</span><span class=n>node_id</span><span class=p>]</span>
<span class=linenos data-linenos="64 "></span>        <span class=n>model_params_processed</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
<span class=linenos data-linenos="65 "></span>        <span class=n>weights_processed</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>weight</span><span class=p>)</span>
<span class=linenos data-linenos="66 "></span>
<span class=linenos data-linenos="67 "></span>    <span class=k>if</span> <span class=nb>any</span><span class=p>([</span><span class=n>x</span> <span class=o>&lt;</span> <span class=mf>0.</span> <span class=ow>or</span> <span class=n>x</span> <span class=o>&gt;</span> <span class=mf>1.</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>weights_processed</span><span class=p>])</span> <span class=ow>or</span> <span class=nb>sum</span><span class=p>(</span><span class=n>weights_processed</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
<span class=linenos data-linenos="68 "></span>        <span class=k>raise</span> <span class=n>FedbiomedAggregatorError</span><span class=p>(</span>
<span class=linenos data-linenos="69 "></span>            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB401</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>. Aggregation aborted due to sum of the weights is equal to 0 </span><span class=si>{</span><span class=n>weights</span><span class=si>}</span><span class=s2>. &quot;</span>
<span class=linenos data-linenos="70 "></span>            <span class=sa>f</span><span class=s2>&quot;Sample sizes received from nodes might be corrupted.&quot;</span>
<span class=linenos data-linenos="71 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="72 "></span>
<span class=linenos data-linenos="73 "></span>    <span class=n>agg_params</span> <span class=o>=</span> <span class=n>federated_averaging</span><span class=p>(</span><span class=n>model_params_processed</span><span class=p>,</span> <span class=n>weights_processed</span><span class=p>)</span>
<span class=linenos data-linenos="74 "></span>
<span class=linenos data-linenos="75 "></span>    <span class=k>return</span> <span class=n>agg_params</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fedbiomed.researcher.aggregators.Scaffold class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">Scaffold</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>Scaffold</span><span class=p>(</span><span class=n>server_lr</span><span class=o>=</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>fds</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fedbiomed.researcher.aggregators.aggregator.Aggregator" href="#fedbiomed.researcher.aggregators.Aggregator">Aggregator</a></code></p> <p>Defines the Scaffold strategy</p> <p>Despite being an algorithm of choice for federated learning, it is observed that FedAvg suffers from <code>client-drift</code> when the data is heterogeneous (non-iid), resulting in unstable and slow convergence. SCAFFOLD uses control variates (variance reduction) to correct for the <code>client-drift</code> in its local updates. Intuitively, SCAFFOLD estimates the update direction for the server model (c) and the update direction for each client (c_i). The difference (c - c_i) is then an estimate of the client-drift which is used to correct the local update.</p> <h5 id=fedbiomed.researcher.aggregators.Scaffold--fed-biomed-implementation-details>Fed-BioMed implementation details</h5> <p>Our implementation is heavily influenced by our design choice to prevent storing any state on the nodes between FL rounds. In particular, this means that the computation of the control variates (i.e. the correction states) needs to be performed centrally by the aggregator. Roughly, our implementation follows these steps (following the notation of the original Scaffold <a href=https://arxiv.org/abs/1910.06378>paper</a>):</p> <ol> <li>let <span class=arithmatex>\(\delta_i = \mathbf{c}_i - \mathbf{c} \)</span></li> <li>foreach(round):</li> <li>sample <span class=arithmatex>\( S \)</span> nodes participating in this round out of <span class=arithmatex>\( N \)</span> total</li> <li>the server communicates the global model <span class=arithmatex>\( \mathbf{x} \)</span> and the correction states <span class=arithmatex>\( \delta_i \)</span> to all clients</li> <li>parallel on each client</li> <li>initialize local model <span class=arithmatex>\( \mathbf{y}_i = \mathbf{x} \)</span></li> <li>foreach(update) until K updates have been performed</li> <li>obtain a data batch</li> <li>compute the gradients for this batch <span class=arithmatex>\( g(\mathbf{y}_i) \)</span></li> <li>apply correction term to gradients <span class=arithmatex>\( g(\mathbf{y}_i) -= \delta_i \)</span></li> <li>update model with one optimizer step e.g. for SGD <span class=arithmatex>\( \mathbf{y}_i -= \eta_i g(\mathbf{y}_i) \)</span></li> <li>end foreach(update)</li> <li>communicate updated model <span class=arithmatex>\( \mathbf{y}_i \)</span> and learning rate <span class=arithmatex>\( \eta_i \)</span></li> <li>end parallel section on each client</li> <li>the server computes the node-wise model update <span class=arithmatex>\( \mathbf{\Delta y}_i = \mathbf{x} - \mathbf{y}_i \)</span></li> <li>the server updates the node-wise states <span class=arithmatex>\( \mathbf{c}_i = \delta_i + (\mathbf{\Delta y}_i) / (\eta_i K) \)</span></li> <li>the server updates the global state <span class=arithmatex>\( \mathbf{c} = (1/N) \sum_{i \in N} \mathbf{c}_i \)</span></li> <li>the server updates the node-wise correction state <span class=arithmatex>\(\delta_i = \mathbf{c}_i - \mathbf{c} \)</span></li> <li>the server updates the global model by averaging <span class=arithmatex>\( \mathbf{x} = \mathbf{x} - (\eta/|S|) \sum_{i \in S} \mathbf{\Delta y}_i \)</span></li> <li>end foreach(round)</li> </ol> <p>This <a href=http://www.plantuml.com/plantuml/dsvg/xLRDJjmm4BxxAUR82fPbWOe2guYsKYyhSQ6SgghosXDYuTYMFIbjdxxE3r7MIac3UkH4i6Vy_SpCsZU1kAUgrApvOEofK1hX8BSUkIZ0syf88506riV7NnQCNGLUkXXojmcLosYpgl-0YybAACT9cGSmLc80Mn7O7BZMSDikNSTqOSkoCafmGdZGTiSrb75F0pUoYLe6XqBbIe2mtgCWPGqG-f9jTjdc_l3axEFxRBEAtmC2Hz3kdDUhkqpLg_iH4JlNzfaV8MZCwMeo3IJcog047Y3YYmvuF7RPXmoN8x3rZr6wCef0Mz5B7WXwyTmOTBg-FCcIX4HVMhlAoThanwvusqNhlgjgvpsN2Wr130OgL80T9r4qIASd5zaaiwF77lQAEwT_fTK2iZrAO7FEJJNFJbr27tl-eh4r-SwbjY1FYWgm1i4wKgNwZHu2eGFs3-27wvJv7CPjuCLUq6kAWKPsRS1pGW_RhWt28fczN9czqTF8lQc7myVTQRslKRljKYBSgDxhTbA0Ft1btkPbwjotUNcRbqY_krm-TPrA1RRNw9CA-2o6DUcNvzd_u9bUU9C7zhrpNxCPq1lCGAWj5BCuJVSh7C9iuQk3CQjXknW8eA9_koHJF50nplnWlRfTD0WVpZg4vh_FxxBR5ch_X57pGA8c7jY43MFuKoudhvYqWdL3fI-tfFbVsKYzxQkxl_XprxATLz69br_40nMQWWRqFz1_rvunjlnQA2dHV5jc340YSL54zMXa-o8U_72y58i_7NfLeg5h5iWwTXDNgrB_0G00>diagram</a> provides a visual representation of the algorithm.</p> <p>References:</p> <ul> <li><a href=https://arxiv.org/abs/1910.06378>Scaffold: Stochastic Controlled Averaging for Federated Learning</a></li> <li><a href=https://arxiv.org/pdf/2207.06343.pdf>TCT: Convexifying Federated Learning using Bootstrapped Neural Tangent Kernels</a></li> </ul> <p><span class=doc-section-title>Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.researcher.aggregators.Scaffold.aggregator_name" href="#fedbiomed.researcher.aggregators.Scaffold.aggregator_name">aggregator_name</a></code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>name of the aggregator</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.researcher.aggregators.Scaffold.server_lr" href="#fedbiomed.researcher.aggregators.Scaffold.server_lr">server_lr</a></code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code> </td> <td> <div class=doc-md-description> <p>value of the server learning rate</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.researcher.aggregators.Scaffold.global_state" href="#fedbiomed.researcher.aggregators.Scaffold.global_state">global_state</a></code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.Tensor" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor">Tensor</a>, <a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]]</code> </td> <td> <div class=doc-md-description> <p>a dictionary representing the global correction state <span class=arithmatex>\( \mathbf{c} \)</span> in the format {parameter name: correction value}</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.researcher.aggregators.Scaffold.nodes_states" href="#fedbiomed.researcher.aggregators.Scaffold.nodes_states">nodes_states</a></code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.Tensor" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor">Tensor</a>, <a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]]]</code> </td> <td> <div class=doc-md-description> <p>a nested dictionary of correction parameters obtained for each client, in the format {node id: node-wise corrections}. The node-wise corrections are a dictionary in the format {parameter name: correction value} where the model parameters are those contained in each node's model.named_parameters().</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.researcher.aggregators.Scaffold.nodes_deltas" href="#fedbiomed.researcher.aggregators.Scaffold.nodes_deltas">nodes_deltas</a></code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.Tensor" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor">Tensor</a>, <a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]]]</code> </td> <td> <div class=doc-md-description> <p>a nested dictionary of deltas for each client, in the same format as nodes_states. The deltas are defined as <span class=arithmatex>\(\delta_i = \mathbf{c}_i - \mathbf{c} \)</span></p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.researcher.aggregators.Scaffold.nodes_lr" href="#fedbiomed.researcher.aggregators.Scaffold.nodes_lr">nodes_lr</a></code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]]</code> </td> <td> <div class=doc-md-description> <p>dictionary of learning rates observed at end of the latest round, in the format {node id: learning rate}</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>server_lr</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code> </td> <td> <div class=doc-md-description> <p>server's (or Researcher's) learning rate. Defaults to 1..</p> </div> </td> <td> <code>1.0</code> </td> </tr> <tr class=doc-section-item> <td><code>fds</code></td> <td> <code>FederatedDataset</code> </td> <td> <div class=doc-md-description> <p>FederatedDataset obtained after a <code>search</code> request. Defaults to None.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/scaffold.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos=" 91 "></span><span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>server_lr</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>1.</span><span class=p>,</span> <span class=n>fds</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>FederatedDataSet</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
<span class=linenos data-linenos=" 92 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Constructs `Scaffold` object as an instance of [`Aggregator`]</span>
<span class=linenos data-linenos=" 93 "></span><span class=sd>    [fedbiomed.researcher.aggregators.Aggregator].</span>
<span class=linenos data-linenos=" 94 "></span>
<span class=linenos data-linenos=" 95 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos=" 96 "></span><span class=sd>        server_lr (float): server&#39;s (or Researcher&#39;s) learning rate. Defaults to 1..</span>
<span class=linenos data-linenos=" 97 "></span><span class=sd>        fds (FederatedDataset, optional): FederatedDataset obtained after a `search` request. Defaults to None.</span>
<span class=linenos data-linenos=" 98 "></span>
<span class=linenos data-linenos=" 99 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="100 "></span>    <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
<span class=linenos data-linenos="101 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>aggregator_name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;Scaffold&quot;</span>
<span class=linenos data-linenos="102 "></span>    <span class=k>if</span> <span class=n>server_lr</span> <span class=o>==</span> <span class=mf>0.</span><span class=p>:</span>
<span class=linenos data-linenos="103 "></span>        <span class=k>raise</span> <span class=n>FedbiomedAggregatorError</span><span class=p>(</span><span class=s2>&quot;SCAFFOLD Error: Server learning rate cannot be equal to 0&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="104 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>server_lr</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>server_lr</span>
<span class=linenos data-linenos="105 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>global_state</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{}</span>
<span class=linenos data-linenos="106 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>nodes_states</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]]]</span> <span class=o>=</span> <span class=p>{}</span>
<span class=linenos data-linenos="107 "></span>    <span class=c1># FIXME: `nodes_states` is mis-named, because can conflict with `node_state`s that are saved </span>
<span class=linenos data-linenos="108 "></span>    <span class=c1># whitin 2 Rounds</span>
<span class=linenos data-linenos="109 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>nodes_deltas</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]]]</span> <span class=o>=</span> <span class=p>{}</span>
<span class=linenos data-linenos="110 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>nodes_lr</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{}</span>
<span class=linenos data-linenos="111 "></span>    <span class=k>if</span> <span class=n>fds</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="112 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>set_fds</span><span class=p>(</span><span class=n>fds</span><span class=p>)</span>
<span class=linenos data-linenos="113 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># we need `_aggregator_args` to be not None</span>
</code></pre></div> </details> <div class="doc doc-children"> <h4 id=fedbiomed.researcher.aggregators.Scaffold-attributes>Attributes</h4> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.aggregators.Scaffold.aggregator_name class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">aggregator_name</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=n>aggregator_name</span> <span class=o>=</span> <span class=s1>&#39;Scaffold&#39;</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.aggregators.Scaffold.global_state class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">global_state</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=n>global_state</span> <span class=o>=</span> <span class=p>{}</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.aggregators.Scaffold.nodes_deltas class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">nodes_deltas</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=n>nodes_deltas</span> <span class=o>=</span> <span class=p>{}</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.aggregators.Scaffold.nodes_lr class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">nodes_lr</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=n>nodes_lr</span> <span class=o>=</span> <span class=p>{}</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.aggregators.Scaffold.nodes_states class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">nodes_states</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=n>nodes_states</span> <span class=o>=</span> <span class=p>{}</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.aggregators.Scaffold.server_lr class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">server_lr</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=n>server_lr</span> <span class=o>=</span> <span class=n>server_lr</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <h4 id=fedbiomed.researcher.aggregators.Scaffold-functions>Functions</h4> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Scaffold.aggregate class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">aggregate</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>aggregate</span><span class=p>(</span><span class=n>model_params</span><span class=p>,</span> <span class=n>weights</span><span class=p>,</span> <span class=n>global_model</span><span class=p>,</span> <span class=n>training_plan</span><span class=p>,</span> <span class=n>training_replies</span><span class=p>,</span> <span class=n>n_updates</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>n_round</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Aggregates local models coming from nodes into a global model, using SCAFFOLD algorithm (2nd option) [Scaffold: Stochastic Controlled Averaging for Federated Learning][https://arxiv.org/abs/1910.06378]</p> <h6 id=fedbiomed.researcher.aggregators.Scaffold.aggregate--performed-computations>Performed computations:</h6> <ul> <li>Compute participating nodes' model update:<ul> <li>update_i = y_i - x</li> </ul> </li> <li>Compute aggregated model parameters:<ul> <li>x(+) = x - eta_g sum_S(update_i)</li> </ul> </li> <li>Update participating nodes' state:<ul> <li>c_i = delta_i + 1/(K*eta_i) * update_i</li> </ul> </li> <li>Update the global state and all nodes' correction state:<ul> <li>c = 1/N sum_{i=1}^n c_i</li> <li>delta_i = (c_i - c)</li> </ul> </li> </ul> <p>where, according to paper notations c_i: local state variable for node <code>i</code> c: global state variable delta_i: (c_i - c), correction state for node <code>i</code> eta_g: server's learning rate eta_i: node i's learning rate N: total number of node participating to federated learning S: number of nodes considered during current round (S&lt;=N) K: number of updates done during the round (ie number of data batches). x: global model parameters y_i: node i 's local model parameters at the end of the round</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>model_params</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></code> </td> <td> <div class=doc-md-description> <p>list of models parameters received from nodes</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>weights</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]</code> </td> <td> <div class=doc-md-description> <p>weights depicting sample proportions available on each node. Unused for Scaffold.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>global_model</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.Tensor" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor">Tensor</a>, <a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]]</code> </td> <td> <div class=doc-md-description> <p>global model, ie aggregated model</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>training_plan</code></td> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans.BaseTrainingPlan" href="../../common/training_plans/#fedbiomed.common.training_plans.BaseTrainingPlan">BaseTrainingPlan</a></code> </td> <td> <div class=doc-md-description> <p>instance of TrainingPlan</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>training_replies</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></code> </td> <td> <div class=doc-md-description> <p>Training replies from each node that participates in the current round</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>n_updates</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>number of updates (number of batch performed). Defaults to 1.</p> </div> </td> <td> <code>1</code> </td> </tr> <tr class=doc-section-item> <td><code>n_round</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>current round. Defaults to 0.</p> </div> </td> <td> <code>0</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></code> </td> <td> <div class=doc-md-description> <p>Aggregated parameters, as a dict mapping weight names and values.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedAggregatorError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedAggregatorError">FedbiomedAggregatorError</a></code> </td> <td> <div class=doc-md-description> <p>If no FederatedDataset is attached to this Scaffold instance, or if <code>node_ids</code> do not belong to the dataset attached to it.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/scaffold.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="115 "></span><span class=k>def</span><span class=w> </span><span class=nf>aggregate</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="116 "></span>              <span class=n>model_params</span><span class=p>:</span> <span class=n>Dict</span><span class=p>,</span>
<span class=linenos data-linenos="117 "></span>              <span class=n>weights</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>],</span>
<span class=linenos data-linenos="118 "></span>              <span class=n>global_model</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]],</span>
<span class=linenos data-linenos="119 "></span>              <span class=n>training_plan</span><span class=p>:</span> <span class=n>BaseTrainingPlan</span><span class=p>,</span>
<span class=linenos data-linenos="120 "></span>              <span class=n>training_replies</span><span class=p>:</span> <span class=n>Dict</span><span class=p>,</span>
<span class=linenos data-linenos="121 "></span>              <span class=n>n_updates</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
<span class=linenos data-linenos="122 "></span>              <span class=n>n_round</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
<span class=linenos data-linenos="123 "></span>              <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
<span class=linenos data-linenos="124 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=linenos data-linenos="125 "></span><span class=sd>    Aggregates local models coming from nodes into a global model, using SCAFFOLD algorithm (2nd option)</span>
<span class=linenos data-linenos="126 "></span><span class=sd>    [Scaffold: Stochastic Controlled Averaging for Federated Learning][https://arxiv.org/abs/1910.06378]</span>
<span class=linenos data-linenos="127 "></span>
<span class=linenos data-linenos="128 "></span><span class=sd>    Performed computations:</span>
<span class=linenos data-linenos="129 "></span><span class=sd>    -----------------------</span>
<span class=linenos data-linenos="130 "></span>
<span class=linenos data-linenos="131 "></span><span class=sd>    - Compute participating nodes&#39; model update:</span>
<span class=linenos data-linenos="132 "></span><span class=sd>        * update_i = y_i - x</span>
<span class=linenos data-linenos="133 "></span><span class=sd>    - Compute aggregated model parameters:</span>
<span class=linenos data-linenos="134 "></span><span class=sd>        * x(+) = x - eta_g sum_S(update_i)</span>
<span class=linenos data-linenos="135 "></span><span class=sd>    - Update participating nodes&#39; state:</span>
<span class=linenos data-linenos="136 "></span><span class=sd>        * c_i = delta_i + 1/(K*eta_i) * update_i</span>
<span class=linenos data-linenos="137 "></span><span class=sd>    - Update the global state and all nodes&#39; correction state:</span>
<span class=linenos data-linenos="138 "></span><span class=sd>        * c = 1/N sum_{i=1}^n c_i</span>
<span class=linenos data-linenos="139 "></span><span class=sd>        * delta_i = (c_i - c)</span>
<span class=linenos data-linenos="140 "></span>
<span class=linenos data-linenos="141 "></span><span class=sd>    where, according to paper notations</span>
<span class=linenos data-linenos="142 "></span><span class=sd>        c_i: local state variable for node `i`</span>
<span class=linenos data-linenos="143 "></span><span class=sd>        c: global state variable</span>
<span class=linenos data-linenos="144 "></span><span class=sd>        delta_i: (c_i - c), correction state for node `i`</span>
<span class=linenos data-linenos="145 "></span><span class=sd>        eta_g: server&#39;s learning rate</span>
<span class=linenos data-linenos="146 "></span><span class=sd>        eta_i: node i&#39;s learning rate</span>
<span class=linenos data-linenos="147 "></span><span class=sd>        N: total number of node participating to federated learning</span>
<span class=linenos data-linenos="148 "></span><span class=sd>        S: number of nodes considered during current round (S&lt;=N)</span>
<span class=linenos data-linenos="149 "></span><span class=sd>        K: number of updates done during the round (ie number of data batches).</span>
<span class=linenos data-linenos="150 "></span><span class=sd>        x: global model parameters</span>
<span class=linenos data-linenos="151 "></span><span class=sd>        y_i: node i &#39;s local model parameters at the end of the round</span>
<span class=linenos data-linenos="152 "></span>
<span class=linenos data-linenos="153 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="154 "></span><span class=sd>        model_params: list of models parameters received from nodes</span>
<span class=linenos data-linenos="155 "></span><span class=sd>        weights: weights depicting sample proportions available</span>
<span class=linenos data-linenos="156 "></span><span class=sd>            on each node. Unused for Scaffold.</span>
<span class=linenos data-linenos="157 "></span><span class=sd>        global_model: global model, ie aggregated model</span>
<span class=linenos data-linenos="158 "></span><span class=sd>        training_plan (BaseTrainingPlan): instance of TrainingPlan</span>
<span class=linenos data-linenos="159 "></span><span class=sd>        training_replies: Training replies from each node that participates in the current round</span>
<span class=linenos data-linenos="160 "></span><span class=sd>        n_updates: number of updates (number of batch performed). Defaults to 1.</span>
<span class=linenos data-linenos="161 "></span><span class=sd>        n_round: current round. Defaults to 0.</span>
<span class=linenos data-linenos="162 "></span>
<span class=linenos data-linenos="163 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="164 "></span><span class=sd>        Aggregated parameters, as a dict mapping weight names and values.</span>
<span class=linenos data-linenos="165 "></span>
<span class=linenos data-linenos="166 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="167 "></span><span class=sd>        FedbiomedAggregatorError: If no FederatedDataset is attached to this</span>
<span class=linenos data-linenos="168 "></span><span class=sd>            Scaffold instance, or if `node_ids` do not belong to the dataset</span>
<span class=linenos data-linenos="169 "></span><span class=sd>            attached to it.</span>
<span class=linenos data-linenos="170 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="171 "></span>    <span class=c1># Gather the learning rates used by nodes, updating `self.nodes_lr`.</span>
<span class=linenos data-linenos="172 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>set_nodes_learning_rate_after_training</span><span class=p>(</span><span class=n>training_plan</span><span class=p>,</span> <span class=n>training_replies</span><span class=p>)</span>
<span class=linenos data-linenos="173 "></span>    <span class=c1># At round 0, initialize zero-valued correction states.</span>
<span class=linenos data-linenos="174 "></span>    <span class=k>if</span> <span class=n>n_round</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
<span class=linenos data-linenos="175 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>init_correction_states</span><span class=p>(</span><span class=n>global_model</span><span class=p>)</span>
<span class=linenos data-linenos="176 "></span>    <span class=c1># Check that the input node_ids match known ones.</span>
<span class=linenos data-linenos="177 "></span>    <span class=k>if</span> <span class=ow>not</span> <span class=nb>set</span><span class=p>(</span><span class=n>model_params</span><span class=p>)</span><span class=o>.</span><span class=n>issubset</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_fds</span><span class=o>.</span><span class=n>node_ids</span><span class=p>()):</span>
<span class=linenos data-linenos="178 "></span>        <span class=k>raise</span> <span class=n>FedbiomedAggregatorError</span><span class=p>(</span>
<span class=linenos data-linenos="179 "></span>            <span class=s2>&quot;Received updates from nodes that are unknown to this aggregator.&quot;</span>
<span class=linenos data-linenos="180 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="181 "></span>    <span class=c1># Compute the node-wise model update: (x^t - y_i^t).</span>
<span class=linenos data-linenos="182 "></span>    <span class=n>model_updates</span> <span class=o>=</span> <span class=p>{</span>
<span class=linenos data-linenos="183 "></span>        <span class=n>node_id</span><span class=p>:</span> <span class=p>{</span>
<span class=linenos data-linenos="184 "></span>            <span class=n>key</span><span class=p>:</span> <span class=p>(</span><span class=n>global_model</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>-</span> <span class=n>local_value</span><span class=p>)</span>
<span class=linenos data-linenos="185 "></span>            <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>local_value</span> <span class=ow>in</span> <span class=n>params</span><span class=o>.</span><span class=n>items</span><span class=p>()</span>
<span class=linenos data-linenos="186 "></span>        <span class=p>}</span>
<span class=linenos data-linenos="187 "></span>        <span class=k>for</span> <span class=n>node_id</span><span class=p>,</span> <span class=n>params</span> <span class=ow>in</span> <span class=n>model_params</span><span class=o>.</span><span class=n>items</span><span class=p>()</span>
<span class=linenos data-linenos="188 "></span>    <span class=p>}</span>
<span class=linenos data-linenos="189 "></span>    <span class=c1># Update all Scaffold state variables.</span>
<span class=linenos data-linenos="190 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>update_correction_states</span><span class=p>(</span><span class=n>model_updates</span><span class=p>,</span> <span class=n>n_updates</span><span class=p>)</span>
<span class=linenos data-linenos="191 "></span>    <span class=c1># Compute and return the aggregated model parameters.</span>
<span class=linenos data-linenos="192 "></span>    <span class=n>global_new</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># type: Dict[str, Union[torch.Tensor, np.ndarray]]</span>
<span class=linenos data-linenos="193 "></span>    <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>val</span> <span class=ow>in</span> <span class=n>global_model</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<span class=linenos data-linenos="194 "></span>        <span class=n>upd</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>model_updates</span><span class=p>[</span><span class=n>node_id</span><span class=p>][</span><span class=n>key</span><span class=p>]</span> <span class=k>for</span> <span class=n>node_id</span> <span class=ow>in</span> <span class=n>model_params</span><span class=p>)</span>
<span class=linenos data-linenos="195 "></span>        <span class=n>global_new</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>val</span> <span class=o>-</span> <span class=n>upd</span> <span class=o>*</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>server_lr</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>model_params</span><span class=p>))</span>
<span class=linenos data-linenos="196 "></span>    <span class=k>return</span> <span class=n>global_new</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Scaffold.check_values class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">check_values</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>check_values</span><span class=p>(</span><span class=n>n_updates</span><span class=p>,</span> <span class=n>training_plan</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Check if all values/parameters are correct and have been set before using aggregator.</p> <p>Raise an error otherwise.</p> <p>This can prove useful if user has set wrong hyperparameter values, so that user will have errors before performing first round of training</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>n_updates</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>number of updates. Must be non-zero and an integer.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>training_plan</code></td> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans.BaseTrainingPlan" href="../../common/training_plans/#fedbiomed.common.training_plans.BaseTrainingPlan">BaseTrainingPlan</a></code> </td> <td> <div class=doc-md-description> <p>training plan. used for checking if optimizer is SGD, otherwise, triggers warning.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedAggregatorError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedAggregatorError">FedbiomedAggregatorError</a></code> </td> <td> <div class=doc-md-description> <p>triggered if <code>num_updates</code> entry is missing (needed for Scaffold aggregator)</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedAggregatorError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedAggregatorError">FedbiomedAggregatorError</a></code> </td> <td> <div class=doc-md-description> <p>triggered if any of the learning rate(s) equals 0</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedAggregatorError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedAggregatorError">FedbiomedAggregatorError</a></code> </td> <td> <div class=doc-md-description> <p>triggered if number of updates equals 0 or is not an integer</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedAggregatorError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedAggregatorError">FedbiomedAggregatorError</a></code> </td> <td> <div class=doc-md-description> <p>triggered if [FederatedDataset][fedbiomed.researcher.datasets.FederatedDataset] has not been set.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/scaffold.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="314 "></span><span class=k>def</span><span class=w> </span><span class=nf>check_values</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>n_updates</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>training_plan</span><span class=p>:</span> <span class=n>BaseTrainingPlan</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>True</span><span class=p>:</span>
<span class=linenos data-linenos="315 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Check if all values/parameters are correct and have been set before using aggregator.</span>
<span class=linenos data-linenos="316 "></span>
<span class=linenos data-linenos="317 "></span><span class=sd>    Raise an error otherwise.</span>
<span class=linenos data-linenos="318 "></span>
<span class=linenos data-linenos="319 "></span><span class=sd>    This can prove useful if user has set wrong hyperparameter values, so that user will</span>
<span class=linenos data-linenos="320 "></span><span class=sd>    have errors before performing first round of training</span>
<span class=linenos data-linenos="321 "></span>
<span class=linenos data-linenos="322 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="323 "></span><span class=sd>        n_updates: number of updates. Must be non-zero and an integer.</span>
<span class=linenos data-linenos="324 "></span><span class=sd>        training_plan: training plan. used for checking if optimizer is SGD, otherwise,</span>
<span class=linenos data-linenos="325 "></span><span class=sd>            triggers warning.</span>
<span class=linenos data-linenos="326 "></span>
<span class=linenos data-linenos="327 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="328 "></span><span class=sd>        FedbiomedAggregatorError: triggered if `num_updates` entry is missing (needed for Scaffold aggregator)</span>
<span class=linenos data-linenos="329 "></span><span class=sd>        FedbiomedAggregatorError: triggered if any of the learning rate(s) equals 0</span>
<span class=linenos data-linenos="330 "></span><span class=sd>        FedbiomedAggregatorError: triggered if number of updates equals 0 or is not an integer</span>
<span class=linenos data-linenos="331 "></span><span class=sd>        FedbiomedAggregatorError: triggered if [FederatedDataset][fedbiomed.researcher.datasets.FederatedDataset]</span>
<span class=linenos data-linenos="332 "></span><span class=sd>            has not been set.</span>
<span class=linenos data-linenos="333 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="334 "></span>    <span class=k>if</span> <span class=n>n_updates</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="335 "></span>        <span class=k>raise</span> <span class=n>FedbiomedAggregatorError</span><span class=p>(</span><span class=s2>&quot;Cannot perform Scaffold: missing &#39;num_updates&#39; entry in the training_args&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="336 "></span>    <span class=k>elif</span> <span class=n>n_updates</span> <span class=o>&lt;=</span> <span class=mi>0</span> <span class=ow>or</span> <span class=nb>int</span><span class=p>(</span><span class=n>n_updates</span><span class=p>)</span> <span class=o>!=</span> <span class=nb>float</span><span class=p>(</span><span class=n>n_updates</span><span class=p>):</span>
<span class=linenos data-linenos="337 "></span>        <span class=k>raise</span> <span class=n>FedbiomedAggregatorError</span><span class=p>(</span>
<span class=linenos data-linenos="338 "></span>            <span class=s2>&quot;n_updates should be a positive non zero integer, but got &quot;</span>
<span class=linenos data-linenos="339 "></span>            <span class=sa>f</span><span class=s2>&quot;n_updates: </span><span class=si>{</span><span class=n>n_updates</span><span class=si>}</span><span class=s2> in SCAFFOLD aggregator&quot;</span>
<span class=linenos data-linenos="340 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="341 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_fds</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="342 "></span>        <span class=k>raise</span> <span class=n>FedbiomedAggregatorError</span><span class=p>(</span>
<span class=linenos data-linenos="343 "></span>            <span class=s2>&quot;Federated Dataset not provided, but needed for Scaffold. Please use setter `set_fds()`.&quot;</span>
<span class=linenos data-linenos="344 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="345 "></span>
<span class=linenos data-linenos="346 "></span>    <span class=k>return</span> <span class=kc>True</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Scaffold.create_aggregator_args class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">create_aggregator_args</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>create_aggregator_args</span><span class=p>(</span><span class=n>global_model</span><span class=p>,</span> <span class=n>node_ids</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Return correction states that are to be sent to the nodes.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>global_model</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.Tensor" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor">Tensor</a>, <a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]]</code> </td> <td> <div class=doc-md-description> <p>parameters of the global model, formatted as a dict mapping weight tensors to their names.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>node_ids</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Collection" href="https://docs.python.org/3/library/typing.html#typing.Collection">Collection</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code> </td> <td> <div class=doc-md-description> <p>identifiers of the nodes that are to receive messages.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]]</code> </td> <td> <div class=doc-md-description> <p>Aggregator arguments to share with the nodes for the next round</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/scaffold.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="275 "></span><span class=k>def</span><span class=w> </span><span class=nf>create_aggregator_args</span><span class=p>(</span>
<span class=linenos data-linenos="276 "></span>    <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="277 "></span>    <span class=n>global_model</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]],</span>
<span class=linenos data-linenos="278 "></span>    <span class=n>node_ids</span><span class=p>:</span> <span class=n>Collection</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
<span class=linenos data-linenos="279 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<span class=linenos data-linenos="280 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Return correction states that are to be sent to the nodes.</span>
<span class=linenos data-linenos="281 "></span>
<span class=linenos data-linenos="282 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="283 "></span><span class=sd>        global_model: parameters of the global model, formatted as a dict</span>
<span class=linenos data-linenos="284 "></span><span class=sd>            mapping weight tensors to their names.</span>
<span class=linenos data-linenos="285 "></span><span class=sd>        node_ids: identifiers of the nodes that are to receive messages.</span>
<span class=linenos data-linenos="286 "></span>
<span class=linenos data-linenos="287 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="288 "></span><span class=sd>        Aggregator arguments to share with the nodes for the next round</span>
<span class=linenos data-linenos="289 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="290 "></span>    <span class=c1># Optionally initialize states, and verify that nodes are known.</span>
<span class=linenos data-linenos="291 "></span>    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>nodes_deltas</span><span class=p>:</span>
<span class=linenos data-linenos="292 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>init_correction_states</span><span class=p>(</span><span class=n>global_model</span><span class=p>)</span>
<span class=linenos data-linenos="293 "></span>    <span class=k>if</span> <span class=ow>not</span> <span class=nb>set</span><span class=p>(</span><span class=n>node_ids</span><span class=p>)</span><span class=o>.</span><span class=n>issubset</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_fds</span><span class=o>.</span><span class=n>node_ids</span><span class=p>()):</span>
<span class=linenos data-linenos="294 "></span>        <span class=k>raise</span> <span class=n>FedbiomedAggregatorError</span><span class=p>(</span>
<span class=linenos data-linenos="295 "></span>            <span class=s2>&quot;Scaffold cannot create aggregator args for nodes that are not&quot;</span>
<span class=linenos data-linenos="296 "></span>            <span class=s2>&quot;covered by its attached FederatedDataset.&quot;</span>
<span class=linenos data-linenos="297 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="298 "></span>
<span class=linenos data-linenos="299 "></span>    <span class=n>aggregator_dat</span> <span class=o>=</span> <span class=p>{}</span>
<span class=linenos data-linenos="300 "></span>    <span class=k>for</span> <span class=n>node_id</span> <span class=ow>in</span> <span class=n>node_ids</span><span class=p>:</span>
<span class=linenos data-linenos="301 "></span>        <span class=c1># If a node was late-added to the FederatedDataset, create states.</span>
<span class=linenos data-linenos="302 "></span>        <span class=k>if</span> <span class=n>node_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>nodes_deltas</span><span class=p>:</span>
<span class=linenos data-linenos="303 "></span>            <span class=n>zeros</span> <span class=o>=</span> <span class=p>{</span><span class=n>key</span><span class=p>:</span> <span class=n>initialize</span><span class=p>(</span><span class=n>val</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>val</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>global_state</span><span class=o>.</span><span class=n>items</span><span class=p>()}</span>
<span class=linenos data-linenos="304 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>nodes_deltas</span><span class=p>[</span><span class=n>node_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>zeros</span>
<span class=linenos data-linenos="305 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>nodes_states</span><span class=p>[</span><span class=n>node_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>zeros</span><span class=p>)</span>
<span class=linenos data-linenos="306 "></span>        <span class=c1># Add information for the current node to the message dicts.</span>
<span class=linenos data-linenos="307 "></span>        <span class=n>aggregator_dat</span><span class=p>[</span><span class=n>node_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
<span class=linenos data-linenos="308 "></span>            <span class=s1>&#39;aggregator_name&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>aggregator_name</span><span class=p>,</span>
<span class=linenos data-linenos="309 "></span>            <span class=s1>&#39;aggregator_correction&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>nodes_deltas</span><span class=p>[</span><span class=n>node_id</span><span class=p>]</span>
<span class=linenos data-linenos="310 "></span>        <span class=p>}</span>
<span class=linenos data-linenos="311 "></span>
<span class=linenos data-linenos="312 "></span>    <span class=k>return</span> <span class=n>aggregator_dat</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Scaffold.init_correction_states class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">init_correction_states</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>init_correction_states</span><span class=p>(</span><span class=n>global_model</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Initialize Scaffold state variables.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>global_model</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.Tensor" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor">Tensor</a>, <a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]]</code> </td> <td> <div class=doc-md-description> <p>parameters of the global model, formatted as a dict mapping weight tensors to their names.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedAggregatorError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedAggregatorError">FedbiomedAggregatorError</a></code> </td> <td> <div class=doc-md-description> <p>if no FederatedDataset is attached to this aggregator.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/scaffold.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="198 "></span><span class=k>def</span><span class=w> </span><span class=nf>init_correction_states</span><span class=p>(</span>
<span class=linenos data-linenos="199 "></span>    <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="200 "></span>    <span class=n>global_model</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]],</span>
<span class=linenos data-linenos="201 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="202 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Initialize Scaffold state variables.</span>
<span class=linenos data-linenos="203 "></span>
<span class=linenos data-linenos="204 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="205 "></span><span class=sd>        global_model: parameters of the global model, formatted as a dict</span>
<span class=linenos data-linenos="206 "></span><span class=sd>            mapping weight tensors to their names.</span>
<span class=linenos data-linenos="207 "></span>
<span class=linenos data-linenos="208 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="209 "></span><span class=sd>        FedbiomedAggregatorError: if no FederatedDataset is attached to</span>
<span class=linenos data-linenos="210 "></span><span class=sd>            this aggregator.</span>
<span class=linenos data-linenos="211 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="212 "></span>    <span class=c1># Gather node ids from the attached FederatedDataset.</span>
<span class=linenos data-linenos="213 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_fds</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="214 "></span>        <span class=k>raise</span> <span class=n>FedbiomedAggregatorError</span><span class=p>(</span>
<span class=linenos data-linenos="215 "></span>            <span class=s2>&quot;Cannot initialize correction states: Scaffold aggregator does &quot;</span>
<span class=linenos data-linenos="216 "></span>            <span class=s2>&quot;not have a FederatedDataset attached.&quot;</span>
<span class=linenos data-linenos="217 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="218 "></span>    <span class=n>node_ids</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_fds</span><span class=o>.</span><span class=n>node_ids</span><span class=p>()</span>
<span class=linenos data-linenos="219 "></span>    <span class=c1># Initialize nodes states with zero scalars, that will be summed into actual tensors.</span>
<span class=linenos data-linenos="220 "></span>    <span class=n>init_params</span> <span class=o>=</span> <span class=p>{</span><span class=n>key</span><span class=p>:</span> <span class=n>initialize</span><span class=p>(</span><span class=n>tensor</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>tensor</span> <span class=ow>in</span> <span class=n>global_model</span><span class=o>.</span><span class=n>items</span><span class=p>()}</span>
<span class=linenos data-linenos="221 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>nodes_deltas</span> <span class=o>=</span> <span class=p>{</span><span class=n>node_id</span><span class=p>:</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>init_params</span><span class=p>)</span> <span class=k>for</span> <span class=n>node_id</span> <span class=ow>in</span> <span class=n>node_ids</span><span class=p>}</span>
<span class=linenos data-linenos="222 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>nodes_states</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>nodes_deltas</span><span class=p>)</span>
<span class=linenos data-linenos="223 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>global_state</span> <span class=o>=</span> <span class=n>init_params</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Scaffold.load_state_breakpoint class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">load_state_breakpoint</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>load_state_breakpoint</span><span class=p>(</span><span class=n>state</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/scaffold.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="432 "></span><span class=k>def</span><span class=w> </span><span class=nf>load_state_breakpoint</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>state</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
<span class=linenos data-linenos="433 "></span>    <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>load_state_breakpoint</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
<span class=linenos data-linenos="434 "></span>
<span class=linenos data-linenos="435 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>server_lr</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span><span class=p>[</span><span class=s1>&#39;server_lr&#39;</span><span class=p>]</span>
<span class=linenos data-linenos="436 "></span>
<span class=linenos data-linenos="437 "></span>    <span class=c1># loading global state</span>
<span class=linenos data-linenos="438 "></span>    <span class=n>global_state_filename</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span><span class=p>[</span><span class=s1>&#39;global_state_filename&#39;</span><span class=p>]</span>
<span class=linenos data-linenos="439 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>global_state</span> <span class=o>=</span> <span class=n>Serializer</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>global_state_filename</span><span class=p>)</span>
<span class=linenos data-linenos="440 "></span>
<span class=linenos data-linenos="441 "></span>    <span class=k>for</span> <span class=n>node_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span><span class=p>[</span><span class=s1>&#39;nodes&#39;</span><span class=p>]:</span>
<span class=linenos data-linenos="442 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>nodes_deltas</span><span class=p>[</span><span class=n>node_id</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span><span class=p>[</span><span class=n>node_id</span><span class=p>][</span><span class=s1>&#39;aggregator_correction&#39;</span><span class=p>]</span>
<span class=linenos data-linenos="443 "></span>
<span class=linenos data-linenos="444 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>nodes_states</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>nodes_deltas</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Scaffold.save_state_breakpoint class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">save_state_breakpoint</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>save_state_breakpoint</span><span class=p>(</span><span class=n>breakpoint_path</span><span class=p>,</span> <span class=n>global_model</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/scaffold.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="413 "></span><span class=k>def</span><span class=w> </span><span class=nf>save_state_breakpoint</span><span class=p>(</span>
<span class=linenos data-linenos="414 "></span>    <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="415 "></span>    <span class=n>breakpoint_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<span class=linenos data-linenos="416 "></span>    <span class=n>global_model</span><span class=p>:</span> <span class=n>Mapping</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]]</span>
<span class=linenos data-linenos="417 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<span class=linenos data-linenos="418 "></span>    <span class=c1># adding aggregator parameters to the breakpoint that wont be sent to nodes</span>
<span class=linenos data-linenos="419 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span><span class=p>[</span><span class=s1>&#39;server_lr&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>server_lr</span>
<span class=linenos data-linenos="420 "></span>
<span class=linenos data-linenos="421 "></span>    <span class=c1># saving global state variable into a file</span>
<span class=linenos data-linenos="422 "></span>    <span class=n>filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>breakpoint_path</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;global_state_</span><span class=si>{</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=si>}</span><span class=s2>.mpk&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="423 "></span>    <span class=n>Serializer</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>global_state</span><span class=p>,</span> <span class=n>filename</span><span class=p>)</span>
<span class=linenos data-linenos="424 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span><span class=p>[</span><span class=s1>&#39;global_state_filename&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>filename</span>
<span class=linenos data-linenos="425 "></span>
<span class=linenos data-linenos="426 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span><span class=p>[</span><span class=s2>&quot;nodes&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_fds</span><span class=o>.</span><span class=n>node_ids</span><span class=p>()</span>
<span class=linenos data-linenos="427 "></span>    <span class=c1># adding aggregator parameters that will be sent to nodes afterwards</span>
<span class=linenos data-linenos="428 "></span>    <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>save_state_breakpoint</span><span class=p>(</span>
<span class=linenos data-linenos="429 "></span>        <span class=n>breakpoint_path</span><span class=p>,</span> <span class=n>global_model</span><span class=o>=</span><span class=n>global_model</span><span class=p>,</span> <span class=n>node_ids</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_fds</span><span class=o>.</span><span class=n>node_ids</span><span class=p>()</span>
<span class=linenos data-linenos="430 "></span>    <span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Scaffold.set_nodes_learning_rate_after_training class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">set_nodes_learning_rate_after_training</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>set_nodes_learning_rate_after_training</span><span class=p>(</span><span class=n>training_plan</span><span class=p>,</span> <span class=n>training_replies</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Gets back learning rate of optimizer from Node (if learning rate scheduler is used)</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>training_plan</code></td> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans.BaseTrainingPlan" href="../../common/training_plans/#fedbiomed.common.training_plans.BaseTrainingPlan">BaseTrainingPlan</a></code> </td> <td> <div class=doc-md-description> <p>training plan instance</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>training_replies</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></code> </td> <td> <div class=doc-md-description> <p>training replies that must contain am <code>optimizer_args</code> entry and a learning rate</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedAggregatorError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedAggregatorError">FedbiomedAggregatorError</a></code> </td> <td> <div class=doc-md-description> <p>raised when setting learning rate has been unsuccessful</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]]</code> </td> <td> <div class=doc-md-description> <p>Dict[str, List[float]]: dictionary mapping node_id and a list of float, as many as the number of layers contained in the model (in Pytroch, each layer can have a specific learning rate).</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/scaffold.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="348 "></span><span class=k>def</span><span class=w> </span><span class=nf>set_nodes_learning_rate_after_training</span><span class=p>(</span>
<span class=linenos data-linenos="349 "></span>    <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="350 "></span>    <span class=n>training_plan</span><span class=p>:</span> <span class=n>BaseTrainingPlan</span><span class=p>,</span>
<span class=linenos data-linenos="351 "></span>    <span class=n>training_replies</span><span class=p>:</span> <span class=n>Dict</span><span class=p>,</span>
<span class=linenos data-linenos="352 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=nb>float</span><span class=p>]]:</span>
<span class=linenos data-linenos="353 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Gets back learning rate of optimizer from Node (if learning rate scheduler is used)</span>
<span class=linenos data-linenos="354 "></span>
<span class=linenos data-linenos="355 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="356 "></span><span class=sd>        training_plan: training plan instance</span>
<span class=linenos data-linenos="357 "></span><span class=sd>        training_replies: training replies that must contain am `optimizer_args`</span>
<span class=linenos data-linenos="358 "></span><span class=sd>            entry and a learning rate</span>
<span class=linenos data-linenos="359 "></span>
<span class=linenos data-linenos="360 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="361 "></span><span class=sd>        FedbiomedAggregatorError: raised when setting learning rate has been unsuccessful</span>
<span class=linenos data-linenos="362 "></span>
<span class=linenos data-linenos="363 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="364 "></span><span class=sd>        Dict[str, List[float]]: dictionary mapping node_id and a list of float, as many as</span>
<span class=linenos data-linenos="365 "></span><span class=sd>            the number of layers contained in the model (in Pytroch, each layer can have a specific learning rate).</span>
<span class=linenos data-linenos="366 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="367 "></span>
<span class=linenos data-linenos="368 "></span>    <span class=n>n_model_layers</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>training_plan</span><span class=o>.</span><span class=n>get_model_params</span><span class=p>(</span>
<span class=linenos data-linenos="369 "></span>        <span class=n>only_trainable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
<span class=linenos data-linenos="370 "></span>        <span class=n>exclude_buffers</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=linenos data-linenos="371 "></span>    <span class=p>)</span>
<span class=linenos data-linenos="372 "></span>    <span class=k>for</span> <span class=n>node_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_fds</span><span class=o>.</span><span class=n>node_ids</span><span class=p>():</span>
<span class=linenos data-linenos="373 "></span>        <span class=n>lrs</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
<span class=linenos data-linenos="374 "></span>
<span class=linenos data-linenos="375 "></span>        <span class=n>node</span> <span class=o>=</span> <span class=n>training_replies</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>node_id</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<span class=linenos data-linenos="376 "></span>        <span class=k>if</span> <span class=n>node</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="377 "></span>            <span class=n>lrs</span> <span class=o>=</span> <span class=n>training_replies</span><span class=p>[</span><span class=n>node_id</span><span class=p>][</span><span class=s2>&quot;optimizer_args&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;lr&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="378 "></span>
<span class=linenos data-linenos="379 "></span>        <span class=k>if</span> <span class=n>node</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>lrs</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="380 "></span>            <span class=c1># fall back to default value if no lr information was provided</span>
<span class=linenos data-linenos="381 "></span>            <span class=n>lrs</span> <span class=o>=</span> <span class=n>training_plan</span><span class=o>.</span><span class=n>optimizer</span><span class=p>()</span><span class=o>.</span><span class=n>get_learning_rate</span><span class=p>()</span>
<span class=linenos data-linenos="382 "></span>
<span class=linenos data-linenos="383 "></span>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>lrs</span><span class=p>)</span> <span class=o>!=</span> <span class=n>n_model_layers</span><span class=p>:</span>
<span class=linenos data-linenos="384 "></span>            <span class=k>raise</span> <span class=n>FedbiomedAggregatorError</span><span class=p>(</span>
<span class=linenos data-linenos="385 "></span>                <span class=s2>&quot;Error when setting node learning rate for SCAFFOLD: cannot extract node learning rate.&quot;</span>
<span class=linenos data-linenos="386 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="387 "></span>
<span class=linenos data-linenos="388 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>nodes_lr</span><span class=p>[</span><span class=n>node_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>lrs</span>
<span class=linenos data-linenos="389 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>nodes_lr</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Scaffold.set_training_plan_type class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">set_training_plan_type</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>set_training_plan_type</span><span class=p>(</span><span class=n>training_plan_type</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Overrides <code>set_training_plan_type</code> from parent class. Checks the training plan type, and if it is SKlearnTrainingPlan, raises an error. Otherwise, calls parent method.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>training_plan_type</code></td> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.constants.TrainingPlans" href="../../common/constants/#fedbiomed.common.constants.TrainingPlans">TrainingPlans</a></code> </td> <td> <div class=doc-md-description> <p>training_plan type</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedAggregatorError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedAggregatorError">FedbiomedAggregatorError</a></code> </td> <td> <div class=doc-md-description> <p>raised if training_plan type has been set to SKLearn training plan</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>TrainingPlans</code></td> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.constants.TrainingPlans" href="../../common/constants/#fedbiomed.common.constants.TrainingPlans">TrainingPlans</a></code> </td> <td> <div class=doc-md-description> <p>training plan type</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/scaffold.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="391 "></span><span class=k>def</span><span class=w> </span><span class=nf>set_training_plan_type</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>training_plan_type</span><span class=p>:</span> <span class=n>TrainingPlans</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>TrainingPlans</span><span class=p>:</span>
<span class=linenos data-linenos="392 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=linenos data-linenos="393 "></span><span class=sd>    Overrides `set_training_plan_type` from parent class.</span>
<span class=linenos data-linenos="394 "></span><span class=sd>    Checks the training plan type, and if it is SKlearnTrainingPlan,</span>
<span class=linenos data-linenos="395 "></span><span class=sd>    raises an error. Otherwise, calls parent method.</span>
<span class=linenos data-linenos="396 "></span>
<span class=linenos data-linenos="397 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="398 "></span><span class=sd>        training_plan_type (TrainingPlans): training_plan type</span>
<span class=linenos data-linenos="399 "></span>
<span class=linenos data-linenos="400 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="401 "></span><span class=sd>        FedbiomedAggregatorError: raised if training_plan type has been set to SKLearn training plan</span>
<span class=linenos data-linenos="402 "></span>
<span class=linenos data-linenos="403 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="404 "></span><span class=sd>        TrainingPlans: training plan type</span>
<span class=linenos data-linenos="405 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="406 "></span>    <span class=k>if</span> <span class=n>training_plan_type</span> <span class=o>==</span> <span class=n>TrainingPlans</span><span class=o>.</span><span class=n>SkLearnTrainingPlan</span><span class=p>:</span>
<span class=linenos data-linenos="407 "></span>        <span class=k>raise</span> <span class=n>FedbiomedAggregatorError</span><span class=p>(</span><span class=s2>&quot;Aggregator SCAFFOLD not implemented for SKlearn&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="408 "></span>    <span class=n>training_plan_type</span> <span class=o>=</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>set_training_plan_type</span><span class=p>(</span><span class=n>training_plan_type</span><span class=p>)</span>
<span class=linenos data-linenos="409 "></span>
<span class=linenos data-linenos="410 "></span>    <span class=c1># TODO: trigger a warning if user is trying to use scaffold with something else than SGD</span>
<span class=linenos data-linenos="411 "></span>    <span class=k>return</span> <span class=n>training_plan_type</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.aggregators.Scaffold.update_correction_states class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">update_correction_states</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>update_correction_states</span><span class=p>(</span><span class=n>model_updates</span><span class=p>,</span> <span class=n>n_updates</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Update all Scaffold state variables based on node-wise model updates.</p> <h6 id=fedbiomed.researcher.aggregators.Scaffold.update_correction_states--performed-computations>Performed computations:</h6> <ul> <li>Update participating nodes' state:<ul> <li>c_i = delta_i + 1/(K*eta_i) * update_i</li> </ul> </li> <li>Update the global state and all nodes' correction state:<ul> <li>c = 1/N sum_{i=1}^n c_i</li> <li>delta_i = (c_i - c)</li> </ul> </li> </ul> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>model_updates</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>, <a class="autorefs autorefs-external" title="torch.Tensor" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor">Tensor</a>]]]</code> </td> <td> <div class=doc-md-description> <p>node-wise model weight updates.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>n_updates</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>number of local optimization steps.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/scaffold.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="225 "></span><span class=k>def</span><span class=w> </span><span class=nf>update_correction_states</span><span class=p>(</span>
<span class=linenos data-linenos="226 "></span>    <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="227 "></span>    <span class=n>model_updates</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>]]],</span>
<span class=linenos data-linenos="228 "></span>    <span class=n>n_updates</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
<span class=linenos data-linenos="229 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="230 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Update all Scaffold state variables based on node-wise model updates.</span>
<span class=linenos data-linenos="231 "></span>
<span class=linenos data-linenos="232 "></span><span class=sd>    Performed computations:</span>
<span class=linenos data-linenos="233 "></span><span class=sd>    ----------------------</span>
<span class=linenos data-linenos="234 "></span>
<span class=linenos data-linenos="235 "></span><span class=sd>    - Update participating nodes&#39; state:</span>
<span class=linenos data-linenos="236 "></span><span class=sd>        * c_i = delta_i + 1/(K*eta_i) * update_i</span>
<span class=linenos data-linenos="237 "></span><span class=sd>    - Update the global state and all nodes&#39; correction state:</span>
<span class=linenos data-linenos="238 "></span><span class=sd>        * c = 1/N sum_{i=1}^n c_i</span>
<span class=linenos data-linenos="239 "></span><span class=sd>        * delta_i = (c_i - c)</span>
<span class=linenos data-linenos="240 "></span>
<span class=linenos data-linenos="241 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="242 "></span><span class=sd>        model_updates: node-wise model weight updates.</span>
<span class=linenos data-linenos="243 "></span><span class=sd>        n_updates: number of local optimization steps.</span>
<span class=linenos data-linenos="244 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="245 "></span>    <span class=c1># Update the node-wise states for participating nodes:</span>
<span class=linenos data-linenos="246 "></span>    <span class=c1># c_i^{t+1} = delta_i^t + (x^t - y_i^t) / (M * eta)</span>
<span class=linenos data-linenos="247 "></span>    <span class=k>for</span> <span class=n>node_id</span><span class=p>,</span> <span class=n>updates</span> <span class=ow>in</span> <span class=n>model_updates</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<span class=linenos data-linenos="248 "></span>        <span class=n>d_i</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>nodes_deltas</span><span class=p>[</span><span class=n>node_id</span><span class=p>]</span>
<span class=linenos data-linenos="249 "></span>        <span class=k>for</span> <span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>val</span><span class=p>)</span> <span class=ow>in</span> <span class=n>updates</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<span class=linenos data-linenos="250 "></span>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>nodes_lr</span><span class=p>[</span><span class=n>node_id</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>)</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="251 "></span>                <span class=bp>self</span><span class=o>.</span><span class=n>nodes_states</span><span class=p>[</span><span class=n>node_id</span><span class=p>]</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
<span class=linenos data-linenos="252 "></span>                    <span class=p>{</span>
<span class=linenos data-linenos="253 "></span>                    <span class=n>key</span><span class=p>:</span> <span class=n>d_i</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>+</span> <span class=n>val</span> <span class=o>/</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>nodes_lr</span><span class=p>[</span><span class=n>node_id</span><span class=p>][</span><span class=n>key</span><span class=p>]</span> <span class=o>*</span> <span class=n>n_updates</span><span class=p>)</span>
<span class=linenos data-linenos="254 "></span>                     <span class=p>}</span>
<span class=linenos data-linenos="255 "></span>                <span class=p>)</span>
<span class=linenos data-linenos="256 "></span>    <span class=c1># Update the global state: c^{t+1} = average(c_i^{t+1})</span>
<span class=linenos data-linenos="257 "></span>    <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>global_state</span><span class=p>:</span>
<span class=linenos data-linenos="258 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>global_state</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
<span class=linenos data-linenos="259 "></span>        <span class=k>for</span> <span class=n>state</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>nodes_states</span><span class=o>.</span><span class=n>values</span><span class=p>():</span>
<span class=linenos data-linenos="260 "></span>            <span class=k>if</span> <span class=n>state</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>)</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="261 "></span>                <span class=bp>self</span><span class=o>.</span><span class=n>global_state</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
<span class=linenos data-linenos="262 "></span>                    <span class=nb>sum</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=k>for</span> <span class=n>state</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>nodes_states</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
<span class=linenos data-linenos="263 "></span>                        <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>nodes_states</span><span class=p>)</span>
<span class=linenos data-linenos="264 "></span>                    <span class=p>)</span>
<span class=linenos data-linenos="265 "></span>
<span class=linenos data-linenos="266 "></span>    <span class=c1># Compute the new node-wise correction states:</span>
<span class=linenos data-linenos="267 "></span>    <span class=c1># delta_i^{t+1} = c_i^{t+1} - c^{t+1}</span>
<span class=linenos data-linenos="268 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>nodes_deltas</span> <span class=o>=</span> <span class=p>{</span>
<span class=linenos data-linenos="269 "></span>        <span class=n>node_id</span><span class=p>:</span> <span class=p>{</span>
<span class=linenos data-linenos="270 "></span>            <span class=n>key</span><span class=p>:</span> <span class=n>val</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>global_state</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>val</span> <span class=ow>in</span> <span class=n>state</span><span class=o>.</span><span class=n>items</span><span class=p>()</span>
<span class=linenos data-linenos="271 "></span>        <span class=p>}</span>
<span class=linenos data-linenos="272 "></span>        <span class=k>for</span> <span class=n>node_id</span><span class=p>,</span> <span class=n>state</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>nodes_states</span><span class=o>.</span><span class=n>items</span><span class=p>()</span>
<span class=linenos data-linenos="273 "></span>    <span class=p>}</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> <h2 id=fedbiomed.researcher.aggregators-functions>Functions</h2> <div class="doc doc-object doc-function"> <h3 id=fedbiomed.researcher.aggregators.federated_averaging class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">federated_averaging</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>federated_averaging</span><span class=p>(</span><span class=n>model_params</span><span class=p>,</span> <span class=n>weights</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Defines Federated Averaging (FedAvg) strategy for model aggregation.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>model_params</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.Tensor" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor">Tensor</a>, <a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]]]</code> </td> <td> <div class=doc-md-description> <p>list that contains nodes' model parameters; each model is stored as an OrderedDict (maps model layer name to the model weights)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>weights</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]</code> </td> <td> <div class=doc-md-description> <p>weights for performing weighted sum in FedAvg strategy (depending on the dataset size of each node). Items in the list must always sum up to 1</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.Tensor" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor">Tensor</a>, <a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]]</code> </td> <td> <div class=doc-md-description> <p>Final model with aggregated layers, as an OrderedDict object.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/functional.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="21 "></span><span class=k>def</span><span class=w> </span><span class=nf>federated_averaging</span><span class=p>(</span><span class=n>model_params</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]]],</span>
<span class=linenos data-linenos="22 "></span>                        <span class=n>weights</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>float</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Mapping</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]]:</span>
<span class=linenos data-linenos="23 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Defines Federated Averaging (FedAvg) strategy for model aggregation.</span>
<span class=linenos data-linenos="24 "></span>
<span class=linenos data-linenos="25 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="26 "></span><span class=sd>        model_params: list that contains nodes&#39; model parameters; each model is stored as an OrderedDict (maps</span>
<span class=linenos data-linenos="27 "></span><span class=sd>            model layer name to the model weights)</span>
<span class=linenos data-linenos="28 "></span><span class=sd>        weights: weights for performing weighted sum in FedAvg strategy (depending on the dataset size of each node).</span>
<span class=linenos data-linenos="29 "></span><span class=sd>            Items in the list must always sum up to 1</span>
<span class=linenos data-linenos="30 "></span>
<span class=linenos data-linenos="31 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="32 "></span><span class=sd>        Final model with aggregated layers, as an OrderedDict object.</span>
<span class=linenos data-linenos="33 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="34 "></span>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>model_params</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;An empty list of models was passed.&#39;</span>
<span class=linenos data-linenos="35 "></span>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>weights</span><span class=p>)</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>model_params</span><span class=p>),</span> <span class=s1>&#39;List with number of observations must have &#39;</span> \
<span class=linenos data-linenos="36 "></span>                                              <span class=s1>&#39;the same number of elements that list of models.&#39;</span>
<span class=linenos data-linenos="37 "></span>
<span class=linenos data-linenos="38 "></span>    <span class=c1># Compute proportions</span>
<span class=linenos data-linenos="39 "></span>    <span class=n>proportions</span> <span class=o>=</span> <span class=p>[</span><span class=n>n_k</span> <span class=o>/</span> <span class=nb>sum</span><span class=p>(</span><span class=n>weights</span><span class=p>)</span> <span class=k>for</span> <span class=n>n_k</span> <span class=ow>in</span> <span class=n>weights</span><span class=p>]</span>
<span class=linenos data-linenos="40 "></span>    <span class=k>return</span> <span class=n>weighted_sum</span><span class=p>(</span><span class=n>model_params</span><span class=p>,</span> <span class=n>proportions</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fedbiomed.researcher.aggregators.initialize class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">initialize</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>initialize</span><span class=p>(</span><span class=n>val</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Initialize tensor or array vector.</p> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/functional.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="11 "></span><span class=k>def</span><span class=w> </span><span class=nf>initialize</span><span class=p>(</span><span class=n>val</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]]:</span>
<span class=linenos data-linenos="12 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Initialize tensor or array vector. &quot;&quot;&quot;</span>
<span class=linenos data-linenos="13 "></span>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>val</span><span class=p>,</span> <span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>):</span>
<span class=linenos data-linenos="14 "></span>        <span class=k>return</span> <span class=s1>&#39;tensor&#39;</span><span class=p>,</span> <span class=n>torch</span><span class=o>.</span><span class=n>zeros_like</span><span class=p>(</span><span class=n>val</span><span class=p>)</span><span class=o>.</span><span class=n>float</span><span class=p>()</span>
<span class=linenos data-linenos="15 "></span>
<span class=linenos data-linenos="16 "></span>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>val</span><span class=p>,</span> <span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>)):</span>
<span class=linenos data-linenos="17 "></span>        <span class=n>val</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>val</span><span class=p>)</span>
<span class=linenos data-linenos="18 "></span>        <span class=k>return</span> <span class=s1>&#39;array&#39;</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>val</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span> <span class=n>dtype</span> <span class=o>=</span> <span class=nb>float</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fedbiomed.researcher.aggregators.weighted_sum class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">weighted_sum</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>weighted_sum</span><span class=p>(</span><span class=n>model_params</span><span class=p>,</span> <span class=n>proportions</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Performs weighted sum operation</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>model_params</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.Tensor" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor">Tensor</a>, <a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]]]</code> </td> <td> <div class=doc-md-description> <p>list that contains nodes' model parameters; each model is stored as an OrderedDict (maps model layer name to the model weights)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>proportions</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]</code> </td> <td> <div class=doc-md-description> <p>weights of all items whithin model_params's list</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.Tensor" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor">Tensor</a>, <a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]]</code> </td> <td> <div class=doc-md-description> <p>Mapping[str, Union[torch.Tensor, np.ndarray]]: model resulting from the weighted sum operation</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/aggregators/functional.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="43 "></span><span class=k>def</span><span class=w> </span><span class=nf>weighted_sum</span><span class=p>(</span><span class=n>model_params</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]]],</span>
<span class=linenos data-linenos="44 "></span>                 <span class=n>proportions</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>float</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Mapping</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]]:</span>
<span class=linenos data-linenos="45 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Performs weighted sum operation</span>
<span class=linenos data-linenos="46 "></span>
<span class=linenos data-linenos="47 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="48 "></span><span class=sd>        model_params (List[Dict[str, Union[torch.Tensor, np.ndarray]]]): list that contains nodes&#39;</span>
<span class=linenos data-linenos="49 "></span><span class=sd>            model parameters; each model is stored as an OrderedDict (maps model layer name to the model weights)</span>
<span class=linenos data-linenos="50 "></span><span class=sd>        proportions (List[float]): weights of all items whithin model_params&#39;s list</span>
<span class=linenos data-linenos="51 "></span>
<span class=linenos data-linenos="52 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="53 "></span><span class=sd>        Mapping[str, Union[torch.Tensor, np.ndarray]]: model resulting from the weighted sum </span>
<span class=linenos data-linenos="54 "></span><span class=sd>                                                       operation</span>
<span class=linenos data-linenos="55 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="56 "></span>    <span class=c1># Empty model parameter dictionary</span>
<span class=linenos data-linenos="57 "></span>    <span class=n>avg_params</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>model_params</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
<span class=linenos data-linenos="58 "></span>
<span class=linenos data-linenos="59 "></span>    <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>val</span> <span class=ow>in</span> <span class=n>avg_params</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<span class=linenos data-linenos="60 "></span>        <span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>avg_params</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=p>)</span> <span class=o>=</span> <span class=n>initialize</span><span class=p>(</span><span class=n>val</span><span class=p>)</span>
<span class=linenos data-linenos="61 "></span>
<span class=linenos data-linenos="62 "></span>    <span class=k>if</span> <span class=n>t</span> <span class=o>==</span> <span class=s1>&#39;tensor&#39;</span><span class=p>:</span>
<span class=linenos data-linenos="63 "></span>        <span class=k>for</span> <span class=n>model</span><span class=p>,</span> <span class=n>weight</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>model_params</span><span class=p>,</span> <span class=n>proportions</span><span class=p>):</span>
<span class=linenos data-linenos="64 "></span>            <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>avg_params</span><span class=o>.</span><span class=n>keys</span><span class=p>():</span>
<span class=linenos data-linenos="65 "></span>                <span class=n>avg_params</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>+=</span> <span class=n>weight</span> <span class=o>*</span> <span class=n>model</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
<span class=linenos data-linenos="66 "></span>
<span class=linenos data-linenos="67 "></span>    <span class=k>if</span> <span class=n>t</span> <span class=o>==</span> <span class=s1>&#39;array&#39;</span><span class=p>:</span>
<span class=linenos data-linenos="68 "></span>        <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>avg_params</span><span class=o>.</span><span class=n>keys</span><span class=p>():</span>
<span class=linenos data-linenos="69 "></span>            <span class=n>matr</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span> <span class=n>d</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=k>for</span> <span class=n>d</span> <span class=ow>in</span> <span class=n>model_params</span> <span class=p>])</span>
<span class=linenos data-linenos="70 "></span>            <span class=n>avg_params</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>average</span><span class=p>(</span><span class=n>matr</span><span class=p>,</span> <span class=n>weights</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>proportions</span><span class=p>),</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
<span class=linenos data-linenos="71 "></span>
<span class=linenos data-linenos="72 "></span>    <span class=k>return</span> <span class=n>avg_params</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> </article> </main> </div> <div class=right-col> <div id=right-sidebar class=sidebar-right> <nav class=toc> <!-- Render item list --> <label class=toc-title for=__toc> <span class=toc-icon></span> </label> <ul class=toc-list data-md-component=toc data-md-scrollfix> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators-classes class=md-nav__link> Classes </a> <nav class=toc-nav aria-label=Classes> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Aggregator class=md-nav__link> Aggregator </a> <nav class=toc-nav aria-label=Aggregator> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Aggregator-functions class=md-nav__link> Functions </a> <nav class=toc-nav aria-label=Functions> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Aggregator.aggregate class=md-nav__link> aggregate </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Aggregator.check_values class=md-nav__link> check_values </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Aggregator.create_aggregator_args class=md-nav__link> create_aggregator_args </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Aggregator.load_state_breakpoint class=md-nav__link> load_state_breakpoint </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Aggregator.save_state_breakpoint class=md-nav__link> save_state_breakpoint </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Aggregator.secure_aggregation class=md-nav__link> secure_aggregation </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Aggregator.set_fds class=md-nav__link> set_fds </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Aggregator.set_training_plan_type class=md-nav__link> set_training_plan_type </a> </li> </ul> </nav> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.FedAverage class=md-nav__link> FedAverage </a> <nav class=toc-nav aria-label=FedAverage> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.FedAverage-attributes class=md-nav__link> Attributes </a> <nav class=toc-nav aria-label=Attributes> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.FedAverage.aggregator_name class=md-nav__link> aggregator_name </a> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.FedAverage-functions class=md-nav__link> Functions </a> <nav class=toc-nav aria-label=Functions> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.FedAverage.aggregate class=md-nav__link> aggregate </a> </li> </ul> </nav> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold class=md-nav__link> Scaffold </a> <nav class=toc-nav aria-label=Scaffold> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold--fed-biomed-implementation-details class=md-nav__link> Fed-BioMed implementation details </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold-attributes class=md-nav__link> Attributes </a> <nav class=toc-nav aria-label=Attributes> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.aggregator_name class=md-nav__link> aggregator_name </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.global_state class=md-nav__link> global_state </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.nodes_deltas class=md-nav__link> nodes_deltas </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.nodes_lr class=md-nav__link> nodes_lr </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.nodes_states class=md-nav__link> nodes_states </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.server_lr class=md-nav__link> server_lr </a> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold-functions class=md-nav__link> Functions </a> <nav class=toc-nav aria-label=Functions> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.aggregate class=md-nav__link> aggregate </a> <nav class=toc-nav aria-label=aggregate> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.aggregate--performed-computations class=md-nav__link> Performed computations: </a> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.check_values class=md-nav__link> check_values </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.create_aggregator_args class=md-nav__link> create_aggregator_args </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.init_correction_states class=md-nav__link> init_correction_states </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.load_state_breakpoint class=md-nav__link> load_state_breakpoint </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.save_state_breakpoint class=md-nav__link> save_state_breakpoint </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.set_nodes_learning_rate_after_training class=md-nav__link> set_nodes_learning_rate_after_training </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.set_training_plan_type class=md-nav__link> set_training_plan_type </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.update_correction_states class=md-nav__link> update_correction_states </a> <nav class=toc-nav aria-label=update_correction_states> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.Scaffold.update_correction_states--performed-computations class=md-nav__link> Performed computations: </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators-functions class=md-nav__link> Functions </a> <nav class=toc-nav aria-label=Functions> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.federated_averaging class=md-nav__link> federated_averaging </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.initialize class=md-nav__link> initialize </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.aggregators.weighted_sum class=md-nav__link> weighted_sum </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> </div> <!-- News Main Page--> </div> <footer> <div class=container-fluid> <div class=footer-first-inner> <div class=container> <div class=row> <div class=col-md-6> <div class=footer-contact> <strong>Address:</strong> <p>2004 Rte des Lucioles, 06902 Sophia Antipolis</p> <strong>E-mail:</strong> <p>fedbiomed _at_ inria _dot_ fr</p> </div> </div> <div class=col-md-6> <div class=footer-contact> <p>Fed-BioMed © 2022</p> </div> </div> </div> </div> </div> </div> </footer> <!-- JQuery --> <script src=https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js></script> <!-- Latest compiled and minified JavaScript --> <script src=https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=../../../../assets/javascript/lunr.js></script> <script src=../../../../assets/javascript/theme.js></script> </body> </html>