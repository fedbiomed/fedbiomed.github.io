<!DOCTYPE html><html> <head><meta charset=UTF-8><meta name=viewport content="width=device-width, initial-scale=1"><meta name=robots context="index, archive"><!--  --><script>
      const versions_json = "../../../../../versions.json";
      const search_worker_js = "../../../../assets/javascript/search-worker.js";
      const search_index_json = "../../../../search/search_index.json";
      const base_url = '../../../..';
    </script><!-- Site title --><title>TrainingPlans - Fed-BioMed</title><link rel=icon type=image/x-icon href=../../../../favicon.ico><!-- Page description --><meta name=description content="Open, Transparent and Trusted Collaborative Learning for Real-world Healthcare Applications"><!-- Page keywords --><!-- Page author --><!-- Latest compiled and minified CSS --><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><!-- Bootstrap Icons --><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css><link href=../../../../assets/_mkdocstrings.css rel=stylesheet><link href=../../../../assets/css/style.css rel=stylesheet></head> <body> <header> <div class="container-fluid top-bar"> <div class=brand> <a href=/ > <img src=../../../../assets/img/fedbiomed-logo-small.png> </a> </div> <nav class=top> <ul> <li class> <a href=../../../..>Home</a> </li> <li class> <a href=../../../../getting-started/what-is-fedbiomed/ >User Documentation</a> </li> <li class> <a href=../../../../pages/about-us/ >About</a> </li> <li id=clicker class=has-sub> More <i class="bi bi-chevron-down"></i> <ul class=sub-nav-menu> <li class> <a href=../../../../#funding>Funding</a> </li> <li class> <a href=../../../../news/ >News</a> </li> <li class> <a href=../../../../#contributors>Contributors</a> </li> <li class> <a href=../../../../#users>Users</a> </li> <li class> <a href=../../../../pages/roadmap/ >Roadmap</a> </li> <li class> <a href=../../../../#contact-us>Contact Us</a> </li> </ul> </li> </ul> </nav> </div> <div class="container-fluid top-bar-mobile"> <div class=mobile-bar> <div class=brand> <a href=../../../../ > <img src=../../../../assets/img/fedbiomed-logo-small.png> </a> </div> <div class=hum-menu> <img class=open src=../../../../assets/img/menu.svg> <img class=close style=display:none src=../../../../assets/img/cancel.svg> </div> </div> <nav class=top-mobile> <ul> <li class> <a href=../../../..>Home</a> </li> <li class> <a href=../../../../getting-started/what-is-fedbiomed/ >User Documentation</a> </li> <li class> <a href=../../../../pages/about-us/ >About</a> </li> <li id=clicker class=has-sub> More <i class="bi bi-chevron-down"></i> <ul class=sub-nav-menu> <li class> <a href=../../../../#funding>Funding</a> </li> <li class> <a href=../../../../news/ >News</a> </li> <li class> <a href=../../../../#contributors>Contributors</a> </li> <li class> <a href=../../../../#users>Users</a> </li> <li class> <a href=../../../../pages/roadmap/ >Roadmap</a> </li> <li class> <a href=../../../../#contact-us>Contact Us</a> </li> </ul> </li> </ul> </nav> </div> </header> <div class=main> <!-- Home page --> <div class=container-fluid> <div class=doc-row> <div class=left-col> <div class=sidebar-doc> <nav class=sidebar-inner> <ul class="sidebar-menu-left sub"> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Getting Started <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../getting-started/what-is-fedbiomed/ class>What's Fed-BioMed</a> </li> <li class> <a href=../../../../getting-started/getting-started/ class>Basic Example</a> </li> <li class> <a href=../../../../getting-started/fedbiomed-architecture/ class>Fedbiomed Architecture</a> </li> <li class> <a href=../../../../getting-started/fedbiomed-workflow/ class>Fedbiomed Workflow</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Tutorials <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Installation <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/installation/0-basic-software-installation/ class>Software Installation</a> </li> <li class> <a href=../../../../tutorials/installation/1-setting-up-environment/ class>Setting Up Environment</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> PyTorch <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/pytorch/01_PyTorch_MNIST_Single_Node_Tutorial/ class>PyTorch MNIST Basic Example</a> </li> <li class> <a href=../../../../tutorials/pytorch/02_Create_Your_Custom_Training_Plan/ class>How to Create Your Custom PyTorch Training Plan</a> </li> <li class> <a href=../../../../tutorials/pytorch/03_PyTorch_Used_Cars_Dataset_Example/ class>PyTorch Used Cars Dataset Example</a> </li> <li class> <a href=../../../../tutorials/pytorch/04-Aggregation_in_Fed-BioMed/ class>PyTorch aggregation methods in Fed-BioMed</a> </li> <li class> <a href=../../../../tutorials/pytorch/05_Transfer-learning_tutorial_usingDenseNet-121/ class>Transfer-learning in Fed-BioMed tutorial</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> MONAI <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/monai/01_monai-2d-image-classification/ class>Federated 2d image classification with MONAI</a> </li> <li class> <a href=../../../../tutorials/monai/02_monai-2d-image-registration/ class>Federated 2d XRay registration with MONAI</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Scikit-Learn <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/scikit-learn/01_sklearn_MNIST_classification_tutorial/ class>MNIST classification with Scikit-Learn Classifier (Perceptron)</a> </li> <li class> <a href=../../../../tutorials/scikit-learn/02_sklearn_sgd_regressor_tutorial/ class>Fed-BioMed to train a federated SGD regressor model</a> </li> <li class> <a href=../../../../tutorials/scikit-learn/03-other-scikit-learn-models/ class>Implementing other Scikit Learn models for Federated Learning</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Optimizers <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/optimizers/01-fedopt-and-scaffold/ class>Advanced optimizers in Fed-BioMed</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> FLamby <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/flamby/flamby/ class>General Concepts</a> </li> <li class> <a href=../../../../tutorials/flamby/flamby-integration-into-fedbiomed/ class>FLamby integration in Fed-BioMed</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Advanced <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/advanced/in-depth-experiment-configuration/ class>In Depth Experiment Configuration</a> </li> <li class> <a href=../../../../tutorials/advanced/training-with-gpu/ class>PyTorch model training using a GPU</a> </li> <li class> <a href=../../../../tutorials/advanced/breakpoints/ class>Breakpoints</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Security <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/security/differential-privacy-with-opacus-on-fedbiomed/ class>Using Differential Privacy with OPACUS on Fed-BioMed</a> </li> <li class> <a href=../../../../tutorials/security/non-private-local-central-dp-monai-2d-image-registration/ class>Local and Central DP with Fed-BioMed: MONAI 2d image registration</a> </li> <li class> <a href=../../../../tutorials/security/training-with-approved-training-plans/ class>Training Process with Training Plan Management</a> </li> <li class> <a href=../../../../tutorials/security/secure-aggregation/ class>Training with Secure Aggregation</a> </li> <li class> <a href=../../../../tutorials/concrete-ml/concrete-ml/ class>End-to-end Privacy Preserving Training and Inference on Medical Data</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Biomedical data <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/medical/medical-image-segmentation-unet-library/ class>Brain Segmentation</a> </li> </ul> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> User Guide <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/glossary/ class>Glossary</a> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Deployment <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/deployment/deployment/ class>Introduction</a> </li> <li class> <a href=../../../../user-guide/deployment/deployment-vpn/ class>VPN Deployment</a> </li> <li class> <a href=../../../../user-guide/deployment/matrix/ class>Network matrix</a> </li> <li class> <a href=../../../../user-guide/deployment/security-model/ class>Security model</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Node <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/nodes/configuring-nodes/ class>Configuring Nodes</a> </li> <li class> <a href=../../../../user-guide/nodes/deploying-datasets/ class>Deploying Datasets</a> </li> <li class> <a href=../../../../user-guide/nodes/training-plan-security-manager/ class>Training Plan Management</a> </li> <li class> <a href=../../../../user-guide/nodes/using-gpu/ class>Using GPU</a> </li> <li class> <a href=../../../../user-guide/nodes/node-gui/ class>Node GUI</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Researcher <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/researcher/training-plan/ class>Training Plan</a> </li> <li class> <a href=../../../../user-guide/researcher/training-data/ class>Training Data</a> </li> <li class> <a href=../../../../user-guide/researcher/experiment/ class>Experiment</a> </li> <li class> <a href=../../../../user-guide/researcher/aggregation/ class>Aggregation</a> </li> <li class> <a href=../../../../user-guide/researcher/listing-datasets-and-selecting-nodes/ class>Listing Datasets and Selecting Nodes</a> </li> <li class> <a href=../../../../user-guide/researcher/model-testing-during-federated-training/ class>Model Validation on the Node Side</a> </li> <li class> <a href=../../../../user-guide/researcher/tensorboard/ class>Tensorboard</a> </li> </ul> </li> <li class> <a href=../../../../user-guide/advanced-optimization/ class>Optimization</a> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Secure Aggregation <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/secagg/introduction/ class>Introduction</a> </li> <li class> <a href=../../../../user-guide/secagg/configuration/ class>Configuration</a> </li> <li class> <a href=../../../../user-guide/secagg/researcher-interface/ class>Managing Secure Aggregation in Researcher</a> </li> <li class> <a href=../../../../user-guide/secagg/certificate-registration/ class>Joye-Libert Cert. Registration</a> </li> </ul> </li> </ul> </li> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> Developer <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> API Reference <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> Common <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li class> <a href=../certificate_manager/ class>Certificate Manager</a> </li> <li class> <a href=../cli/ class>CLI</a> </li> <li class> <a href=../config/ class>Config</a> </li> <li class> <a href=../constants/ class>Constants</a> </li> <li class> <a href=../data/ class>Data</a> </li> <li class> <a href=../db/ class>DB</a> </li> <li class> <a href=../environ/ class>Environ</a> </li> <li class> <a href=../exceptions/ class>Exceptions</a> </li> <li class> <a href=../ipython/ class>IPython</a> </li> <li class> <a href=../json/ class>Json</a> </li> <li class> <a href=../logger/ class>Logger</a> </li> <li class> <a href=../message/ class>Message</a> </li> <li class> <a href=../metrics/ class>Metrics</a> </li> <li class> <a href=../models/ class>Model</a> </li> <li class> <a href=../mpc_controller/ class>MPC controller</a> </li> <li class> <a href=../optimizers/ class>Optimizers</a> </li> <li class> <a href=../privacy/ class>Privacy</a> </li> <li class> <a href=../secagg/ class>Secagg</a> </li> <li class> <a href=../secagg_manager/ class>Secagg Manager</a> </li> <li class> <a href=../serializer/ class>Serializer</a> </li> <li class> <a href=../singleton/ class>Singleton</a> </li> <li class> <a href=../synchro/ class>Synchro</a> </li> <li class> <a href=../tasks_queue/ class>TasksQueue</a> </li> <li class=current> <a href=./ class="link current">TrainingPlans</a> </li> <li class> <a href=../training_args/ class>TrainingArgs</a> </li> <li class> <a href=../utils/ class>Utils</a> </li> <li class> <a href=../validator/ class>Validator</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Node <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../node/cli/ class>CLI</a> </li> <li class> <a href=../../node/cli_utils/ class>CLI Utils</a> </li> <li class> <a href=../../node/config/ class>Config</a> </li> <li class> <a href=../../node/dataset_manager/ class>DatasetManager</a> </li> <li class> <a href=../../node/environ/ class>Environ</a> </li> <li class> <a href=../../node/history_monitor/ class>HistoryMonitor</a> </li> <li class> <a href=../../node/node/ class>Node</a> </li> <li class> <a href=../../node/node_state_manager/ class>NodeStateManager</a> </li> <li class> <a href=../../node/requests/ class>Requests</a> </li> <li class> <a href=../../node/round/ class>Round</a> </li> <li class> <a href=../../node/secagg/ class>Secagg</a> </li> <li class> <a href=../../node/secagg_manager/ class>Secagg Manager</a> </li> <li class> <a href=../../node/training_plan_security_manager/ class>TrainingPlanSecurityManager</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Researcher <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../researcher/aggregators/ class>Aggregators</a> </li> <li class> <a href=../../researcher/cli/ class>CLI</a> </li> <li class> <a href=../../researcher/config/ class>Config</a> </li> <li class> <a href=../../researcher/datasets/ class>Datasets</a> </li> <li class> <a href=../../researcher/environ/ class>Environ</a> </li> <li class> <a href=../../researcher/federated_workflows/ class>Federated Workflows</a> </li> <li class> <a href=../../researcher/filetools/ class>Filetools</a> </li> <li class> <a href=../../researcher/jobs/ class>Jobs</a> </li> <li class> <a href=../../researcher/monitor/ class>Monitor</a> </li> <li class> <a href=../../researcher/node_state_agent/ class>NodeStateAgent</a> </li> <li class> <a href=../../researcher/requests/ class>Requests</a> </li> <li class> <a href=../../researcher/secagg/ class>Secagg</a> </li> <li class> <a href=../../researcher/strategies/ class>Strategies</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Transport <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../transport/client/ class>Client</a> </li> <li class> <a href=../../transport/controller/ class>Controller</a> </li> <li class> <a href=../../transport/node_agent/ class>NodeAgent</a> </li> <li class> <a href=../../transport/server/ class>Server</a> </li> </ul> </li> </ul> </li> <li class> <a href=../../../usage_and_tools/ class>Usage and Tools</a> </li> <li class> <a href=../../../ci/ class>Continuous Integration</a> </li> <li class> <a href=../../../definition-of-done/ class>Definition of Done</a> </li> <li class> <a href=../../../testing-in-fedbiomed/ class>Testing in Fed-BioMed</a> </li> <li class> <a href=../../../messaging/ class>RPC Protocol and Messages</a> </li> </ul> </li> </ul> </nav> </div> </div> <div class=main-col> <main class=main-docs> <h1>TrainingPlans</h1> <article> <div class="doc doc-object doc-module"> <div class="doc doc-contents first"> <p>The <code>fedbiomed.common.training_plans</code> module includes training plan classes that are used for federated training</p> <div class="doc doc-children"> <h2 id=fedbiomed.common.training_plans-classes>Classes</h2> <div class="doc doc-object doc-class"> <h3 id=fedbiomed.common.training_plans.BaseTrainingPlan class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">BaseTrainingPlan</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>BaseTrainingPlan</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Base class for training plan</p> <p>All concrete, framework- and/or model-specific training plans should inherit from this class, and implement: * the <code>post_init</code> method: to process model and training hyper-parameters * the <code>training_routine</code> method: to train the model for one round * the <code>predict</code> method: to compute predictions over a given batch * (opt.) the <code>testing_step</code> method: to override the evaluation behavior and compute a batch-wise (set of) metric(s)</p> <p><span class=doc-section-title>Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans.BaseTrainingPlan.dataset_path" href="#fedbiomed.common.training_plans.BaseTrainingPlan.dataset_path">dataset_path</a></code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, None]</code> </td> <td> <div class=doc-md-description> <p>The path that indicates where dataset has been stored</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans.BaseTrainingPlan.pre_processes" href="#fedbiomed.common.training_plans.BaseTrainingPlan.pre_processes">pre_processes</a></code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <span title="fedbiomed.common.training_plans._base_training_plan.PreProcessDict">PreProcessDict</span>]</code> </td> <td> <div class=doc-md-description> <p>Preprocess functions that will be applied to the training data at the beginning of the training routine.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans.BaseTrainingPlan.training_data_loader" href="#fedbiomed.common.training_plans.BaseTrainingPlan.training_data_loader">training_data_loader</a></code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.utils.data.DataLoader" href="https://pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader">DataLoader</a>, <a class="autorefs autorefs-internal" title="fedbiomed.common.data.NPDataLoader" href="../data/#fedbiomed.common.data.NPDataLoader">NPDataLoader</a>, None]</code> </td> <td> <div class=doc-md-description> <p>Data loader used in the training routine.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans.BaseTrainingPlan.testing_data_loader" href="#fedbiomed.common.training_plans.BaseTrainingPlan.testing_data_loader">testing_data_loader</a></code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.utils.data.DataLoader" href="https://pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader">DataLoader</a>, <a class="autorefs autorefs-internal" title="fedbiomed.common.data.NPDataLoader" href="../data/#fedbiomed.common.data.NPDataLoader">NPDataLoader</a>, None]</code> </td> <td> <div class=doc-md-description> <p>Data loader used in the validation routine.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="62 "></span><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="63 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Construct the base training plan.&quot;&quot;&quot;</span>
<span class=linenos data-linenos="64 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_dependencies</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
<span class=linenos data-linenos="65 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>dataset_path</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="66 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>pre_processes</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>PreProcessDict</span><span class=p>]</span> <span class=o>=</span> <span class=n>OrderedDict</span><span class=p>()</span>
<span class=linenos data-linenos="67 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>training_data_loader</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>DataLoader</span><span class=p>,</span> <span class=n>NPDataLoader</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="68 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>testing_data_loader</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>DataLoader</span><span class=p>,</span> <span class=n>NPDataLoader</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="69 "></span>
<span class=linenos data-linenos="70 "></span>    <span class=c1># Arguments provided by the researcher; they will be populated by post_init</span>
<span class=linenos data-linenos="71 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_model_args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="72 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="73 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer_args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="74 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_loader_args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="75 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="76 "></span>
<span class=linenos data-linenos="77 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_error_msg_import_model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB605</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: Training Plan&#39;s Model is not initialized.</span><span class=se>\n</span><span class=s2>&quot;</span> <span class=o>+</span>\
<span class=linenos data-linenos="78 "></span>                                        <span class=s2>&quot;To </span><span class=si>%s</span><span class=s2> a model, you should do it through `fedbiomed.researcher.federated_workflows.Experiment`&#39;s interface&quot;</span> <span class=o>+</span>\
<span class=linenos data-linenos="79 "></span>                                        <span class=s2>&quot; and not directly from Training Plan&quot;</span>
</code></pre></div> </details> <div class="doc doc-children"> <h4 id=fedbiomed.common.training_plans.BaseTrainingPlan-attributes>Attributes</h4> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.dataset_path class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">dataset_path</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=n>dataset_path</span> <span class=o>=</span> <span class=kc>None</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.dependencies class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">dependencies</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=n>dependencies</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.pre_processes class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">pre_processes</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=n>pre_processes</span> <span class=o>=</span> <span class=n>OrderedDict</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.testing_data_loader class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">testing_data_loader</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=n>testing_data_loader</span> <span class=o>=</span> <span class=kc>None</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.training_data_loader class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">training_data_loader</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=n>training_data_loader</span> <span class=o>=</span> <span class=kc>None</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <h4 id=fedbiomed.common.training_plans.BaseTrainingPlan-functions>Functions</h4> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.add_preprocess class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">add_preprocess</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>add_preprocess</span><span class=p>(</span><span class=n>method</span><span class=p>,</span> <span class=n>process_type</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Register a pre-processing method to be executed on training data.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>method</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></code> </td> <td> <div class=doc-md-description> <p>Pre-processing method to be run before training.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>process_type</code></td> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.constants.ProcessTypes" href="../constants/#fedbiomed.common.constants.ProcessTypes">ProcessTypes</a></code> </td> <td> <div class=doc-md-description> <p>Type of pre-processing that will be run. The expected signature of <code>method</code> and the arguments passed to it depend on this parameter.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="328 "></span><span class=k>def</span> <span class=nf>add_preprocess</span><span class=p>(</span>
<span class=linenos data-linenos="329 "></span>        <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="330 "></span>        <span class=n>method</span><span class=p>:</span> <span class=n>Callable</span><span class=p>,</span>
<span class=linenos data-linenos="331 "></span>        <span class=n>process_type</span><span class=p>:</span> <span class=n>ProcessTypes</span>
<span class=linenos data-linenos="332 "></span>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="333 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Register a pre-processing method to be executed on training data.</span>
<span class=linenos data-linenos="334 "></span>
<span class=linenos data-linenos="335 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="336 "></span><span class=sd>        method: Pre-processing method to be run before training.</span>
<span class=linenos data-linenos="337 "></span><span class=sd>        process_type: Type of pre-processing that will be run.</span>
<span class=linenos data-linenos="338 "></span><span class=sd>            The expected signature of `method` and the arguments</span>
<span class=linenos data-linenos="339 "></span><span class=sd>            passed to it depend on this parameter.</span>
<span class=linenos data-linenos="340 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="341 "></span>    <span class=k>if</span> <span class=ow>not</span> <span class=nb>callable</span><span class=p>(</span><span class=n>method</span><span class=p>):</span>
<span class=linenos data-linenos="342 "></span>        <span class=n>msg</span> <span class=o>=</span> <span class=p>(</span>
<span class=linenos data-linenos="343 "></span>            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB605</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: error while adding &quot;</span>
<span class=linenos data-linenos="344 "></span>            <span class=s2>&quot;preprocess, `method` should be callable.&quot;</span>
<span class=linenos data-linenos="345 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="346 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="347 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="348 "></span>    <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>process_type</span><span class=p>,</span> <span class=n>ProcessTypes</span><span class=p>):</span>
<span class=linenos data-linenos="349 "></span>        <span class=n>msg</span> <span class=o>=</span> <span class=p>(</span>
<span class=linenos data-linenos="350 "></span>            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB605</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: error while adding &quot;</span>
<span class=linenos data-linenos="351 "></span>            <span class=s2>&quot;preprocess, `process_type` should be an instance &quot;</span>
<span class=linenos data-linenos="352 "></span>            <span class=s2>&quot;of `fedbiomed.common.constants.ProcessTypes`.&quot;</span>
<span class=linenos data-linenos="353 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="354 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="355 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="356 "></span>    <span class=c1># NOTE: this may be revised into a list rather than OrderedDict</span>
<span class=linenos data-linenos="357 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>pre_processes</span><span class=p>[</span><span class=n>method</span><span class=o>.</span><span class=vm>__name__</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
<span class=linenos data-linenos="358 "></span>        <span class=s1>&#39;method&#39;</span><span class=p>:</span> <span class=n>method</span><span class=p>,</span>
<span class=linenos data-linenos="359 "></span>        <span class=s1>&#39;process_type&#39;</span><span class=p>:</span> <span class=n>process_type</span>
<span class=linenos data-linenos="360 "></span>    <span class=p>}</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.after_training_params class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">after_training_params</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>after_training_params</span><span class=p>(</span><span class=n>flatten</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Return the wrapped model's parameters for aggregation.</p> <p>This method returns a dict containing parameters that need to be reported back and aggregated in a federated learning setting.</p> <p>It may also implement post-processing steps to make these parameters suitable for sharing with the researcher after training - hence its being used over <code>get_model_params</code> at the end of training rounds.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>], <a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]]</code> </td> <td> <div class=doc-md-description> <p>The trained parameters to aggregate.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="627 "></span><span class=k>def</span> <span class=nf>after_training_params</span><span class=p>(</span>
<span class=linenos data-linenos="628 "></span>    <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="629 "></span>    <span class=n>flatten</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
<span class=linenos data-linenos="630 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=nb>float</span><span class=p>]]:</span>
<span class=linenos data-linenos="631 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Return the wrapped model&#39;s parameters for aggregation.</span>
<span class=linenos data-linenos="632 "></span>
<span class=linenos data-linenos="633 "></span><span class=sd>    This method returns a dict containing parameters that need to be</span>
<span class=linenos data-linenos="634 "></span><span class=sd>    reported back and aggregated in a federated learning setting.</span>
<span class=linenos data-linenos="635 "></span>
<span class=linenos data-linenos="636 "></span><span class=sd>    It may also implement post-processing steps to make these parameters</span>
<span class=linenos data-linenos="637 "></span><span class=sd>    suitable for sharing with the researcher after training - hence its</span>
<span class=linenos data-linenos="638 "></span><span class=sd>    being used over `get_model_params` at the end of training rounds.</span>
<span class=linenos data-linenos="639 "></span>
<span class=linenos data-linenos="640 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="641 "></span><span class=sd>        The trained parameters to aggregate.</span>
<span class=linenos data-linenos="642 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="643 "></span>    <span class=n>exclude_buffers</span> <span class=o>=</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span><span class=p>[</span><span class=s1>&#39;share_persistent_buffers&#39;</span><span class=p>]</span>
<span class=linenos data-linenos="644 "></span>    <span class=k>if</span> <span class=n>flatten</span><span class=p>:</span>
<span class=linenos data-linenos="645 "></span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>flatten</span><span class=p>(</span><span class=n>exclude_buffers</span><span class=o>=</span><span class=n>exclude_buffers</span><span class=p>)</span>
<span class=linenos data-linenos="646 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_model_params</span><span class=p>(</span><span class=n>exclude_buffers</span><span class=o>=</span><span class=n>exclude_buffers</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.export_model class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">export_model</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>export_model</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Export the wrapped model to a dump file.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>filename</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>path to the file where the model will be saved.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>FedBiomedTrainingPlanError</code> </td> <td> <div class=doc-md-description> <p>raised if model has not be initialized through the</p> </div> </td> </tr> </tbody> </table> <p>!!! info "Notes": This method is designed to save the model to a local dump file for easy re-use by the same user, possibly outside of Fed-BioMed. It is not designed to produce trustworthy data dumps and is not used to exchange models and their weights as part of the federated learning process.</p> <div class=highlight><pre><span></span><code>To save the model parameters for sharing as part of the FL process,
use the `after_training_params` method (or `get_model_params` one
outside of a training context) and export results using
[`Serializer`][fedbiomed.common.serializer.Serializer].
</code></pre></div> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="648 "></span><span class=k>def</span> <span class=nf>export_model</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>filename</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="649 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Export the wrapped model to a dump file.</span>
<span class=linenos data-linenos="650 "></span>
<span class=linenos data-linenos="651 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="652 "></span><span class=sd>        filename: path to the file where the model will be saved.</span>
<span class=linenos data-linenos="653 "></span>
<span class=linenos data-linenos="654 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="655 "></span><span class=sd>        FedBiomedTrainingPlanError: raised if model has not be initialized through the</span>
<span class=linenos data-linenos="656 "></span><span class=sd>        `post_init` method. If you need to export the model, you must do it through</span>
<span class=linenos data-linenos="657 "></span><span class=sd>        [`Experiment`][`fedbiomed.researcher.federated_workflows.Experiment`]&#39;s interface.</span>
<span class=linenos data-linenos="658 "></span>
<span class=linenos data-linenos="659 "></span><span class=sd>    !!! info &quot;Notes&quot;:</span>
<span class=linenos data-linenos="660 "></span><span class=sd>        This method is designed to save the model to a local dump</span>
<span class=linenos data-linenos="661 "></span><span class=sd>        file for easy re-use by the same user, possibly outside of</span>
<span class=linenos data-linenos="662 "></span><span class=sd>        Fed-BioMed. It is not designed to produce trustworthy data</span>
<span class=linenos data-linenos="663 "></span><span class=sd>        dumps and is not used to exchange models and their weights</span>
<span class=linenos data-linenos="664 "></span><span class=sd>        as part of the federated learning process.</span>
<span class=linenos data-linenos="665 "></span>
<span class=linenos data-linenos="666 "></span><span class=sd>        To save the model parameters for sharing as part of the FL process,</span>
<span class=linenos data-linenos="667 "></span><span class=sd>        use the `after_training_params` method (or `get_model_params` one</span>
<span class=linenos data-linenos="668 "></span><span class=sd>        outside of a training context) and export results using</span>
<span class=linenos data-linenos="669 "></span><span class=sd>        [`Serializer`][fedbiomed.common.serializer.Serializer].</span>
<span class=linenos data-linenos="670 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="671 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="672 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_error_msg_import_model</span> <span class=o>%</span> <span class=s2>&quot;export&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="673 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>export</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.get_model_params class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_model_params</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>get_model_params</span><span class=p>(</span><span class=n>only_trainable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>exclude_buffers</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Return a copy of the model's trainable weights.</p> <p>The type of data structure used to store weights depends on the actual framework of the wrapped model.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>only_trainable</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </td> <td> <div class=doc-md-description> <p>Whether to ignore non-trainable model parameters from outputs (e.g. frozen neural network layers' parameters), or include all model parameters (the default).</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td><code>exclude_buffers</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </td> <td> <div class=doc-md-description> <p>Whether to ignore buffers (the default), or include them.</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code> </td> <td> <div class=doc-md-description> <p>Model weights, as a dictionary mapping parameters' names to their value.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="275 "></span><span class=k>def</span> <span class=nf>get_model_params</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="276 "></span>                     <span class=n>only_trainable</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
<span class=linenos data-linenos="277 "></span>                     <span class=n>exclude_buffers</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<span class=linenos data-linenos="278 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Return a copy of the model&#39;s trainable weights.</span>
<span class=linenos data-linenos="279 "></span>
<span class=linenos data-linenos="280 "></span><span class=sd>    The type of data structure used to store weights depends on the actual</span>
<span class=linenos data-linenos="281 "></span><span class=sd>    framework of the wrapped model.</span>
<span class=linenos data-linenos="282 "></span>
<span class=linenos data-linenos="283 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="284 "></span><span class=sd>        only_trainable: Whether to ignore non-trainable model parameters</span>
<span class=linenos data-linenos="285 "></span><span class=sd>            from outputs (e.g. frozen neural network layers&#39; parameters),</span>
<span class=linenos data-linenos="286 "></span><span class=sd>            or include all model parameters (the default).</span>
<span class=linenos data-linenos="287 "></span><span class=sd>        exclude_buffers: Whether to ignore buffers (the default), or</span>
<span class=linenos data-linenos="288 "></span><span class=sd>            include them.</span>
<span class=linenos data-linenos="289 "></span>
<span class=linenos data-linenos="290 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="291 "></span><span class=sd>        Model weights, as a dictionary mapping parameters&#39; names to their value.</span>
<span class=linenos data-linenos="292 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="293 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>get_weights</span><span class=p>(</span><span class=n>only_trainable</span><span class=o>=</span><span class=n>only_trainable</span><span class=p>,</span> <span class=n>exclude_buffers</span><span class=o>=</span><span class=n>exclude_buffers</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.get_model_wrapper_class class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_model_wrapper_class</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>get_model_wrapper_class</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Gets training plan's model wrapper class.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-internal" title="fedbiomed.common.models.Model" href="../models/#fedbiomed.common.models.Model">Model</a>]</code> </td> <td> <div class=doc-md-description> <p>the wrapper class for the model, or None</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-internal" title="fedbiomed.common.models.Model" href="../models/#fedbiomed.common.models.Model">Model</a>]</code> </td> <td> <div class=doc-md-description> <p>if model is not instantiated.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="88 "></span><span class=k>def</span> <span class=nf>get_model_wrapper_class</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Model</span><span class=p>]:</span>
<span class=linenos data-linenos="89 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Gets training plan&#39;s model wrapper class.</span>
<span class=linenos data-linenos="90 "></span>
<span class=linenos data-linenos="91 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="92 "></span><span class=sd>        the wrapper class for the model, or None</span>
<span class=linenos data-linenos="93 "></span><span class=sd>        if model is not instantiated.</span>
<span class=linenos data-linenos="94 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="95 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.import_model class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">import_model</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>import_model</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Import and replace the wrapped model from a dump file.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>filename</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>path to the file where the model has been exported.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>FedBiomedTrainingPlanError</code> </td> <td> <div class=doc-md-description> <p>raised if model has not be initialized through the</p> </div> </td> </tr> </tbody> </table> <p>!!! info "Notes": This method is designed to load the model from a local dump file, that might not be in a trustworthy format. It should therefore only be used to re-load data exported locally and not received from someone else, including other FL peers.</p> <div class=highlight><pre><span></span><code>To load model parameters shared as part of the FL process, use the
[`Serializer`][fedbiomed.common.serializer.Serializer] to read the
network-exchanged file, and the `set_model_params` method to assign
the loaded values into the wrapped model.
</code></pre></div> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="675 "></span><span class=k>def</span> <span class=nf>import_model</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>filename</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="676 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Import and replace the wrapped model from a dump file.</span>
<span class=linenos data-linenos="677 "></span>
<span class=linenos data-linenos="678 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="679 "></span><span class=sd>        filename: path to the file where the model has been exported.</span>
<span class=linenos data-linenos="680 "></span>
<span class=linenos data-linenos="681 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="682 "></span><span class=sd>        FedBiomedTrainingPlanError: raised if model has not be initialized through the</span>
<span class=linenos data-linenos="683 "></span><span class=sd>        `post_init` method. If you need to export the model from the Training Plan, you</span>
<span class=linenos data-linenos="684 "></span><span class=sd>        must do it through [`Experiment`][`fedbiomed.researcher.federated_workflows.Experiment`]&#39;s</span>
<span class=linenos data-linenos="685 "></span><span class=sd>        interface.</span>
<span class=linenos data-linenos="686 "></span>
<span class=linenos data-linenos="687 "></span><span class=sd>    !!! info &quot;Notes&quot;:</span>
<span class=linenos data-linenos="688 "></span><span class=sd>        This method is designed to load the model from a local dump</span>
<span class=linenos data-linenos="689 "></span><span class=sd>        file, that might not be in a trustworthy format. It should</span>
<span class=linenos data-linenos="690 "></span><span class=sd>        therefore only be used to re-load data exported locally and</span>
<span class=linenos data-linenos="691 "></span><span class=sd>        not received from someone else, including other FL peers.</span>
<span class=linenos data-linenos="692 "></span>
<span class=linenos data-linenos="693 "></span><span class=sd>        To load model parameters shared as part of the FL process, use the</span>
<span class=linenos data-linenos="694 "></span><span class=sd>        [`Serializer`][fedbiomed.common.serializer.Serializer] to read the</span>
<span class=linenos data-linenos="695 "></span><span class=sd>        network-exchanged file, and the `set_model_params` method to assign</span>
<span class=linenos data-linenos="696 "></span><span class=sd>        the loaded values into the wrapped model.</span>
<span class=linenos data-linenos="697 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="698 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="699 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_error_msg_import_model</span> <span class=o>%</span> <span class=s2>&quot;import&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="700 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="701 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>reload</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
<span class=linenos data-linenos="702 "></span>    <span class=k>except</span> <span class=n>FedbiomedModelError</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
<span class=linenos data-linenos="703 "></span>        <span class=n>msg</span> <span class=o>=</span> <span class=p>(</span>
<span class=linenos data-linenos="704 "></span>            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB304</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: failed to import a model from &quot;</span>
<span class=linenos data-linenos="705 "></span>            <span class=sa>f</span><span class=s2>&quot;a dump file: </span><span class=si>{</span><span class=n>exc</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="706 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="707 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="708 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span> <span class=kn>from</span> <span class=nn>exc</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.init_dependencies class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">init_dependencies</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>init_dependencies</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Default method where dependencies are returned</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code> </td> <td> <div class=doc-md-description> <p>Empty list as default</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="187 "></span><span class=k>def</span> <span class=nf>init_dependencies</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=linenos data-linenos="188 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Default method where dependencies are returned</span>
<span class=linenos data-linenos="189 "></span>
<span class=linenos data-linenos="190 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="191 "></span><span class=sd>        Empty list as default</span>
<span class=linenos data-linenos="192 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="193 "></span>    <span class=k>return</span> <span class=p>[]</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.init_optimizer class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">init_optimizer</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>init_optimizer</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Method for declaring optimizer by default</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></code> </td> <td> <div class=doc-md-description> <p>either framework specific optimizer (or None) or</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></code> </td> <td> <div class=doc-md-description> <p>FedBiomed [<code>Optimizers</code>][<code>fedbiomed.common.optimizers.Optimizer</code>]</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="310 "></span><span class=nd>@abstractmethod</span>
<span class=linenos data-linenos="311 "></span><span class=k>def</span> <span class=nf>init_optimizer</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
<span class=linenos data-linenos="312 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Method for declaring optimizer by default</span>
<span class=linenos data-linenos="313 "></span>
<span class=linenos data-linenos="314 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="315 "></span><span class=sd>        either framework specific optimizer (or None) or</span>
<span class=linenos data-linenos="316 "></span><span class=sd>        FedBiomed [`Optimizers`][`fedbiomed.common.optimizers.Optimizer`]</span>
<span class=linenos data-linenos="317 "></span><span class=sd>    &quot;&quot;&quot;</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.loader_args class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">loader_args</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>loader_args</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Retrieve loader arguments</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code> </td> <td> <div class=doc-md-description> <p>Loader arguments</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="726 "></span><span class=k>def</span> <span class=nf>loader_args</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<span class=linenos data-linenos="727 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Retrieve loader arguments</span>
<span class=linenos data-linenos="728 "></span>
<span class=linenos data-linenos="729 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="730 "></span><span class=sd>        Loader arguments</span>
<span class=linenos data-linenos="731 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="732 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_loader_args</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.model class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">model</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>model</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Gets model instance of the training plan</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="81 "></span><span class=nd>@abstractmethod</span>
<span class=linenos data-linenos="82 "></span><span class=k>def</span> <span class=nf>model</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=linenos data-linenos="83 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Gets model instance of the training plan&quot;&quot;&quot;</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.model_args class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">model_args</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>model_args</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Retrieve model arguments.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code> </td> <td> <div class=doc-md-description> <p>Model arguments</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="710 "></span><span class=k>def</span> <span class=nf>model_args</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<span class=linenos data-linenos="711 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Retrieve model arguments.</span>
<span class=linenos data-linenos="712 "></span>
<span class=linenos data-linenos="713 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="714 "></span><span class=sd>        Model arguments</span>
<span class=linenos data-linenos="715 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="716 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model_args</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.optimizer class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">optimizer</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>optimizer</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Get the BaseOptimizer wrapped by this training plan.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-internal" title="fedbiomed.common.optimizers.generic_optimizers.BaseOptimizer" href="../optimizers/#fedbiomed.common.optimizers.BaseOptimizer">BaseOptimizer</a>]</code> </td> <td> <div class=doc-md-description> <p>BaseOptimizer wrapped by this training plan, or None if</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-internal" title="fedbiomed.common.optimizers.generic_optimizers.BaseOptimizer" href="../optimizers/#fedbiomed.common.optimizers.BaseOptimizer">BaseOptimizer</a>]</code> </td> <td> <div class=doc-md-description> <p>it has not been initialized yet.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="101 "></span><span class=k>def</span> <span class=nf>optimizer</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>BaseOptimizer</span><span class=p>]:</span>
<span class=linenos data-linenos="102 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get the BaseOptimizer wrapped by this training plan.</span>
<span class=linenos data-linenos="103 "></span>
<span class=linenos data-linenos="104 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="105 "></span><span class=sd>        BaseOptimizer wrapped by this training plan, or None if</span>
<span class=linenos data-linenos="106 "></span><span class=sd>        it has not been initialized yet.</span>
<span class=linenos data-linenos="107 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="108 "></span>    <span class=c1># FUTURE: return `self._optimizer.optimizer` instead?</span>
<span class=linenos data-linenos="109 "></span>    <span class=c1># Currently, the legacy Scaffold implem. needs the BaseOptimizer,</span>
<span class=linenos data-linenos="110 "></span>    <span class=c1># but IMHO it really should remain a private backend component.</span>
<span class=linenos data-linenos="111 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.optimizer_args class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">optimizer_args</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>optimizer_args</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Retrieves optimizer arguments</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code> </td> <td> <div class=doc-md-description> <p>Optimizer arguments</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="734 "></span><span class=k>def</span> <span class=nf>optimizer_args</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<span class=linenos data-linenos="735 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Retrieves optimizer arguments</span>
<span class=linenos data-linenos="736 "></span>
<span class=linenos data-linenos="737 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="738 "></span><span class=sd>        Optimizer arguments</span>
<span class=linenos data-linenos="739 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="740 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer_args</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.post_init class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">post_init</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>post_init</span><span class=p>(</span><span class=n>model_args</span><span class=p>,</span> <span class=n>training_args</span><span class=p>,</span> <span class=n>aggregator_args</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>initialize_optimizer</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Process model, training and optimizer arguments.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>model_args</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code> </td> <td> <div class=doc-md-description> <p>Arguments defined to instantiate the wrapped model.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>training_args</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code> </td> <td> <div class=doc-md-description> <p>Arguments that are used in training routines such as epoch, dry_run etc. Please see <a class="autorefs autorefs-internal" href="../training_args/#fedbiomed.common.training_args.TrainingArgs"><code>TrainingArgs</code></a></p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>aggregator_args</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]]</code> </td> <td> <div class=doc-md-description> <p>Arguments managed by and shared with the researcher-side aggregator.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>initialize_optimizer</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </td> <td> <div class=doc-md-description> <p>whether to initialize the optimizer or not. Defaults to True.</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="116 "></span><span class=nd>@abstractmethod</span>
<span class=linenos data-linenos="117 "></span><span class=k>def</span> <span class=nf>post_init</span><span class=p>(</span>
<span class=linenos data-linenos="118 "></span>        <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="119 "></span>        <span class=n>model_args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
<span class=linenos data-linenos="120 "></span>        <span class=n>training_args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
<span class=linenos data-linenos="121 "></span>        <span class=n>aggregator_args</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="122 "></span>        <span class=n>initialize_optimizer</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>
<span class=linenos data-linenos="123 "></span>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="124 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Process model, training and optimizer arguments.</span>
<span class=linenos data-linenos="125 "></span>
<span class=linenos data-linenos="126 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="127 "></span><span class=sd>        model_args: Arguments defined to instantiate the wrapped model.</span>
<span class=linenos data-linenos="128 "></span><span class=sd>        training_args: Arguments that are used in training routines</span>
<span class=linenos data-linenos="129 "></span><span class=sd>            such as epoch, dry_run etc.</span>
<span class=linenos data-linenos="130 "></span><span class=sd>            Please see [`TrainingArgs`][fedbiomed.common.training_args.TrainingArgs]</span>
<span class=linenos data-linenos="131 "></span><span class=sd>        aggregator_args: Arguments managed by and shared with the</span>
<span class=linenos data-linenos="132 "></span><span class=sd>            researcher-side aggregator.</span>
<span class=linenos data-linenos="133 "></span><span class=sd>        initialize_optimizer: whether to initialize the optimizer or not. Defaults</span>
<span class=linenos data-linenos="134 "></span><span class=sd>            to True.</span>
<span class=linenos data-linenos="135 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="136 "></span>
<span class=linenos data-linenos="137 "></span>    <span class=c1># Store various arguments provided by the researcher</span>
<span class=linenos data-linenos="138 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_model_args</span> <span class=o>=</span> <span class=n>model_args</span>
<span class=linenos data-linenos="139 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span> <span class=o>=</span> <span class=n>aggregator_args</span> <span class=ow>or</span> <span class=p>{}</span>
<span class=linenos data-linenos="140 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer_args</span> <span class=o>=</span> <span class=n>training_args</span><span class=o>.</span><span class=n>optimizer_arguments</span><span class=p>()</span> <span class=ow>or</span> <span class=p>{}</span>
<span class=linenos data-linenos="141 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_loader_args</span> <span class=o>=</span> <span class=n>training_args</span><span class=o>.</span><span class=n>loader_arguments</span><span class=p>()</span> <span class=ow>or</span> <span class=p>{}</span>
<span class=linenos data-linenos="142 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span> <span class=o>=</span> <span class=n>training_args</span><span class=o>.</span><span class=n>pure_training_arguments</span><span class=p>()</span>
<span class=linenos data-linenos="143 "></span>
<span class=linenos data-linenos="144 "></span>    <span class=c1># Set random seed: the seed can be either None or an int provided by the researcher.</span>
<span class=linenos data-linenos="145 "></span>    <span class=c1># when it is None, both random.seed and np.random.seed rely on the OS to generate a random seed.</span>
<span class=linenos data-linenos="146 "></span>    <span class=n>rseed</span> <span class=o>=</span> <span class=n>training_args</span><span class=p>[</span><span class=s1>&#39;random_seed&#39;</span><span class=p>]</span>
<span class=linenos data-linenos="147 "></span>    <span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=n>rseed</span><span class=p>)</span>
<span class=linenos data-linenos="148 "></span>    <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=n>rseed</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.save_code class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">save_code</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>save_code</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=n>from_code</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Saves the class source/codes of the training plan class that is created byuser.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>filepath</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>path to the destination file</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanError" href="../exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanError">FedbiomedTrainingPlanError</a></code> </td> <td> <div class=doc-md-description> <p>raised when source of the model class cannot be assessed</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanError" href="../exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanError">FedbiomedTrainingPlanError</a></code> </td> <td> <div class=doc-md-description> <p>raised when model file cannot be created/opened/edited</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="227 "></span><span class=k>def</span> <span class=nf>save_code</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>filepath</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>from_code</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="228 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Saves the class source/codes of the training plan class that is created byuser.</span>
<span class=linenos data-linenos="229 "></span>
<span class=linenos data-linenos="230 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="231 "></span><span class=sd>        filepath: path to the destination file</span>
<span class=linenos data-linenos="232 "></span>
<span class=linenos data-linenos="233 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="234 "></span><span class=sd>        FedbiomedTrainingPlanError: raised when source of the model class cannot be assessed</span>
<span class=linenos data-linenos="235 "></span><span class=sd>        FedbiomedTrainingPlanError: raised when model file cannot be created/opened/edited</span>
<span class=linenos data-linenos="236 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="237 "></span>    <span class=k>if</span> <span class=n>from_code</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="238 "></span>        <span class=n>content</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>source</span><span class=p>()</span>
<span class=linenos data-linenos="239 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="240 "></span>        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>from_code</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
<span class=linenos data-linenos="241 "></span>            <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB605</span><span class=si>}</span><span class=s2>: Expected type str for `from_code`, &quot;</span>
<span class=linenos data-linenos="242 "></span>                                             <span class=s2>&quot;got: {type(from_code)}&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="243 "></span>        <span class=n>content</span> <span class=o>=</span> <span class=n>from_code</span>
<span class=linenos data-linenos="244 "></span>
<span class=linenos data-linenos="245 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="246 "></span>        <span class=c1># should we write it in binary (for the sake of space optimization)?</span>
<span class=linenos data-linenos="247 "></span>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
<span class=linenos data-linenos="248 "></span>            <span class=n>file</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
<span class=linenos data-linenos="249 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Model file has been saved: &quot;</span> <span class=o>+</span> <span class=n>filepath</span><span class=p>)</span>
<span class=linenos data-linenos="250 "></span>    <span class=k>except</span> <span class=ne>PermissionError</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
<span class=linenos data-linenos="251 "></span>        <span class=n>_msg</span> <span class=o>=</span> <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB605</span><span class=o>.</span><span class=n>value</span> <span class=o>+</span> <span class=sa>f</span><span class=s2>&quot; : Unable to read </span><span class=si>{</span><span class=n>filepath</span><span class=si>}</span><span class=s2> due to unsatisfactory privileges&quot;</span> <span class=o>+</span> \
<span class=linenos data-linenos="252 "></span>               <span class=s2>&quot;, can&#39;t write the model content into it&quot;</span>
<span class=linenos data-linenos="253 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=n>_msg</span><span class=p>)</span>
<span class=linenos data-linenos="254 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=n>_msg</span><span class=p>)</span> <span class=kn>from</span> <span class=nn>exc</span>
<span class=linenos data-linenos="255 "></span>    <span class=k>except</span> <span class=ne>MemoryError</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
<span class=linenos data-linenos="256 "></span>        <span class=n>_msg</span> <span class=o>=</span> <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB605</span><span class=o>.</span><span class=n>value</span> <span class=o>+</span> <span class=sa>f</span><span class=s2>&quot; : Can&#39;t write model file on </span><span class=si>{</span><span class=n>filepath</span><span class=si>}</span><span class=s2>: out of memory!&quot;</span>
<span class=linenos data-linenos="257 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=n>_msg</span><span class=p>)</span>
<span class=linenos data-linenos="258 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=n>_msg</span><span class=p>)</span> <span class=kn>from</span> <span class=nn>exc</span>
<span class=linenos data-linenos="259 "></span>    <span class=k>except</span> <span class=ne>OSError</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
<span class=linenos data-linenos="260 "></span>        <span class=n>_msg</span> <span class=o>=</span> <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB605</span><span class=o>.</span><span class=n>value</span> <span class=o>+</span> <span class=sa>f</span><span class=s2>&quot; : Can&#39;t open file </span><span class=si>{</span><span class=n>filepath</span><span class=si>}</span><span class=s2> to write model content&quot;</span>
<span class=linenos data-linenos="261 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=n>_msg</span><span class=p>)</span>
<span class=linenos data-linenos="262 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=n>_msg</span><span class=p>)</span> <span class=kn>from</span> <span class=nn>exc</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.set_aggregator_args class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">set_aggregator_args</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>set_aggregator_args</span><span class=p>(</span><span class=n>aggregator_args</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="307 "></span><span class=k>def</span> <span class=nf>set_aggregator_args</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregator_args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
<span class=linenos data-linenos="308 "></span>    <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=s2>&quot;method not implemented and needed&quot;</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.set_data_loaders class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">set_data_loaders</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>set_data_loaders</span><span class=p>(</span><span class=n>train_data_loader</span><span class=p>,</span> <span class=n>test_data_loader</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Sets data loaders</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>train_data_loader</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.utils.data.DataLoader" href="https://pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader">DataLoader</a>, <a class="autorefs autorefs-internal" title="fedbiomed.common.data.NPDataLoader" href="../data/#fedbiomed.common.data.NPDataLoader">NPDataLoader</a>, None]</code> </td> <td> <div class=doc-md-description> <p>Data loader for training routine/loop</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>test_data_loader</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.utils.data.DataLoader" href="https://pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader">DataLoader</a>, <a class="autorefs autorefs-internal" title="fedbiomed.common.data.NPDataLoader" href="../data/#fedbiomed.common.data.NPDataLoader">NPDataLoader</a>, None]</code> </td> <td> <div class=doc-md-description> <p>Data loader for validation routine</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="173 "></span><span class=k>def</span> <span class=nf>set_data_loaders</span><span class=p>(</span>
<span class=linenos data-linenos="174 "></span>        <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="175 "></span>        <span class=n>train_data_loader</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>DataLoader</span><span class=p>,</span> <span class=n>NPDataLoader</span><span class=p>,</span> <span class=kc>None</span><span class=p>],</span>
<span class=linenos data-linenos="176 "></span>        <span class=n>test_data_loader</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>DataLoader</span><span class=p>,</span> <span class=n>NPDataLoader</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span>
<span class=linenos data-linenos="177 "></span>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="178 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Sets data loaders</span>
<span class=linenos data-linenos="179 "></span>
<span class=linenos data-linenos="180 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="181 "></span><span class=sd>        train_data_loader: Data loader for training routine/loop</span>
<span class=linenos data-linenos="182 "></span><span class=sd>        test_data_loader: Data loader for validation routine</span>
<span class=linenos data-linenos="183 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="184 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>training_data_loader</span> <span class=o>=</span> <span class=n>train_data_loader</span>
<span class=linenos data-linenos="185 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>testing_data_loader</span> <span class=o>=</span> <span class=n>test_data_loader</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.set_dataset_path class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">set_dataset_path</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>set_dataset_path</span><span class=p>(</span><span class=n>dataset_path</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Dataset path setter for TrainingPlan</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>dataset_path</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>The path where data is saved on the node. This method is called by the node that executes the training.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="163 "></span><span class=k>def</span> <span class=nf>set_dataset_path</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>dataset_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="164 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Dataset path setter for TrainingPlan</span>
<span class=linenos data-linenos="165 "></span>
<span class=linenos data-linenos="166 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="167 "></span><span class=sd>        dataset_path: The path where data is saved on the node.</span>
<span class=linenos data-linenos="168 "></span><span class=sd>            This method is called by the node that executes the training.</span>
<span class=linenos data-linenos="169 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="170 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>dataset_path</span> <span class=o>=</span> <span class=n>dataset_path</span>
<span class=linenos data-linenos="171 "></span>    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Dataset path has been set as </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.set_model_params class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">set_model_params</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>set_model_params</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Assign new values to the model's trainable parameters.</p> <p>The type of data structure used to store weights depends on the actual framework of the wrapped model.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>params</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code> </td> <td> <div class=doc-md-description> <p>model weights, as a dictionary mapping parameters' names to their value.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="295 "></span><span class=k>def</span> <span class=nf>set_model_params</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>params</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="296 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Assign new values to the model&#39;s trainable parameters.</span>
<span class=linenos data-linenos="297 "></span>
<span class=linenos data-linenos="298 "></span><span class=sd>    The type of data structure used to store weights depends on the actual</span>
<span class=linenos data-linenos="299 "></span><span class=sd>    framework of the wrapped model.</span>
<span class=linenos data-linenos="300 "></span>
<span class=linenos data-linenos="301 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="302 "></span><span class=sd>        params: model weights, as a dictionary mapping parameters&#39; names</span>
<span class=linenos data-linenos="303 "></span><span class=sd>            to their value.</span>
<span class=linenos data-linenos="304 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="305 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>set_weights</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.set_optimizer class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">set_optimizer</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>set_optimizer</span><span class=p>(</span><span class=n>optimizer</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="113 "></span><span class=k>def</span> <span class=nf>set_optimizer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>optimizer</span><span class=p>:</span> <span class=n>BaseOptimizer</span><span class=p>):</span>
<span class=linenos data-linenos="114 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer</span> <span class=o>=</span> <span class=n>optimizer</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.source class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">source</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>source</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="211 "></span><span class=k>def</span> <span class=nf>source</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=linenos data-linenos="212 "></span>
<span class=linenos data-linenos="213 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="214 "></span>        <span class=n>class_source</span> <span class=o>=</span> <span class=n>get_class_source</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=vm>__class__</span><span class=p>)</span>
<span class=linenos data-linenos="215 "></span>    <span class=k>except</span> <span class=n>FedbiomedError</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
<span class=linenos data-linenos="216 "></span>        <span class=n>msg</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB605</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: error while getting source of the model class: </span><span class=si>{</span><span class=n>exc</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="217 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="218 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span> <span class=kn>from</span> <span class=nn>exc</span>
<span class=linenos data-linenos="219 "></span>
<span class=linenos data-linenos="220 "></span>    <span class=c1># Preparing content of the module</span>
<span class=linenos data-linenos="221 "></span>    <span class=n>content</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_dependencies</span><span class=p>)</span>
<span class=linenos data-linenos="222 "></span>    <span class=n>content</span> <span class=o>+=</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="223 "></span>    <span class=n>content</span> <span class=o>+=</span> <span class=n>class_source</span>
<span class=linenos data-linenos="224 "></span>
<span class=linenos data-linenos="225 "></span>    <span class=k>return</span> <span class=n>content</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.testing_routine class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">testing_routine</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>testing_routine</span><span class=p>(</span><span class=n>metric</span><span class=p>,</span> <span class=n>metric_args</span><span class=p>,</span> <span class=n>history_monitor</span><span class=p>,</span> <span class=n>before_train</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Evaluation routine, to be called once per round.</p> <div class="admonition info"> <p class=admonition-title>Note</p> <p>If the training plan implements a <code>testing_step</code> method (the signature of which is func(data, target) -&gt; metrics) then it will be used rather than the input metric.</p> </div> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>metric</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-internal" title="fedbiomed.common.metrics.MetricTypes" href="../metrics/#fedbiomed.common.metrics.MetricTypes">MetricTypes</a>]</code> </td> <td> <div class=doc-md-description> <p>The metric used for validation. If None, use MetricTypes.ACCURACY.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>metric_args</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code> </td> <td> <div class=doc-md-description> <p>dicitonary containing additinal arguments for setting up metric, that maps <argument_name; argument_value> ad that will be passed to the metric function as positinal arguments.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>history_monitor</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[HistoryMonitor]</code> </td> <td> <div class=doc-md-description> <p>HistoryMonitor instance, used to record computed metrics and communicate them to the researcher (server).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>before_train</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </td> <td> <div class=doc-md-description> <p>Whether the evaluation is being performed before local training occurs, of afterwards. This is merely reported back through <code>history_monitor</code>.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="505 "></span><span class=k>def</span> <span class=nf>testing_routine</span><span class=p>(</span>
<span class=linenos data-linenos="506 "></span>        <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="507 "></span>        <span class=n>metric</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>MetricTypes</span><span class=p>],</span>
<span class=linenos data-linenos="508 "></span>        <span class=n>metric_args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
<span class=linenos data-linenos="509 "></span>        <span class=n>history_monitor</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=s1>&#39;HistoryMonitor&#39;</span><span class=p>],</span>
<span class=linenos data-linenos="510 "></span>        <span class=n>before_train</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span>
<span class=linenos data-linenos="511 "></span>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="512 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Evaluation routine, to be called once per round.</span>
<span class=linenos data-linenos="513 "></span>
<span class=linenos data-linenos="514 "></span><span class=sd>    !!! info &quot;Note&quot;</span>
<span class=linenos data-linenos="515 "></span><span class=sd>        If the training plan implements a `testing_step` method</span>
<span class=linenos data-linenos="516 "></span><span class=sd>        (the signature of which is func(data, target) -&gt; metrics)</span>
<span class=linenos data-linenos="517 "></span><span class=sd>        then it will be used rather than the input metric.</span>
<span class=linenos data-linenos="518 "></span>
<span class=linenos data-linenos="519 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="520 "></span><span class=sd>        metric: The metric used for validation.</span>
<span class=linenos data-linenos="521 "></span><span class=sd>            If None, use MetricTypes.ACCURACY.</span>
<span class=linenos data-linenos="522 "></span><span class=sd>        metric_args: dicitonary containing additinal arguments for setting up metric,</span>
<span class=linenos data-linenos="523 "></span><span class=sd>            that maps &lt;argument_name; argument_value&gt; ad that will be passed to the</span>
<span class=linenos data-linenos="524 "></span><span class=sd>            metric function as positinal arguments.</span>
<span class=linenos data-linenos="525 "></span><span class=sd>        history_monitor: HistoryMonitor instance,</span>
<span class=linenos data-linenos="526 "></span><span class=sd>            used to record computed metrics and communicate them to</span>
<span class=linenos data-linenos="527 "></span><span class=sd>            the researcher (server).</span>
<span class=linenos data-linenos="528 "></span><span class=sd>        before_train: Whether the evaluation is being performed</span>
<span class=linenos data-linenos="529 "></span><span class=sd>            before local training occurs, of afterwards. This is merely</span>
<span class=linenos data-linenos="530 "></span><span class=sd>            reported back through `history_monitor`.</span>
<span class=linenos data-linenos="531 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="532 "></span>    <span class=c1># TODO: Add preprocess option for testing_data_loader.</span>
<span class=linenos data-linenos="533 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>testing_data_loader</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="534 "></span>        <span class=n>msg</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB605</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: no validation dataset was set.&quot;</span>
<span class=linenos data-linenos="535 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="536 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="537 "></span>
<span class=linenos data-linenos="538 "></span>    <span class=n>n_samples</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>testing_data_loader</span><span class=o>.</span><span class=n>dataset</span><span class=p>)</span>
<span class=linenos data-linenos="539 "></span>    <span class=n>n_batches</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>testing_data_loader</span><span class=p>)</span> <span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<span class=linenos data-linenos="540 "></span>
<span class=linenos data-linenos="541 "></span>    <span class=c1># Set up a batch-wise metrics-computation function.</span>
<span class=linenos data-linenos="542 "></span>    <span class=c1># Either use an optionally-implemented custom training routine.</span>
<span class=linenos data-linenos="543 "></span>    <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;testing_step&quot;</span><span class=p>):</span>
<span class=linenos data-linenos="544 "></span>        <span class=n>evaluate</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;testing_step&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="545 "></span>        <span class=n>metric_name</span> <span class=o>=</span> <span class=s2>&quot;Custom&quot;</span>
<span class=linenos data-linenos="546 "></span>    <span class=c1># Or use the provided `metric` (or its default value).</span>
<span class=linenos data-linenos="547 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="548 "></span>        <span class=k>if</span> <span class=n>metric</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="549 "></span>            <span class=n>metric</span> <span class=o>=</span> <span class=n>MetricTypes</span><span class=o>.</span><span class=n>ACCURACY</span>
<span class=linenos data-linenos="550 "></span>        <span class=n>metric_controller</span> <span class=o>=</span> <span class=n>Metrics</span><span class=p>()</span>
<span class=linenos data-linenos="551 "></span>        <span class=k>def</span> <span class=nf>evaluate</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>target</span><span class=p>):</span>
<span class=linenos data-linenos="552 "></span>            <span class=k>nonlocal</span> <span class=n>metric</span><span class=p>,</span> <span class=n>metric_args</span><span class=p>,</span> <span class=n>metric_controller</span>
<span class=linenos data-linenos="553 "></span>            <span class=n>output</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
<span class=linenos data-linenos="554 "></span>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>target</span><span class=p>,</span> <span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>):</span>
<span class=linenos data-linenos="555 "></span>                <span class=n>target</span> <span class=o>=</span> <span class=n>target</span><span class=o>.</span><span class=n>numpy</span><span class=p>()</span>
<span class=linenos data-linenos="556 "></span>
<span class=linenos data-linenos="557 "></span>            <span class=k>return</span> <span class=n>metric_controller</span><span class=o>.</span><span class=n>evaluate</span><span class=p>(</span>
<span class=linenos data-linenos="558 "></span>                <span class=n>target</span><span class=p>,</span> <span class=n>output</span><span class=p>,</span> <span class=n>metric</span><span class=o>=</span><span class=n>metric</span><span class=p>,</span> <span class=o>**</span><span class=n>metric_args</span>
<span class=linenos data-linenos="559 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="560 "></span>        <span class=n>metric_name</span> <span class=o>=</span> <span class=n>metric</span><span class=o>.</span><span class=n>name</span>
<span class=linenos data-linenos="561 "></span>    <span class=c1># Iterate over the validation dataset and run the defined routine.</span>
<span class=linenos data-linenos="562 "></span>    <span class=n>num_samples_observed_till_now</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
<span class=linenos data-linenos="563 "></span>
<span class=linenos data-linenos="564 "></span>
<span class=linenos data-linenos="565 "></span>    <span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>target</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>testing_data_loader</span><span class=p>,</span> <span class=mi>1</span><span class=p>):</span>
<span class=linenos data-linenos="566 "></span>
<span class=linenos data-linenos="567 "></span>        <span class=n>num_samples_observed_till_now</span> <span class=o>+=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_infer_batch_size</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
<span class=linenos data-linenos="568 "></span>        <span class=c1># Run the evaluation step; catch and raise exceptions.</span>
<span class=linenos data-linenos="569 "></span>        <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="570 "></span>            <span class=n>m_value</span> <span class=o>=</span> <span class=n>evaluate</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>target</span><span class=p>)</span>
<span class=linenos data-linenos="571 "></span>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
<span class=linenos data-linenos="572 "></span>            <span class=n>msg</span> <span class=o>=</span> <span class=p>(</span>
<span class=linenos data-linenos="573 "></span>                <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB605</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: An error occurred &quot;</span>
<span class=linenos data-linenos="574 "></span>                <span class=sa>f</span><span class=s2>&quot;while computing the </span><span class=si>{</span><span class=n>metric_name</span><span class=si>}</span><span class=s2> metric: </span><span class=si>{</span><span class=n>exc</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="575 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="576 "></span>            <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="577 "></span>            <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span> <span class=kn>from</span> <span class=nn>exc</span>
<span class=linenos data-linenos="578 "></span>        <span class=c1># Log the computed value.</span>
<span class=linenos data-linenos="579 "></span>        <span class=c1># Reporting</span>
<span class=linenos data-linenos="580 "></span>
<span class=linenos data-linenos="581 "></span>        <span class=k>if</span> <span class=n>idx</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>training_args</span><span class=p>()[</span><span class=s1>&#39;log_interval&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>or</span> <span class=n>idx</span> <span class=o>==</span> <span class=mi>1</span> <span class=ow>or</span> <span class=n>idx</span> <span class=o>==</span> <span class=n>n_batches</span><span class=p>:</span>
<span class=linenos data-linenos="582 "></span>            <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
<span class=linenos data-linenos="583 "></span>                <span class=sa>f</span><span class=s2>&quot;Validation: Batch </span><span class=si>{</span><span class=n>idx</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>n_batches</span><span class=si>}</span><span class=s2> &quot;</span>
<span class=linenos data-linenos="584 "></span>                <span class=sa>f</span><span class=s2>&quot;| Samples </span><span class=si>{</span><span class=n>num_samples_observed_till_now</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>n_samples</span><span class=si>}</span><span class=s2> &quot;</span>
<span class=linenos data-linenos="585 "></span>                <span class=sa>f</span><span class=s2>&quot;| Metric[</span><span class=si>{</span><span class=n>metric_name</span><span class=si>}</span><span class=s2>]: </span><span class=si>{</span><span class=n>m_value</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="586 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="587 "></span>            <span class=c1># Further parse, and report it (provided a monitor is set).</span>
<span class=linenos data-linenos="588 "></span>            <span class=k>if</span> <span class=n>history_monitor</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="589 "></span>                <span class=n>m_dict</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_metric_result_dict</span><span class=p>(</span><span class=n>m_value</span><span class=p>,</span> <span class=n>metric_name</span><span class=p>)</span>
<span class=linenos data-linenos="590 "></span>                <span class=n>history_monitor</span><span class=o>.</span><span class=n>add_scalar</span><span class=p>(</span>
<span class=linenos data-linenos="591 "></span>                    <span class=n>metric</span><span class=o>=</span><span class=n>m_dict</span><span class=p>,</span>
<span class=linenos data-linenos="592 "></span>                    <span class=n>iteration</span><span class=o>=</span><span class=n>idx</span><span class=p>,</span>
<span class=linenos data-linenos="593 "></span>                    <span class=n>epoch</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="594 "></span>                    <span class=n>test</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
<span class=linenos data-linenos="595 "></span>                    <span class=n>test_on_local_updates</span><span class=o>=</span><span class=p>(</span><span class=ow>not</span> <span class=n>before_train</span><span class=p>),</span>
<span class=linenos data-linenos="596 "></span>                    <span class=n>test_on_global_updates</span><span class=o>=</span><span class=n>before_train</span><span class=p>,</span>
<span class=linenos data-linenos="597 "></span>                    <span class=n>total_samples</span><span class=o>=</span><span class=n>n_samples</span><span class=p>,</span>
<span class=linenos data-linenos="598 "></span>                    <span class=n>batch_samples</span><span class=o>=</span><span class=n>num_samples_observed_till_now</span><span class=p>,</span>
<span class=linenos data-linenos="599 "></span>                    <span class=n>num_batches</span><span class=o>=</span><span class=n>n_batches</span>
<span class=linenos data-linenos="600 "></span>                <span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.training_args class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">training_args</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>training_args</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Retrieve training arguments</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code> </td> <td> <div class=doc-md-description> <p>Training arguments</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="718 "></span><span class=k>def</span> <span class=nf>training_args</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<span class=linenos data-linenos="719 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Retrieve training arguments</span>
<span class=linenos data-linenos="720 "></span>
<span class=linenos data-linenos="721 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="722 "></span><span class=sd>        Training arguments</span>
<span class=linenos data-linenos="723 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="724 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.training_data class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">training_data</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>training_data</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>All subclasses must provide a training_data routine the purpose of this actual code is to detect that it has been provided</p> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanError" href="../exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanError">FedbiomedTrainingPlanError</a></code> </td> <td> <div class=doc-md-description> <p>if called and not inherited</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="264 "></span><span class=k>def</span> <span class=nf>training_data</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=linenos data-linenos="265 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;All subclasses must provide a training_data routine the purpose of this actual code is to detect</span>
<span class=linenos data-linenos="266 "></span><span class=sd>    that it has been provided</span>
<span class=linenos data-linenos="267 "></span>
<span class=linenos data-linenos="268 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="269 "></span><span class=sd>        FedbiomedTrainingPlanError: if called and not inherited</span>
<span class=linenos data-linenos="270 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="271 "></span>    <span class=n>msg</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB303</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: training_data must be implemented&quot;</span>
<span class=linenos data-linenos="272 "></span>    <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="273 "></span>    <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.BaseTrainingPlan.training_routine class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">training_routine</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>training_routine</span><span class=p>(</span><span class=n>history_monitor</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>node_args</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Training routine, to be called once per round.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>history_monitor</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[HistoryMonitor]</code> </td> <td> <div class=doc-md-description> <p>optional HistoryMonitor instance, recording training metadata.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>node_args</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]]</code> </td> <td> <div class=doc-md-description> <p>Command line arguments for node. These arguments can specify GPU use; however, this is not supported for scikit-learn models and thus will be ignored.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_base_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="488 "></span><span class=nd>@abstractmethod</span>
<span class=linenos data-linenos="489 "></span><span class=k>def</span> <span class=nf>training_routine</span><span class=p>(</span>
<span class=linenos data-linenos="490 "></span>        <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="491 "></span>        <span class=n>history_monitor</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=s1>&#39;HistoryMonitor&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="492 "></span>        <span class=n>node_args</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="493 "></span>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="494 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Training routine, to be called once per round.</span>
<span class=linenos data-linenos="495 "></span>
<span class=linenos data-linenos="496 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="497 "></span><span class=sd>        history_monitor: optional HistoryMonitor</span>
<span class=linenos data-linenos="498 "></span><span class=sd>            instance, recording training metadata.</span>
<span class=linenos data-linenos="499 "></span><span class=sd>        node_args: Command line arguments for node.</span>
<span class=linenos data-linenos="500 "></span><span class=sd>            These arguments can specify GPU use; however, this is not</span>
<span class=linenos data-linenos="501 "></span><span class=sd>            supported for scikit-learn models and thus will be ignored.</span>
<span class=linenos data-linenos="502 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="503 "></span>    <span class=k>return</span> <span class=kc>None</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fedbiomed.common.training_plans.FedPerceptron class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">FedPerceptron</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>FedPerceptron</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans._sklearn_models.FedSGDClassifier" href="#fedbiomed.common.training_plans.FedSGDClassifier">FedSGDClassifier</a></code></p> <p>Fed-BioMed training plan for scikit-learn Perceptron models.</p> <p>This class inherits from FedSGDClassifier, and forces the wrapped scikit-learn SGDClassifier model to use a "perceptron" loss, that makes it equivalent to an actual scikit-learn Perceptron model.</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_sklearn_models.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="254 "></span><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="255 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Class constructor.&quot;&quot;&quot;</span>
<span class=linenos data-linenos="256 "></span>    <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</code></pre></div> </details> <div class="doc doc-children"> <h4 id=fedbiomed.common.training_plans.FedPerceptron-functions>Functions</h4> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.FedPerceptron.post_init class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">post_init</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>post_init</span><span class=p>(</span><span class=n>model_args</span><span class=p>,</span> <span class=n>training_args</span><span class=p>,</span> <span class=n>aggregator_args</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_sklearn_models.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="258 "></span><span class=k>def</span> <span class=nf>post_init</span><span class=p>(</span>
<span class=linenos data-linenos="259 "></span>        <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="260 "></span>        <span class=n>model_args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
<span class=linenos data-linenos="261 "></span>        <span class=n>training_args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
<span class=linenos data-linenos="262 "></span>        <span class=n>aggregator_args</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="263 "></span>        <span class=o>**</span><span class=n>kwargs</span>
<span class=linenos data-linenos="264 "></span>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="265 "></span>    <span class=c1># get default values of Perceptron model (different from SGDClassifier model default values)</span>
<span class=linenos data-linenos="266 "></span>    <span class=n>perceptron_default_values</span> <span class=o>=</span> <span class=n>Perceptron</span><span class=p>()</span><span class=o>.</span><span class=n>get_params</span><span class=p>()</span>
<span class=linenos data-linenos="267 "></span>    <span class=n>sgd_classifier_default_values</span> <span class=o>=</span> <span class=n>SGDClassifier</span><span class=p>()</span><span class=o>.</span><span class=n>get_params</span><span class=p>()</span>
<span class=linenos data-linenos="268 "></span>    <span class=c1># make sure loss used is perceptron loss - can not be changed by user</span>
<span class=linenos data-linenos="269 "></span>    <span class=n>model_args</span><span class=p>[</span><span class=s2>&quot;loss&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;perceptron&quot;</span>
<span class=linenos data-linenos="270 "></span>    <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>post_init</span><span class=p>(</span><span class=n>model_args</span><span class=p>,</span> <span class=n>training_args</span><span class=p>)</span>
<span class=linenos data-linenos="271 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>set_params</span><span class=p>(</span><span class=n>loss</span><span class=o>=</span><span class=s2>&quot;perceptron&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="272 "></span>
<span class=linenos data-linenos="273 "></span>    <span class=c1># collect default values of Perceptron and set it to the model FedPerceptron</span>
<span class=linenos data-linenos="274 "></span>    <span class=n>model_hyperparameters</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>get_params</span><span class=p>()</span>
<span class=linenos data-linenos="275 "></span>    <span class=k>for</span> <span class=n>hyperparameter_name</span><span class=p>,</span> <span class=n>val</span> <span class=ow>in</span> <span class=n>perceptron_default_values</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<span class=linenos data-linenos="276 "></span>        <span class=k>if</span> <span class=n>model_hyperparameters</span><span class=p>[</span><span class=n>hyperparameter_name</span><span class=p>]</span> <span class=o>==</span> <span class=n>sgd_classifier_default_values</span><span class=p>[</span><span class=n>hyperparameter_name</span><span class=p>]:</span>
<span class=linenos data-linenos="277 "></span>            <span class=c1># this means default parameter of SGDClassifier has not been changed by user</span>
<span class=linenos data-linenos="278 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>set_params</span><span class=p>(</span><span class=o>**</span><span class=p>{</span><span class=n>hyperparameter_name</span><span class=p>:</span> <span class=n>val</span><span class=p>})</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fedbiomed.common.training_plans.FedSGDClassifier class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">FedSGDClassifier</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>FedSGDClassifier</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title="fedbiomed.common.training_plans._sklearn_models.SKLearnTrainingPlanPartialFit">SKLearnTrainingPlanPartialFit</span></code></p> <p>Fed-BioMed training plan for scikit-learn SGDClassifier models.</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_sklearn_models.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="216 "></span><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="217 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Initialize the sklearn SGDClassifier training plan.&quot;&quot;&quot;</span>
<span class=linenos data-linenos="218 "></span>    <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</code></pre></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fedbiomed.common.training_plans.FedSGDRegressor class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">FedSGDRegressor</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>FedSGDRegressor</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title="fedbiomed.common.training_plans._sklearn_models.SKLearnTrainingPlanPartialFit">SKLearnTrainingPlanPartialFit</span></code></p> <p>Fed-BioMed training plan for scikit-learn SGDRegressor models.</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_sklearn_models.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="202 "></span><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="203 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Initialize the sklearn SGDRegressor training plan.&quot;&quot;&quot;</span>
<span class=linenos data-linenos="204 "></span>    <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</code></pre></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fedbiomed.common.training_plans.SKLearnTrainingPlan class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">SKLearnTrainingPlan</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>SKLearnTrainingPlan</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans._base_training_plan.BaseTrainingPlan" href="#fedbiomed.common.training_plans.BaseTrainingPlan">BaseTrainingPlan</a></code></p> <p>Base class for Fed-BioMed wrappers of sklearn classes.</p> <p>Classes that inherit from this abstract class must: - Specify a <code>_model_cls</code> class attribute that defines the type of scikit-learn model being wrapped for training. - Implement a <code>set_init_params</code> method that: - sets and assigns the model's initial trainable weights attributes. - populates the <code>_param_list</code> attribute with names of these attributes. - Implement a <code>_training_routine</code> method that performs a training round based on <code>self.train_data_loader</code> (which is a <code>NPDataLoader</code>).</p> <p><span class=doc-section-title>Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans.SKLearnTrainingPlan.dataset_path" href="#fedbiomed.common.training_plans.SKLearnTrainingPlan.dataset_path">dataset_path</a></code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code> </td> <td> <div class=doc-md-description> <p>The path that indicates where dataset has been stored</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans.SKLearnTrainingPlan.pre_processes" href="#fedbiomed.common.training_plans.BaseTrainingPlan.pre_processes">pre_processes</a></code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code> </td> <td> <div class=doc-md-description> <p>Preprocess functions that will be applied to the training data at the beginning of the training routine.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans.SKLearnTrainingPlan.training_data_loader" href="#fedbiomed.common.training_plans.BaseTrainingPlan.training_data_loader">training_data_loader</a></code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code> </td> <td> <div class=doc-md-description> <p>Data loader used in the training routine.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans.SKLearnTrainingPlan.testing_data_loader" href="#fedbiomed.common.training_plans.BaseTrainingPlan.testing_data_loader">testing_data_loader</a></code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code> </td> <td> <div class=doc-md-description> <p>Data loader used in the validation routine.</p> </div> </td> </tr> </tbody> </table> <div class="admonition info"> <p class=admonition-title>Notes</p> <p>The trained model may be exported via the <code>export_model</code> method, resulting in a dump file that may be reloded using <code>joblib.load</code> outside of Fed-BioMed.</p> </div> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_sklearn_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="59 "></span><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="60 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Initialize the SKLearnTrainingPlan.&quot;&quot;&quot;</span>
<span class=linenos data-linenos="61 "></span>    <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
<span class=linenos data-linenos="62 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>SkLearnModel</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="63 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># type: Dict[str, Any]</span>
<span class=linenos data-linenos="64 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>__type</span> <span class=o>=</span> <span class=n>TrainingPlans</span><span class=o>.</span><span class=n>SkLearnTrainingPlan</span>
<span class=linenos data-linenos="65 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_batch_maxnum</span> <span class=o>=</span> <span class=mi>0</span>
<span class=linenos data-linenos="66 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>dataset_path</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="67 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>BaseOptimizer</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="68 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_add_dependency</span><span class=p>([</span>
<span class=linenos data-linenos="69 "></span>        <span class=s2>&quot;import inspect&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="70 "></span>        <span class=s2>&quot;import numpy as np&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="71 "></span>        <span class=s2>&quot;import pandas as pd&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="72 "></span>        <span class=s2>&quot;from fedbiomed.common.training_plans import SKLearnTrainingPlan&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="73 "></span>        <span class=s2>&quot;from fedbiomed.common.data import DataManager&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="74 "></span>    <span class=p>])</span>
<span class=linenos data-linenos="75 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_add_dependency</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_model_dep</span><span class=p>))</span>
<span class=linenos data-linenos="76 "></span>
<span class=linenos data-linenos="77 "></span>    <span class=c1># Add dependencies</span>
<span class=linenos data-linenos="78 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_configure_dependencies</span><span class=p>()</span>
</code></pre></div> </details> <div class="doc doc-children"> <h4 id=fedbiomed.common.training_plans.SKLearnTrainingPlan-attributes>Attributes</h4> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.common.training_plans.SKLearnTrainingPlan.dataset_path class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">dataset_path</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=n>dataset_path</span> <span class=o>=</span> <span class=kc>None</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <h4 id=fedbiomed.common.training_plans.SKLearnTrainingPlan-functions>Functions</h4> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.SKLearnTrainingPlan.init_optimizer class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">init_optimizer</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>init_optimizer</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Creates and configures optimizer. By default, returns None (meaning native inner scikit learn optimization SGD based will be used).</p> <p>In the case a Declearn Optimizer is used, this method should be overridden in the Training Plan and return a Fedbiomed <a class="autorefs autorefs-internal" href="../optimizers/#fedbiomed.common.optimizers.Optimizer"><code>Optimizer</code></a></p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_sklearn_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="189 "></span><span class=k>def</span> <span class=nf>init_optimizer</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>FedOptimizer</span><span class=p>]:</span>
<span class=linenos data-linenos="190 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Creates and configures optimizer. By default, returns None (meaning native inner scikit</span>
<span class=linenos data-linenos="191 "></span><span class=sd>    learn optimization SGD based will be used).</span>
<span class=linenos data-linenos="192 "></span>
<span class=linenos data-linenos="193 "></span><span class=sd>    In the case a Declearn Optimizer is used, this method should be overridden in the Training Plan and return</span>
<span class=linenos data-linenos="194 "></span><span class=sd>    a Fedbiomed [`Optimizer`][fedbiomed.common.optimizers.optimizer.Optimizer]&quot;&quot;&quot;</span>
<span class=linenos data-linenos="195 "></span>    <span class=k>pass</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.SKLearnTrainingPlan.model class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">model</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>model</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Retrieve the wrapped scikit-learn model instance.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="sklearn.base.BaseEstimator" href="https://scikit-learn.org/stable/modules/generated/sklearn.base.BaseEstimator.html#sklearn.base.BaseEstimator">BaseEstimator</a>]</code> </td> <td> <div class=doc-md-description> <p>Scikit-learn model instance</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_sklearn_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="142 "></span><span class=k>def</span> <span class=nf>model</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>BaseEstimator</span><span class=p>]:</span>
<span class=linenos data-linenos="143 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Retrieve the wrapped scikit-learn model instance.</span>
<span class=linenos data-linenos="144 "></span>
<span class=linenos data-linenos="145 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="146 "></span><span class=sd>        Scikit-learn model instance</span>
<span class=linenos data-linenos="147 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="148 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="149 "></span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>model</span>
<span class=linenos data-linenos="150 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="151 "></span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.SKLearnTrainingPlan.post_init class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">post_init</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>post_init</span><span class=p>(</span><span class=n>model_args</span><span class=p>,</span> <span class=n>training_args</span><span class=p>,</span> <span class=n>aggregator_args</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>initialize_optimizer</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Process model, training and optimizer arguments.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>model_args</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code> </td> <td> <div class=doc-md-description> <p>Arguments defined to instantiate the wrapped model.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>training_args</code></td> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_args.TrainingArgs" href="../training_args/#fedbiomed.common.training_args.TrainingArgs">TrainingArgs</a></code> </td> <td> <div class=doc-md-description> <p>Arguments that are used in training routines such as epoch, dry_run etc. Please see <a class="autorefs autorefs-internal" href="../training_args/#fedbiomed.common.training_args.TrainingArgs"><code>TrainingArgs</code></a></p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>aggregator_args</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]]</code> </td> <td> <div class=doc-md-description> <p>Arguments managed by and shared with the researcher-side aggregator.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>initialize_optimizer</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </td> <td> <div class=doc-md-description> <p>Unused.</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_sklearn_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos=" 80 "></span><span class=k>def</span> <span class=nf>post_init</span><span class=p>(</span>
<span class=linenos data-linenos=" 81 "></span>        <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos=" 82 "></span>        <span class=n>model_args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
<span class=linenos data-linenos=" 83 "></span>        <span class=n>training_args</span><span class=p>:</span> <span class=n>TrainingArgs</span><span class=p>,</span>
<span class=linenos data-linenos=" 84 "></span>        <span class=n>aggregator_args</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos=" 85 "></span>        <span class=n>initialize_optimizer</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>
<span class=linenos data-linenos=" 86 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos=" 87 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Process model, training and optimizer arguments.</span>
<span class=linenos data-linenos=" 88 "></span>
<span class=linenos data-linenos=" 89 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos=" 90 "></span><span class=sd>        model_args: Arguments defined to instantiate the wrapped model.</span>
<span class=linenos data-linenos=" 91 "></span><span class=sd>        training_args: Arguments that are used in training routines</span>
<span class=linenos data-linenos=" 92 "></span><span class=sd>            such as epoch, dry_run etc.</span>
<span class=linenos data-linenos=" 93 "></span><span class=sd>            Please see [`TrainingArgs`][fedbiomed.common.training_args.TrainingArgs]</span>
<span class=linenos data-linenos=" 94 "></span><span class=sd>        aggregator_args: Arguments managed by and shared with the</span>
<span class=linenos data-linenos=" 95 "></span><span class=sd>            researcher-side aggregator.</span>
<span class=linenos data-linenos=" 96 "></span><span class=sd>        initialize_optimizer: Unused.</span>
<span class=linenos data-linenos=" 97 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos=" 98 "></span>    <span class=n>model_args</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=s2>&quot;verbose&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<span class=linenos data-linenos=" 99 "></span>    <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>post_init</span><span class=p>(</span><span class=n>model_args</span><span class=p>,</span> <span class=n>training_args</span><span class=p>,</span> <span class=n>aggregator_args</span><span class=p>)</span>
<span class=linenos data-linenos="100 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_model</span> <span class=o>=</span> <span class=n>SkLearnModel</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_model_cls</span><span class=p>)</span>
<span class=linenos data-linenos="101 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_batch_maxnum</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;batch_maxnum&#39;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_batch_maxnum</span><span class=p>)</span>
<span class=linenos data-linenos="102 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_warn_about_training_args</span><span class=p>()</span>
<span class=linenos data-linenos="103 "></span>
<span class=linenos data-linenos="104 "></span>    <span class=c1># configure optimizer (if provided in the TrainingPlan)</span>
<span class=linenos data-linenos="105 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_configure_optimizer</span><span class=p>()</span>
<span class=linenos data-linenos="106 "></span>
<span class=linenos data-linenos="107 "></span>    <span class=c1># FIXME: should we do that in `_configure_optimizer`</span>
<span class=linenos data-linenos="108 "></span>    <span class=c1># from now on, `self._optimizer`` is not None</span>
<span class=linenos data-linenos="109 "></span>    <span class=c1># Override default model parameters based on `self._model_args`.</span>
<span class=linenos data-linenos="110 "></span>    <span class=n>params</span> <span class=o>=</span> <span class=p>{</span>
<span class=linenos data-linenos="111 "></span>        <span class=n>key</span><span class=p>:</span> <span class=n>model_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>val</span><span class=p>)</span>
<span class=linenos data-linenos="112 "></span>        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>val</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>get_params</span><span class=p>()</span><span class=o>.</span><span class=n>items</span><span class=p>()</span>
<span class=linenos data-linenos="113 "></span>    <span class=p>}</span>
<span class=linenos data-linenos="114 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>set_params</span><span class=p>(</span><span class=o>**</span><span class=n>params</span><span class=p>)</span>
<span class=linenos data-linenos="115 "></span>    <span class=c1># Set up additional parameters (normally created by `self._model.fit`).</span>
<span class=linenos data-linenos="116 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>set_init_params</span><span class=p>(</span><span class=n>model_args</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.SKLearnTrainingPlan.set_data_loaders class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">set_data_loaders</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>set_data_loaders</span><span class=p>(</span><span class=n>train_data_loader</span><span class=p>,</span> <span class=n>test_data_loader</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Sets data loaders</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>train_data_loader</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.utils.data.DataLoader" href="https://pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader">DataLoader</a>, <a class="autorefs autorefs-internal" title="fedbiomed.common.data.NPDataLoader" href="../data/#fedbiomed.common.data.NPDataLoader">NPDataLoader</a>, None]</code> </td> <td> <div class=doc-md-description> <p>Data loader for training routine/loop</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>test_data_loader</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.utils.data.DataLoader" href="https://pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader">DataLoader</a>, <a class="autorefs autorefs-internal" title="fedbiomed.common.data.NPDataLoader" href="../data/#fedbiomed.common.data.NPDataLoader">NPDataLoader</a>, None]</code> </td> <td> <div class=doc-md-description> <p>Data loader for validation routine</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_sklearn_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="118 "></span><span class=k>def</span> <span class=nf>set_data_loaders</span><span class=p>(</span>
<span class=linenos data-linenos="119 "></span>        <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="120 "></span>        <span class=n>train_data_loader</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>DataLoader</span><span class=p>,</span> <span class=n>NPDataLoader</span><span class=p>,</span> <span class=kc>None</span><span class=p>],</span>
<span class=linenos data-linenos="121 "></span>        <span class=n>test_data_loader</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>DataLoader</span><span class=p>,</span> <span class=n>NPDataLoader</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span>
<span class=linenos data-linenos="122 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="123 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Sets data loaders</span>
<span class=linenos data-linenos="124 "></span>
<span class=linenos data-linenos="125 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="126 "></span><span class=sd>        train_data_loader: Data loader for training routine/loop</span>
<span class=linenos data-linenos="127 "></span><span class=sd>        test_data_loader: Data loader for validation routine</span>
<span class=linenos data-linenos="128 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="129 "></span>    <span class=n>args</span> <span class=o>=</span> <span class=p>(</span><span class=n>train_data_loader</span><span class=p>,</span> <span class=n>test_data_loader</span><span class=p>)</span>
<span class=linenos data-linenos="130 "></span>    <span class=k>if</span> <span class=ow>not</span> <span class=nb>all</span><span class=p>(</span><span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>NPDataLoader</span><span class=p>)</span> <span class=k>for</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>args</span><span class=p>):</span>
<span class=linenos data-linenos="131 "></span>        <span class=n>msg</span> <span class=o>=</span> <span class=p>(</span>
<span class=linenos data-linenos="132 "></span>            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB310</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: SKLearnTrainingPlan expects &quot;</span>
<span class=linenos data-linenos="133 "></span>            <span class=s2>&quot;NPDataLoader instances as training and testing data &quot;</span>
<span class=linenos data-linenos="134 "></span>            <span class=sa>f</span><span class=s2>&quot;loaders, but received </span><span class=si>{</span><span class=nb>type</span><span class=p>(</span><span class=n>train_data_loader</span><span class=p>)</span><span class=si>}</span><span class=s2> &quot;</span>
<span class=linenos data-linenos="135 "></span>            <span class=sa>f</span><span class=s2>&quot;and </span><span class=si>{</span><span class=nb>type</span><span class=p>(</span><span class=n>test_data_loader</span><span class=p>)</span><span class=si>}</span><span class=s2> respectively.&quot;</span>
<span class=linenos data-linenos="136 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="137 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="138 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="139 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>training_data_loader</span> <span class=o>=</span> <span class=n>train_data_loader</span>
<span class=linenos data-linenos="140 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>testing_data_loader</span> <span class=o>=</span> <span class=n>test_data_loader</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.SKLearnTrainingPlan.testing_routine class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">testing_routine</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>testing_routine</span><span class=p>(</span><span class=n>metric</span><span class=p>,</span> <span class=n>metric_args</span><span class=p>,</span> <span class=n>history_monitor</span><span class=p>,</span> <span class=n>before_train</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Evaluation routine, to be called once per round.</p> <div class="admonition info"> <p class=admonition-title>Note</p> <p>If the training plan implements a <code>testing_step</code> method (the signature of which is func(data, target) -&gt; metrics) then it will be used rather than the input metric.</p> </div> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>metric</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-internal" title="fedbiomed.common.metrics.MetricTypes" href="../metrics/#fedbiomed.common.metrics.MetricTypes">MetricTypes</a>]</code> </td> <td> <div class=doc-md-description> <p>The metric used for validation. If None, use MetricTypes.ACCURACY.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>history_monitor</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[HistoryMonitor]</code> </td> <td> <div class=doc-md-description> <p>HistoryMonitor instance, used to record computed metrics and communicate them to the researcher (server).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>before_train</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </td> <td> <div class=doc-md-description> <p>Whether the evaluation is being performed before local training occurs, of afterwards. This is merely reported back through <code>history_monitor</code>.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_sklearn_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="258 "></span><span class=k>def</span> <span class=nf>testing_routine</span><span class=p>(</span>
<span class=linenos data-linenos="259 "></span>        <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="260 "></span>        <span class=n>metric</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>MetricTypes</span><span class=p>],</span>
<span class=linenos data-linenos="261 "></span>        <span class=n>metric_args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
<span class=linenos data-linenos="262 "></span>        <span class=n>history_monitor</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=s1>&#39;HistoryMonitor&#39;</span><span class=p>],</span>
<span class=linenos data-linenos="263 "></span>        <span class=n>before_train</span><span class=p>:</span> <span class=nb>bool</span>
<span class=linenos data-linenos="264 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="265 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Evaluation routine, to be called once per round.</span>
<span class=linenos data-linenos="266 "></span>
<span class=linenos data-linenos="267 "></span><span class=sd>    !!! info &quot;Note&quot;</span>
<span class=linenos data-linenos="268 "></span><span class=sd>        If the training plan implements a `testing_step` method</span>
<span class=linenos data-linenos="269 "></span><span class=sd>        (the signature of which is func(data, target) -&gt; metrics)</span>
<span class=linenos data-linenos="270 "></span><span class=sd>        then it will be used rather than the input metric.</span>
<span class=linenos data-linenos="271 "></span>
<span class=linenos data-linenos="272 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="273 "></span><span class=sd>        metric: The metric used for validation.</span>
<span class=linenos data-linenos="274 "></span><span class=sd>            If None, use MetricTypes.ACCURACY.</span>
<span class=linenos data-linenos="275 "></span><span class=sd>        history_monitor: HistoryMonitor instance,</span>
<span class=linenos data-linenos="276 "></span><span class=sd>            used to record computed metrics and communicate them to</span>
<span class=linenos data-linenos="277 "></span><span class=sd>            the researcher (server).</span>
<span class=linenos data-linenos="278 "></span><span class=sd>        before_train: Whether the evaluation is being performed</span>
<span class=linenos data-linenos="279 "></span><span class=sd>            before local training occurs, of afterwards. This is merely</span>
<span class=linenos data-linenos="280 "></span><span class=sd>            reported back through `history_monitor`.</span>
<span class=linenos data-linenos="281 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="282 "></span>    <span class=c1># Check that the testing data loader is of proper type.</span>
<span class=linenos data-linenos="283 "></span>    <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>testing_data_loader</span><span class=p>,</span> <span class=n>NPDataLoader</span><span class=p>):</span>
<span class=linenos data-linenos="284 "></span>        <span class=n>msg</span> <span class=o>=</span> <span class=p>(</span>
<span class=linenos data-linenos="285 "></span>            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB310</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: SKLearnTrainingPlan cannot be &quot;</span>
<span class=linenos data-linenos="286 "></span>            <span class=s2>&quot;evaluated without a NPDataLoader as `testing_data_loader`.&quot;</span>
<span class=linenos data-linenos="287 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="288 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="289 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="290 "></span>    <span class=c1># If required, make up for the lack of specifications regarding target</span>
<span class=linenos data-linenos="291 "></span>    <span class=c1># classification labels.</span>
<span class=linenos data-linenos="292 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>is_classification</span> <span class=ow>and</span> <span class=ow>not</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=p>(),</span> <span class=s1>&#39;classes_&#39;</span><span class=p>):</span>
<span class=linenos data-linenos="293 "></span>        <span class=n>classes</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_classes_from_concatenated_train_test</span><span class=p>()</span>
<span class=linenos data-linenos="294 "></span>        <span class=nb>setattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=p>(),</span> <span class=s1>&#39;classes_&#39;</span><span class=p>,</span> <span class=n>classes</span><span class=p>)</span>
<span class=linenos data-linenos="295 "></span>    <span class=c1># If required, select the default metric (accuracy or mse).</span>
<span class=linenos data-linenos="296 "></span>    <span class=k>if</span> <span class=n>metric</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="297 "></span>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>is_classification</span><span class=p>:</span>
<span class=linenos data-linenos="298 "></span>            <span class=n>metric</span> <span class=o>=</span> <span class=n>MetricTypes</span><span class=o>.</span><span class=n>ACCURACY</span>
<span class=linenos data-linenos="299 "></span>        <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="300 "></span>            <span class=n>metric</span> <span class=o>=</span> <span class=n>MetricTypes</span><span class=o>.</span><span class=n>MEAN_SQUARE_ERROR</span>
<span class=linenos data-linenos="301 "></span>    <span class=c1># Delegate the actual evalation routine to the parent class.</span>
<span class=linenos data-linenos="302 "></span>    <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>testing_routine</span><span class=p>(</span>
<span class=linenos data-linenos="303 "></span>        <span class=n>metric</span><span class=p>,</span> <span class=n>metric_args</span><span class=p>,</span> <span class=n>history_monitor</span><span class=p>,</span> <span class=n>before_train</span>
<span class=linenos data-linenos="304 "></span>    <span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.SKLearnTrainingPlan.training_routine class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">training_routine</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>training_routine</span><span class=p>(</span><span class=n>history_monitor</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>node_args</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Training routine, to be called once per round.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>history_monitor</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[HistoryMonitor]</code> </td> <td> <div class=doc-md-description> <p>optional HistoryMonitor instance, recording training metadata. Defaults to None.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>node_args</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]]</code> </td> <td> <div class=doc-md-description> <p>command line arguments for node. These arguments can specify GPU use; however, this is not supported for scikit-learn models and thus will be ignored.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_sklearn_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="197 "></span><span class=k>def</span> <span class=nf>training_routine</span><span class=p>(</span>
<span class=linenos data-linenos="198 "></span>        <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="199 "></span>        <span class=n>history_monitor</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=s1>&#39;HistoryMonitor&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="200 "></span>        <span class=n>node_args</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="201 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="202 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Training routine, to be called once per round.</span>
<span class=linenos data-linenos="203 "></span>
<span class=linenos data-linenos="204 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="205 "></span><span class=sd>        history_monitor: optional HistoryMonitor</span>
<span class=linenos data-linenos="206 "></span><span class=sd>            instance, recording training metadata. Defaults to None.</span>
<span class=linenos data-linenos="207 "></span><span class=sd>        node_args: command line arguments for node.</span>
<span class=linenos data-linenos="208 "></span><span class=sd>            These arguments can specify GPU use; however, this is not</span>
<span class=linenos data-linenos="209 "></span><span class=sd>            supported for scikit-learn models and thus will be ignored.</span>
<span class=linenos data-linenos="210 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="211 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="212 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=s1>&#39;Optimizer is None, please run `post_init` beforehand&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="213 "></span>
<span class=linenos data-linenos="214 "></span>    <span class=c1># Run preprocesses</span>
<span class=linenos data-linenos="215 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_preprocess</span><span class=p>()</span>
<span class=linenos data-linenos="216 "></span>
<span class=linenos data-linenos="217 "></span>    <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>training_data_loader</span><span class=p>,</span> <span class=n>NPDataLoader</span><span class=p>):</span>
<span class=linenos data-linenos="218 "></span>        <span class=n>msg</span> <span class=o>=</span> <span class=p>(</span>
<span class=linenos data-linenos="219 "></span>            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB310</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: SKLearnTrainingPlan cannot &quot;</span>
<span class=linenos data-linenos="220 "></span>            <span class=s2>&quot;be trained without a NPDataLoader as `training_data_loader`.&quot;</span>
<span class=linenos data-linenos="221 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="222 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="223 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="224 "></span>
<span class=linenos data-linenos="225 "></span>    <span class=c1># Warn if GPU-use was expected (as it is not supported).</span>
<span class=linenos data-linenos="226 "></span>    <span class=k>if</span> <span class=n>node_args</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>node_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;gpu_only&#39;</span><span class=p>,</span> <span class=kc>False</span><span class=p>):</span>
<span class=linenos data-linenos="227 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
<span class=linenos data-linenos="228 "></span>            <span class=s1>&#39;Node would like to force GPU usage, but sklearn training &#39;</span>
<span class=linenos data-linenos="229 "></span>            <span class=s1>&#39;plan does not support it. Training on CPU.&#39;</span>
<span class=linenos data-linenos="230 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="231 "></span>    <span class=c1># Run the model-specific training routine.</span>
<span class=linenos data-linenos="232 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="233 "></span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_routine</span><span class=p>(</span><span class=n>history_monitor</span><span class=p>)</span>
<span class=linenos data-linenos="234 "></span>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
<span class=linenos data-linenos="235 "></span>        <span class=n>msg</span> <span class=o>=</span> <span class=p>(</span>
<span class=linenos data-linenos="236 "></span>            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB605</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: error while fitting &quot;</span>
<span class=linenos data-linenos="237 "></span>            <span class=sa>f</span><span class=s2>&quot;the model: </span><span class=si>{</span><span class=n>exc</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="238 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="239 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="240 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.SKLearnTrainingPlan.type class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">type</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nb>type</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Getter for training plan type</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_sklearn_training_plan.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="315 "></span><span class=k>def</span> <span class=nf>type</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>TrainingPlans</span><span class=p>:</span>
<span class=linenos data-linenos="316 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Getter for training plan type &quot;&quot;&quot;</span>
<span class=linenos data-linenos="317 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>__type</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fedbiomed.common.training_plans.TorchTrainingPlan class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">TorchTrainingPlan</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>TorchTrainingPlan</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans._base_training_plan.BaseTrainingPlan" href="#fedbiomed.common.training_plans.BaseTrainingPlan">BaseTrainingPlan</a></code></p> <p>Implements TrainingPlan for torch NN framework</p> <p>An abstraction over pytorch module to run pytorch models and scripts on node side. Researcher model (resp. params) will be:</p> <ol> <li>saved on a '<em>.py' (resp. '</em>.mpk') files,</li> <li>uploaded on a HTTP server (network layer),</li> <li>then Downloaded from the HTTP server on node side,</li> <li>finally, read and executed on node side.</li> </ol> <p>Researcher must define/override: - a <code>training_data()</code> function - a <code>training_step()</code> function</p> <p>Researcher may have to add extra dependencies/python imports, by using <code>init_dependencies</code> method.</p> <p><span class=doc-section-title>Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans.TorchTrainingPlan.dataset_path" href="#fedbiomed.common.training_plans.BaseTrainingPlan.dataset_path">dataset_path</a></code></td> <td> </td> <td> <div class=doc-md-description> <p>The path that indicates where dataset has been stored</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans.TorchTrainingPlan.pre_processes" href="#fedbiomed.common.training_plans.BaseTrainingPlan.pre_processes">pre_processes</a></code></td> <td> </td> <td> <div class=doc-md-description> <p>Preprocess functions that will be applied to the training data at the beginning of the training routine.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans.TorchTrainingPlan.training_data_loader" href="#fedbiomed.common.training_plans.BaseTrainingPlan.training_data_loader">training_data_loader</a></code></td> <td> </td> <td> <div class=doc-md-description> <p>Data loader used in the training routine.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans.TorchTrainingPlan.testing_data_loader" href="#fedbiomed.common.training_plans.BaseTrainingPlan.testing_data_loader">testing_data_loader</a></code></td> <td> </td> <td> <div class=doc-md-description> <p>Data loader used in the validation routine.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans.TorchTrainingPlan.correction_state" href="#fedbiomed.common.training_plans.TorchTrainingPlan.correction_state">correction_state</a></code></td> <td> <code><a class="autorefs autorefs-external" title="typing.OrderedDict" href="https://docs.python.org/3/library/typing.html#typing.OrderedDict">OrderedDict</a></code> </td> <td> <div class=doc-md-description> <p>an OrderedDict of {'parameter name': torch.Tensor} where the keys correspond to the names of the model parameters contained in self._model.named_parameters(), and the values correspond to the correction to be applied to that parameter.</p> </div> </td> </tr> </tbody> </table> <div class="admonition info"> <p class=admonition-title>Notes</p> <p>The trained model may be exported via the <code>export_model</code> method, resulting in a dump file that may be reloded using <code>torch.save</code> outside of Fed-BioMed.</p> </div> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_torchnn.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos=" 65 "></span><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=linenos data-linenos=" 66 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot; Construct training plan &quot;&quot;&quot;</span>
<span class=linenos data-linenos=" 67 "></span>
<span class=linenos data-linenos=" 68 "></span>    <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
<span class=linenos data-linenos=" 69 "></span>
<span class=linenos data-linenos=" 70 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>__type</span> <span class=o>=</span> <span class=n>TrainingPlans</span><span class=o>.</span><span class=n>TorchTrainingPlan</span>
<span class=linenos data-linenos=" 71 "></span>
<span class=linenos data-linenos=" 72 "></span>    <span class=c1># Differential privacy support</span>
<span class=linenos data-linenos=" 73 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_dp_controller</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>DPController</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos=" 74 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>BaseOptimizer</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos=" 75 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>TorchModel</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos=" 76 "></span>
<span class=linenos data-linenos=" 77 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_use_gpu</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=linenos data-linenos=" 78 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_share_persistent_buffers</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos=" 79 "></span>
<span class=linenos data-linenos=" 80 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_batch_maxnum</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>100</span>
<span class=linenos data-linenos=" 81 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_fedprox_mu</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos=" 82 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_log_interval</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span>
<span class=linenos data-linenos=" 83 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_epochs</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span>
<span class=linenos data-linenos=" 84 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_dry_run</span> <span class=o>=</span> <span class=kc>False</span>
<span class=linenos data-linenos=" 85 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_num_updates</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos=" 86 "></span>
<span class=linenos data-linenos=" 87 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>correction_state</span><span class=p>:</span> <span class=n>OrderedDict</span> <span class=o>=</span> <span class=n>OrderedDict</span><span class=p>()</span>
<span class=linenos data-linenos=" 88 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>aggregator_name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos=" 89 "></span>
<span class=linenos data-linenos=" 90 "></span>    <span class=c1># TODO : add random seed init</span>
<span class=linenos data-linenos=" 91 "></span>    <span class=c1># self.random_seed_params = None</span>
<span class=linenos data-linenos=" 92 "></span>    <span class=c1># self.random_seed_shuffling_data = None</span>
<span class=linenos data-linenos=" 93 "></span>
<span class=linenos data-linenos=" 94 "></span>    <span class=c1># device to use: cpu/gpu</span>
<span class=linenos data-linenos=" 95 "></span>    <span class=c1># - all operations except training only use cpu</span>
<span class=linenos data-linenos=" 96 "></span>    <span class=c1># - researcher doesn&#39;t request to use gpu by default</span>
<span class=linenos data-linenos=" 97 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_device_init</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;cpu&quot;</span>
<span class=linenos data-linenos=" 98 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_device</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_device_init</span>
<span class=linenos data-linenos=" 99 "></span>
<span class=linenos data-linenos="100 "></span>    <span class=c1># list dependencies of the model</span>
<span class=linenos data-linenos="101 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_add_dependency</span><span class=p>([</span><span class=s2>&quot;import torch&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="102 "></span>                         <span class=s2>&quot;import torch.nn as nn&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="103 "></span>                         <span class=s2>&quot;import torch.nn.functional as F&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="104 "></span>                         <span class=s2>&quot;from fedbiomed.common.training_plans import TorchTrainingPlan&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="105 "></span>                         <span class=s2>&quot;from fedbiomed.common.data import DataManager&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="106 "></span>                         <span class=s2>&quot;from fedbiomed.common.constants import ProcessTypes&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="107 "></span>                         <span class=s2>&quot;from torch.utils.data import DataLoader&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="108 "></span>                         <span class=s2>&quot;from torchvision import datasets, transforms&quot;</span>
<span class=linenos data-linenos="109 "></span>                         <span class=p>])</span>
<span class=linenos data-linenos="110 "></span>
<span class=linenos data-linenos="111 "></span>    <span class=c1># Aggregated model parameters</span>
<span class=linenos data-linenos="112 "></span>    <span class=c1>#self._init_params: List[torch.Tensor] = None</span>
<span class=linenos data-linenos="113 "></span>
<span class=linenos data-linenos="114 "></span>    <span class=c1># Add dependencies</span>
<span class=linenos data-linenos="115 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_configure_dependencies</span><span class=p>()</span>
</code></pre></div> </details> <div class="doc doc-children"> <h4 id=fedbiomed.common.training_plans.TorchTrainingPlan-attributes>Attributes</h4> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.aggregator_name class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">aggregator_name</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=n>aggregator_name</span> <span class=o>=</span> <span class=kc>None</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.correction_state class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">correction_state</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=n>correction_state</span> <span class=o>=</span> <span class=n>OrderedDict</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <h4 id=fedbiomed.common.training_plans.TorchTrainingPlan-functions>Functions</h4> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.after_training_params class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">after_training_params</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>after_training_params</span><span class=p>(</span><span class=n>flatten</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Return the wrapped model's parameters for aggregation.</p> <p>This method returns a dict containing parameters that need to be reported back and aggregated in a federated learning setting.</p> <p>If the <code>postprocess</code> method exists (i.e. has been defined by end-users) it is called in the context of this method. DP-required adjustments are also set to happen as part of this method.</p> <p>If the researcher specified <code>share_persistent_buffers: False</code> in the training arguments, then we return only the output of <a class="autorefs autorefs-internal" href="../models/#fedbiomed.common.models.TorchModel.get_weights">Model.get_weights</a>, which considers only the trainable parameters. Otherwise, the default behaviour is to return the complete <code>state_dict</code>.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="torch.Tensor" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor">Tensor</a>]</code> </td> <td> <div class=doc-md-description> <p>The trained parameters to aggregate.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_torchnn.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="603 "></span><span class=k>def</span> <span class=nf>after_training_params</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>flatten</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>]:</span>
<span class=linenos data-linenos="604 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Return the wrapped model&#39;s parameters for aggregation.</span>
<span class=linenos data-linenos="605 "></span>
<span class=linenos data-linenos="606 "></span><span class=sd>    This method returns a dict containing parameters that need to be</span>
<span class=linenos data-linenos="607 "></span><span class=sd>    reported back and aggregated in a federated learning setting.</span>
<span class=linenos data-linenos="608 "></span>
<span class=linenos data-linenos="609 "></span><span class=sd>    If the `postprocess` method exists (i.e. has been defined by end-users)</span>
<span class=linenos data-linenos="610 "></span><span class=sd>    it is called in the context of this method. DP-required adjustments are</span>
<span class=linenos data-linenos="611 "></span><span class=sd>    also set to happen as part of this method.</span>
<span class=linenos data-linenos="612 "></span>
<span class=linenos data-linenos="613 "></span><span class=sd>    If the researcher specified `share_persistent_buffers: False` in the</span>
<span class=linenos data-linenos="614 "></span><span class=sd>    training arguments, then we return only the output of</span>
<span class=linenos data-linenos="615 "></span><span class=sd>    [Model.get_weights][fedbiomed.common.models.TorchModel.get_weights],</span>
<span class=linenos data-linenos="616 "></span><span class=sd>    which considers only the trainable parameters.</span>
<span class=linenos data-linenos="617 "></span><span class=sd>    Otherwise, the default behaviour is to return the complete `state_dict`.</span>
<span class=linenos data-linenos="618 "></span>
<span class=linenos data-linenos="619 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="620 "></span><span class=sd>        The trained parameters to aggregate.</span>
<span class=linenos data-linenos="621 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="622 "></span>    <span class=c1># Either include non-parameter buffers to the outputs or not.</span>
<span class=linenos data-linenos="623 "></span>    <span class=c1># Note: this is mostly about sharing statistics from BatchNorm layers.</span>
<span class=linenos data-linenos="624 "></span>    <span class=n>params</span> <span class=o>=</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>after_training_params</span><span class=p>()</span>
<span class=linenos data-linenos="625 "></span>    <span class=c1># Check whether postprocess method exists, and use it.</span>
<span class=linenos data-linenos="626 "></span>    <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s1>&#39;postprocess&#39;</span><span class=p>):</span>
<span class=linenos data-linenos="627 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;running model.postprocess() method&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="628 "></span>        <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="629 "></span>            <span class=n>params</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>postprocess</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>model</span><span class=o>.</span><span class=n>state_dict</span><span class=p>())</span>  <span class=c1># Post process</span>
<span class=linenos data-linenos="630 "></span>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<span class=linenos data-linenos="631 "></span>            <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB605</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: Error while running post-process &quot;</span>
<span class=linenos data-linenos="632 "></span>                                             <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span> <span class=kn>from</span> <span class=nn>e</span>
<span class=linenos data-linenos="633 "></span>
<span class=linenos data-linenos="634 "></span>    <span class=c1># Run (optional) DP controller adjustments as well.</span>
<span class=linenos data-linenos="635 "></span>    <span class=n>params</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dp_controller</span><span class=o>.</span><span class=n>after_training</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
<span class=linenos data-linenos="636 "></span>    <span class=k>if</span> <span class=n>flatten</span><span class=p>:</span>
<span class=linenos data-linenos="637 "></span>        <span class=n>params</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>flatten</span><span class=p>(</span><span class=n>exclude_buffers</span><span class=o>=</span><span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_share_persistent_buffers</span><span class=p>)</span>
<span class=linenos data-linenos="638 "></span>    <span class=k>return</span> <span class=n>params</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.init_model class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">init_model</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>init_model</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Abstract method where model should be defined.</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_torchnn.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="163 "></span><span class=nd>@abstractmethod</span>
<span class=linenos data-linenos="164 "></span><span class=k>def</span> <span class=nf>init_model</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=linenos data-linenos="165 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Abstract method where model should be defined.&quot;&quot;&quot;</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.init_optimizer class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">init_optimizer</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>init_optimizer</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Abstract method for declaring optimizer by default</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_torchnn.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="215 "></span><span class=k>def</span> <span class=nf>init_optimizer</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>FedOptimizer</span><span class=p>,</span> <span class=n>torch</span><span class=o>.</span><span class=n>optim</span><span class=o>.</span><span class=n>Optimizer</span><span class=p>]:</span>
<span class=linenos data-linenos="216 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Abstract method for declaring optimizer by default &quot;&quot;&quot;</span>
<span class=linenos data-linenos="217 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="218 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>optim</span><span class=o>.</span><span class=n>Adam</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>model</span><span class=o>.</span><span class=n>parameters</span><span class=p>(),</span> <span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>_optimizer_args</span><span class=p>)</span>
<span class=linenos data-linenos="219 "></span>    <span class=k>except</span> <span class=ne>AttributeError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<span class=linenos data-linenos="220 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB605</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: Invalid argument for default &quot;</span>
<span class=linenos data-linenos="221 "></span>                                         <span class=sa>f</span><span class=s2>&quot;optimizer Adam. Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span> <span class=kn>from</span> <span class=nn>e</span>
<span class=linenos data-linenos="222 "></span>
<span class=linenos data-linenos="223 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.initial_parameters class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">initial_parameters</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>initial_parameters</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Returns initial parameters without DP or training applied</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></code> </td> <td> <div class=doc-md-description> <p>State dictionary of torch Module</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_torchnn.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="207 "></span><span class=k>def</span> <span class=nf>initial_parameters</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
<span class=linenos data-linenos="208 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns initial parameters without DP or training applied</span>
<span class=linenos data-linenos="209 "></span>
<span class=linenos data-linenos="210 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="211 "></span><span class=sd>        State dictionary of torch Module</span>
<span class=linenos data-linenos="212 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="213 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>init_params</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.model class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">model</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>model</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_torchnn.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="175 "></span><span class=k>def</span> <span class=nf>model</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>Module</span><span class=p>]:</span>
<span class=linenos data-linenos="176 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="177 "></span>        <span class=k>return</span> <span class=kc>None</span>
<span class=linenos data-linenos="178 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>model</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.optimizer_args class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">optimizer_args</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>optimizer_args</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Retrieves optimizer arguments</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code> </td> <td> <div class=doc-md-description> <p>Optimizer arguments</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_torchnn.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="198 "></span><span class=k>def</span> <span class=nf>optimizer_args</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<span class=linenos data-linenos="199 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Retrieves optimizer arguments</span>
<span class=linenos data-linenos="200 "></span>
<span class=linenos data-linenos="201 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="202 "></span><span class=sd>        Optimizer arguments</span>
<span class=linenos data-linenos="203 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="204 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>update_optimizer_args</span><span class=p>()</span>  <span class=c1># update `optimizer_args` (eg after training)</span>
<span class=linenos data-linenos="205 "></span>    <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>optimizer_args</span><span class=p>()</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.post_init class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">post_init</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>post_init</span><span class=p>(</span><span class=n>model_args</span><span class=p>,</span> <span class=n>training_args</span><span class=p>,</span> <span class=n>aggregator_args</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>initialize_optimizer</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Process model, training and optimizer arguments.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>model_args</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code> </td> <td> <div class=doc-md-description> <p>Arguments defined to instantiate the wrapped model.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>training_args</code></td> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_args.TrainingArgs" href="../training_args/#fedbiomed.common.training_args.TrainingArgs">TrainingArgs</a></code> </td> <td> <div class=doc-md-description> <p>Arguments that are used in training routines such as epoch, dry_run etc. Please see <a class="autorefs autorefs-internal" href="../training_args/#fedbiomed.common.training_args.TrainingArgs"><code>TrainingArgs</code></a></p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>aggregator_args</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]]</code> </td> <td> <div class=doc-md-description> <p>Arguments managed by and shared with the researcher-side aggregator.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>initialize_optimizer</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </td> <td> <div class=doc-md-description> <p>If True, configures optimizer. It has to be True for node side configuration to prepare optimizer for the training.</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p>Raises: FedbiomedTrainingPlanError: If the provided arguments do not match expectations, or if the optimizer, model and dependencies configuration goes wrong.</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_torchnn.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="117 "></span><span class=k>def</span> <span class=nf>post_init</span><span class=p>(</span>
<span class=linenos data-linenos="118 "></span>        <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="119 "></span>        <span class=n>model_args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
<span class=linenos data-linenos="120 "></span>        <span class=n>training_args</span><span class=p>:</span> <span class=n>TrainingArgs</span><span class=p>,</span>
<span class=linenos data-linenos="121 "></span>        <span class=n>aggregator_args</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="122 "></span>        <span class=n>initialize_optimizer</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>
<span class=linenos data-linenos="123 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="124 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Process model, training and optimizer arguments.</span>
<span class=linenos data-linenos="125 "></span>
<span class=linenos data-linenos="126 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="127 "></span><span class=sd>        model_args: Arguments defined to instantiate the wrapped model.</span>
<span class=linenos data-linenos="128 "></span><span class=sd>        training_args: Arguments that are used in training routines</span>
<span class=linenos data-linenos="129 "></span><span class=sd>            such as epoch, dry_run etc.</span>
<span class=linenos data-linenos="130 "></span><span class=sd>            Please see [`TrainingArgs`][fedbiomed.common.training_args.TrainingArgs]</span>
<span class=linenos data-linenos="131 "></span><span class=sd>        aggregator_args: Arguments managed by and shared with the</span>
<span class=linenos data-linenos="132 "></span><span class=sd>            researcher-side aggregator.</span>
<span class=linenos data-linenos="133 "></span><span class=sd>        initialize_optimizer: If True, configures optimizer. It has to be True for node</span>
<span class=linenos data-linenos="134 "></span><span class=sd>            side configuration to prepare optimizer for the training.</span>
<span class=linenos data-linenos="135 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="136 "></span><span class=sd>        FedbiomedTrainingPlanError: If the provided arguments do not</span>
<span class=linenos data-linenos="137 "></span><span class=sd>            match expectations, or if the optimizer, model and dependencies</span>
<span class=linenos data-linenos="138 "></span><span class=sd>            configuration goes wrong.</span>
<span class=linenos data-linenos="139 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="140 "></span>    <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>post_init</span><span class=p>(</span><span class=n>model_args</span><span class=p>,</span> <span class=n>training_args</span><span class=p>,</span> <span class=n>aggregator_args</span><span class=p>)</span>
<span class=linenos data-linenos="141 "></span>    <span class=c1># Assign scalar attributes.</span>
<span class=linenos data-linenos="142 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_use_gpu</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;use_gpu&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="143 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_batch_maxnum</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;batch_maxnum&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="144 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_log_interval</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;log_interval&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="145 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_epochs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;epochs&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="146 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_num_updates</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;num_updates&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<span class=linenos data-linenos="147 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_dry_run</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;dry_run&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="148 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_share_persistent_buffers</span> <span class=o>=</span> <span class=n>training_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;share_persistent_buffers&#39;</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
<span class=linenos data-linenos="149 "></span>    <span class=c1># Set random seed (Pytorch-specific)</span>
<span class=linenos data-linenos="150 "></span>    <span class=n>rseed</span> <span class=o>=</span> <span class=n>training_args</span><span class=p>[</span><span class=s1>&#39;random_seed&#39;</span><span class=p>]</span>
<span class=linenos data-linenos="151 "></span>    <span class=n>rseed</span> <span class=o>=</span> <span class=n>rseed</span> <span class=k>if</span> <span class=n>rseed</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=k>else</span> <span class=n>torch</span><span class=o>.</span><span class=n>seed</span><span class=p>()</span>
<span class=linenos data-linenos="152 "></span>    <span class=n>torch</span><span class=o>.</span><span class=n>manual_seed</span><span class=p>(</span><span class=n>rseed</span><span class=p>)</span>
<span class=linenos data-linenos="153 "></span>    <span class=c1># Optionally set up differential privacy.</span>
<span class=linenos data-linenos="154 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_dp_controller</span> <span class=o>=</span> <span class=n>DPController</span><span class=p>(</span><span class=n>training_args</span><span class=o>.</span><span class=n>dp_arguments</span><span class=p>()</span> <span class=ow>or</span> <span class=kc>None</span><span class=p>)</span>
<span class=linenos data-linenos="155 "></span>    <span class=c1># Configure aggregator-related arguments</span>
<span class=linenos data-linenos="156 "></span>    <span class=c1># TODO: put fedprox mu inside strategy_args</span>
<span class=linenos data-linenos="157 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_fedprox_mu</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;fedprox_mu&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="158 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>set_aggregator_args</span><span class=p>(</span><span class=n>aggregator_args</span> <span class=ow>or</span> <span class=p>{})</span>
<span class=linenos data-linenos="159 "></span>    <span class=c1># Configure the model and optimizer.</span>
<span class=linenos data-linenos="160 "></span>
<span class=linenos data-linenos="161 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_configure_model_and_optimizer</span><span class=p>(</span><span class=n>initialize_optimizer</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.send_to_device class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">send_to_device</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>send_to_device</span><span class=p>(</span><span class=n>to_send</span><span class=p>,</span> <span class=n>device</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Send inputs to correct device for training.</p> <p>Recursively traverses lists, tuples and dicts until it meets a torch Tensor, then sends the Tensor to the specified device.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>to_send</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="torch.Tensor" href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor">Tensor</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>]</code> </td> <td> <div class=doc-md-description> <p>the data to be sent to the device.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>device</code></td> <td> <code><a class="autorefs autorefs-external" title="torch.device" href="https://pytorch.org/docs/stable/tensor_attributes.html#torch.device">device</a></code> </td> <td> <div class=doc-md-description> <p>the device to send the data to.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanError" href="../exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanError">FedbiomedTrainingPlanError</a></code> </td> <td> <div class=doc-md-description> <p>when to_send is not the correct type</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_torchnn.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="340 "></span><span class=k>def</span> <span class=nf>send_to_device</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="341 "></span>                   <span class=n>to_send</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>,</span> <span class=nb>list</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>,</span> <span class=nb>dict</span><span class=p>],</span>
<span class=linenos data-linenos="342 "></span>                   <span class=n>device</span><span class=p>:</span> <span class=n>torch</span><span class=o>.</span><span class=n>device</span>
<span class=linenos data-linenos="343 "></span>                   <span class=p>):</span>
<span class=linenos data-linenos="344 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Send inputs to correct device for training.</span>
<span class=linenos data-linenos="345 "></span>
<span class=linenos data-linenos="346 "></span><span class=sd>    Recursively traverses lists, tuples and dicts until it meets a torch Tensor, then sends the Tensor</span>
<span class=linenos data-linenos="347 "></span><span class=sd>    to the specified device.</span>
<span class=linenos data-linenos="348 "></span>
<span class=linenos data-linenos="349 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="350 "></span><span class=sd>        to_send: the data to be sent to the device.</span>
<span class=linenos data-linenos="351 "></span><span class=sd>        device: the device to send the data to.</span>
<span class=linenos data-linenos="352 "></span>
<span class=linenos data-linenos="353 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="354 "></span><span class=sd>       FedbiomedTrainingPlanError: when to_send is not the correct type</span>
<span class=linenos data-linenos="355 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="356 "></span>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>to_send</span><span class=p>,</span> <span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>):</span>
<span class=linenos data-linenos="357 "></span>        <span class=k>return</span> <span class=n>to_send</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=n>device</span><span class=p>)</span>
<span class=linenos data-linenos="358 "></span>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>to_send</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
<span class=linenos data-linenos="359 "></span>        <span class=k>return</span> <span class=p>{</span><span class=n>key</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>send_to_device</span><span class=p>(</span><span class=n>val</span><span class=p>,</span> <span class=n>device</span><span class=p>)</span> <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>val</span> <span class=ow>in</span> <span class=n>to_send</span><span class=o>.</span><span class=n>items</span><span class=p>()}</span>
<span class=linenos data-linenos="360 "></span>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>to_send</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>):</span>
<span class=linenos data-linenos="361 "></span>        <span class=k>return</span> <span class=nb>tuple</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>send_to_device</span><span class=p>(</span><span class=n>d</span><span class=p>,</span> <span class=n>device</span><span class=p>)</span> <span class=k>for</span> <span class=n>d</span> <span class=ow>in</span> <span class=n>to_send</span><span class=p>)</span>
<span class=linenos data-linenos="362 "></span>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>to_send</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<span class=linenos data-linenos="363 "></span>        <span class=k>return</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>send_to_device</span><span class=p>(</span><span class=n>d</span><span class=p>,</span> <span class=n>device</span><span class=p>)</span> <span class=k>for</span> <span class=n>d</span> <span class=ow>in</span> <span class=n>to_send</span><span class=p>]</span>
<span class=linenos data-linenos="364 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="365 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB310</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s1> cannot send data to device. &#39;</span>
<span class=linenos data-linenos="366 "></span>                                         <span class=sa>f</span><span class=s1>&#39;Data must be a torch Tensor or a list, tuple or dict &#39;</span>
<span class=linenos data-linenos="367 "></span>                                         <span class=sa>f</span><span class=s1>&#39;ultimately containing Tensors.&#39;</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.set_aggregator_args class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">set_aggregator_args</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>set_aggregator_args</span><span class=p>(</span><span class=n>aggregator_args</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Handles and loads aggregators arguments to received from the researcher</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>aggregator_args</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code> </td> <td> <div class=doc-md-description> <p>dictionary mapping aggregator argument name with its value (eg 'aggregator_correction' with correction states)</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_torchnn.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="581 "></span><span class=k>def</span> <span class=nf>set_aggregator_args</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aggregator_args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
<span class=linenos data-linenos="582 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Handles and loads aggregators arguments to received from the researcher</span>
<span class=linenos data-linenos="583 "></span>
<span class=linenos data-linenos="584 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="585 "></span><span class=sd>        aggregator_args (Dict[str, Any]): dictionary mapping aggregator argument</span>
<span class=linenos data-linenos="586 "></span><span class=sd>            name with its value (eg &#39;aggregator_correction&#39; with correction states)</span>
<span class=linenos data-linenos="587 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="588 "></span>
<span class=linenos data-linenos="589 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>aggregator_name</span> <span class=o>=</span> <span class=n>aggregator_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;aggregator_name&#39;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>aggregator_name</span><span class=p>)</span>
<span class=linenos data-linenos="590 "></span>    <span class=c1># FIXME: this is too specific to Scaffold. Should be redesigned, or handled</span>
<span class=linenos data-linenos="591 "></span>    <span class=c1># by an aggregator handler that contains all keys for all strategies</span>
<span class=linenos data-linenos="592 "></span>    <span class=c1># implemented in fedbiomed</span>
<span class=linenos data-linenos="593 "></span>    <span class=c1># here we ae loading all args that have been sent from file exchange system</span>
<span class=linenos data-linenos="594 "></span>    <span class=k>for</span> <span class=n>arg_name</span><span class=p>,</span> <span class=n>aggregator_arg</span> <span class=ow>in</span> <span class=n>aggregator_args</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<span class=linenos data-linenos="595 "></span>        <span class=k>if</span> <span class=n>arg_name</span> <span class=o>==</span> <span class=s1>&#39;aggregator_correction&#39;</span><span class=p>:</span>
<span class=linenos data-linenos="596 "></span>            <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>aggregator_arg</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
<span class=linenos data-linenos="597 "></span>                <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span>
<span class=linenos data-linenos="598 "></span>                    <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB309</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: TorchTrainingPlan received &quot;</span>
<span class=linenos data-linenos="599 "></span>                    <span class=s2>&quot;invalid &#39;aggregator_correction&#39; aggregator args.&quot;</span>
<span class=linenos data-linenos="600 "></span>                <span class=p>)</span>
<span class=linenos data-linenos="601 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>correction_state</span> <span class=o>=</span> <span class=n>aggregator_arg</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.testing_routine class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">testing_routine</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>testing_routine</span><span class=p>(</span><span class=n>metric</span><span class=p>,</span> <span class=n>metric_args</span><span class=p>,</span> <span class=n>history_monitor</span><span class=p>,</span> <span class=n>before_train</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Evaluation routine, to be called once per round.</p> <div class="admonition info"> <p class=admonition-title>Note</p> <p>If the training plan implements a <code>testing_step</code> method (the signature of which is func(data, target) -&gt; metrics) then it will be used rather than the input metric.</p> </div> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>metric</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-internal" title="fedbiomed.common.metrics.MetricTypes" href="../metrics/#fedbiomed.common.metrics.MetricTypes">MetricTypes</a>]</code> </td> <td> <div class=doc-md-description> <p>The metric used for validation. If None, use MetricTypes.ACCURACY.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>history_monitor</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[HistoryMonitor]</code> </td> <td> <div class=doc-md-description> <p>HistoryMonitor instance, used to record computed metrics and communicate them to the researcher (server).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>before_train</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </td> <td> <div class=doc-md-description> <p>Whether the evaluation is being performed before local training occurs, of afterwards. This is merely reported back through <code>history_monitor</code>.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_torchnn.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="541 "></span><span class=k>def</span> <span class=nf>testing_routine</span><span class=p>(</span>
<span class=linenos data-linenos="542 "></span>        <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="543 "></span>        <span class=n>metric</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>MetricTypes</span><span class=p>],</span>
<span class=linenos data-linenos="544 "></span>        <span class=n>metric_args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
<span class=linenos data-linenos="545 "></span>        <span class=n>history_monitor</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=s1>&#39;HistoryMonitor&#39;</span><span class=p>],</span>
<span class=linenos data-linenos="546 "></span>        <span class=n>before_train</span><span class=p>:</span> <span class=nb>bool</span>
<span class=linenos data-linenos="547 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="548 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Evaluation routine, to be called once per round.</span>
<span class=linenos data-linenos="549 "></span>
<span class=linenos data-linenos="550 "></span><span class=sd>    !!! info &quot;Note&quot;</span>
<span class=linenos data-linenos="551 "></span><span class=sd>        If the training plan implements a `testing_step` method</span>
<span class=linenos data-linenos="552 "></span><span class=sd>        (the signature of which is func(data, target) -&gt; metrics)</span>
<span class=linenos data-linenos="553 "></span><span class=sd>        then it will be used rather than the input metric.</span>
<span class=linenos data-linenos="554 "></span>
<span class=linenos data-linenos="555 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="556 "></span><span class=sd>        metric: The metric used for validation.</span>
<span class=linenos data-linenos="557 "></span><span class=sd>            If None, use MetricTypes.ACCURACY.</span>
<span class=linenos data-linenos="558 "></span><span class=sd>        history_monitor: HistoryMonitor instance,</span>
<span class=linenos data-linenos="559 "></span><span class=sd>            used to record computed metrics and communicate them to</span>
<span class=linenos data-linenos="560 "></span><span class=sd>            the researcher (server).</span>
<span class=linenos data-linenos="561 "></span><span class=sd>        before_train: Whether the evaluation is being performed</span>
<span class=linenos data-linenos="562 "></span><span class=sd>            before local training occurs, of afterwards. This is merely</span>
<span class=linenos data-linenos="563 "></span><span class=sd>            reported back through `history_monitor`.</span>
<span class=linenos data-linenos="564 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="565 "></span>    <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=p>(),</span> <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>Module</span><span class=p>):</span>
<span class=linenos data-linenos="566 "></span>        <span class=n>msg</span> <span class=o>=</span> <span class=p>(</span>
<span class=linenos data-linenos="567 "></span>            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB320</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: model should be a torch &quot;</span>
<span class=linenos data-linenos="568 "></span>            <span class=sa>f</span><span class=s2>&quot;nn.Module, but is of type </span><span class=si>{</span><span class=nb>type</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=p>())</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="569 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="570 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="571 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=linenos data-linenos="572 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="573 "></span>
<span class=linenos data-linenos="574 "></span>        <span class=k>with</span> <span class=n>torch</span><span class=o>.</span><span class=n>no_grad</span><span class=p>():</span>
<span class=linenos data-linenos="575 "></span>            <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>testing_routine</span><span class=p>(</span>
<span class=linenos data-linenos="576 "></span>                <span class=n>metric</span><span class=p>,</span> <span class=n>metric_args</span><span class=p>,</span> <span class=n>history_monitor</span><span class=p>,</span> <span class=n>before_train</span>
<span class=linenos data-linenos="577 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="578 "></span>    <span class=k>finally</span><span class=p>:</span>
<span class=linenos data-linenos="579 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=p>()</span><span class=o>.</span><span class=n>train</span><span class=p>()</span>  <span class=c1># restore training behaviors</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.training_data class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">training_data</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>training_data</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Abstract method to return training data</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_torchnn.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="171 "></span><span class=nd>@abstractmethod</span>
<span class=linenos data-linenos="172 "></span><span class=k>def</span> <span class=nf>training_data</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=linenos data-linenos="173 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Abstract method to return training data&quot;&quot;&quot;</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.training_routine class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">training_routine</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>training_routine</span><span class=p>(</span><span class=n>history_monitor</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>node_args</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Training routine procedure.</p> <p>End-user should define;</p> <ul> <li>a <code>training_data()</code> function defining how sampling / handling data in node's dataset is done. It should return a generator able to output tuple (batch_idx, (data, targets)) that is iterable for each batch.</li> <li>a <code>training_step()</code> function defining how cost is computed. It should output loss values for backpropagation.</li> </ul> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>history_monitor</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></code> </td> <td> <div class=doc-md-description> <p>Monitor handler for real-time feed. Defined by the Node and can't be overwritten</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>node_args</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>, None]</code> </td> <td> <div class=doc-md-description> <p>command line arguments for node. Can include: - <code>gpu (bool)</code>: propose use a GPU device if any is available. Default False. - <code>gpu_num (Union[int, None])</code>: if not None, use the specified GPU device instead of default GPU device if this GPU device is available. Default None. - <code>gpu_only (bool)</code>: force use of a GPU device if any available, even if researcher doesn't request for using a GPU. Default False.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p>Returns: Total number of samples observed during the training.</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_torchnn.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="369 "></span><span class=k>def</span> <span class=nf>training_routine</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="370 "></span>                     <span class=n>history_monitor</span><span class=p>:</span> <span class=n>Any</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="371 "></span>                     <span class=n>node_args</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>dict</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="372 "></span>                     <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
<span class=linenos data-linenos="373 "></span>    <span class=c1># FIXME: add betas parameters for ADAM solver + momentum for SGD</span>
<span class=linenos data-linenos="374 "></span>    <span class=c1># FIXME 2: remove parameters specific for validation specified in the</span>
<span class=linenos data-linenos="375 "></span>    <span class=c1># training routine</span>
<span class=linenos data-linenos="376 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Training routine procedure.</span>
<span class=linenos data-linenos="377 "></span>
<span class=linenos data-linenos="378 "></span><span class=sd>    End-user should define;</span>
<span class=linenos data-linenos="379 "></span>
<span class=linenos data-linenos="380 "></span><span class=sd>    - a `training_data()` function defining how sampling / handling data in node&#39;s dataset is done. It should</span>
<span class=linenos data-linenos="381 "></span><span class=sd>        return a generator able to output tuple (batch_idx, (data, targets)) that is iterable for each batch.</span>
<span class=linenos data-linenos="382 "></span><span class=sd>    - a `training_step()` function defining how cost is computed. It should output loss values for backpropagation.</span>
<span class=linenos data-linenos="383 "></span>
<span class=linenos data-linenos="384 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="385 "></span><span class=sd>        history_monitor: Monitor handler for real-time feed. Defined by the Node and can&#39;t be overwritten</span>
<span class=linenos data-linenos="386 "></span><span class=sd>        node_args: command line arguments for node. Can include:</span>
<span class=linenos data-linenos="387 "></span><span class=sd>            - `gpu (bool)`: propose use a GPU device if any is available. Default False.</span>
<span class=linenos data-linenos="388 "></span><span class=sd>            - `gpu_num (Union[int, None])`: if not None, use the specified GPU device instead of default</span>
<span class=linenos data-linenos="389 "></span><span class=sd>                GPU device if this GPU device is available. Default None.</span>
<span class=linenos data-linenos="390 "></span><span class=sd>            - `gpu_only (bool)`: force use of a GPU device if any available, even if researcher</span>
<span class=linenos data-linenos="391 "></span><span class=sd>                doesn&#39;t request for using a GPU. Default False.</span>
<span class=linenos data-linenos="392 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="393 "></span><span class=sd>        Total number of samples observed during the training.</span>
<span class=linenos data-linenos="394 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="395 "></span>
<span class=linenos data-linenos="396 "></span>    <span class=c1>#self.model().train()  # pytorch switch for training</span>
<span class=linenos data-linenos="397 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer</span><span class=o>.</span><span class=n>init_training</span><span class=p>()</span>
<span class=linenos data-linenos="398 "></span>    <span class=c1># set correct type for node args</span>
<span class=linenos data-linenos="399 "></span>    <span class=n>node_args</span> <span class=o>=</span> <span class=p>{}</span> <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>node_args</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=k>else</span> <span class=n>node_args</span>
<span class=linenos data-linenos="400 "></span>
<span class=linenos data-linenos="401 "></span>    <span class=c1># send all model to device, ensures having all the requested tensors</span>
<span class=linenos data-linenos="402 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_set_device</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_use_gpu</span><span class=p>,</span> <span class=n>node_args</span><span class=p>)</span>
<span class=linenos data-linenos="403 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>send_to_device</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_device</span><span class=p>)</span>
<span class=linenos data-linenos="404 "></span>
<span class=linenos data-linenos="405 "></span>    <span class=c1># Run preprocess when everything is ready before the training</span>
<span class=linenos data-linenos="406 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_preprocess</span><span class=p>()</span>
<span class=linenos data-linenos="407 "></span>
<span class=linenos data-linenos="408 "></span>    <span class=c1># # initial aggregated model parameters</span>
<span class=linenos data-linenos="409 "></span>    <span class=c1># self._init_params = deepcopy(list(self.model().parameters()))</span>
<span class=linenos data-linenos="410 "></span>
<span class=linenos data-linenos="411 "></span>    <span class=c1># DP actions</span>
<span class=linenos data-linenos="412 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>training_data_loader</span> <span class=o>=</span> \
<span class=linenos data-linenos="413 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_dp_controller</span><span class=o>.</span><span class=n>before_training</span><span class=p>(</span><span class=n>optimizer</span><span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer</span><span class=p>,</span> <span class=n>loader</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>training_data_loader</span><span class=p>)</span>
<span class=linenos data-linenos="414 "></span>
<span class=linenos data-linenos="415 "></span>    <span class=c1># set number of training loop iterations</span>
<span class=linenos data-linenos="416 "></span>    <span class=n>iterations_accountant</span> <span class=o>=</span> <span class=n>MiniBatchTrainingIterationsAccountant</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
<span class=linenos data-linenos="417 "></span>
<span class=linenos data-linenos="418 "></span>    <span class=c1># Training loop iterations</span>
<span class=linenos data-linenos="419 "></span>    <span class=k>for</span> <span class=n>epoch</span> <span class=ow>in</span> <span class=n>iterations_accountant</span><span class=o>.</span><span class=n>iterate_epochs</span><span class=p>():</span>
<span class=linenos data-linenos="420 "></span>        <span class=n>training_data_iter</span><span class=p>:</span> <span class=n>Iterator</span> <span class=o>=</span> <span class=nb>iter</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>training_data_loader</span><span class=p>)</span>
<span class=linenos data-linenos="421 "></span>
<span class=linenos data-linenos="422 "></span>        <span class=k>for</span> <span class=n>batch_idx</span> <span class=ow>in</span> <span class=n>iterations_accountant</span><span class=o>.</span><span class=n>iterate_batches</span><span class=p>():</span>
<span class=linenos data-linenos="423 "></span>            <span class=c1># retrieve data and target</span>
<span class=linenos data-linenos="424 "></span>            <span class=n>data</span><span class=p>,</span> <span class=n>target</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>training_data_iter</span><span class=p>)</span>
<span class=linenos data-linenos="425 "></span>
<span class=linenos data-linenos="426 "></span>            <span class=c1># update accounting for number of observed samples</span>
<span class=linenos data-linenos="427 "></span>            <span class=n>batch_size</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_infer_batch_size</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
<span class=linenos data-linenos="428 "></span>            <span class=n>iterations_accountant</span><span class=o>.</span><span class=n>increment_sample_counters</span><span class=p>(</span><span class=n>batch_size</span><span class=p>)</span>
<span class=linenos data-linenos="429 "></span>
<span class=linenos data-linenos="430 "></span>            <span class=c1># handle training on accelerator devices</span>
<span class=linenos data-linenos="431 "></span>            <span class=n>data</span><span class=p>,</span> <span class=n>target</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>send_to_device</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_device</span><span class=p>),</span> <span class=bp>self</span><span class=o>.</span><span class=n>send_to_device</span><span class=p>(</span><span class=n>target</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_device</span><span class=p>)</span>
<span class=linenos data-linenos="432 "></span>
<span class=linenos data-linenos="433 "></span>            <span class=c1># train this batch</span>
<span class=linenos data-linenos="434 "></span>            <span class=n>corrected_loss</span><span class=p>,</span> <span class=n>loss</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_train_over_batch</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>target</span><span class=p>)</span>
<span class=linenos data-linenos="435 "></span>
<span class=linenos data-linenos="436 "></span>            <span class=c1># Reporting</span>
<span class=linenos data-linenos="437 "></span>            <span class=k>if</span> <span class=n>iterations_accountant</span><span class=o>.</span><span class=n>should_log_this_batch</span><span class=p>():</span>
<span class=linenos data-linenos="438 "></span>                <span class=c1># Retrieve reporting information: semantics differ whether num_updates or epochs were specified</span>
<span class=linenos data-linenos="439 "></span>                <span class=n>num_samples</span><span class=p>,</span> <span class=n>num_samples_max</span> <span class=o>=</span> <span class=n>iterations_accountant</span><span class=o>.</span><span class=n>reporting_on_num_samples</span><span class=p>()</span>
<span class=linenos data-linenos="440 "></span>                <span class=n>num_iter</span><span class=p>,</span> <span class=n>num_iter_max</span> <span class=o>=</span> <span class=n>iterations_accountant</span><span class=o>.</span><span class=n>reporting_on_num_iter</span><span class=p>()</span>
<span class=linenos data-linenos="441 "></span>                <span class=n>epoch_to_report</span> <span class=o>=</span> <span class=n>iterations_accountant</span><span class=o>.</span><span class=n>reporting_on_epoch</span><span class=p>()</span>
<span class=linenos data-linenos="442 "></span>
<span class=linenos data-linenos="443 "></span>                <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s1>&#39;Train </span><span class=si>{}</span><span class=s1>| &#39;</span>
<span class=linenos data-linenos="444 "></span>                             <span class=s1>&#39;Iteration </span><span class=si>{}</span><span class=s1>/</span><span class=si>{}</span><span class=s1> | &#39;</span>
<span class=linenos data-linenos="445 "></span>                             <span class=s1>&#39;Samples </span><span class=si>{}</span><span class=s1>/</span><span class=si>{}</span><span class=s1> (</span><span class=si>{:.0f}</span><span class=s1>%)</span><span class=se>\t</span><span class=s1>Loss: </span><span class=si>{:.6f}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
<span class=linenos data-linenos="446 "></span>                                 <span class=sa>f</span><span class=s1>&#39;Epoch: </span><span class=si>{</span><span class=n>epoch_to_report</span><span class=si>}</span><span class=s1> &#39;</span> <span class=k>if</span> <span class=n>epoch_to_report</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=k>else</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
<span class=linenos data-linenos="447 "></span>                                 <span class=n>num_iter</span><span class=p>,</span>
<span class=linenos data-linenos="448 "></span>                                 <span class=n>num_iter_max</span><span class=p>,</span>
<span class=linenos data-linenos="449 "></span>                                 <span class=n>num_samples</span><span class=p>,</span>
<span class=linenos data-linenos="450 "></span>                                 <span class=n>num_samples_max</span><span class=p>,</span>
<span class=linenos data-linenos="451 "></span>                                 <span class=mf>100.</span> <span class=o>*</span> <span class=n>num_iter</span> <span class=o>/</span> <span class=n>num_iter_max</span><span class=p>,</span>
<span class=linenos data-linenos="452 "></span>                                 <span class=n>loss</span><span class=o>.</span><span class=n>item</span><span class=p>())</span>
<span class=linenos data-linenos="453 "></span>                             <span class=p>)</span>
<span class=linenos data-linenos="454 "></span>
<span class=linenos data-linenos="455 "></span>                <span class=c1># Send scalar values via general/feedback topic</span>
<span class=linenos data-linenos="456 "></span>                <span class=k>if</span> <span class=n>history_monitor</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="457 "></span>                    <span class=c1># the researcher only sees the average value of samples observed until now</span>
<span class=linenos data-linenos="458 "></span>                    <span class=n>history_monitor</span><span class=o>.</span><span class=n>add_scalar</span><span class=p>(</span><span class=n>metric</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;Loss&#39;</span><span class=p>:</span> <span class=n>loss</span><span class=o>.</span><span class=n>item</span><span class=p>()},</span>
<span class=linenos data-linenos="459 "></span>                                               <span class=n>iteration</span><span class=o>=</span><span class=n>num_iter</span><span class=p>,</span>
<span class=linenos data-linenos="460 "></span>                                               <span class=n>epoch</span><span class=o>=</span><span class=n>epoch_to_report</span><span class=p>,</span>
<span class=linenos data-linenos="461 "></span>                                               <span class=n>train</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
<span class=linenos data-linenos="462 "></span>                                               <span class=n>num_samples_trained</span><span class=o>=</span><span class=n>num_samples</span><span class=p>,</span>
<span class=linenos data-linenos="463 "></span>                                               <span class=n>num_batches</span><span class=o>=</span><span class=n>num_iter_max</span><span class=p>,</span>
<span class=linenos data-linenos="464 "></span>                                               <span class=n>total_samples</span><span class=o>=</span><span class=n>num_samples_max</span><span class=p>,</span>
<span class=linenos data-linenos="465 "></span>                                               <span class=n>batch_samples</span><span class=o>=</span><span class=n>batch_size</span><span class=p>)</span>
<span class=linenos data-linenos="466 "></span>
<span class=linenos data-linenos="467 "></span>            <span class=c1># Handle dry run mode</span>
<span class=linenos data-linenos="468 "></span>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dry_run</span><span class=p>:</span>
<span class=linenos data-linenos="469 "></span>                <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>send_to_device</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_device_init</span><span class=p>)</span>
<span class=linenos data-linenos="470 "></span>                <span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>empty_cache</span><span class=p>()</span>
<span class=linenos data-linenos="471 "></span>                <span class=k>return</span> <span class=n>iterations_accountant</span><span class=o>.</span><span class=n>num_samples_observed_in_total</span>
<span class=linenos data-linenos="472 "></span>
<span class=linenos data-linenos="473 "></span>    <span class=c1># release gpu usage as much as possible though:</span>
<span class=linenos data-linenos="474 "></span>    <span class=c1># - it should be done by deleting the object</span>
<span class=linenos data-linenos="475 "></span>    <span class=c1># - and some gpu memory remains used until process (cuda kernel ?) finishes</span>
<span class=linenos data-linenos="476 "></span>
<span class=linenos data-linenos="477 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_model</span><span class=o>.</span><span class=n>send_to_device</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_device_init</span><span class=p>)</span>
<span class=linenos data-linenos="478 "></span>    <span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>empty_cache</span><span class=p>()</span>
<span class=linenos data-linenos="479 "></span>
<span class=linenos data-linenos="480 "></span>    <span class=c1># # test (to be removed)</span>
<span class=linenos data-linenos="481 "></span>    <span class=c1># assert id(self._optimizer.model.model) == id(self._model.model)</span>
<span class=linenos data-linenos="482 "></span>
<span class=linenos data-linenos="483 "></span>    <span class=c1># assert id(self._optimizer.model) == id(self._model)</span>
<span class=linenos data-linenos="484 "></span>
<span class=linenos data-linenos="485 "></span>    <span class=c1># for (layer, val), (layer2, val2) in zip(self._model.model.state_dict().items(), self._optimizer.model.model.state_dict().items()):</span>
<span class=linenos data-linenos="486 "></span>    <span class=c1>#     assert layer == layer2</span>
<span class=linenos data-linenos="487 "></span>    <span class=c1>#     print(val, layer2)</span>
<span class=linenos data-linenos="488 "></span>    <span class=c1>#     assert torch.isclose(val, val2).all()</span>
<span class=linenos data-linenos="489 "></span>
<span class=linenos data-linenos="490 "></span>    <span class=c1># for attributes, values in self._model.__dict__.items():</span>
<span class=linenos data-linenos="491 "></span>    <span class=c1>#     print(&quot;ATTRIBUTES&quot;, values)</span>
<span class=linenos data-linenos="492 "></span>    <span class=c1>#     assert values == getattr(self._optimizer.model, attributes)</span>
<span class=linenos data-linenos="493 "></span>
<span class=linenos data-linenos="494 "></span>    <span class=c1># for attributes, values in self._model.model.__dict__.items():</span>
<span class=linenos data-linenos="495 "></span>    <span class=c1>#     print(&quot;ATTRIBUTES&quot;, values)</span>
<span class=linenos data-linenos="496 "></span>    <span class=c1>#     assert values == getattr(self._optimizer.model.model, attributes)</span>
<span class=linenos data-linenos="497 "></span>    <span class=k>return</span> <span class=n>iterations_accountant</span><span class=o>.</span><span class=n>num_samples_observed_in_total</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.training_step class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">training_step</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small> </span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>training_step</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Abstract method, all subclasses must provide a training_step.</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_torchnn.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="167 "></span><span class=nd>@abstractmethod</span>
<span class=linenos data-linenos="168 "></span><span class=k>def</span> <span class=nf>training_step</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=linenos data-linenos="169 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Abstract method, all subclasses must provide a training_step.&quot;&quot;&quot;</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.type class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">type</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nb>type</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Gets training plan type</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_torchnn.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="225 "></span><span class=k>def</span> <span class=nf>type</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>TrainingPlans</span><span class=o>.</span><span class=n>TorchTrainingPlan</span><span class=p>:</span>
<span class=linenos data-linenos="226 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot; Gets training plan type&quot;&quot;&quot;</span>
<span class=linenos data-linenos="227 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>__type</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.common.training_plans.TorchTrainingPlan.update_optimizer_args class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">update_optimizer_args</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>update_optimizer_args</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Updates <code>_optimizer_args</code> variable. Can prove useful to retrieve optimizer parameters after having trained a model, parameters which may have changed during training (eg learning rate).</p> <details class=updated-arguments open> <summary>Updated arguments</summary> <ul> <li>learning_rate</li> </ul> </details> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>Dict</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></code> </td> <td> <div class=doc-md-description> <p>updated <code>_optimizer_args</code></p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_torchnn.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="180 "></span><span class=k>def</span> <span class=nf>update_optimizer_args</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
<span class=linenos data-linenos="181 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=linenos data-linenos="182 "></span><span class=sd>    Updates `_optimizer_args` variable. Can prove useful</span>
<span class=linenos data-linenos="183 "></span><span class=sd>    to retrieve optimizer parameters after having trained a</span>
<span class=linenos data-linenos="184 "></span><span class=sd>    model, parameters which may have changed during training (eg learning rate).</span>
<span class=linenos data-linenos="185 "></span>
<span class=linenos data-linenos="186 "></span><span class=sd>    Updated arguments:</span>
<span class=linenos data-linenos="187 "></span><span class=sd>     - learning_rate</span>
<span class=linenos data-linenos="188 "></span>
<span class=linenos data-linenos="189 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="190 "></span><span class=sd>        Dict: updated `_optimizer_args`</span>
<span class=linenos data-linenos="191 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="192 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer_args</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="193 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer_args</span> <span class=o>=</span> <span class=p>{}</span>
<span class=linenos data-linenos="194 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>aggregator_name</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>aggregator_name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&quot;scaffold&quot;</span><span class=p>:</span>
<span class=linenos data-linenos="195 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer_args</span><span class=p>[</span><span class=s1>&#39;lr&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer</span><span class=o>.</span><span class=n>get_learning_rate</span><span class=p>()</span>
<span class=linenos data-linenos="196 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_optimizer_args</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <div class="doc doc-contents first"> <p>Accounting class for keeping track of training iterations.</p> <p>This class has the following responsibilities:</p> <div class=highlight><pre><span></span><code>- manage iterators for epochs and batches
- provide up-to-date values for reporting
- handle different semantics in case the researcher asked for num_updates or epochs
</code></pre></div> <p>We assume that the underlying implementation for the training loop is always made in terms of epochs and batches. So the primary purpose of this class is to provide a way to correctly convert the number of updates into epochs and batches.</p> <p>For reporting purposes, in the case of num_updates then we think of the training as a single big loop, while in the case of epochs and batches we think of it as two nested loops. This changes the meaning of the values outputted by the reporting functions (see their docstrings for more details).</p> <p><span class=doc-section-title>Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><span title="fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant._training_plan">_training_plan</span></code></td> <td> </td> <td> <div class=doc-md-description> <p>a reference to the training plan executing the training iterations</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.cur_epoch" href="#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.cur_epoch">cur_epoch</a></code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>the index of the current epoch during iterations</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.cur_batch" href="#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.cur_batch">cur_batch</a></code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>the index of the current batch during iterations</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.epochs" href="#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.epochs">epochs</a></code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>the total number of epochs to be performed (we always perform one additional -- possibly empty -- epoch</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_batches_per_epoch" href="#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_batches_per_epoch">num_batches_per_epoch</a></code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>the number of iterations per epoch</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_batches_in_last_epoch" href="#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_batches_in_last_epoch">num_batches_in_last_epoch</a></code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>the number of iterations in the last epoch (can be zero)</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_samples_observed_in_epoch" href="#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_samples_observed_in_epoch">num_samples_observed_in_epoch</a></code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>a counter for the number of samples observed in the current epoch, for reporting</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" title="fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_samples_observed_in_total" href="#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_samples_observed_in_total">num_samples_observed_in_total</a></code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>a counter for the number of samples observed total, for reporting</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>training_plan</code></td> <td> <code><span title="fedbiomed.common.training_plans._training_iterations.TBaseTrainingPlan">TBaseTrainingPlan</span></code> </td> <td> <div class=doc-md-description> <p>a reference to the training plan that is executing the training iterations</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_training_iterations.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="48 "></span><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>training_plan</span><span class=p>:</span> <span class=n>TBaseTrainingPlan</span><span class=p>):</span>
<span class=linenos data-linenos="49 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Initialize the class.</span>
<span class=linenos data-linenos="50 "></span>
<span class=linenos data-linenos="51 "></span><span class=sd>    Arguments:</span>
<span class=linenos data-linenos="52 "></span><span class=sd>        training_plan: a reference to the training plan that is executing the training iterations</span>
<span class=linenos data-linenos="53 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="54 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span> <span class=o>=</span> <span class=n>training_plan</span>
<span class=linenos data-linenos="55 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>cur_epoch</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
<span class=linenos data-linenos="56 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>cur_batch</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
<span class=linenos data-linenos="57 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>epochs</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
<span class=linenos data-linenos="58 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>num_batches_per_epoch</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
<span class=linenos data-linenos="59 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>num_batches_in_last_epoch</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
<span class=linenos data-linenos="60 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>num_samples_observed_in_epoch</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
<span class=linenos data-linenos="61 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>num_samples_observed_in_total</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
<span class=linenos data-linenos="62 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_n_training_iterations</span><span class=p>()</span>
</code></pre></div> </details> <div class="doc doc-children"> <h2 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant-attributes>Attributes</h2> <div class="doc doc-object doc-attribute"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.cur_batch class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">cur_batch</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>cur_batch</span> <span class=o>=</span> <span class=mi>0</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.cur_epoch class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">cur_epoch</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>cur_epoch</span> <span class=o>=</span> <span class=mi>0</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.epochs class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">epochs</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>epochs</span> <span class=o>=</span> <span class=mi>0</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_batches_in_last_epoch class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">num_batches_in_last_epoch</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>num_batches_in_last_epoch</span> <span class=o>=</span> <span class=mi>0</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_batches_per_epoch class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">num_batches_per_epoch</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>num_batches_per_epoch</span> <span class=o>=</span> <span class=mi>0</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_samples_observed_in_epoch class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">num_samples_observed_in_epoch</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>num_samples_observed_in_epoch</span> <span class=o>=</span> <span class=mi>0</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_samples_observed_in_total class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">num_samples_observed_in_total</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>num_samples_observed_in_total</span> <span class=o>=</span> <span class=mi>0</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <h2 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant-classes>Classes</h2> <div class="doc doc-object doc-class"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.BatchIter class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">BatchIter</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>BatchIter</span><span class=p>(</span><span class=n>accountant</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Iterator over batches.</p> <p><span class=doc-section-title>Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><span title="fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.BatchIter._accountant">_accountant</span></code></td> <td> </td> <td> <div class=doc-md-description> <p>an instance of the class that created this iterator</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_training_iterations.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="230 "></span><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>accountant</span><span class=p>:</span> <span class=n>TTrainingIterationsAccountant</span><span class=p>):</span>
<span class=linenos data-linenos="231 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_accountant</span> <span class=o>=</span> <span class=n>accountant</span>
</code></pre></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.EpochsIter class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">EpochsIter</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>EpochsIter</span><span class=p>(</span><span class=n>accountant</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Iterator over epochs.</p> <p><span class=doc-section-title>Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><span title="fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.EpochsIter._accountant">_accountant</span></code></td> <td> </td> <td> <div class=doc-md-description> <p>an instance of the class that created this iterator</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_training_iterations.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="201 "></span><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>accountant</span><span class=p>:</span> <span class=n>TTrainingIterationsAccountant</span><span class=p>):</span>
<span class=linenos data-linenos="202 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_accountant</span> <span class=o>=</span> <span class=n>accountant</span>
</code></pre></div> </details> <div class="doc doc-children"> </div> </div> </div> <h2 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant-functions>Functions</h2> <div class="doc doc-object doc-function"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.increment_sample_counters class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">increment_sample_counters</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>increment_sample_counters</span><span class=p>(</span><span class=n>n_samples</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Increments internal counter for numbers of observed samples</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_training_iterations.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="71 "></span><span class=k>def</span> <span class=nf>increment_sample_counters</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>n_samples</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
<span class=linenos data-linenos="72 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Increments internal counter for numbers of observed samples&quot;&quot;&quot;</span>
<span class=linenos data-linenos="73 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>num_samples_observed_in_epoch</span> <span class=o>+=</span> <span class=n>n_samples</span>
<span class=linenos data-linenos="74 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>num_samples_observed_in_total</span> <span class=o>+=</span> <span class=n>n_samples</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.iterate_batches class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">iterate_batches</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>iterate_batches</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Returns an instance of a batches iterator.</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_training_iterations.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="253 "></span><span class=k>def</span> <span class=nf>iterate_batches</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=linenos data-linenos="254 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns an instance of a batches iterator.&quot;&quot;&quot;</span>
<span class=linenos data-linenos="255 "></span>    <span class=k>return</span> <span class=n>MiniBatchTrainingIterationsAccountant</span><span class=o>.</span><span class=n>BatchIter</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.iterate_epochs class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">iterate_epochs</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>iterate_epochs</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Returns an instance of an epochs iterator.</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_training_iterations.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="249 "></span><span class=k>def</span> <span class=nf>iterate_epochs</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=linenos data-linenos="250 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns an instance of an epochs iterator.&quot;&quot;&quot;</span>
<span class=linenos data-linenos="251 "></span>    <span class=k>return</span> <span class=n>MiniBatchTrainingIterationsAccountant</span><span class=o>.</span><span class=n>EpochsIter</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_batches_in_this_epoch class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">num_batches_in_this_epoch</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>num_batches_in_this_epoch</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Returns the number of iterations to be performed in the current epoch</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_training_iterations.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="64 "></span><span class=k>def</span> <span class=nf>num_batches_in_this_epoch</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
<span class=linenos data-linenos="65 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns the number of iterations to be performed in the current epoch&quot;&quot;&quot;</span>
<span class=linenos data-linenos="66 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>cur_epoch</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>epochs</span><span class=p>:</span>
<span class=linenos data-linenos="67 "></span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>num_batches_in_last_epoch</span>
<span class=linenos data-linenos="68 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="69 "></span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>num_batches_per_epoch</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.reporting_on_epoch class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">reporting_on_epoch</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>reporting_on_epoch</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Returns the optional index of the current epoch, for reporting.</p> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_training_iterations.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="127 "></span><span class=k>def</span> <span class=nf>reporting_on_epoch</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]:</span>
<span class=linenos data-linenos="128 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns the optional index of the current epoch, for reporting.&quot;&quot;&quot;</span>
<span class=linenos data-linenos="129 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>training_args</span><span class=p>()[</span><span class=s1>&#39;num_updates&#39;</span><span class=p>]</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="130 "></span>        <span class=k>return</span> <span class=kc>None</span>
<span class=linenos data-linenos="131 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="132 "></span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>cur_epoch</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.reporting_on_num_iter class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">reporting_on_num_iter</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>reporting_on_num_iter</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Outputs useful reporting information about the number of iterations</p> <p>If the researcher specified num_updates, then the iteration number will be the cumulated total, and similarly the maximum number of iterations will be equal to the requested number of updates. If the researcher specified epochs, then the iteration number will be the batch index in the current epoch, while the maximum number of iterations will be computed specifically for the current epoch.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>the iteration number</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>the maximum number of iterations to be reported</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_training_iterations.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="105 "></span><span class=k>def</span> <span class=nf>reporting_on_num_iter</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>]:</span>
<span class=linenos data-linenos="106 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Outputs useful reporting information about the number of iterations</span>
<span class=linenos data-linenos="107 "></span>
<span class=linenos data-linenos="108 "></span><span class=sd>    If the researcher specified num_updates, then the iteration number will be the cumulated total, and</span>
<span class=linenos data-linenos="109 "></span><span class=sd>    similarly the maximum number of iterations will be equal to the requested number of updates.</span>
<span class=linenos data-linenos="110 "></span><span class=sd>    If the researcher specified epochs, then the iteration number will be the batch index in the current epoch,</span>
<span class=linenos data-linenos="111 "></span><span class=sd>    while the maximum number of iterations will be computed specifically for the current epoch.</span>
<span class=linenos data-linenos="112 "></span>
<span class=linenos data-linenos="113 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="114 "></span><span class=sd>        the iteration number</span>
<span class=linenos data-linenos="115 "></span><span class=sd>        the maximum number of iterations to be reported</span>
<span class=linenos data-linenos="116 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="117 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>training_args</span><span class=p>()[</span><span class=s1>&#39;num_updates&#39;</span><span class=p>]</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="118 "></span>        <span class=n>num_iter</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>cur_epoch</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>num_batches_per_epoch</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>cur_batch</span>
<span class=linenos data-linenos="119 "></span>        <span class=n>total_batches_to_be_observed</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>epochs</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>num_batches_per_epoch</span> <span class=o>+</span> \
<span class=linenos data-linenos="120 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>num_batches_in_last_epoch</span>
<span class=linenos data-linenos="121 "></span>        <span class=n>num_iter_max</span> <span class=o>=</span> <span class=n>total_batches_to_be_observed</span>
<span class=linenos data-linenos="122 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="123 "></span>        <span class=n>num_iter</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cur_batch</span>
<span class=linenos data-linenos="124 "></span>        <span class=n>num_iter_max</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>num_batches_per_epoch</span>
<span class=linenos data-linenos="125 "></span>    <span class=k>return</span> <span class=n>num_iter</span><span class=p>,</span> <span class=n>num_iter_max</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.reporting_on_num_samples class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">reporting_on_num_samples</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>reporting_on_num_samples</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Outputs useful reporting information about the number of observed samples</p> <p>If the researcher specified num_updates, then the number of observed samples will be the grand total, and similarly the maximum number of samples will be the grand total over all iterations. If the researcher specified epochs, then both values will be specific to the current epoch.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>the number of samples observed until the current iteration</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td> <div class=doc-md-description> <p>the maximum number of samples to be observed</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_training_iterations.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos=" 76 "></span><span class=k>def</span> <span class=nf>reporting_on_num_samples</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>]:</span>
<span class=linenos data-linenos=" 77 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Outputs useful reporting information about the number of observed samples</span>
<span class=linenos data-linenos=" 78 "></span>
<span class=linenos data-linenos=" 79 "></span><span class=sd>    If the researcher specified num_updates, then the number of observed samples will be the grand total, and</span>
<span class=linenos data-linenos=" 80 "></span><span class=sd>    similarly the maximum number of samples will be the grand total over all iterations.</span>
<span class=linenos data-linenos=" 81 "></span><span class=sd>    If the researcher specified epochs, then both values will be specific to the current epoch.</span>
<span class=linenos data-linenos=" 82 "></span>
<span class=linenos data-linenos=" 83 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos=" 84 "></span><span class=sd>        the number of samples observed until the current iteration</span>
<span class=linenos data-linenos=" 85 "></span><span class=sd>        the maximum number of samples to be observed</span>
<span class=linenos data-linenos=" 86 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos=" 87 "></span>    <span class=c1># get batch size</span>
<span class=linenos data-linenos=" 88 "></span>    <span class=k>if</span> <span class=s1>&#39;batch_size&#39;</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>loader_args</span><span class=p>():</span>
<span class=linenos data-linenos=" 89 "></span>        <span class=n>batch_size</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>loader_args</span><span class=p>()[</span><span class=s1>&#39;batch_size&#39;</span><span class=p>]</span>
<span class=linenos data-linenos=" 90 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos=" 91 "></span>        <span class=k>raise</span> <span class=n>FedbiomedUserInputError</span><span class=p>(</span><span class=s1>&#39;Missing required key `batch_size` in `loader_args`.&#39;</span><span class=p>)</span>
<span class=linenos data-linenos=" 92 "></span>    <span class=c1># compute number of observed samples</span>
<span class=linenos data-linenos=" 93 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>training_args</span><span class=p>()[</span><span class=s1>&#39;num_updates&#39;</span><span class=p>]</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos=" 94 "></span>        <span class=n>num_samples</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>num_samples_observed_in_total</span>
<span class=linenos data-linenos=" 95 "></span>        <span class=n>total_batches_to_be_observed</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>epochs</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>num_batches_per_epoch</span> <span class=o>+</span> \
<span class=linenos data-linenos=" 96 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>num_batches_in_last_epoch</span>
<span class=linenos data-linenos=" 97 "></span>        <span class=n>total_n_samples_to_be_observed</span> <span class=o>=</span> <span class=n>batch_size</span> <span class=o>*</span> <span class=n>total_batches_to_be_observed</span>
<span class=linenos data-linenos=" 98 "></span>        <span class=n>num_samples_max</span> <span class=o>=</span> <span class=n>total_n_samples_to_be_observed</span>
<span class=linenos data-linenos=" 99 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="100 "></span>        <span class=n>num_samples</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>num_samples_observed_in_epoch</span>
<span class=linenos data-linenos="101 "></span>        <span class=n>num_samples_max</span> <span class=o>=</span> <span class=n>batch_size</span><span class=o>*</span><span class=bp>self</span><span class=o>.</span><span class=n>num_batches_in_this_epoch</span><span class=p>()</span> <span class=k>if</span> \
<span class=linenos data-linenos="102 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>cur_batch</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>num_batches_in_this_epoch</span><span class=p>()</span> <span class=k>else</span> <span class=n>num_samples</span>
<span class=linenos data-linenos="103 "></span>    <span class=k>return</span> <span class=n>num_samples</span><span class=p>,</span> <span class=n>num_samples_max</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.should_log_this_batch class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">should_log_this_batch</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>should_log_this_batch</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Whether the current batch should be logged or not.</p> <p>A batch shall be logged if at least one of the following conditions is True:</p> <div class=highlight><pre><span></span><code>- the cumulative batch index is a multiple of the logging interval
- the dry_run condition was specified by the researcher
- it is the last batch of the epoch
- it is the first batch of the epoch
</code></pre></div> <details class=quote> <summary>Source code in <code>fedbiomed/common/training_plans/_training_iterations.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="134 "></span><span class=k>def</span> <span class=nf>should_log_this_batch</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=linenos data-linenos="135 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Whether the current batch should be logged or not.</span>
<span class=linenos data-linenos="136 "></span>
<span class=linenos data-linenos="137 "></span><span class=sd>    A batch shall be logged if at least one of the following conditions is True:</span>
<span class=linenos data-linenos="138 "></span>
<span class=linenos data-linenos="139 "></span><span class=sd>        - the cumulative batch index is a multiple of the logging interval</span>
<span class=linenos data-linenos="140 "></span><span class=sd>        - the dry_run condition was specified by the researcher</span>
<span class=linenos data-linenos="141 "></span><span class=sd>        - it is the last batch of the epoch</span>
<span class=linenos data-linenos="142 "></span><span class=sd>        - it is the first batch of the epoch</span>
<span class=linenos data-linenos="143 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="144 "></span>    <span class=n>current_iter</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>cur_epoch</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>num_batches_per_epoch</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>cur_batch</span>
<span class=linenos data-linenos="145 "></span>    <span class=k>return</span> <span class=p>(</span><span class=n>current_iter</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>training_args</span><span class=p>()[</span><span class=s1>&#39;log_interval&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>or</span>
<span class=linenos data-linenos="146 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>training_args</span><span class=p>()[</span><span class=s1>&#39;dry_run&#39;</span><span class=p>]</span> <span class=ow>or</span>
<span class=linenos data-linenos="147 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>cur_batch</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>num_batches_in_this_epoch</span><span class=p>()</span> <span class=ow>or</span>  <span class=c1># last batch</span>
<span class=linenos data-linenos="148 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>cur_batch</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span>  <span class=c1># first batch</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> </article> </main> </div> <div class=right-col> <div id=right-sidebar class=sidebar-right> <nav class=toc> <!-- Render item list --> <label class=toc-title for=__toc> <span class=toc-icon></span> </label> <ul class=toc-list data-md-component=toc data-md-scrollfix> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans-classes class=md-nav__link> Classes </a> <nav class=toc-nav aria-label=Classes> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan class=md-nav__link> BaseTrainingPlan </a> <nav class=toc-nav aria-label=BaseTrainingPlan> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan-attributes class=md-nav__link> Attributes </a> <nav class=toc-nav aria-label=Attributes> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.dataset_path class=md-nav__link> dataset_path </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.dependencies class=md-nav__link> dependencies </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.pre_processes class=md-nav__link> pre_processes </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.testing_data_loader class=md-nav__link> testing_data_loader </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.training_data_loader class=md-nav__link> training_data_loader </a> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan-functions class=md-nav__link> Functions </a> <nav class=toc-nav aria-label=Functions> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.add_preprocess class=md-nav__link> add_preprocess </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.after_training_params class=md-nav__link> after_training_params </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.export_model class=md-nav__link> export_model </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.get_model_params class=md-nav__link> get_model_params </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.get_model_wrapper_class class=md-nav__link> get_model_wrapper_class </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.import_model class=md-nav__link> import_model </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.init_dependencies class=md-nav__link> init_dependencies </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.init_optimizer class=md-nav__link> init_optimizer </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.loader_args class=md-nav__link> loader_args </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.model class=md-nav__link> model </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.model_args class=md-nav__link> model_args </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.optimizer class=md-nav__link> optimizer </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.optimizer_args class=md-nav__link> optimizer_args </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.post_init class=md-nav__link> post_init </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.save_code class=md-nav__link> save_code </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.set_aggregator_args class=md-nav__link> set_aggregator_args </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.set_data_loaders class=md-nav__link> set_data_loaders </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.set_dataset_path class=md-nav__link> set_dataset_path </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.set_model_params class=md-nav__link> set_model_params </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.set_optimizer class=md-nav__link> set_optimizer </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.source class=md-nav__link> source </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.testing_routine class=md-nav__link> testing_routine </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.training_args class=md-nav__link> training_args </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.training_data class=md-nav__link> training_data </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.BaseTrainingPlan.training_routine class=md-nav__link> training_routine </a> </li> </ul> </nav> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.FedPerceptron class=md-nav__link> FedPerceptron </a> <nav class=toc-nav aria-label=FedPerceptron> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.FedPerceptron-functions class=md-nav__link> Functions </a> <nav class=toc-nav aria-label=Functions> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.FedPerceptron.post_init class=md-nav__link> post_init </a> </li> </ul> </nav> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.FedSGDClassifier class=md-nav__link> FedSGDClassifier </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.FedSGDRegressor class=md-nav__link> FedSGDRegressor </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.SKLearnTrainingPlan class=md-nav__link> SKLearnTrainingPlan </a> <nav class=toc-nav aria-label=SKLearnTrainingPlan> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.SKLearnTrainingPlan-attributes class=md-nav__link> Attributes </a> <nav class=toc-nav aria-label=Attributes> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.SKLearnTrainingPlan.dataset_path class=md-nav__link> dataset_path </a> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.SKLearnTrainingPlan-functions class=md-nav__link> Functions </a> <nav class=toc-nav aria-label=Functions> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.SKLearnTrainingPlan.init_optimizer class=md-nav__link> init_optimizer </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.SKLearnTrainingPlan.model class=md-nav__link> model </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.SKLearnTrainingPlan.post_init class=md-nav__link> post_init </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.SKLearnTrainingPlan.set_data_loaders class=md-nav__link> set_data_loaders </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.SKLearnTrainingPlan.testing_routine class=md-nav__link> testing_routine </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.SKLearnTrainingPlan.training_routine class=md-nav__link> training_routine </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.SKLearnTrainingPlan.type class=md-nav__link> type </a> </li> </ul> </nav> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan class=md-nav__link> TorchTrainingPlan </a> <nav class=toc-nav aria-label=TorchTrainingPlan> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan-attributes class=md-nav__link> Attributes </a> <nav class=toc-nav aria-label=Attributes> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.aggregator_name class=md-nav__link> aggregator_name </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.correction_state class=md-nav__link> correction_state </a> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan-functions class=md-nav__link> Functions </a> <nav class=toc-nav aria-label=Functions> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.after_training_params class=md-nav__link> after_training_params </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.init_model class=md-nav__link> init_model </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.init_optimizer class=md-nav__link> init_optimizer </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.initial_parameters class=md-nav__link> initial_parameters </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.model class=md-nav__link> model </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.optimizer_args class=md-nav__link> optimizer_args </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.post_init class=md-nav__link> post_init </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.send_to_device class=md-nav__link> send_to_device </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.set_aggregator_args class=md-nav__link> set_aggregator_args </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.testing_routine class=md-nav__link> testing_routine </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.training_data class=md-nav__link> training_data </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.training_routine class=md-nav__link> training_routine </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.training_step class=md-nav__link> training_step </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.type class=md-nav__link> type </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans.TorchTrainingPlan.update_optimizer_args class=md-nav__link> update_optimizer_args </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant-attributes class=md-nav__link> Attributes </a> <nav class=toc-nav aria-label=Attributes> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.cur_batch class=md-nav__link> cur_batch </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.cur_epoch class=md-nav__link> cur_epoch </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.epochs class=md-nav__link> epochs </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_batches_in_last_epoch class=md-nav__link> num_batches_in_last_epoch </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_batches_per_epoch class=md-nav__link> num_batches_per_epoch </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_samples_observed_in_epoch class=md-nav__link> num_samples_observed_in_epoch </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_samples_observed_in_total class=md-nav__link> num_samples_observed_in_total </a> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant-classes class=md-nav__link> Classes </a> <nav class=toc-nav aria-label=Classes> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.BatchIter class=md-nav__link> BatchIter </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.EpochsIter class=md-nav__link> EpochsIter </a> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant-functions class=md-nav__link> Functions </a> <nav class=toc-nav aria-label=Functions> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.increment_sample_counters class=md-nav__link> increment_sample_counters </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.iterate_batches class=md-nav__link> iterate_batches </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.iterate_epochs class=md-nav__link> iterate_epochs </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.num_batches_in_this_epoch class=md-nav__link> num_batches_in_this_epoch </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.reporting_on_epoch class=md-nav__link> reporting_on_epoch </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.reporting_on_num_iter class=md-nav__link> reporting_on_num_iter </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.reporting_on_num_samples class=md-nav__link> reporting_on_num_samples </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.common.training_plans._training_iterations.MiniBatchTrainingIterationsAccountant.should_log_this_batch class=md-nav__link> should_log_this_batch </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> </div> <!-- News Main Page--> </div> <footer> <div class=container-fluid> <div class=footer-first-inner> <div class=container> <div class=row> <div class=col-md-6> <div class=footer-contact> <strong>Address:</strong> <p>2004 Rte des Lucioles, 06902 Sophia Antipolis</p> <strong>E-mail:</strong> <p>fedbiomed _at_ inria _dot_ fr</p> </div> </div> <div class=col-md-6> <div class=footer-contact> <p>Fed-BioMed © 2022</p> </div> </div> </div> </div> </div> </div> </footer> <!-- JQuery --> <script src=https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js></script> <!-- Latest compiled and minified JavaScript --> <script src=https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=../../../../assets/javascript/lunr.js></script> <script src=../../../../assets/javascript/theme.js></script> </body> </html>