<!DOCTYPE html><html> <head><meta charset=UTF-8><meta name=viewport content="width=device-width, initial-scale=1"><!--  --><script>
      const versions_json = "../../../../versions.json";
      const search_worker_js = "../../../assets/javascript/search-worker.js";
      const search_index_json = "../../../search/search_index.json";
      const base_url = '../../..';
    </script><!-- Site title --><title>The Method `training_data` in Training Plan - Fed-BioMed</title><link rel=icon type=image/x-icon href=../../../favicon.ico><!-- Page description --><meta name=description content="The method `training_data` of the training plan is needed to load and process the dataset deployed on the nodes. It is a method that has to be defined in every training plan class."><!-- Page keywords --><meta name=keywords content="training data,training plan,fedbiomed, loading dataset in FL"><!-- Page author --><!-- Latest compiled and minified CSS --><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><!-- Bootstrap Icons --><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css><link href=../../../assets/_mkdocstrings.css rel=stylesheet><link href=../../../assets/css/style.css rel=stylesheet></head> <body> <div class="container-fluid top-bar"> <div class=brand> <a href=/ > <img src=../../../assets/img/fedbiomed-logo-small.png> </a> </div> <nav class=top> <ul> <li class> <a href=../../..>Home</a> </li> <li class> <a href=../../../getting-started/what-is-fedbiomed/ >User Documentation</a> </li> <li class> <a href=../../../pages/about-us/ >About</a> </li> <li id=clicker class=has-sub> More <i class="bi bi-chevron-down"></i> <ul class=sub-nav-menu> <li class> <a href=../../../#funding>Funding</a> </li> <li class> <a href=../../../news/ >News</a> </li> <li class> <a href=../../../#contributors>Contributors</a> </li> <li class> <a href=../../../#users>Users</a> </li> <li class> <a href=../../../pages/roadmap/ >Roadmap</a> </li> <li class> <a href=../../../#contact-us>Contact Us</a> </li> </ul> </li> </ul> </nav> </div> <div class="container-fluid top-bar-mobile"> <div class=mobile-bar> <div class=brand> <a href=../../../ > <img src=../../../assets/img/fedbiomed-logo-small.png> </a> </div> <div class=hum-menu> <img class=open src=../../../assets/img/menu.svg> <img class=close style=display:none src=../../../assets/img/cancel.svg> </div> </div> <nav class=top-mobile> <ul> <li class> <a href=../../..>Home</a> </li> <li class> <a href=../../../getting-started/what-is-fedbiomed/ >User Documentation</a> </li> <li class> <a href=../../../pages/about-us/ >About</a> </li> <li id=clicker class=has-sub> More <i class="bi bi-chevron-down"></i> <ul class=sub-nav-menu> <li class> <a href=../../../#funding>Funding</a> </li> <li class> <a href=../../../news/ >News</a> </li> <li class> <a href=../../../#contributors>Contributors</a> </li> <li class> <a href=../../../#users>Users</a> </li> <li class> <a href=../../../pages/roadmap/ >Roadmap</a> </li> <li class> <a href=../../../#contact-us>Contact Us</a> </li> </ul> </li> </ul> </nav> </div> <div class=main> <!-- Home page --> <div class=container-fluid> <div class=doc-row> <div class=left-col> <div class=sidebar-doc> <div class=sidebar-inner> <ul class="sidebar-menu-left sub"> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Getting Started <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../getting-started/what-is-fedbiomed/ class>What's Fed-BioMed</a> </li> <li class> <a href=../../../getting-started/getting-started/ class>Basic Example</a> </li> <li class> <a href=../../../getting-started/fedbiomed-architecture/ class>Fedbiomed Architecture</a> </li> <li class> <a href=../../../getting-started/fedbiomed-workflow/ class>Fedbiomed Workflow</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Tutorials <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Installation <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/installation/0-basic-software-installation/ class>Software Installation</a> </li> <li class> <a href=../../../tutorials/installation/1-setting-up-environment/ class>Setting Up Environment</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> PyTorch <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/pytorch/01_PyTorch_MNIST_Single_Node_Tutorial/ class>PyTorch MNIST Basic Example</a> </li> <li class> <a href=../../../tutorials/pytorch/02_Create_Your_Custom_Training_Plan/ class>How to Create Your Custom PyTorch Training Plan</a> </li> <li class> <a href=../../../tutorials/pytorch/03_PyTorch_MNIST_local_vs_Federated/ class>MNIST classification with PyTorch, comparing federated model vs model trained locally</a> </li> <li class> <a href=../../../tutorials/pytorch/04_PyTorch_Used_Cars_Dataset_Example/ class>PyTorch Used Cars Dataset Example</a> </li> <li class> <a href=../../../tutorials/pytorch/05-Aggregation_in_Fed-BioMed/ class>PyTorch aggregation methods in Fed-BioMed</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> MONAI <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/monai/01_monai-2d-image-classification/ class>Federated 2d image classification with MONAI</a> </li> <li class> <a href=../../../tutorials/monai/02_monai-2d-image-registration/ class>Federated 2d XRay registration with MONAI</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Scikit-Learn <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/scikit-learn/01_sklearn_MNIST_classification_tutorial/ class>MNIST classification with Scikit-Learn Classifier (Perceptron)</a> </li> <li class> <a href=../../../tutorials/scikit-learn/02_sklearn_sgd_regressor_tutorial/ class>Fed-BioMed to train a federated SGD regressor model</a> </li> <li class> <a href=../../../tutorials/scikit-learn/03-other-scikit-learn-models/ class>Implementing other Scikit Learn models for Federated Learning</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> FLamby <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/flamby/flamby/ class>General Concepts</a> </li> <li class> <a href=../../../tutorials/flamby/flamby-integration-into-fedbiomed/ class>FLamby integration in Fed-BioMed</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Advanced <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/advanced/in-depth-experiment-configuration/ class>In Depth Experiment Configuration</a> </li> <li class> <a href=../../../tutorials/advanced/training-with-gpu/ class>PyTorch model training using a GPU</a> </li> <li class> <a href=../../../tutorials/advanced/breakpoints/ class>Breakpoints</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Security <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/security/differential-privacy-with-opacus-on-fedbiomed/ class>Using Differential Privacy with OPACUS on Fed-BioMed</a> </li> <li class> <a href=../../../tutorials/security/non-private-local-central-dp-monai-2d-image-registration/ class>Local and Central DP with Fed-BioMed: MONAI 2d image registration</a> </li> <li class> <a href=../../../tutorials/security/training-with-approved-training-plans/ class>Training Process with Training Plan Management</a> </li> <li class> <a href=../../../tutorials/security/secure-aggregation/ class>Training with Secure Aggregation</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Biomedical data <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/medical/medical-image-segmentation-unet-library/ class>Brain Segmentation</a> </li> </ul> </li> </ul> </li> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> User Guide <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li class> <a href=../../glossary/ class>Glossary</a> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Deployment <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../deployment/deployment/ class>Introduction</a> </li> <li class> <a href=../../deployment/deployment-vpn/ class>VPN Deployment</a> </li> <li class> <a href=../../deployment/matrix/ class>Network matrix</a> </li> <li class> <a href=../../deployment/security-model/ class>Security model</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Node <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../nodes/configuring-nodes/ class>Configuring Nodes</a> </li> <li class> <a href=../../nodes/deploying-datasets/ class>Deploying Datasets</a> </li> <li class> <a href=../../nodes/training-plan-security-manager/ class>Training Plan Management</a> </li> <li class> <a href=../../nodes/using-gpu/ class>Using GPU</a> </li> <li class> <a href=../../nodes/node-gui/ class>Node GUI</a> </li> </ul> </li> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> Researcher <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li class> <a href=../training-plan/ class>Training Plan</a> </li> <li class=current> <a href=./ class="link current">Training Data</a> </li> <li class> <a href=../experiment/ class>Experiment</a> </li> <li class> <a href=../aggregation/ class>Aggregation</a> </li> <li class> <a href=../listing-datasets-and-selecting-nodes/ class>Listing Datasets and Selecting Nodes</a> </li> <li class> <a href=../model-testing-during-federated-training/ class>Model Validation on the Node Side</a> </li> <li class> <a href=../tensorboard/ class>Tensorboard</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Secure Aggregation <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../secagg/introduction/ class>Introduction</a> </li> <li class> <a href=../../secagg/configuration/ class>Configuration</a> </li> <li class> <a href=../../secagg/certificate-registration/ class>Certificate Registration</a> </li> <li class> <a href=../../secagg/researcher-interface/ class>Managing Secure Aggregation in Researcher</a> </li> </ul> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Developer <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> API Reference <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Common <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../developer/api/common/constants/ class>Constants</a> </li> <li class> <a href=../../../developer/api/common/data/ class>Data</a> </li> <li class> <a href=../../../developer/api/common/environ/ class>Environ</a> </li> <li class> <a href=../../../developer/api/common/exceptions/ class>Exceptions</a> </li> <li class> <a href=../../../developer/api/common/json/ class>Json</a> </li> <li class> <a href=../../../developer/api/common/logger/ class>Logger</a> </li> <li class> <a href=../../../developer/api/common/message/ class>Message</a> </li> <li class> <a href=../../../developer/api/common/messaging/ class>Messaging</a> </li> <li class> <a href=../../../developer/api/common/models/ class>Model</a> </li> <li class> <a href=../../../developer/api/common/optimizer/ class>Optimizer</a> </li> <li class> <a href=../../../developer/api/common/repository/ class>Repository</a> </li> <li class> <a href=../../../developer/api/common/tasks_queue/ class>TasksQueue</a> </li> <li class> <a href=../../../developer/api/common/training_plans/ class>TrainingPlans</a> </li> <li class> <a href=../../../developer/api/common/training_args/ class>TrainingArgs</a> </li> <li class> <a href=../../../developer/api/common/utils/ class>Utils</a> </li> <li class> <a href=../../../developer/api/common/validator/ class>Validator</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Node <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../developer/api/node/cli/ class>CLI</a> </li> <li class> <a href=../../../developer/api/node/dataset_manager/ class>DatasetManager</a> </li> <li class> <a href=../../../developer/api/node/node/ class>Node</a> </li> <li class> <a href=../../../developer/api/node/training_plan_security_manager/ class>TrainingPlanSecurityManager</a> </li> <li class> <a href=../../../developer/api/node/history_monitor/ class>HistoryMonitor</a> </li> <li class> <a href=../../../developer/api/node/round/ class>Round</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Researcher <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../developer/api/researcher/aggregators/ class>Aggregators</a> </li> <li class> <a href=../../../developer/api/researcher/datasets/ class>Datasets</a> </li> <li class> <a href=../../../developer/api/researcher/experiment/ class>Experiment</a> </li> <li class> <a href=../../../developer/api/researcher/filetools/ class>Filetools</a> </li> <li class> <a href=../../../developer/api/researcher/job/ class>Job</a> </li> <li class> <a href=../../../developer/api/researcher/monitor/ class>Monitor</a> </li> <li class> <a href=../../../developer/api/researcher/responses/ class>Responses</a> </li> <li class> <a href=../../../developer/api/researcher/requests/ class>Requests</a> </li> <li class> <a href=../../../developer/api/researcher/strategies/ class>Strategies</a> </li> <li class> <a href=../../../developer/api/researcher/secagg/ class>Secagg</a> </li> </ul> </li> </ul> </li> <li class> <a href=../../../developer/usage_and_tools/ class>Usage and Tools</a> </li> <li class> <a href=../../../developer/ci/ class>Continuous Integration</a> </li> <li class> <a href=../../../developer/definition-of-done/ class>Definition of Done</a> </li> </ul> </li> </ul> </div> </div> </div> <div class=main-col> <div class=main-docs> <h1 id=loading-dataset-for-training>Loading Dataset for Training</h1> <p>Datasets in the nodes are saved on the disk. Therefore, before the training, each node should load these datasets from the file system. Since the type of datasets (image, tabular, etc.) and the way of loading might vary from one to another, the user (researcher) should define a method called <code>training_data</code>. The method <code>training_data</code> is mandatory for each training plan (<code>TrochTrainingPlan</code> and <code>SkLearnSGDModel</code>). If it is not defined nodes will return an error at the very beginning of the first round. </p> <h2 id=defining-the-method-training-data>Defining The Method Training Data</h2> <p>The method <code>training_data</code> is the method that should be defined while creating the training plan class. This method can take one input argument which is the <code>batch_size</code>. This argument represents the batch size that is going to be used for the data loader. Although this argument is not mandatory for <code>training_data</code>, if it exists, each node will pass the value <code>batch_size</code> defined in the <code>training_args</code> while calling the <code>training_data</code> method. </p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>fedbiomed.common.training_plans</span> <span class=kn>import</span> <span class=n>TorchTrainingPlan</span>

<span class=k>class</span> <span class=nc>MyTrainingPlan</span><span class=p>(</span><span class=n>TorchTrainingPlan</span><span class=p>):</span>
    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>pass</span>
        <span class=c1># ....</span>
    <span class=k>def</span> <span class=nf>training_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>batch_size</span><span class=p>):</span>
        <span class=k>pass</span>
</code></pre></div> <p>You can also remove the <code>batch_size</code> argument and define it inside the method. In this case, the <code>batch_size</code>defined in the training arguments will no longer have an impact. </p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>training_data</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
    <span class=n>batch_size</span> <span class=o>=</span> <span class=mi>48</span>
    <span class=k>pass</span>
</code></pre></div> <div class="admonition note"> <p><code>training_data</code> can have a maximum of one argument which is <code>batch_size</code>. Since <code>training_data</code> is executed by the node and the nodes are aware of only one argument, adding extra argument to this method will raise errors on the node side.</p> </div> <h3 id=reading-datafiles>Reading Datafiles</h3> <p>As mentioned before, a node can store <code>IMAGE</code> and <code>CSV</code> dataset types. In this case, the way of loading these datasets might be different. The only information necessary for loading will be the file path where data files are stored. This path is accessible through <code>self.dataset_path</code>. If the dataset is a tabular <code>CSV</code> dataset <code>self.dataset_path</code> will address to a file. Otherwise, if it is an <code>IMAGE</code> dataset, <code>self.dataset_path</code> will address to a directory where all the images are stored. Therefore, before loading the dataset it is important to know what type of dataset is going to be loaded. It is possible to send <a href=../listing-datasets-and-selecting-nodes/ >list request to the nodes to get meta-data of the dataset there are deployed</a>.</p> <p>The following snippet shows an example of loading operation for a dataset of <code>CSV</code> type. </p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
<span class=kn>from</span> <span class=nn>fedbiomed.common.training_plans</span> <span class=kn>import</span> <span class=n>TorchTrainingPlan</span>
<span class=kn>from</span> <span class=nn>fedbiomed.common.data</span> <span class=kn>import</span> <span class=n>DataManager</span>

<span class=k>class</span> <span class=nc>MyTrainingPlan</span><span class=p>(</span><span class=n>TorchTrainingPlan</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>init_model</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=c1># ....</span>
    <span class=k>def</span> <span class=nf>init_dependencies</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=c1># ....</span>
    <span class=k>def</span> <span class=nf>init_optimizer</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=c1># ....</span>

    <span class=k>def</span> <span class=nf>training_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>batch_size</span><span class=p>):</span>
        <span class=n>dataset</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_path</span><span class=p>,</span> <span class=n>header</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>delimiter</span><span class=o>=</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
        <span class=n>X</span> <span class=o>=</span> <span class=n>dataset</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span><span class=mi>0</span><span class=p>:</span><span class=mi>15</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
        <span class=n>y</span> <span class=o>=</span> <span class=n>dataset</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span><span class=mi>15</span><span class=p>]</span>
        <span class=k>return</span> <span class=n>DataManager</span><span class=p>(</span><span class=n>dataset</span><span class=o>=</span><span class=n>X</span><span class=p>,</span> <span class=n>target</span><span class=o>=</span><span class=n>y</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> <span class=n>batch_size</span><span class=o>=</span><span class=n>batch_size</span><span class=p>)</span>
</code></pre></div> <p>It is also possible to use some model arguments in the training data method. For example, if the following model argument is passed to the model by the experiment. </p> <p><div class=highlight><pre><span></span><code><span class=n>model_args</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s1>&#39;feature_cols&#39;</span> <span class=p>:</span> <span class=mi>15</span>
<span class=p>}</span>
</code></pre></div> <code>training_data</code> can be configured as follows:</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
<span class=kn>from</span> <span class=nn>fedbiomed.common.training_plans</span> <span class=kn>import</span> <span class=n>TorchTrainingPlan</span>
<span class=kn>from</span> <span class=nn>fedbiomed.common.data</span> <span class=kn>import</span> <span class=n>DataManager</span>

<span class=k>class</span> <span class=nc>MyTrainingPlan</span><span class=p>(</span><span class=n>TorchTrainingPlan</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>init_model</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=c1># ....</span>
    <span class=k>def</span> <span class=nf>init_dependencies</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=c1># ....</span>
    <span class=k>def</span> <span class=nf>init_optimizer</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=c1># ....</span>

    <span class=k>def</span> <span class=nf>training_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>batch_size</span><span class=p>):</span>
        <span class=n>feature_cols</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_args</span><span class=p>()[</span><span class=s2>&quot;feature_cols&quot;</span><span class=p>]</span>
        <span class=n>dataset</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_path</span><span class=p>,</span> <span class=n>header</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>delimiter</span><span class=o>=</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
        <span class=n>X</span> <span class=o>=</span> <span class=n>dataset</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span><span class=mi>0</span><span class=p>:</span><span class=n>feature_cols</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
        <span class=n>y</span> <span class=o>=</span> <span class=n>dataset</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span><span class=n>feature_cols</span><span class=p>]</span>
        <span class=k>return</span> <span class=n>DataManager</span><span class=p>(</span><span class=n>dataset</span><span class=o>=</span><span class=n>X</span><span class=p>,</span> <span class=n>target</span><span class=o>=</span><span class=n>y</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> <span class=n>batch_size</span><span class=o>=</span><span class=n>batch_size</span><span class=p>)</span>
</code></pre></div> <h3 id=what-training_data-should-return>What <code>training_data</code> Should Return?</h3> <p>The method <code>training_data</code> should always return <code>DataManager</code> of Fed-BioMed defined in the module <code>fedbiomed.common.data.DataManager</code>. <code>DataManager</code> has been designed for managing different types of data objects for different types of training plans. It is also responsible for splitting a given dataset into training and validation if model validation is activated in the experiment. </p> <p><code>DataManager</code> takes two main input arguments as <code>dataset</code> and <code>target</code>. <code>dataset</code> should be an instance of one of PyTorch <code>Dataset</code>, Numpy <code>ndarray</code>, <code>pd.DataFrame</code> or <code>pd.Series</code>. The argument <code>target</code> should be an instance of one of Numpy <code>ndarray</code>, <code>pd.DataFrame</code> or <code>pd.Series</code>. By default, the argument <code>target</code> is <code>None</code>. If <code>target</code> is <code>None</code> the data manager considers that the <code>dataset</code> is an object that includes both input and target variables. This is the case where the dataset is an instance of the PyTorch dataset. <strong>If <code>dataset</code> is an instance of Numpy <code>Array</code> or Pandas <code>DataFrame</code>, it is mandatory to provide the <code>target</code> variable.</strong> </p> <p>As it is mentioned, <code>DataManager</code> is capable of managing/configuring datasets/data-loaders based on the training plans that are going to be used for training. This configuration is necessary since each training plan requires different types of data loader/batch iterator. </p> <h2 id=defining-training-data-in-different-training-plans>Defining Training Data in Different Training Plans</h2> <h3 id=defining-training-data-for-pytorch-based-training-plans>Defining Training Data for PyTorch Based Training Plans</h3> <p>In the following code snippet, <code>training_data</code> of PyTorch-based training plan returns a <code>DataManager</code> object instantiated with <code>dataset</code> and <code>target</code> as <code>pd.Series</code>. Since PyTorch-based training requires a PyTorch <code>DataLoader</code>, <code>DataManager</code> converts <code>pd.Series</code> to a proper <code>torch.utils.data.Dataset</code> object and create a PyTorch <code>DataLoader</code> to pass it to the training loop on the node side. </p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
<span class=kn>from</span> <span class=nn>fedbiomed.common.training_plans</span> <span class=kn>import</span> <span class=n>TorchTrainingPlan</span>
<span class=kn>from</span> <span class=nn>fedbiomed.common.data</span> <span class=kn>import</span> <span class=n>DataManager</span>

<span class=k>class</span> <span class=nc>MyTrainingPlan</span><span class=p>(</span><span class=n>TorchTrainingPlan</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>init_model</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=c1># ....</span>
    <span class=k>def</span> <span class=nf>init_dependencies</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=c1># ....</span>
    <span class=k>def</span> <span class=nf>init_optimizer</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=c1># ....</span>

    <span class=k>def</span> <span class=nf>training_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>batch_size</span><span class=p>):</span>
        <span class=n>feature_cols</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_args</span><span class=p>()[</span><span class=s2>&quot;feature_cols&quot;</span><span class=p>]</span>
        <span class=n>dataset</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_path</span><span class=p>,</span> <span class=n>header</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>delimiter</span><span class=o>=</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
        <span class=n>X</span> <span class=o>=</span> <span class=n>dataset</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span><span class=mi>0</span><span class=p>:</span><span class=n>feature_cols</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
        <span class=n>y</span> <span class=o>=</span> <span class=n>dataset</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span><span class=n>feature_cols</span><span class=p>]</span>
        <span class=k>return</span> <span class=n>DataManager</span><span class=p>(</span><span class=n>dataset</span><span class=o>=</span><span class=n>X</span><span class=p>,</span> <span class=n>target</span><span class=o>=</span><span class=n>y</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> <span class=n>batch_size</span><span class=o>=</span><span class=n>batch_size</span><span class=p>)</span>
</code></pre></div> <p>It is also possible to define a custom PyTorch <code>Dataset</code> and use it in the <code>DataManager</code> without declaring the argument <code>target</code>. </p> <p><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
<span class=kn>from</span> <span class=nn>torch.utils.data</span> <span class=kn>import</span> <span class=n>Dataset</span>
<span class=kn>from</span> <span class=nn>fedbiomed.common.training_plans</span> <span class=kn>import</span> <span class=n>TorchTrainingPlan</span>
<span class=kn>from</span> <span class=nn>fedbiomed.common.data</span> <span class=kn>import</span> <span class=n>DataManager</span>

<span class=k>class</span> <span class=nc>MyTrainingPlan</span><span class=p>(</span><span class=n>TorchTrainingPlan</span><span class=p>):</span>

    <span class=k>class</span> <span class=nc>CSVDataset</span><span class=p>(</span><span class=n>Dataset</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot; Cusotm PyTorch Dataset &quot;&quot;&quot;</span>
        <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>dataset_path</span><span class=p>,</span> <span class=n>features</span><span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>input_file</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=n>dataset_path</span><span class=p>,</span><span class=n>sep</span><span class=o>=</span><span class=s1>&#39;,&#39;</span><span class=p>,</span><span class=n>index_col</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
            <span class=n>x_train</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_file</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span><span class=mi>0</span><span class=p>:</span><span class=n>features</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
            <span class=n>y_train</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_file</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span><span class=n>features</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>X_train</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>from_numpy</span><span class=p>(</span><span class=n>x_train</span><span class=p>)</span><span class=o>.</span><span class=n>float</span><span class=p>()</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>Y_train</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>from_numpy</span><span class=p>(</span><span class=n>y_train</span><span class=p>)</span><span class=o>.</span><span class=n>float</span><span class=p>()</span>

        <span class=k>def</span> <span class=fm>__len__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>            
            <span class=k>return</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>Y_train</span><span class=p>)</span>

        <span class=k>def</span> <span class=fm>__getitem__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>idx</span><span class=p>):</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>X_train</span><span class=p>[</span><span class=n>idx</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>Y_train</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>

    <span class=k>def</span> <span class=nf>training_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>batch_size</span><span class=p>):</span> 
        <span class=n>feature_cols</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_args</span><span class=p>()[</span><span class=s2>&quot;feature_cols&quot;</span><span class=p>]</span>    
        <span class=n>dataset</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>CSVDataset</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_path</span><span class=p>,</span> <span class=n>feature_cols</span><span class=p>)</span>
        <span class=n>loader_kwargs</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;batch_size&#39;</span><span class=p>:</span> <span class=n>batch_size</span><span class=p>,</span> <span class=s1>&#39;shuffle&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>}</span>
        <span class=k>return</span> <span class=n>DataManager</span><span class=p>(</span><span class=n>dataset</span><span class=o>=</span><span class=n>dataset</span><span class=p>,</span> <span class=o>**</span><span class=n>loader_kwargs</span><span class=p>)</span>
</code></pre></div> In the code snippet above, <code>loader_kwargs</code> contains the arguments that are going to be used while creating a PyTorch <code>DataLoader</code>.</p> <h3 id=defining-training-data-for-sklearn-based-training-plans>Defining Training Data for SkLearn Based Training Plans</h3> <p>The operations in the <code>training_data</code> for SkLearn based training plans are not much different than<code>TorchTrainingPlan</code>. Currently, SkLearn based training plans do not require a data loader for training. This means that all samples will be used for fitting the model. That's why passing <code>**loader_args</code> does not make sense for SkLearn based training plans. These arguments will be ignored even if they are set. </p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
<span class=kn>from</span> <span class=nn>fedbiomed.common.training_plans</span> <span class=kn>import</span> <span class=n>FedPerceptron</span>
<span class=kn>from</span> <span class=nn>fedbiomed.common.data</span> <span class=kn>import</span> <span class=n>DataManager</span>

<span class=k>class</span> <span class=nc>SGDRegressorTrainingPlan</span><span class=p>(</span><span class=n>FedPerceptron</span><span class=p>):</span>

    <span class=k>def</span> <span class=nf>training_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>batch_size</span><span class=p>):</span>
        <span class=n>num_cols</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_args</span><span class=p>()[</span><span class=s2>&quot;number_cols&quot;</span><span class=p>]</span>
        <span class=n>dataset</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_path</span><span class=p>,</span> <span class=n>header</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>delimiter</span><span class=o>=</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
        <span class=n>X</span> <span class=o>=</span> <span class=n>dataset</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span><span class=mi>0</span><span class=p>:</span><span class=n>num_cols</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
        <span class=n>y</span> <span class=o>=</span> <span class=n>dataset</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span><span class=n>num_cols</span><span class=p>]</span>
        <span class=k>return</span> <span class=n>DataManager</span><span class=p>(</span><span class=n>dataset</span><span class=o>=</span><span class=n>X</span><span class=p>,</span> <span class=n>target</span><span class=o>=</span><span class=n>y</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> <span class=n>batch_size</span><span class=p>)</span>
</code></pre></div> <h2 id=preprocessing-for-data>Preprocessing for Data</h2> <p>Since the method <code>training_data</code> is defined by the user, it is possible to do preprocessing before creating the <code>DataManager</code> object. In the code snippet below, a preprocess for normalization is shown for the dataset MNIST.</p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>training_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>batch_size</span> <span class=o>=</span> <span class=mi>48</span><span class=p>):</span>
    <span class=c1># Custom torch Dataloader for MNIST data</span>
    <span class=n>transform</span> <span class=o>=</span> <span class=n>transforms</span><span class=o>.</span><span class=n>Compose</span><span class=p>([</span><span class=n>transforms</span><span class=o>.</span><span class=n>ToTensor</span><span class=p>(),</span>
    <span class=n>transforms</span><span class=o>.</span><span class=n>Normalize</span><span class=p>((</span><span class=mf>0.1307</span><span class=p>,),</span> <span class=p>(</span><span class=mf>0.3081</span><span class=p>,))])</span>
    <span class=n>dataset_mnist</span> <span class=o>=</span> <span class=n>datasets</span><span class=o>.</span><span class=n>MNIST</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_path</span><span class=p>,</span> <span class=n>train</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>download</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>transform</span><span class=o>=</span><span class=n>transform</span><span class=p>)</span>
    <span class=n>train_kwargs</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;batch_size&#39;</span><span class=p>:</span> <span class=n>batch_size</span><span class=p>,</span> <span class=s1>&#39;shuffle&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>}</span>
    <span class=k>return</span> <span class=n>DataManager</span><span class=p>(</span><span class=n>dataset</span><span class=o>=</span><span class=n>dataset_mnist</span><span class=p>,</span> <span class=o>**</span><span class=n>train_kwargs</span><span class=p>)</span>
</code></pre></div> <div class="admonition info"> <p>Training and validation partitions are created on the node side using returned <code>DataManager</code> object. Therefore, preprocessing in <code>training_data</code> will be applied for both validation and training data.</p> </div> <h2 id=data-loaders>Data Loaders</h2> <p>A <code>DataLoader</code> is a class that takes care of handling the logic of iterating over a certain dataset. Thus, while a <code>Dataset</code> is concerned with loading and preprocessing samples one-by-one, the <code>DataLoader</code> is responsible for:</p> <ul> <li>calling the dataset's <code>__getitem__</code> method when needed</li> <li>collating samples in a batch</li> <li>shuffling the data at every epoch</li> <li>in general, managing the actions related to iterating over a certain dataset</li> </ul> <h3 id=passing-arguments-to-data-loaders>Passing arguments to Data Loaders</h3> <p>Any keyword argument, except <code>dataset</code> and <code>target</code>, that was provided to the <code>DataManager</code> constructor in the <code>training_data</code> function will be passed as a keyword argument to the <code>DataLoader</code>. For PyTorch and scikit-learn experiments, the <code>DataLoaders</code> have been heavily inspired by the <a href=https://pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader><code>torch.utils.data.DataLoader</code></a> class, so please refer to that documentation for the meaning of the supported keyword arguments. For example:</p> <div class=highlight><pre><span></span><code><span class=k>class</span> <span class=nc>MyTrainingPlan</span><span class=p>(</span><span class=n>SKLearnTrainingPlan</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>training_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>batch_size</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>DataManager</span><span class=p>(</span><span class=n>dataset</span><span class=o>=</span><span class=n>X</span><span class=p>,</span> <span class=n>target</span><span class=o>=</span><span class=n>Y</span><span class=p>,</span> 
                           <span class=c1># The following arguments will be passed to the DataLoader:</span>
                           <span class=n>batch_size</span><span class=o>=</span><span class=n>batch_size</span><span class=p>,</span> <span class=n>shuffle</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>drop_last</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</code></pre></div> <h4 id=the-special-case-of-batch-size>The special case of batch size</h4> <p>As you may have noticed below, <code>batch_size</code> represents a special case since it can be provided as argument to the <code>training_data</code> function. </p> <div class="admonition note"> <p class=admonition-title>Recommended approach</p> <p>For <code>batch_size</code>, we recommend that you always include it is argument to the <code>training_data</code> function, and forward that value as keyworkd argument to the <code>DataManager</code>, as such: <div class=highlight><pre><span></span><code><span class=k>class</span> <span class=nc>MyTrainingPlan</span><span class=p>(</span><span class=n>SKLearnTrainingPlan</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>training_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>batch_size</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>DataManager</span><span class=p>(</span><span class=n>dataset</span><span class=o>=</span><span class=n>X</span><span class=p>,</span> <span class=n>target</span><span class=o>=</span><span class=n>Y</span><span class=p>,</span> <span class=n>batch_size</span><span class=o>=</span><span class=n>batch_size</span><span class=p>)</span>
</code></pre></div></p> </div> <p>It is not useful to set a default value for the <code>batch_size</code> argument, as it will be ignored in favour of Fed-BioMed's internal default value set in the <code>TrainingArgs</code> class. </p> <h2 id=conclusion>Conclusion</h2> <p><code>training_data</code> should be provided in each training plan. The way it is defined is almost the same for each framework's training plan as long as the structure of the datasets is simple. Since the method is defined by users, it provides flexibility to load and pre-process complex datasets distributed on the nodes. However, this method will be executed on the node side. Therefore, typos and lack of arguments may cause errors in the nodes even if it does not create any errors on the researcher side.</p> </div> </div> <div class=right-col> <div id=right-sidebar class=sidebar-right> <nav class=toc> <!-- Render item list --> <label class=toc-title for=__toc> <span class=toc-icon></span> </label> <ul class=toc-list data-md-component=toc data-md-scrollfix> <!-- Table of contents item --> <li class=toc-item> <a href=#defining-the-method-training-data class=md-nav__link> Defining The Method Training Data </a> <nav class=toc-nav aria-label="Defining The Method Training Data"> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#reading-datafiles class=md-nav__link> Reading Datafiles </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#what-training_data-should-return class=md-nav__link> What training_data Should Return? </a> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#defining-training-data-in-different-training-plans class=md-nav__link> Defining Training Data in Different Training Plans </a> <nav class=toc-nav aria-label="Defining Training Data in Different Training Plans"> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#defining-training-data-for-pytorch-based-training-plans class=md-nav__link> Defining Training Data for PyTorch Based Training Plans </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#defining-training-data-for-sklearn-based-training-plans class=md-nav__link> Defining Training Data for SkLearn Based Training Plans </a> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#preprocessing-for-data class=md-nav__link> Preprocessing for Data </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#data-loaders class=md-nav__link> Data Loaders </a> <nav class=toc-nav aria-label="Data Loaders"> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#passing-arguments-to-data-loaders class=md-nav__link> Passing arguments to Data Loaders </a> <nav class=toc-nav aria-label="Passing arguments to Data Loaders"> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#the-special-case-of-batch-size class=md-nav__link> The special case of batch size </a> </li> </ul> </nav> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#conclusion class=md-nav__link> Conclusion </a> </li> </ul> </nav> </div> </div> </div> </div> <!-- News Main Page--> </div> <footer> <div class=container-fluid> <div class=footer-first-inner> <div class=container> <div class=row> <div class=col-md-6> <div class=footer-contact> <strong>Address:</strong> <p>2004 Rte des Lucioles, 06902 Sophia Antipolis</p> <strong>E-mail:</strong> <p>fedbiomed _at_ inria _dot_ fr</p> </div> </div> <div class=col-md-6> <div class=footer-contact> <p>Fed-BioMed © 2022</p> </div> </div> </div> </div> </div> </div> </footer> <!-- JQuery --> <script src=https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js></script> <!-- Latest compiled and minified JavaScript --> <script src=https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=../../../assets/javascript/lunr.js></script> <script src=../../../assets/javascript/theme.js></script> </body> </html>