<!DOCTYPE html><html> <head><meta charset=UTF-8><meta name=viewport content="width=device-width, initial-scale=1"><meta name=robots context="index, archive"><!--  --><script>
      const versions_json = "../../../../versions.json";
      const search_worker_js = "../../../assets/javascript/search-worker.js";
      const search_index_json = "../../../search/search_index.json";
      const base_url = '../../..';
    </script><!-- Site title --><title>VPN Deployment - Fed-BioMed</title><link rel=icon type=image/x-icon href=../../../favicon.ico><!-- Page description --><meta name=description content="Open, Transparent and Trusted Collaborative Learning for Real-world Healthcare Applications"><!-- Page keywords --><!-- Page author --><!-- Latest compiled and minified CSS --><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><!-- Bootstrap Icons --><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css><link href=../../../assets/_mkdocstrings.css rel=stylesheet><link href=../../../assets/css/style.css rel=stylesheet></head> <body> <header> <div class="container-fluid top-bar"> <div class=brand> <a href=/ > <img src=../../../assets/img/fedbiomed-logo-small.png> </a> </div> <nav class=top> <ul> <li class> <a href=../../..>Home</a> </li> <li class> <a href=../../../getting-started/what-is-fedbiomed/ >User Documentation</a> </li> <li class> <a href=../../../pages/about-us/ >About</a> </li> <li id=clicker class=has-sub> More <i class="bi bi-chevron-down"></i> <ul class=sub-nav-menu> <li class> <a href=../../../#funding>Funding</a> </li> <li class> <a href=../../../news/ >News</a> </li> <li class> <a href=../../../#contributors>Contributors</a> </li> <li class> <a href=../../../#users>Users</a> </li> <li class> <a href=../../../pages/roadmap/ >Roadmap</a> </li> <li class> <a href=../../../#contact-us>Contact Us</a> </li> </ul> </li> </ul> </nav> </div> <div class="container-fluid top-bar-mobile"> <div class=mobile-bar> <div class=brand> <a href=../../../ > <img src=../../../assets/img/fedbiomed-logo-small.png> </a> </div> <div class=hum-menu> <img class=open src=../../../assets/img/menu.svg> <img class=close style=display:none src=../../../assets/img/cancel.svg> </div> </div> <nav class=top-mobile> <ul> <li class> <a href=../../..>Home</a> </li> <li class> <a href=../../../getting-started/what-is-fedbiomed/ >User Documentation</a> </li> <li class> <a href=../../../pages/about-us/ >About</a> </li> <li id=clicker class=has-sub> More <i class="bi bi-chevron-down"></i> <ul class=sub-nav-menu> <li class> <a href=../../../#funding>Funding</a> </li> <li class> <a href=../../../news/ >News</a> </li> <li class> <a href=../../../#contributors>Contributors</a> </li> <li class> <a href=../../../#users>Users</a> </li> <li class> <a href=../../../pages/roadmap/ >Roadmap</a> </li> <li class> <a href=../../../#contact-us>Contact Us</a> </li> </ul> </li> </ul> </nav> </div> </header> <div class=main> <!-- Home page --> <div class=container-fluid> <div class=doc-row> <div class=left-col> <div class=sidebar-doc> <nav class=sidebar-inner> <ul class="sidebar-menu-left sub"> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Getting Started <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../getting-started/what-is-fedbiomed/ class>What's Fed-BioMed</a> </li> <li class> <a href=../../../getting-started/getting-started/ class>Basic Example</a> </li> <li class> <a href=../../../getting-started/fedbiomed-architecture/ class>Fedbiomed Architecture</a> </li> <li class> <a href=../../../getting-started/fedbiomed-workflow/ class>Fedbiomed Workflow</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Tutorials <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Installation <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/installation/0-basic-software-installation/ class>Software Installation</a> </li> <li class> <a href=../../../tutorials/installation/1-setting-up-environment/ class>Setting Up Environment</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> PyTorch <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/pytorch/01_PyTorch_MNIST_Single_Node_Tutorial/ class>PyTorch MNIST Basic Example</a> </li> <li class> <a href=../../../tutorials/pytorch/02_Create_Your_Custom_Training_Plan/ class>How to Create Your Custom PyTorch Training Plan</a> </li> <li class> <a href=../../../tutorials/pytorch/03_PyTorch_Used_Cars_Dataset_Example/ class>PyTorch Used Cars Dataset Example</a> </li> <li class> <a href=../../../tutorials/pytorch/04-Aggregation_in_Fed-BioMed/ class>PyTorch aggregation methods in Fed-BioMed</a> </li> <li class> <a href=../../../tutorials/pytorch/05_Transfer-learning_tutorial_usingDenseNet-121/ class>Transfer-learning in Fed-BioMed tutorial</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> MONAI <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/monai/01_monai-2d-image-classification/ class>Federated 2d image classification with MONAI</a> </li> <li class> <a href=../../../tutorials/monai/02_monai-2d-image-registration/ class>Federated 2d XRay registration with MONAI</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Scikit-Learn <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/scikit-learn/01_sklearn_MNIST_classification_tutorial/ class>MNIST classification with Scikit-Learn Classifier (Perceptron)</a> </li> <li class> <a href=../../../tutorials/scikit-learn/02_sklearn_sgd_regressor_tutorial/ class>Fed-BioMed to train a federated SGD regressor model</a> </li> <li class> <a href=../../../tutorials/scikit-learn/03-other-scikit-learn-models/ class>Implementing other Scikit Learn models for Federated Learning</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Optimizers <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/optimizers/01-fedopt-and-scaffold/ class>Advanced optimizers in Fed-BioMed</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> FLamby <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/flamby/flamby/ class>General Concepts</a> </li> <li class> <a href=../../../tutorials/flamby/flamby-integration-into-fedbiomed/ class>FLamby integration in Fed-BioMed</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Advanced <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/advanced/in-depth-experiment-configuration/ class>In Depth Experiment Configuration</a> </li> <li class> <a href=../../../tutorials/advanced/training-with-gpu/ class>PyTorch model training using a GPU</a> </li> <li class> <a href=../../../tutorials/advanced/breakpoints/ class>Breakpoints</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Security <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/security/differential-privacy-with-opacus-on-fedbiomed/ class>Using Differential Privacy with OPACUS on Fed-BioMed</a> </li> <li class> <a href=../../../tutorials/security/non-private-local-central-dp-monai-2d-image-registration/ class>Local and Central DP with Fed-BioMed: MONAI 2d image registration</a> </li> <li class> <a href=../../../tutorials/security/training-with-approved-training-plans/ class>Training Process with Training Plan Management</a> </li> <li class> <a href=../../../tutorials/security/secure-aggregation/ class>Training with Secure Aggregation</a> </li> <li class> <a href=../../../tutorials/concrete-ml/concrete-ml/ class>End-to-end Privacy Preserving Training and Inference on Medical Data</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Biomedical data <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/medical/medical-image-segmentation-unet-library/ class>Brain Segmentation</a> </li> </ul> </li> </ul> </li> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> User Guide <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li class> <a href=../../glossary/ class>Glossary</a> </li> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> Deployment <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li class> <a href=../deployment/ class>Introduction</a> </li> <li class=current> <a href=./ class="link current">VPN Deployment</a> </li> <li class> <a href=../matrix/ class>Network matrix</a> </li> <li class> <a href=../security-model/ class>Security model</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Node <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../nodes/configuring-nodes/ class>Configuring Nodes</a> </li> <li class> <a href=../../nodes/deploying-datasets/ class>Deploying Datasets</a> </li> <li class> <a href=../../nodes/training-plan-security-manager/ class>Training Plan Management</a> </li> <li class> <a href=../../nodes/using-gpu/ class>Using GPU</a> </li> <li class> <a href=../../nodes/node-gui/ class>Node GUI</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Researcher <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../researcher/training-plan/ class>Training Plan</a> </li> <li class> <a href=../../researcher/training-data/ class>Training Data</a> </li> <li class> <a href=../../researcher/experiment/ class>Experiment</a> </li> <li class> <a href=../../researcher/aggregation/ class>Aggregation</a> </li> <li class> <a href=../../researcher/listing-datasets-and-selecting-nodes/ class>Listing Datasets and Selecting Nodes</a> </li> <li class> <a href=../../researcher/model-testing-during-federated-training/ class>Model Validation on the Node Side</a> </li> <li class> <a href=../../researcher/tensorboard/ class>Tensorboard</a> </li> </ul> </li> <li class> <a href=../../advanced-optimization/ class>Optimization</a> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Secure Aggregation <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../secagg/introduction/ class>Introduction</a> </li> <li class> <a href=../../secagg/configuration/ class>Configuration</a> </li> <li class> <a href=../../secagg/researcher-interface/ class>Managing Secure Aggregation in Researcher</a> </li> </ul> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Developer <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> API Reference <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Common <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../developer/api/common/certificate_manager/ class>Certificate Manager</a> </li> <li class> <a href=../../../developer/api/common/cli/ class>CLI</a> </li> <li class> <a href=../../../developer/api/common/config/ class>Config</a> </li> <li class> <a href=../../../developer/api/common/constants/ class>Constants</a> </li> <li class> <a href=../../../developer/api/common/data/ class>Data</a> </li> <li class> <a href=../../../developer/api/common/db/ class>DB</a> </li> <li class> <a href=../../../developer/api/common/environ/ class>Environ</a> </li> <li class> <a href=../../../developer/api/common/exceptions/ class>Exceptions</a> </li> <li class> <a href=../../../developer/api/common/ipython/ class>IPython</a> </li> <li class> <a href=../../../developer/api/common/json/ class>Json</a> </li> <li class> <a href=../../../developer/api/common/logger/ class>Logger</a> </li> <li class> <a href=../../../developer/api/common/message/ class>Message</a> </li> <li class> <a href=../../../developer/api/common/metrics/ class>Metrics</a> </li> <li class> <a href=../../../developer/api/common/models/ class>Model</a> </li> <li class> <a class href=../../../developer/api/common/mpc_controller.md>MPC controller</a> </li> <li class> <a href=../../../developer/api/common/optimizers/ class>Optimizers</a> </li> <li class> <a href=../../../developer/api/common/privacy/ class>Privacy</a> </li> <li class> <a href=../../../developer/api/common/secagg/ class>Secagg</a> </li> <li class> <a href=../../../developer/api/common/secagg_manager/ class>Secagg Manager</a> </li> <li class> <a href=../../../developer/api/common/serializer/ class>Serializer</a> </li> <li class> <a href=../../../developer/api/common/singleton/ class>Singleton</a> </li> <li class> <a href=../../../developer/api/common/synchro/ class>Synchro</a> </li> <li class> <a href=../../../developer/api/common/tasks_queue/ class>TasksQueue</a> </li> <li class> <a href=../../../developer/api/common/training_plans/ class>TrainingPlans</a> </li> <li class> <a href=../../../developer/api/common/training_args/ class>TrainingArgs</a> </li> <li class> <a href=../../../developer/api/common/utils/ class>Utils</a> </li> <li class> <a href=../../../developer/api/common/validator/ class>Validator</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Node <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../developer/api/node/cli/ class>CLI</a> </li> <li class> <a href=../../../developer/api/node/cli_utils/ class>CLI Utils</a> </li> <li class> <a href=../../../developer/api/node/config/ class>Config</a> </li> <li class> <a href=../../../developer/api/node/dataset_manager/ class>DatasetManager</a> </li> <li class> <a href=../../../developer/api/node/environ/ class>Environ</a> </li> <li class> <a href=../../../developer/api/node/history_monitor/ class>HistoryMonitor</a> </li> <li class> <a href=../../../developer/api/node/node/ class>Node</a> </li> <li class> <a href=../../../developer/api/node/node_state_manager/ class>NodeStateManager</a> </li> <li class> <a href=../../../developer/api/node/requests/ class>Requests</a> </li> <li class> <a href=../../../developer/api/node/round/ class>Round</a> </li> <li class> <a href=../../../developer/api/node/secagg/ class>Secagg</a> </li> <li class> <a href=../../../developer/api/node/secagg_manager/ class>Secagg Manager</a> </li> <li class> <a href=../../../developer/api/node/training_plan_security_manager/ class>TrainingPlanSecurityManager</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Researcher <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../developer/api/researcher/aggregators/ class>Aggregators</a> </li> <li class> <a href=../../../developer/api/researcher/cli/ class>CLI</a> </li> <li class> <a href=../../../developer/api/researcher/config/ class>Config</a> </li> <li class> <a href=../../../developer/api/researcher/datasets/ class>Datasets</a> </li> <li class> <a href=../../../developer/api/researcher/environ/ class>Environ</a> </li> <li class> <a href=../../../developer/api/researcher/federated_workflows/ class>Federated Workflows</a> </li> <li class> <a href=../../../developer/api/researcher/filetools/ class>Filetools</a> </li> <li class> <a href=../../../developer/api/researcher/jobs/ class>Jobs</a> </li> <li class> <a href=../../../developer/api/researcher/monitor/ class>Monitor</a> </li> <li class> <a href=../../../developer/api/researcher/node_state_agent/ class>NodeStateAgent</a> </li> <li class> <a href=../../../developer/api/researcher/requests/ class>Requests</a> </li> <li class> <a href=../../../developer/api/researcher/secagg/ class>Secagg</a> </li> <li class> <a href=../../../developer/api/researcher/strategies/ class>Strategies</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Transport <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../developer/api/transport/client/ class>Client</a> </li> <li class> <a href=../../../developer/api/transport/controller/ class>Controller</a> </li> <li class> <a href=../../../developer/api/transport/node_agent/ class>NodeAgent</a> </li> <li class> <a href=../../../developer/api/transport/server/ class>Server</a> </li> </ul> </li> </ul> </li> <li class> <a href=../../../developer/usage_and_tools/ class>Usage and Tools</a> </li> <li class> <a href=../../../developer/ci/ class>Continuous Integration</a> </li> <li class> <a href=../../../developer/definition-of-done/ class>Definition of Done</a> </li> <li class> <a href=../../../developer/testing-in-fedbiomed/ class>Testing in Fed-BioMed</a> </li> <li class> <a href=../../../developer/messaging/ class>RPC Protocol and Messages</a> </li> </ul> </li> </ul> </nav> </div> </div> <div class=main-col> <main class=main-docs> <article> <h1 id=fed-biomed-deployment-on-multiple-machines-with-vpncontainers>Fed-BioMed deployment on multiple machines with VPN/containers</h1> <p>Most real-life deployments require protecting node data. Deployment using VPN/containers contributes to this goal by providing isolation of the Fed-BioMed instance from third parties. All communications between the components of a Fed-BioMed instance occur inside WireGuard VPN tunnels with mutual authentication of the VPN endpoints. Using containers can also ease installation on multiple sites.</p> <p>This tutorial details a deployment scenario where:</p> <ul> <li>Fed-BioMed vpnserver and researcher components run on the same machine ("the <strong>server</strong>") in the following <code>docker</code> containers<ul> <li><code>vpnserver</code> / <code>fedbiomed/vpn-vpnserver</code>: WireGuard server</li> <li><code>researcher</code> / <code>fedbiomed/vpn-researcher</code>: a researcher jupyter notebooks</li> </ul> </li> <li>several Fed-BioMed <strong>node</strong> components run, one node per machine with the following containers<ul> <li><code>node</code> / <code>fedbiomed/vpn-node</code>: a node component</li> <li><code>gui</code> / <code>fedbiomed/vpn-gui</code>: a GUI for managing node component data (optional)</li> </ul> </li> <li>all communications between the components are tunneled through a VPN</li> </ul> <h2 id=requirements>Requirements</h2> <div class="admonition info"> <p class=admonition-title>Supported operating systems and software requirements</p> <p>Supported operating systems for containers/VPN deployment include <strong>Fedora 38</strong>, <strong>Ubuntu 22.04 LTS</strong>. Should also work for most recent Linux, <strong>MacOS X 12.6.6, 13 and 14</strong>, <strong>Windows 11</strong> with WSL2 using Ubuntu-22.04 distribution. Also requires <strong>docker</strong> and <strong>docker compose &gt;= 2.0</strong>.</p> <p>Check here for <a href=../vpn-dependencies-install/ >guidelines</a> on <code>docker</code> and <code>docker-compose</code> installation</p> <p>Check here for <a href=https://github.com/fedbiomed/fedbiomed/blob/master/envs/vpn/README.md#requirements>detailed requirements</a>.</p> </div> <div class="admonition info"> <p class=admonition-title>Account privileges</p> <p>Components deployment requires an account which can use docker (typically belonging to the <code>docker</code> group). Using a dedicated service account is a good practice. No access to the administrative account is needed, usage of <code>root</code> account for deploying components is discouraged to follow the principle of privilege minimization.</p> </div> <div class="admonition info"> <p class=admonition-title>Web proxy</p> <p>On sites where web access uses a proxy you need to <a href=#proxy>configure web proxy for docker</a>.</p> </div> <div class="admonition info"> <p class=admonition-title>User or group ID for containers</p> <p>By default, Fed-BioMed uses the current account's user and group ID for building and running containers.</p> <p>Avoid using low ID for user or group ( &lt; 500 for MacOS, &lt; 1000 for Linux ) inside containers. They often conflict with pre-existing user or group account in the container images. This results in unhandled failures when setting up or starting the containers. Check your account id with <code>id -a</code>.</p> <p>Use the <code>CONTAINER_USER</code>, <code>CONTAINER_UID</code>, <code>CONTAINER_GROUP</code> and <code>CONTAINER_GID</code> variables to use alternate values, eg for MacOS:</p> <p>MacOS commonly uses group <code>staff:20</code> for user accounts, which conflicts with Fed-BioMed VPN/containers mode. So a good configuration choice for MacOS can be:</p> <div class=highlight><pre><span></span><code><span class=nb>export</span><span class=w> </span><span class=nv>CONTAINER_GROUP</span><span class=o>=</span>fedbiomed
<span class=nb>export</span><span class=w> </span><span class=nv>CONTAINER_GID</span><span class=o>=</span><span class=m>1111</span>
</code></pre></div> </div> <p>More options for containers/VPN deployment are not covered in this tutorial but <a href=https://github.com/fedbiomed/fedbiomed/blob/master/envs/vpn/README.md>can be found here</a> including:</p> <ul> <li>using GPU in <code>node</code> container</li> <li>building containers (eg: <code>node</code> and <code>gui</code>) on one machine, using this pre-built containers on the nodes</li> <li>using different identity (account) for building and launching a container</li> <li>deploying vpnserver and researcher on distinct machines</li> </ul> <h2 id=notations>Notations</h2> <p>In this tutorial we use the following notations:</p> <ul> <li><code>[user@server $]</code> means the command is launched on the server machine (outside containers)</li> <li><code>[user@node $]</code> means the command is launched on a node machine (outside containers)</li> <li>for commands typed inside containers, <code>[root@vpnserver-container #]</code> means the command is launched inside the <code>vpnserver</code> container as root, <code>[user@node-container $]</code> means the command is launched inside the <code>vpnserver</code> container with same user account as outside the container</li> </ul> <h2 id=deploy-on-the-server-side>Deploy on the server side</h2> <p>This part of the tutorial is executed once on the server side, before deploying the nodes. It covers the initial server deployment, including build, configuration and launch of containers.</p> <ul> <li> <p>download Fed-BioMed software by doing a local clone of the git repository:</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span>git<span class=w> </span>clone<span class=w> </span>-b<span class=w> </span>master<span class=w> </span>https://github.com/fedbiomed/fedbiomed.git
<span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=nb>cd</span><span class=w> </span>fedbiomed
<span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=nb>export</span><span class=w> </span><span class=nv>FEDBIOMED_DIR</span><span class=o>=</span><span class=nv>$PWD</span><span class=w> </span><span class=c1># use setenv for *csh</span>
<span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=nb>cd</span><span class=w> </span>envs/vpn/docker
</code></pre></div> <p>For the rest of this tutorial <code>${FEDBIOMED_DIR}</code> represents the base directory of the clone.</p> <p><code>docker compose</code> commands need to be launched from <code>${FEDBIOMED_DIR}/envs/vpn/docker directory</code>.</p> </li> <li> <p>clean running containers, containers files, temporary files</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=nb>source</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_environment<span class=w> </span>clean
<span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>clean
</code></pre></div> </li> <li> <p><strong>optionally</strong> clean the container images to force build fresh new images</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>clean<span class=w> </span>image
</code></pre></div> </li> <li> <p>build server-side containers</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>build<span class=w> </span>vpnserver<span class=w> </span>researcher
</code></pre></div> </li> <li> <p>configure the VPN keys for containers running on the server side, after starting the <code>vpnserver</code> container</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>configure<span class=w> </span>researcher
</code></pre></div> </li> <li> <p>start other server side containers</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>start<span class=w> </span>researcher
</code></pre></div> </li> <li> <p>check all containers are running as expected on the server side</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>status<span class=w> </span>vpnserver<span class=w> </span>researcher
</code></pre></div> <p>Server side containers should be up and able to ping the VPN server</p> <div class=highlight><pre><span></span><code>**<span class=w> </span>Checking<span class=w> </span>docker<span class=w> </span>VPN<span class=w> </span>images<span class=w> </span><span class=p>&amp;</span><span class=w> </span>VPN<span class=w> </span>access:<span class=w> </span>vpnserver<span class=w> </span>researcher
-<span class=w> </span>container<span class=w> </span>vpnserver<span class=w> </span>is<span class=w> </span>running
-<span class=w> </span>container<span class=w> </span>researcher<span class=w> </span>is<span class=w> </span>running
-<span class=w> </span>pinging<span class=w> </span>VPN<span class=w> </span>server<span class=w> </span>from<span class=w> </span>container<span class=w> </span>vpnserver<span class=w> </span>-&gt;<span class=w> </span>OK
-<span class=w> </span>pinging<span class=w> </span>VPN<span class=w> </span>server<span class=w> </span>from<span class=w> </span>container<span class=w> </span>researcher<span class=w> </span>-&gt;<span class=w> </span>OK
</code></pre></div> <p>Server side containers are now ready for node side deployment.</p> </li> </ul> <h2 id=deploy-on-the-node-side>Deploy on the node side</h2> <p>This part of the tutorial is executed once on each node, after deploying the server. It covers the initial deployment, including build, configuration and launch of containers.</p> <p>Some commands are executed on the node side, while some commands are executed on the server side (pay attention to the prompt).</p> <p>For each node, choose a <strong>unique</strong> node tag (eg: <em>NODETAG</em> in this example) that represents this specific node instance for server side management commands.</p> <ul> <li> <p>download Fed-BioMed software by doing a local clone of the git repository:</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span>git<span class=w> </span>clone<span class=w> </span>-b<span class=w> </span>master<span class=w> </span>https://github.com/fedbiomed/fedbiomed.git
<span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=nb>cd</span><span class=w> </span>fedbiomed
<span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=nb>export</span><span class=w> </span><span class=nv>FEDBIOMED_DIR</span><span class=o>=</span><span class=nv>$PWD</span><span class=w> </span><span class=c1># use setenv for *csh</span>
<span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=nb>cd</span><span class=w> </span>envs/vpn/docker
</code></pre></div> <p>For the rest of this tutorial <code>${FEDBIOMED_DIR}</code> represents the base directory of the clone.</p> <p><code>docker compose</code> commands need to be launched from <code>${FEDBIOMED_DIR}/envs/vpn/docker directory</code>.</p> </li> <li> <p>clean running containers, containers files, temporary files (skip that step if node and server run on the same machine)</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=nb>source</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_environment<span class=w> </span>clean
<span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>clean
</code></pre></div> </li> <li> <p><strong>optionally</strong> clean the container images to force build fresh new images</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>clean<span class=w> </span>image
</code></pre></div> </li> <li> <p>build node-side containers</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>build<span class=w> </span>node<span class=w> </span>gui
</code></pre></div> </li> <li> <p><strong>on the server side</strong>, generate a configuration for this node (known as <em>NODETAG</em>)</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=nb>cd</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/envs/vpn/docker
<span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span>docker<span class=w> </span>compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>vpnserver<span class=w> </span>bash<span class=w> </span>-ci<span class=w> </span><span class=s1>&#39;python ./vpn/bin/configure_peer.py genconf node NODETAG&#39;</span>
</code></pre></div> <p>The configuration file is now available on the server side in path <code>${FEDBIOMED_DIR}/envs/vpn/docker/vpnserver/run_mounts/config/config_peers/node/NODETAG/config.env</code> or with command :</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span>docker<span class=w> </span>compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>vpnserver<span class=w> </span>cat<span class=w> </span>/config/config_peers/node/NODETAG/config.env
</code></pre></div> </li> <li> <p>copy the configuration file from the server side <strong>to the node side</strong> via a secure channel, to path <code>/tmp/config.env</code> on the node.</p> <p>In most real life deployments, one shouldn't have access to both server side and node side. Secure channel in an out-of-band secured exchange (outside of Fed-BioMed scope) between the server administrator and the node administrator that provides mutual authentication of the parties, integrity and privacy of the exchanged file.</p> <p>In a test deployment, one may be connected both on server side and node side. In this case, you just need to cut-paste or copy the file to the node.</p> <p>Use the node's copy of the configuration file:</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span>cp<span class=w> </span>/tmp/config.env<span class=w> </span>./node/run_mounts/config/config.env
</code></pre></div> </li> <li> <p>start <code>node</code> container</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span>docker<span class=w> </span>compose<span class=w> </span>up<span class=w> </span>-d<span class=w> </span>node
</code></pre></div> </li> <li> <p>retrieve the <code>node</code>'s publickey</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span>docker<span class=w> </span>compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>node<span class=w> </span>wg<span class=w> </span>show<span class=w> </span>wg0<span class=w> </span>public-key<span class=w> </span><span class=p>|</span><span class=w> </span>tr<span class=w> </span>-d<span class=w> </span><span class=s1>&#39;\r&#39;</span><span class=w> </span>&gt;/tmp/publickey-nodeside
</code></pre></div> </li> <li> <p>copy the public key from the node side <strong>to the server side</strong> via a secure channel (see above), to path <code>/tmp/publickey-serverside</code> on the server.</p> </li> <li> <p><strong>on the server side</strong> finalize configuration of the VPN keys for this node (known as <em>NODETAG</em>)</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=nb>cd</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/envs/vpn/docker
<span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span>docker<span class=w> </span>compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>vpnserver<span class=w> </span>bash<span class=w> </span>-ci<span class=w> </span><span class=s2>&quot;python ./vpn/bin/configure_peer.py add node NODETAG </span><span class=k>$(</span>cat<span class=w> </span>/tmp/publickey-serverside<span class=k>)</span><span class=s2>&quot;</span>
</code></pre></div> </li> <li> <p>check containers running on the node side</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>status<span class=w> </span>node
</code></pre></div> <p><code>node</code> container should be up and able to ping the VPN server</p> <div class=highlight><pre><span></span><code>**<span class=w> </span>Checking<span class=w> </span>docker<span class=w> </span>VPN<span class=w> </span>images<span class=w> </span><span class=p>&amp;</span><span class=w> </span>VPN<span class=w> </span>access:<span class=w> </span>node
-<span class=w> </span>container<span class=w> </span>node<span class=w> </span>is<span class=w> </span>running
-<span class=w> </span>pinging<span class=w> </span>VPN<span class=w> </span>server<span class=w> </span>from<span class=w> </span>container<span class=w> </span>node<span class=w> </span>-&gt;<span class=w> </span>OK
</code></pre></div> <p><code>node</code> container is now ready to be used.</p> </li> <li> <p><strong>optionally</strong> force the use of secure aggregation by the node (node will refuse to train without the use of secure aggregation):</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=nb>export</span><span class=w> </span><span class=nv>FORCE_SECURE_AGGREGATION</span><span class=o>=</span>True
</code></pre></div> </li> <li> <p>do initial node configuration</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span>docker<span class=w> </span>compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>-u<span class=w> </span><span class=k>$(</span>id<span class=w> </span>-u<span class=k>)</span><span class=w> </span>node<span class=w> </span>bash<span class=w> </span>-ci<span class=w> </span><span class=s1>&#39;export FORCE_SECURE_AGGREGATION=&#39;</span><span class=si>${</span><span class=nv>FORCE_SECURE_AGGREGATION</span><span class=si>}</span><span class=s1>&#39;&amp;&amp; export SECAGG_INSECURE_VALIDATION=false &amp;&amp; export RESEARCHER_SERVER_HOST=10.222.0.2 &amp;&amp; export RESEARCHER_SERVER_PORT=50051 &amp;&amp; export PYTHONPATH=/fedbiomed &amp;&amp; ENABLE_TRAINING_PLAN_APPROVAL=True ALLOW_DEFAULT_TRAINING_PLANS=True ./scripts/fedbiomed_run environ-node configuration create --component NODE --use-current&#39;</span>
</code></pre></div> </li> </ul> <p>Optionally launch the node GUI :</p> <ul> <li> <p><strong>optionally</strong> authorize connection to node GUI from distant machines. By default, only connection from local machine (<code>localhost</code>) is authorized.</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=nb>export</span><span class=w> </span><span class=nv>GUI_SERVER_IP</span><span class=o>=</span><span class=m>0</span>.0.0.0
</code></pre></div> <p>To authorize distant connection to only one of the node machine's IP addresses use a command of the form <code>export GUI_SERVER_IP=a.b.c.d</code> where <code>a.b.c.d</code> is one of the IP addresses of the node machine.</p> <p>For security reasons, when authorizing connection from distant machines, it is strongly recommended to <strong>use a custom SSL certificate signed by a well-known authority</strong>.</p> <div class="admonition note"> <p class=admonition-title>Custom SSL certificates for GUI</p> <p>GUI will start serving on port 8443 with self-signed certificates. These certificates will be identified as risky by the browsers, and users will have to approve them. However, it is also possible to set custom trusted SSL certificates by adding <code>crt</code> and <code>key</code> files to the <code>${FEDBIOMED_DIR}/envs/vpn/docker/gui/run_mounts/certs</code> directory before starting the GUI.</p> <p>When adding these files, please ensure that:</p> <ul> <li>the certificate extension is <code>.crt</code> and the key file extension is <code>.key</code></li> <li>there is no more than one file for each certificate and key</li> </ul> </div> </li> <li> <p><strong>optionally</strong> restrict the HTTP host names that can be used to connect to the node GUI. By default all the host names (DNS CNAME) of the node machine can be used.</p> <p>For example, if the node machine has two host names <code>my.fqdn.com</code> and <code>other.alias.org</code>, use syntax like <code>export GUI_SERVER_NAME=my.fqdn.com</code> or <code>GUI_SERVER_NAME='*.fqdn.com'</code> (don't forget the enclosing single quotes) to authorize only requests using the first name (eg: <code>https://my.fqdn.com</code>) to reach the node GUI. Use the syntax of Nginx <a href=http://nginx.org/en/docs/http/server_names.html><code>server_name</code></a>.</p> </li> <li> <p>start <code>gui</code> container</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span>docker<span class=w> </span>compose<span class=w> </span>up<span class=w> </span>-d<span class=w> </span>gui
</code></pre></div> </li> <li> <p>check containers running on the node side</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>status<span class=w> </span>node<span class=w> </span>gui
</code></pre></div> <p>Node side containers should be up and able to ping the VPN server</p> <div class=highlight><pre><span></span><code>**<span class=w> </span>Checking<span class=w> </span>docker<span class=w> </span>VPN<span class=w> </span>images<span class=w> </span><span class=p>&amp;</span><span class=w> </span>VPN<span class=w> </span>access:<span class=w> </span>node<span class=w> </span>gui
-<span class=w> </span>container<span class=w> </span>node<span class=w> </span>is<span class=w> </span>running
-<span class=w> </span>container<span class=w> </span>gui<span class=w> </span>is<span class=w> </span>running
-<span class=w> </span>pinging<span class=w> </span>VPN<span class=w> </span>server<span class=w> </span>from<span class=w> </span>container<span class=w> </span>node<span class=w> </span>-&gt;<span class=w> </span>OK
</code></pre></div> <p><code>node</code> and <code>gui</code> containers are now ready to be used.</p> </li> </ul> <h2 id=optionally-deploy-a-second-node-instance-on-the-same-node>Optionally deploy a second node instance on the same node</h2> <p>Optionally deploy a second node instance on the same node (useful for testing purpose, not a normal deployment scenario):</p> <ul> <li><a href=../deployment-vpn-node2/#deploy-a-second-node-instance-on-the-same-node-machine>deploy second node on the same machine</a></li> </ul> <p>This part of the tutorial is optionally executed on some nodes, after deploying the server.</p> <h2 id=optionally-configure-joye-libert-secure-aggregation>Optionally configure Joye-Libert secure aggregation</h2> <p>Secure aggregation provides additional security. <strong>No additional configuration is needed for using LOM secure aggregation, only for using Joye-Libert secure aggregation</strong></p> <p>Optionally configure Joye-Libert secure aggregation:</p> <ul> <li>for <a href=../deployment-vpn-secagg/#configure-joye-libert-secure-aggregation-for-the-server-side>the server side</a></li> <li>for <a href=../deployment-vpn-secagg/#configure-joye-libert-secure-aggregation-for-the-node-side>the node side</a></li> </ul> <p>This part of the tutorial is optionally executed once on each node and once on the server. It is necessary before this component can use secure aggregation in an experiment.</p> <h2 id=use-the-node>Use the node</h2> <p>This part is executed at least once on each node, after deploying the node side containers.</p> <p>Setup the node by sharing datasets and by launching the Fed-BioMed node:</p> <ul> <li> <p>if node GUI is launched, it can be used to share datasets. On the node side machine, connect to <code>https://localhost:8443</code> (or <code>https://&lt;host_name_and_domain&gt;:8443</code> if connection from distant machine is authorized)</p> </li> <li> <p>connect to the <code>node</code> container and launch commands, for example :</p> <ul> <li> <p>connect to the container</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=nb>cd</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/envs/vpn/docker
<span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span>docker<span class=w> </span>compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>-u<span class=w> </span><span class=k>$(</span>id<span class=w> </span>-u<span class=k>)</span><span class=w> </span>node<span class=w> </span>bash<span class=w> </span>-ci<span class=w> </span><span class=s1>&#39;export PYTHONPATH=/fedbiomed &amp;&amp; eval &quot;$(conda shell.bash hook)&quot; &amp;&amp; conda activate fedbiomed-node &amp;&amp; bash&#39;</span>
</code></pre></div> </li> <li> <p>start the Fed-BioMed node, for example in background:</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node-container<span class=w> </span>$<span class=o>]</span><span class=w> </span>nohup<span class=w> </span>./scripts/fedbiomed_run<span class=w> </span>node<span class=w> </span>start<span class=w> </span>&gt;./fedbiomed_node.out<span class=w> </span><span class=p>&amp;</span>
</code></pre></div> </li> <li> <p>share one or more datasets, for example a MNIST dataset or an interactively defined dataset (can also be done via the GUI):</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node-container<span class=w> </span>$<span class=o>]</span><span class=w> </span>./scripts/fedbiomed_run<span class=w> </span>node<span class=w> </span>dataset<span class=w> </span>add<span class=w> </span>-m<span class=w> </span>/data
<span class=o>[</span>user@node-container<span class=w> </span>$<span class=o>]</span><span class=w> </span>./scripts/fedbiomed_run<span class=w> </span>node<span class=w> </span>dataset<span class=w> </span>add
</code></pre></div> </li> </ul> </li> </ul> <p>Example of a few more possible commands:</p> <ul> <li> <p>optionally list shared datasets:</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node-container<span class=w> </span>$<span class=o>]</span><span class=w> </span>./scripts/fedbiomed_run<span class=w> </span>node<span class=w> </span>dataset<span class=w> </span>list
</code></pre></div> </li> <li> <p>optionally register a new <a href=../../../tutorials/security/training-with-approved-training-plans/ >authorized training plan</a> previously copied on the node side in <code>${FEDBIOMED_DIR}/envs/vpn/docker/node/run_mounts/data/my_training_plan.txt</code></p> <p><div class=highlight><pre><span></span><code><span class=o>[</span>user@node-container<span class=w> </span>$<span class=o>]</span><span class=w> </span>./scripts/fedbiomed_run<span class=w> </span>node<span class=w> </span>training-plan<span class=w> </span>register
</code></pre></div> Indicate <code>/data/my_training_plan.txt</code> as path of the training plan file.</p> </li> </ul> <h2 id=optionally-use-a-second-node-instance-on-the-same-node>Optionally use a second node instance on the same node</h2> <p>This optional part is executed at least once on the nodes where a second node instance is deployed, after deploying the second node side containers:</p> <ul> <li><a href=../deployment-vpn-node2/#use-the-second-node-instance-on-the-same-node-machine>use second node on the same machine</a></li> </ul> <h2 id=use-the-server>Use the server</h2> <p>This part is executed at least once on the server after setting up the nodes:</p> <ul> <li> <p>on the server side machine, connect to <code>http://localhost:8888</code>, then choose and run a Jupyter notebook</p> <ul> <li> <p>make more notebooks available from the server side machine (eg: <code>/tmp/my_notebook.ipynb</code>) by copying them to the <code>samples</code> directory</p> <p><div class=highlight><pre><span></span><code><span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span>cp<span class=w> </span>/tmp/my_notebook.ipynb<span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/envs/vpn/docker/researcher/run_mounts/samples/
</code></pre></div> The notebook is now available in the Jupyter GUI under the <code>samples</code> subdirectory of the Jupyter notebook interface.</p> </li> </ul> </li> <li> <p>if the notebook uses Tensorboard, it can be viewed</p> <ul> <li>either embedded inside the Jupyter notebook as explained in the <a href=../../researcher/tensorboard/ >Tensorboard documentation</a></li> <li>or by connecting to <code>http://localhost:6006</code></li> </ul> </li> </ul> <p>Optionally use the researcher container's command line instead of the Jupyter notebooks:</p> <ul> <li> <p>connect to the <code>researcher</code> container</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=nb>cd</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/envs/vpn/docker
<span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span>docker<span class=w> </span>compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>-u<span class=w> </span><span class=k>$(</span>id<span class=w> </span>-u<span class=k>)</span><span class=w> </span>researcher<span class=w> </span>bash<span class=w> </span>-ci<span class=w> </span><span class=s1>&#39;export PYTHONPATH=/fedbiomed &amp;&amp; eval &quot;$(conda shell.bash hook)&quot; &amp;&amp; conda activate fedbiomed-researcher &amp;&amp; bash&#39;</span>
</code></pre></div> </li> <li> <p>launch a script, for example a training:</p> <p><div class=highlight><pre><span></span><code><span class=o>[</span>user@server-container<span class=w> </span>$<span class=o>]</span><span class=w> </span>jupyter<span class=w> </span>nbconvert<span class=w> </span>--output<span class=o>=</span>101_getting-started<span class=w> </span>--to<span class=w> </span>script<span class=w> </span>./notebooks/101_getting-started.ipynb
<span class=o>[</span>user@server-container<span class=w> </span>$<span class=o>]</span><span class=w> </span>python<span class=w> </span>./notebooks/101_getting-started.py
</code></pre></div> Note: the .py script can be created from the notebooks by a command such as <code>jupyter nbconvert --output=101_getting-started --to script ./notebooks/101_getting-started.ipynb</code>.</p> </li> </ul> <h2 id=misc-server-management-commands>Misc server management commands</h2> <p>Some possible management commands after initial deployment include:</p> <ul> <li> <p>check all containers running on the server side</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>status<span class=w> </span>vpnserver<span class=w> </span>researcher
</code></pre></div> </li> <li> <p>check the VPN peers known from the VPN server</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=o>(</span><span class=w> </span><span class=nb>cd</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/envs/vpn/docker<span class=w> </span><span class=p>;</span><span class=w> </span>docker<span class=w> </span>compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>vpnserver<span class=w> </span>bash<span class=w> </span>-ci<span class=w> </span><span class=s2>&quot;python ./vpn/bin/configure_peer.py list&quot;</span><span class=w> </span><span class=o>)</span>
<span class=nb>type</span><span class=w>        </span>id<span class=w>           </span>prefix<span class=w>         </span>peers
----------<span class=w>  </span>-----------<span class=w>  </span>-------------<span class=w>  </span>------------------------------------------------
researcher<span class=w>  </span>researcher1<span class=w>  </span><span class=m>10</span>.222.0.2/32<span class=w>  </span><span class=o>[</span><span class=s1>&#39;1exampleofdummykeyVo+lj/ZfT/wYv+I9ddWYzohC0=&#39;</span><span class=o>]</span>
node<span class=w>        </span>NODETAG<span class=w>      </span><span class=m>10</span>.221.0.2/32<span class=w>  </span><span class=o>[</span><span class=s1>&#39;1exampleofdummykey/Z1SKEzjsMkSe1qztF0uXglnA=&#39;</span><span class=o>]</span>
</code></pre></div> </li> <li> <p>restart all containers running on the server side</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>stop<span class=w> </span>vpnserver<span class=w> </span>researcher
<span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>start<span class=w> </span>vpnserver<span class=w> </span>researcher
</code></pre></div> <p>VPN configurations and container files are kept unchanged when restarting containers.</p> </li> <li> <p>clean running containers, container files and temporary files on the server side. Requires to stop containers before.</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>stop<span class=w> </span>vpnserver<span class=w> </span>researcher
<span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=nb>source</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_environment<span class=w> </span>clean
<span class=o>[</span>user@server<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>clean
</code></pre></div> <p>Warning: all VPN configurations, researcher configuration files,experiment files and results, etc. are deleted when cleaning.</p> <p>To clean also the container images:</p> <div class=highlight><pre><span></span><code>[user@server $] ${FEDBIOMED_DIR}/scripts/fedbiomed_vpn clean image
</code></pre></div> </li> </ul> <h2 id=misc-node-management-commands>Misc node management commands</h2> <p>Some possible management commands after initial deployment include:</p> <ul> <li> <p>check all containers running on the node side</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>status<span class=w> </span>node<span class=w> </span>gui
</code></pre></div> </li> <li> <p>restart all containers running on the node side</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>stop<span class=w> </span>node<span class=w> </span>gui
<span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=o>(</span><span class=w> </span><span class=nb>cd</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/envs/vpn/docker<span class=w> </span><span class=p>;</span><span class=w> </span>docker<span class=w> </span>compose<span class=w> </span>up<span class=w> </span>-d<span class=w> </span>node<span class=w> </span>gui<span class=w> </span><span class=o>)</span>
</code></pre></div> <p>VPN configurations and container files are kept unchanged when restarting containers.</p> </li> <li> <p>clean running containers, container files and temporary files on the node side. Requires to stop containers before.</p> <div class=highlight><pre><span></span><code><span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>stop<span class=w> </span>node<span class=w> </span>gui
<span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=nb>source</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_environment<span class=w> </span>clean
<span class=o>[</span>user@node<span class=w> </span>$<span class=o>]</span><span class=w> </span><span class=si>${</span><span class=nv>FEDBIOMED_DIR</span><span class=si>}</span>/scripts/fedbiomed_vpn<span class=w> </span>clean
</code></pre></div> <p>Warning: all VPN configurations, node configuration files, node dataset sharing, etc. are deleted when cleaning.</p> <p>To clean also the container images:</p> <div class=highlight><pre><span></span><code>[user@node $] ${FEDBIOMED_DIR}/scripts/fedbiomed_vpn clean image
</code></pre></div> </li> </ul> <h2 id=troubleshooting>Troubleshooting</h2> <h3 id=proxy>Proxy</h3> <p>On a site where access to an Internet web site requires using a proxy, configure <a href=https://docs.docker.com/network/proxy#configure-the-docker-client>web proxy for docker client</a> in <code>~/.docker/config.json</code>.</p> <p>Prefix used by Fed-BioMed's communication inside the VPN (<code>10.220.0.0/14</code>) shall not be proxied. So your proxy configuration may look like (replace <code>mysiteproxy.domain</code> with your site proxy):</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w> </span><span class=nt>&quot;proxies&quot;</span><span class=p>:</span>
<span class=w> </span><span class=p>{</span>
<span class=w>   </span><span class=nt>&quot;default&quot;</span><span class=p>:</span>
<span class=w>   </span><span class=p>{</span>
<span class=w>     </span><span class=nt>&quot;httpProxy&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;http://mysiteproxy.domain:3128&quot;</span><span class=p>,</span>
<span class=w>     </span><span class=nt>&quot;httpsProxy&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;http://mysiteproxy.domain:3128&quot;</span><span class=p>,</span>
<span class=w>     </span><span class=nt>&quot;noProxy&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;10.220.0.0/14&quot;</span>
<span class=w>   </span><span class=p>}</span>
<span class=w> </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <h3 id=image-build-on-mac-m1m2m3-arm>Image build on Mac M1/M2/M3 ARM</h3> <p>Build may fail on Mac M1/M2/M3 processors for <code>fedbiomed/vpn-base</code> or <code>fedbiomed/vpn-basenode</code> due to arm64 system.</p> <p>By default, docker can use the images that are created for <code>arm64/aarch64</code>. But docker build files of the Fed-BioMed images and the libraries that are installed within are compatible with <code>amd64</code> type of platforms. Therefore, you may get some error while <code>fedbiomed_vpn</code> script builds images. Those errors can be during the miniconda installation, secure aggregation setup or while installing some of required pip dependencies for Fed-BioMed environment. You can fix this problem by setting environment variable that declares default default docker platform to force docker to use linux/amd64.</p> <div class=highlight><pre><span></span><code>export DOCKER_DEFAULT_PLATFORM=linux/amd64
</code></pre></div> <p>After setting this variable you can execute build command through <code>`{FEDBIOMED_DIR}/scripts/fedbiomed_run build</code></p> </article> </main> </div> <div class=right-col> <div id=right-sidebar class=sidebar-right> <nav class=toc> <!-- Render item list --> <label class=toc-title for=__toc> <span class=toc-icon></span> </label> <ul class=toc-list data-md-component=toc data-md-scrollfix> <!-- Table of contents item --> <li class=toc-item> <a href=#requirements class=md-nav__link> Requirements </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#notations class=md-nav__link> Notations </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#deploy-on-the-server-side class=md-nav__link> Deploy on the server side </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#deploy-on-the-node-side class=md-nav__link> Deploy on the node side </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#optionally-deploy-a-second-node-instance-on-the-same-node class=md-nav__link> Optionally deploy a second node instance on the same node </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#optionally-configure-joye-libert-secure-aggregation class=md-nav__link> Optionally configure Joye-Libert secure aggregation </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#use-the-node class=md-nav__link> Use the node </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#optionally-use-a-second-node-instance-on-the-same-node class=md-nav__link> Optionally use a second node instance on the same node </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#use-the-server class=md-nav__link> Use the server </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#misc-server-management-commands class=md-nav__link> Misc server management commands </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#misc-node-management-commands class=md-nav__link> Misc node management commands </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> <nav class=toc-nav aria-label=Troubleshooting> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#proxy class=md-nav__link> Proxy </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#image-build-on-mac-m1m2m3-arm class=md-nav__link> Image build on Mac M1/M2/M3 ARM </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> </div> <!-- News Main Page--> </div> <footer> <div class=container-fluid> <div class=footer-first-inner> <div class=container> <div class=row> <div class=col-md-6> <div class=footer-contact> <strong>Address:</strong> <p>2004 Rte des Lucioles, 06902 Sophia Antipolis</p> <strong>E-mail:</strong> <p>fedbiomed _at_ inria _dot_ fr</p> </div> </div> <div class=col-md-6> <div class=footer-contact> <p>Fed-BioMed  2022</p> </div> </div> </div> </div> </div> </div> </footer> <!-- JQuery --> <script src=https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js></script> <!-- Latest compiled and minified JavaScript --> <script src=https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=../../../assets/javascript/lunr.js></script> <script src=../../../assets/javascript/theme.js></script> </body> </html>