<!DOCTYPE html><html> <head><meta charset=UTF-8><meta name=viewport content="width=device-width, initial-scale=1"><!--  --><script>
      const versions_json = "../../../../../versions.json";
      const search_worker_js = "../../../../assets/javascript/search-worker.js";
      const search_index_json = "../../../../search/search_index.json";
      const base_url = '../../../..';
    </script><!-- Site title --><title>Job - Fed-BioMed</title><link rel=icon type=image/x-icon href=../../../../favicon.ico><!-- Page description --><meta name=description content="Open, Transparent and Trusted Federated Learning for Real-world Healthcare Applications"><!-- Page keywords --><!-- Page author --><!-- Latest compiled and minified CSS --><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><!-- Bootstrap Icons --><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css><link href=../../../../assets/_mkdocstrings.css rel=stylesheet><link href=../../../../assets/css/style.css rel=stylesheet></head> <body> <div class="container-fluid top-bar"> <div class=brand> <a href=/ > <img src=../../../../assets/img/fedbiomed-logo-small.png> </a> </div> <nav class=top> <ul> <li class> <a href=../../../..>Home</a> </li> <li class> <a href=../../../../getting-started/what-is-fedbiomed/ >User Documentation</a> </li> <li class> <a href=../../../../pages/about-us/ >About</a> </li> <li id=clicker class=has-sub> More <i class="bi bi-chevron-down"></i> <ul class=sub-nav-menu> <li class> <a href=../../../../#funding>Funding</a> </li> <li class> <a href=../../../../news/ >News</a> </li> <li class> <a href=../../../../#contributors>Contributors</a> </li> <li class> <a href=../../../../#users>Users</a> </li> <li class> <a href=../../../../pages/roadmap/ >Roadmap</a> </li> <li class> <a href=../../../../#contact-us>Contact Us</a> </li> </ul> </li> </ul> </nav> </div> <div class="container-fluid top-bar-mobile"> <div class=mobile-bar> <div class=brand> <a href=../../../../ > <img src=../../../../assets/img/fedbiomed-logo-small.png> </a> </div> <div class=hum-menu> <img class=open src=../../../../assets/img/menu.svg> <img class=close style=display:none src=../../../../assets/img/cancel.svg> </div> </div> <nav class=top-mobile> <ul> <li class> <a href=../../../..>Home</a> </li> <li class> <a href=../../../../getting-started/what-is-fedbiomed/ >User Documentation</a> </li> <li class> <a href=../../../../pages/about-us/ >About</a> </li> <li id=clicker class=has-sub> More <i class="bi bi-chevron-down"></i> <ul class=sub-nav-menu> <li class> <a href=../../../../#funding>Funding</a> </li> <li class> <a href=../../../../news/ >News</a> </li> <li class> <a href=../../../../#contributors>Contributors</a> </li> <li class> <a href=../../../../#users>Users</a> </li> <li class> <a href=../../../../pages/roadmap/ >Roadmap</a> </li> <li class> <a href=../../../../#contact-us>Contact Us</a> </li> </ul> </li> </ul> </nav> </div> <div class=main> <!-- Home page --> <div class=container-fluid> <div class=doc-row> <div class=left-col> <div class=sidebar-doc> <div class=sidebar-inner> <ul class="sidebar-menu-left sub"> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Getting Started <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../getting-started/what-is-fedbiomed/ class>What's Fed-BioMed</a> </li> <li class> <a href=../../../../getting-started/getting-started/ class>Basic Example</a> </li> <li class> <a href=../../../../getting-started/fedbiomed-architecture/ class>Fedbiomed Architecture</a> </li> <li class> <a href=../../../../getting-started/fedbiomed-workflow/ class>Fedbiomed Workflow</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Tutorials <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Installation <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/installation/0-basic-software-installation/ class>Software Installation</a> </li> <li class> <a href=../../../../tutorials/installation/1-setting-up-environment/ class>Setting Up Environment</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> PyTorch <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/pytorch/01_PyTorch_MNIST_Single_Node_Tutorial/ class>PyTorch MNIST Basic Example</a> </li> <li class> <a href=../../../../tutorials/pytorch/02_Create_Your_Custom_Training_Plan/ class>How to Create Your Custom PyTorch Training Plan</a> </li> <li class> <a href=../../../../tutorials/pytorch/03_PyTorch_MNIST_local_vs_Federated/ class>MNIST classification with PyTorch, comparing federated model vs model trained locally</a> </li> <li class> <a href=../../../../tutorials/pytorch/04_PyTorch_Used_Cars_Dataset_Example/ class>PyTorch Used Cars Dataset Example</a> </li> <li class> <a href=../../../../tutorials/pytorch/05-Aggregation_in_Fed-BioMed/ class>PyTorch aggregation methods in Fed-BioMed</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> MONAI <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/monai/01_monai-2d-image-classification/ class>Federated 2d image classification with MONAI</a> </li> <li class> <a href=../../../../tutorials/monai/02_monai-2d-image-registration/ class>Federated 2d XRay registration with MONAI</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Scikit-Learn <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/scikit-learn/01_sklearn_MNIST_classification_tutorial/ class>MNIST classification with Scikit-Learn Classifier (Perceptron)</a> </li> <li class> <a href=../../../../tutorials/scikit-learn/02_sklearn_sgd_regressor_tutorial/ class>Fed-BioMed to train a federated SGD regressor model</a> </li> <li class> <a href=../../../../tutorials/scikit-learn/03-other-scikit-learn-models/ class>Implementing other Scikit Learn models for Federated Learning</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> FLamby <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/flamby/flamby/ class>General Concepts</a> </li> <li class> <a href=../../../../tutorials/flamby/flamby-integration-into-fedbiomed/ class>FLamby integration in Fed-BioMed</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Advanced <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/advanced/in-depth-experiment-configuration/ class>In Depth Experiment Configuration</a> </li> <li class> <a href=../../../../tutorials/advanced/training-with-gpu/ class>PyTorch model training using a GPU</a> </li> <li class> <a href=../../../../tutorials/advanced/breakpoints/ class>Breakpoints</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Security <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/security/differential-privacy-with-opacus-on-fedbiomed/ class>Using Differential Privacy with OPACUS on Fed-BioMed</a> </li> <li class> <a href=../../../../tutorials/security/non-private-local-central-dp-monai-2d-image-registration/ class>Local and Central DP with Fed-BioMed: MONAI 2d image registration</a> </li> <li class> <a href=../../../../tutorials/security/training-with-approved-training-plans/ class>Training Process with Training Plan Management</a> </li> <li class> <a href=../../../../tutorials/security/secure-aggregation/ class>Training with Secure Aggregation</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Biomedical data <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/medical/medical-image-segmentation-unet-library/ class>Brain Segmentation</a> </li> </ul> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> User Guide <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/glossary/ class>Glossary</a> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Deployment <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/deployment/deployment/ class>Introduction</a> </li> <li class> <a href=../../../../user-guide/deployment/deployment-vpn/ class>VPN Deployment</a> </li> <li class> <a href=../../../../user-guide/deployment/matrix/ class>Network matrix</a> </li> <li class> <a href=../../../../user-guide/deployment/security-model/ class>Security model</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Node <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/nodes/configuring-nodes/ class>Configuring Nodes</a> </li> <li class> <a href=../../../../user-guide/nodes/deploying-datasets/ class>Deploying Datasets</a> </li> <li class> <a href=../../../../user-guide/nodes/training-plan-security-manager/ class>Training Plan Management</a> </li> <li class> <a href=../../../../user-guide/nodes/using-gpu/ class>Using GPU</a> </li> <li class> <a href=../../../../user-guide/nodes/node-gui/ class>Node GUI</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Researcher <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/researcher/training-plan/ class>Training Plan</a> </li> <li class> <a href=../../../../user-guide/researcher/training-data/ class>Training Data</a> </li> <li class> <a href=../../../../user-guide/researcher/experiment/ class>Experiment</a> </li> <li class> <a href=../../../../user-guide/researcher/aggregation/ class>Aggregation</a> </li> <li class> <a href=../../../../user-guide/researcher/listing-datasets-and-selecting-nodes/ class>Listing Datasets and Selecting Nodes</a> </li> <li class> <a href=../../../../user-guide/researcher/model-testing-during-federated-training/ class>Model Validation on the Node Side</a> </li> <li class> <a href=../../../../user-guide/researcher/tensorboard/ class>Tensorboard</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Secure Aggregation <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/secagg/introduction/ class>Introduction</a> </li> <li class> <a href=../../../../user-guide/secagg/configuration/ class>Configuration</a> </li> <li class> <a href=../../../../user-guide/secagg/certificate-registration/ class>Certificate Registration</a> </li> <li class> <a href=../../../../user-guide/secagg/researcher-interface/ class>Managing Secure Aggregation in Researcher</a> </li> </ul> </li> </ul> </li> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> Developer <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> API Reference <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Common <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../common/constants/ class>Constants</a> </li> <li class> <a href=../../common/data/ class>Data</a> </li> <li class> <a href=../../common/environ/ class>Environ</a> </li> <li class> <a href=../../common/exceptions/ class>Exceptions</a> </li> <li class> <a href=../../common/json/ class>Json</a> </li> <li class> <a href=../../common/logger/ class>Logger</a> </li> <li class> <a href=../../common/message/ class>Message</a> </li> <li class> <a href=../../common/messaging/ class>Messaging</a> </li> <li class> <a href=../../common/models/ class>Model</a> </li> <li class> <a href=../../common/optimizer/ class>Optimizer</a> </li> <li class> <a href=../../common/repository/ class>Repository</a> </li> <li class> <a href=../../common/tasks_queue/ class>TasksQueue</a> </li> <li class> <a href=../../common/training_plans/ class>TrainingPlans</a> </li> <li class> <a href=../../common/training_args/ class>TrainingArgs</a> </li> <li class> <a href=../../common/utils/ class>Utils</a> </li> <li class> <a href=../../common/validator/ class>Validator</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Node <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../node/cli/ class>CLI</a> </li> <li class> <a href=../../node/dataset_manager/ class>DatasetManager</a> </li> <li class> <a href=../../node/node/ class>Node</a> </li> <li class> <a href=../../node/training_plan_security_manager/ class>TrainingPlanSecurityManager</a> </li> <li class> <a href=../../node/history_monitor/ class>HistoryMonitor</a> </li> <li class> <a href=../../node/round/ class>Round</a> </li> </ul> </li> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> Researcher <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li class> <a href=../aggregators/ class>Aggregators</a> </li> <li class> <a href=../datasets/ class>Datasets</a> </li> <li class> <a href=../experiment/ class>Experiment</a> </li> <li class> <a href=../filetools/ class>Filetools</a> </li> <li class=current> <a href=./ class="link current">Job</a> </li> <li class> <a href=../monitor/ class>Monitor</a> </li> <li class> <a href=../responses/ class>Responses</a> </li> <li class> <a href=../requests/ class>Requests</a> </li> <li class> <a href=../strategies/ class>Strategies</a> </li> <li class> <a href=../secagg/ class>Secagg</a> </li> </ul> </li> </ul> </li> <li class> <a href=../../../usage_and_tools/ class>Usage and Tools</a> </li> <li class> <a href=../../../ci/ class>Continuous Integration</a> </li> <li class> <a href=../../../definition-of-done/ class>Definition of Done</a> </li> </ul> </li> </ul> </div> </div> </div> <div class=main-col> <div class=main-docs> <div class="doc doc-object doc-module"> <h1 id=fedbiomed.researcher.job class="doc doc-heading module"> fedbiomed.researcher.job </h1> <span>Module: <code>fedbiomed.researcher.job</code></span> <div class="doc doc-contents first"> <p>Manage the training part of the experiment.</p> <div class="doc doc-children"> <h2 id=fedbiomed.researcher.job-classes class=api-section-header>Classes</h2> <div class="doc doc-object doc-class"> <h3 id=fedbiomed.researcher.job.Job class="doc doc-heading"> Job<!--        --> <!--          <code>Job</code>--> <!--        --> </h3> <div class=main-class-init> <span>CLASS </span> <div class=highlight><pre><span></span><code><span class=n>Job</span><span class=p>(</span><span class=n>reqs</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>nodes</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>training_plan_class</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>training_plan_path</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>training_args</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>model_args</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>keep_files_dir</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</code></pre></div> </div> <div class="doc doc-contents "> <p>Represents the entity that manage the training part at the nodes level</p> <p>Starts a message queue, loads python model file created by researcher (through <a class="autorefs autorefs-internal" href="../../common/training_plans/#fedbiomed.common.training_plans"><code>training_plans</code></a>) and saves the loaded model in a temporary file (under the filename '<temp_dir>/my_model_<random_id>.py').</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>reqs</code></td> <td> <code><!--fedbiomed.researcher.requests.Requests--><a class="autorefs autorefs-internal" title="fedbiomed.researcher.requests.Requests" href="../requests/#fedbiomed.researcher.requests.Requests">Requests</a></code> </td> <td><p>Researcher's requests assigned to nodes. Defaults to None.</p></td> <td> <code><!---->None</code> </td> </tr> <tr> <td><code>nodes</code></td> <td> <code><!--dict--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></code> </td> <td><p>A dict of node_id containing the nodes used for training</p></td> <td> <code><!---->None</code> </td> </tr> <tr> <td><code>training_plan_class</code></td> <td> <code><!--typing.Union[typing.Type[typing.Callable], str]--><!--typing.Union--><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a><!---->[<!--typing.Type[typing.Callable], str--><!--typing.Type[typing.Callable]--><!--typing.Type--><a class="autorefs autorefs-external" title="typing.Type" href="https://docs.python.org/3/library/typing.html#typing.Type">Type</a><!---->[<!--typing.Callable--><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a><!---->]<!---->, <!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a><!---->]</code> </td> <td><p>instance or class of the TrainingPlan.</p></td> <td> <code><!---->None</code> </td> </tr> <tr> <td><code>training_plan_path</code></td> <td> <code><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td><p>Path to file containing model class code</p></td> <td> <code><!---->None</code> </td> </tr> <tr> <td><code>training_args</code></td> <td> <code><!--fedbiomed.common.training_args.TrainingArgs--><a class="autorefs autorefs-internal" title="fedbiomed.common.training_args.TrainingArgs" href="../../common/training_args/#fedbiomed.common.training_args.TrainingArgs">TrainingArgs</a></code> </td> <td><p>Contains training parameters; lr, epochs, batch_size.</p></td> <td> <code><!---->None</code> </td> </tr> <tr> <td><code>model_args</code></td> <td> <code><!--dict--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></code> </td> <td><p>Contains output and input feature dimension</p></td> <td> <code><!---->None</code> </td> </tr> <tr> <td><code>data</code></td> <td> <code><!--fedbiomed.researcher.datasets.FederatedDataSet--><a class="autorefs autorefs-internal" title="fedbiomed.researcher.datasets.FederatedDataSet" href="../datasets/#fedbiomed.researcher.datasets.FederatedDataSet">FederatedDataSet</a></code> </td> <td><p>Federated datasets</p></td> <td> <code><!---->None</code> </td> </tr> <tr> <td><code>keep_files_dir</code></td> <td> <code><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td><p>Directory for storing files created by the job that we want to keep beyond the execution of the job. Defaults to None, files are not kept after the end of the job.</p></td> <td> <code><!---->None</code> </td> </tr> </tbody> </table> <p><strong>Raises:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><!--NameError--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#NameError">NameError</a></code> </td> <td><p>If model is not defined or if the class can not to be inspected</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/job.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos=" 45 "></span><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos=" 46 "></span>             <span class=n>reqs</span><span class=p>:</span> <span class=n>Requests</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos=" 47 "></span>             <span class=n>nodes</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos=" 48 "></span>             <span class=n>training_plan_class</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Type</span><span class=p>[</span><span class=n>Callable</span><span class=p>],</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos=" 49 "></span>             <span class=n>training_plan_path</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos=" 50 "></span>             <span class=n>training_args</span><span class=p>:</span> <span class=n>TrainingArgs</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos=" 51 "></span>             <span class=n>model_args</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos=" 52 "></span>             <span class=n>data</span><span class=p>:</span> <span class=n>FederatedDataSet</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos=" 53 "></span>             <span class=n>keep_files_dir</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
<span class=linenos data-linenos=" 54 "></span>
<span class=linenos data-linenos=" 55 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot; Constructor of the class</span>
<span class=linenos data-linenos=" 56 "></span>
<span class=linenos data-linenos=" 57 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos=" 58 "></span><span class=sd>        reqs: Researcher&#39;s requests assigned to nodes. Defaults to None.</span>
<span class=linenos data-linenos=" 59 "></span><span class=sd>        nodes: A dict of node_id containing the nodes used for training</span>
<span class=linenos data-linenos=" 60 "></span><span class=sd>        training_plan_class: instance or class of the TrainingPlan.</span>
<span class=linenos data-linenos=" 61 "></span><span class=sd>        training_plan_path: Path to file containing model class code</span>
<span class=linenos data-linenos=" 62 "></span><span class=sd>        training_args: Contains training parameters; lr, epochs, batch_size.</span>
<span class=linenos data-linenos=" 63 "></span><span class=sd>        model_args: Contains output and input feature dimension</span>
<span class=linenos data-linenos=" 64 "></span><span class=sd>        data: Federated datasets</span>
<span class=linenos data-linenos=" 65 "></span><span class=sd>        keep_files_dir: Directory for storing files created by the job that we want to keep beyond the execution</span>
<span class=linenos data-linenos=" 66 "></span><span class=sd>            of the job. Defaults to None, files are not kept after the end of the job.</span>
<span class=linenos data-linenos=" 67 "></span>
<span class=linenos data-linenos=" 68 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos=" 69 "></span><span class=sd>        NameError: If model is not defined or if the class can not to be inspected</span>
<span class=linenos data-linenos=" 70 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos=" 71 "></span>
<span class=linenos data-linenos=" 72 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>  <span class=c1># creating a unique job id</span>
<span class=linenos data-linenos=" 73 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_researcher_id</span> <span class=o>=</span> <span class=n>environ</span><span class=p>[</span><span class=s1>&#39;RESEARCHER_ID&#39;</span><span class=p>]</span>
<span class=linenos data-linenos=" 74 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_repository_args</span> <span class=o>=</span> <span class=p>{}</span>
<span class=linenos data-linenos=" 75 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span> <span class=o>=</span> <span class=n>training_args</span>
<span class=linenos data-linenos=" 76 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_model_args</span> <span class=o>=</span> <span class=n>model_args</span>
<span class=linenos data-linenos=" 77 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_nodes</span> <span class=o>=</span> <span class=n>nodes</span>
<span class=linenos data-linenos=" 78 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_training_replies</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># will contain all node replies for every round</span>
<span class=linenos data-linenos=" 79 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_model_file</span> <span class=o>=</span> <span class=kc>None</span>  <span class=c1># path to local file containing model code</span>
<span class=linenos data-linenos=" 80 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_model_params_file</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>  <span class=c1># path to local file containing current version of aggregated params</span>
<span class=linenos data-linenos=" 81 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_class</span> <span class=o>=</span> <span class=n>training_plan_class</span>
<span class=linenos data-linenos=" 82 "></span>    <span class=c1># self._training_plan = None  # declared below, as a TrainingPlan instance</span>
<span class=linenos data-linenos=" 83 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_aggregator_args</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos=" 84 "></span>
<span class=linenos data-linenos=" 85 "></span>    <span class=k>if</span> <span class=n>keep_files_dir</span><span class=p>:</span>
<span class=linenos data-linenos=" 86 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_keep_files_dir</span> <span class=o>=</span> <span class=n>keep_files_dir</span>
<span class=linenos data-linenos=" 87 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos=" 88 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_keep_files_dir</span> <span class=o>=</span> <span class=n>tempfile</span><span class=o>.</span><span class=n>mkdtemp</span><span class=p>(</span><span class=n>prefix</span><span class=o>=</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;TMP_DIR&#39;</span><span class=p>])</span>
<span class=linenos data-linenos=" 89 "></span>        <span class=n>atexit</span><span class=o>.</span><span class=n>register</span><span class=p>(</span><span class=k>lambda</span><span class=p>:</span> <span class=n>shutil</span><span class=o>.</span><span class=n>rmtree</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_keep_files_dir</span><span class=p>))</span>  <span class=c1># remove directory</span>
<span class=linenos data-linenos=" 90 "></span>        <span class=c1># when script ends running (replace</span>
<span class=linenos data-linenos=" 91 "></span>        <span class=c1># `with tempfile.TemporaryDirectory(dir=environ[&#39;TMP_DIR&#39;]) as self._keep_files_dir: `)</span>
<span class=linenos data-linenos=" 92 "></span>
<span class=linenos data-linenos=" 93 "></span>    <span class=k>if</span> <span class=n>reqs</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos=" 94 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_reqs</span> <span class=o>=</span> <span class=n>Requests</span><span class=p>()</span>
<span class=linenos data-linenos=" 95 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos=" 96 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_reqs</span> <span class=o>=</span> <span class=n>reqs</span>
<span class=linenos data-linenos=" 97 "></span>
<span class=linenos data-linenos=" 98 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>last_msg</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos=" 99 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>data</span>
<span class=linenos data-linenos="100 "></span>
<span class=linenos data-linenos="101 "></span>    <span class=c1># Check dataset quality</span>
<span class=linenos data-linenos="102 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_data</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="103 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>check_data_quality</span><span class=p>()</span>
<span class=linenos data-linenos="104 "></span>
<span class=linenos data-linenos="105 "></span>    <span class=c1># Model is mandatory</span>
<span class=linenos data-linenos="106 "></span>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_class</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="107 "></span>        <span class=n>mess</span> <span class=o>=</span> <span class=s2>&quot;Missing training plan class name or instance in Job arguments&quot;</span>
<span class=linenos data-linenos="108 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=n>mess</span><span class=p>)</span>
<span class=linenos data-linenos="109 "></span>        <span class=k>raise</span> <span class=ne>NameError</span><span class=p>(</span><span class=n>mess</span><span class=p>)</span>
<span class=linenos data-linenos="110 "></span>
<span class=linenos data-linenos="111 "></span>    <span class=c1># handle case when model is in a file</span>
<span class=linenos data-linenos="112 "></span>    <span class=k>if</span> <span class=n>training_plan_path</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="113 "></span>        <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="114 "></span>            <span class=c1># import model from python file</span>
<span class=linenos data-linenos="115 "></span>
<span class=linenos data-linenos="116 "></span>            <span class=n>model_module</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>training_plan_path</span><span class=p>)</span>
<span class=linenos data-linenos="117 "></span>            <span class=n>model_module</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s2>&quot;(.*)\.py$&quot;</span><span class=p>,</span> <span class=n>model_module</span><span class=p>)</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
<span class=linenos data-linenos="118 "></span>            <span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>training_plan_path</span><span class=p>))</span>
<span class=linenos data-linenos="119 "></span>
<span class=linenos data-linenos="120 "></span>            <span class=n>module</span> <span class=o>=</span> <span class=n>importlib</span><span class=o>.</span><span class=n>import_module</span><span class=p>(</span><span class=n>model_module</span><span class=p>)</span>
<span class=linenos data-linenos="121 "></span>            <span class=n>tr_class</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>module</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_class</span><span class=p>)</span>
<span class=linenos data-linenos="122 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_class</span> <span class=o>=</span> <span class=n>tr_class</span>
<span class=linenos data-linenos="123 "></span>            <span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
<span class=linenos data-linenos="124 "></span>
<span class=linenos data-linenos="125 "></span>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<span class=linenos data-linenos="126 "></span>            <span class=n>e</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>exc_info</span><span class=p>()</span>
<span class=linenos data-linenos="127 "></span>            <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Cannot import class </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_class</span><span class=si>}</span><span class=s2> from &quot;</span>
<span class=linenos data-linenos="128 "></span>                            <span class=sa>f</span><span class=s2>&quot;path </span><span class=si>{</span><span class=n>training_plan_path</span><span class=si>}</span><span class=s2> - Error: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="129 "></span>            <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
<span class=linenos data-linenos="130 "></span>
<span class=linenos data-linenos="131 "></span>    <span class=c1># check class is defined</span>
<span class=linenos data-linenos="132 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="133 "></span>        <span class=n>_</span> <span class=o>=</span> <span class=n>inspect</span><span class=o>.</span><span class=n>isclass</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_class</span><span class=p>)</span>
<span class=linenos data-linenos="134 "></span>    <span class=k>except</span> <span class=ne>NameError</span><span class=p>:</span>
<span class=linenos data-linenos="135 "></span>        <span class=n>mess</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Cannot find training plan for Job, training plan class </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_class</span><span class=si>}</span><span class=s2> is not defined&quot;</span>
<span class=linenos data-linenos="136 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=n>mess</span><span class=p>)</span>
<span class=linenos data-linenos="137 "></span>        <span class=k>raise</span> <span class=ne>NameError</span><span class=p>(</span><span class=n>mess</span><span class=p>)</span>
<span class=linenos data-linenos="138 "></span>
<span class=linenos data-linenos="139 "></span>    <span class=c1># create/save TrainingPlan instance</span>
<span class=linenos data-linenos="140 "></span>    <span class=k>if</span> <span class=n>inspect</span><span class=o>.</span><span class=n>isclass</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_class</span><span class=p>):</span>
<span class=linenos data-linenos="141 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_class</span><span class=p>()</span>  <span class=c1># contains TrainingPlan</span>
<span class=linenos data-linenos="142 "></span>
<span class=linenos data-linenos="143 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="144 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_class</span>
<span class=linenos data-linenos="145 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>post_init</span><span class=p>(</span><span class=n>model_args</span><span class=o>=</span><span class=p>{}</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model_args</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model_args</span><span class=p>,</span>
<span class=linenos data-linenos="146 "></span>                                  <span class=n>training_args</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span><span class=p>)</span>
<span class=linenos data-linenos="147 "></span>
<span class=linenos data-linenos="148 "></span>    <span class=c1># find the name of the class in any case</span>
<span class=linenos data-linenos="149 "></span>    <span class=c1># (it is `model` only in the case where `model` is not an instance)</span>
<span class=linenos data-linenos="150 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span>
<span class=linenos data-linenos="151 "></span>
<span class=linenos data-linenos="152 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>repo</span> <span class=o>=</span> <span class=n>Repository</span><span class=p>(</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;UPLOADS_URL&#39;</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>_keep_files_dir</span><span class=p>,</span> <span class=n>environ</span><span class=p>[</span><span class=s1>&#39;CACHE_DIR&#39;</span><span class=p>])</span>
<span class=linenos data-linenos="153 "></span>
<span class=linenos data-linenos="154 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_file</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_keep_files_dir</span><span class=p>,</span> <span class=s1>&#39;my_model_&#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span> <span class=o>+</span> <span class=s1>&#39;.py&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="155 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="156 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>save_code</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_file</span><span class=p>)</span>
<span class=linenos data-linenos="157 "></span>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<span class=linenos data-linenos="158 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&quot;Cannot save the training plan to a local tmp dir : &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
<span class=linenos data-linenos="159 "></span>        <span class=k>return</span>
<span class=linenos data-linenos="160 "></span>
<span class=linenos data-linenos="161 "></span>    <span class=c1># upload my_model_xxx.py on repository server (contains model definition)</span>
<span class=linenos data-linenos="162 "></span>    <span class=n>repo_response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>repo</span><span class=o>.</span><span class=n>upload_file</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_file</span><span class=p>)</span>
<span class=linenos data-linenos="163 "></span>
<span class=linenos data-linenos="164 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_repository_args</span><span class=p>[</span><span class=s1>&#39;training_plan_url&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>repo_response</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>]</span>
<span class=linenos data-linenos="165 "></span>
<span class=linenos data-linenos="166 "></span>    <span class=c1># Save model parameters to a local file and upload it to the remote repository.</span>
<span class=linenos data-linenos="167 "></span>    <span class=c1># The filename and remote url are assigned to attributes through this call.</span>
<span class=linenos data-linenos="168 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="169 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>update_parameters</span><span class=p>()</span>
<span class=linenos data-linenos="170 "></span>    <span class=k>except</span> <span class=ne>SystemExit</span><span class=p>:</span>
<span class=linenos data-linenos="171 "></span>        <span class=k>return</span>
<span class=linenos data-linenos="172 "></span>
<span class=linenos data-linenos="173 "></span>    <span class=c1># (below) regex: matches a character not present among &quot;^&quot;, &quot;\&quot;, &quot;.&quot;</span>
<span class=linenos data-linenos="174 "></span>    <span class=c1># characters at the end of string.</span>
<span class=linenos data-linenos="175 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_repository_args</span><span class=p>[</span><span class=s1>&#39;training_plan_class&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan_name</span>
<span class=linenos data-linenos="176 "></span>
<span class=linenos data-linenos="177 "></span>    <span class=c1># Validate fields in each argument</span>
<span class=linenos data-linenos="178 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>validate_minimal_arguments</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_repository_args</span><span class=p>,</span>
<span class=linenos data-linenos="179 "></span>                                    <span class=p>[</span><span class=s1>&#39;training_plan_url&#39;</span><span class=p>,</span> <span class=s1>&#39;training_plan_class&#39;</span><span class=p>,</span> <span class=s1>&#39;params_url&#39;</span><span class=p>])</span>
</code></pre></div> </details> <div class="doc doc-children"> <h4 id=fedbiomed.researcher.job.Job-attributes class=api-section-header>Attributes</h4> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.job.Job.aggregator_args class="doc doc-heading attribute"> aggregator_args <span class="doc doc-properties"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h5> <div class=highlight><pre><span></span><code><span class=n>aggregator_args</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.job.Job.id class="doc doc-heading attribute"> id <span class="doc doc-properties"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h5> <div class=highlight><pre><span></span><code><span class=nb>id</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.job.Job.last_msg class="doc doc-heading attribute"> last_msg <span class="doc doc-properties"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class=highlight><pre><span></span><code><span class=n>last_msg</span> <span class=o>=</span> <span class=kc>None</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.job.Job.nodes class="doc doc-heading attribute"> nodes <span class="doc doc-properties"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h5> <div class=highlight><pre><span></span><code><span class=n>nodes</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.job.Job.repo class="doc doc-heading attribute"> repo <span class="doc doc-properties"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class=highlight><pre><span></span><code><span class=n>repo</span> <span class=o>=</span> <span class=n>Repository</span><span class=p>(</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;UPLOADS_URL&#39;</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>_keep_files_dir</span><span class=p>,</span> <span class=n>environ</span><span class=p>[</span><span class=s1>&#39;CACHE_DIR&#39;</span><span class=p>])</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.job.Job.requests class="doc doc-heading attribute"> requests <span class="doc doc-properties"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h5> <div class=highlight><pre><span></span><code><span class=n>requests</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.job.Job.training_args class="doc doc-heading attribute"> training_args <span class="doc doc-properties"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h5> <div class=highlight><pre><span></span><code><span class=n>training_args</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.job.Job.training_plan class="doc doc-heading attribute"> training_plan <span class="doc doc-properties"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h5> <div class=highlight><pre><span></span><code><span class=n>training_plan</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.job.Job.training_plan_file class="doc doc-heading attribute"> training_plan_file <span class="doc doc-properties"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h5> <div class=highlight><pre><span></span><code><span class=n>training_plan_file</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.job.Job.training_plan_name class="doc doc-heading attribute"> training_plan_name <span class="doc doc-properties"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h5> <div class=highlight><pre><span></span><code><span class=n>training_plan_name</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.job.Job.training_replies class="doc doc-heading attribute"> training_replies <span class="doc doc-properties"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h5> <div class=highlight><pre><span></span><code><span class=n>training_replies</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <h4 id=fedbiomed.researcher.job.Job-functions class=api-section-header>Functions</h4> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.job.Job.check_data_quality class="doc doc-heading function"> <div class=highlight><pre><span></span><code><span class=n>check_data_quality</span><span class=p>()</span>
</code></pre></div> </h5> <div class="doc doc-contents "> <p>Does quality check by comparing datasets that have been found in different nodes.</p> <details class="quote source-code"> <summary>Source code in <code>fedbiomed/researcher/job.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="668 "></span><span class=k>def</span> <span class=nf>check_data_quality</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=linenos data-linenos="669 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Does quality check by comparing datasets that have been found in different nodes. &quot;&quot;&quot;</span>
<span class=linenos data-linenos="670 "></span>
<span class=linenos data-linenos="671 "></span>    <span class=n>data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_data</span><span class=o>.</span><span class=n>data</span><span class=p>()</span>
<span class=linenos data-linenos="672 "></span>    <span class=c1># If there are more than two nodes ready for the job</span>
<span class=linenos data-linenos="673 "></span>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
<span class=linenos data-linenos="674 "></span>
<span class=linenos data-linenos="675 "></span>        <span class=c1># First check data types are same based on searched tags</span>
<span class=linenos data-linenos="676 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Checking data quality of federated datasets...&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="677 "></span>
<span class=linenos data-linenos="678 "></span>        <span class=n>data_types</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># CSV, Image or default</span>
<span class=linenos data-linenos="679 "></span>        <span class=n>shapes</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># dimensions</span>
<span class=linenos data-linenos="680 "></span>        <span class=n>dtypes</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># variable types for CSV datasets</span>
<span class=linenos data-linenos="681 "></span>
<span class=linenos data-linenos="682 "></span>        <span class=c1># Extract features into arrays for comparison</span>
<span class=linenos data-linenos="683 "></span>        <span class=k>for</span> <span class=n>feature</span> <span class=ow>in</span> <span class=n>data</span><span class=o>.</span><span class=n>values</span><span class=p>():</span>
<span class=linenos data-linenos="684 "></span>            <span class=n>data_types</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>feature</span><span class=p>[</span><span class=s2>&quot;data_type&quot;</span><span class=p>])</span>
<span class=linenos data-linenos="685 "></span>            <span class=n>dtypes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>feature</span><span class=p>[</span><span class=s2>&quot;dtypes&quot;</span><span class=p>])</span>
<span class=linenos data-linenos="686 "></span>            <span class=n>shapes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>feature</span><span class=p>[</span><span class=s2>&quot;shape&quot;</span><span class=p>])</span>
<span class=linenos data-linenos="687 "></span>
<span class=linenos data-linenos="688 "></span>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>data_types</span><span class=p>))</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
<span class=linenos data-linenos="689 "></span>            <span class=k>raise</span> <span class=n>FedbiomedDataQualityCheckError</span><span class=p>(</span>
<span class=linenos data-linenos="690 "></span>                <span class=sa>f</span><span class=s1>&#39;Different type of datasets has been loaded with same tag: </span><span class=si>{</span><span class=n>data_types</span><span class=si>}</span><span class=s1>&#39;</span>
<span class=linenos data-linenos="691 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="692 "></span>
<span class=linenos data-linenos="693 "></span>        <span class=k>if</span> <span class=n>data_types</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;csv&#39;</span><span class=p>:</span>
<span class=linenos data-linenos="694 "></span>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nb>set</span><span class=p>([</span><span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>shapes</span><span class=p>]))</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
<span class=linenos data-linenos="695 "></span>                <span class=k>raise</span> <span class=n>FedbiomedDataQualityCheckError</span><span class=p>(</span>
<span class=linenos data-linenos="696 "></span>                    <span class=sa>f</span><span class=s1>&#39;Number of columns of federated datasets do not match </span><span class=si>{</span><span class=n>shapes</span><span class=si>}</span><span class=s1>.&#39;</span>
<span class=linenos data-linenos="697 "></span>                <span class=p>)</span>
<span class=linenos data-linenos="698 "></span>
<span class=linenos data-linenos="699 "></span>            <span class=n>dtypes_t</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=nb>zip</span><span class=p>(</span><span class=o>*</span><span class=n>dtypes</span><span class=p>)))</span>
<span class=linenos data-linenos="700 "></span>            <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>dtypes_t</span><span class=p>:</span>
<span class=linenos data-linenos="701 "></span>                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>t</span><span class=p>))</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
<span class=linenos data-linenos="702 "></span>                    <span class=c1># FIXME: specifying a specific use case (in the condition above) should be avoided</span>
<span class=linenos data-linenos="703 "></span>                    <span class=k>raise</span> <span class=n>FedbiomedDataQualityCheckError</span><span class=p>(</span>
<span class=linenos data-linenos="704 "></span>                        <span class=sa>f</span><span class=s1>&#39;Variable data types do not match in federated datasets </span><span class=si>{</span><span class=n>dtypes</span><span class=si>}</span><span class=s1>&#39;</span>
<span class=linenos data-linenos="705 "></span>                    <span class=p>)</span>
<span class=linenos data-linenos="706 "></span>
<span class=linenos data-linenos="707 "></span>        <span class=k>elif</span> <span class=n>data_types</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;images&#39;</span><span class=p>:</span>
<span class=linenos data-linenos="708 "></span>            <span class=n>shapes_t</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=nb>zip</span><span class=p>(</span><span class=o>*</span><span class=p>[</span><span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>:]</span> <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>shapes</span><span class=p>])))</span>
<span class=linenos data-linenos="709 "></span>            <span class=n>dim_state</span> <span class=o>=</span> <span class=kc>True</span>
<span class=linenos data-linenos="710 "></span>            <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>shapes_t</span><span class=p>:</span>
<span class=linenos data-linenos="711 "></span>                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>:</span>
<span class=linenos data-linenos="712 "></span>                    <span class=n>dim_state</span> <span class=o>=</span> <span class=kc>False</span>
<span class=linenos data-linenos="713 "></span>
<span class=linenos data-linenos="714 "></span>            <span class=k>if</span> <span class=ow>not</span> <span class=n>dim_state</span><span class=p>:</span>
<span class=linenos data-linenos="715 "></span>                <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Dimensions of the images in federated datasets </span><span class=se>\</span>
<span class=linenos data-linenos="716 "></span><span class=s1>                             do not match. Please consider using resize. </span><span class=si>{</span><span class=n>shapes</span><span class=si>}</span><span class=s1> &#39;</span><span class=p>)</span>
<span class=linenos data-linenos="717 "></span>
<span class=linenos data-linenos="718 "></span>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nb>set</span><span class=p>([</span><span class=n>k</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=n>shapes</span><span class=p>]))</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>:</span>
<span class=linenos data-linenos="719 "></span>                <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Color channels of the images in federated </span><span class=se>\</span>
<span class=linenos data-linenos="720 "></span><span class=s1>                                datasets do not match. </span><span class=si>{</span><span class=n>shapes</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="721 "></span>
<span class=linenos data-linenos="722 "></span>        <span class=c1># If it is default MNIST dataset pass</span>
<span class=linenos data-linenos="723 "></span>        <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="724 "></span>            <span class=k>pass</span>
<span class=linenos data-linenos="725 "></span>
<span class=linenos data-linenos="726 "></span>    <span class=k>pass</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.job.Job.check_training_plan_is_approved_by_nodes class="doc doc-heading function"> <div class=highlight><pre><span></span><code><span class=n>check_training_plan_is_approved_by_nodes</span><span class=p>()</span>
</code></pre></div> </h5> <div class="doc doc-contents "> <p>Checks whether model is approved or not.</p> <p>This method sends <code>training-plan-status</code> request to the nodes. It should be run before running experiment. So, researchers can find out if their model has been approved</p> <details class="quote source-code"> <summary>Source code in <code>fedbiomed/researcher/job.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="238 "></span><span class=k>def</span> <span class=nf>check_training_plan_is_approved_by_nodes</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>:</span>
<span class=linenos data-linenos="239 "></span>
<span class=linenos data-linenos="240 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot; Checks whether model is approved or not.</span>
<span class=linenos data-linenos="241 "></span>
<span class=linenos data-linenos="242 "></span><span class=sd>    This method sends `training-plan-status` request to the nodes. It should be run before running experiment.</span>
<span class=linenos data-linenos="243 "></span><span class=sd>    So, researchers can find out if their model has been approved</span>
<span class=linenos data-linenos="244 "></span>
<span class=linenos data-linenos="245 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="246 "></span>
<span class=linenos data-linenos="247 "></span>    <span class=n>message</span> <span class=o>=</span> <span class=p>{</span>
<span class=linenos data-linenos="248 "></span>        <span class=s1>&#39;researcher_id&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_researcher_id</span><span class=p>,</span>
<span class=linenos data-linenos="249 "></span>        <span class=s1>&#39;job_id&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_id</span><span class=p>,</span>
<span class=linenos data-linenos="250 "></span>        <span class=s1>&#39;training_plan_url&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_repository_args</span><span class=p>[</span><span class=s1>&#39;training_plan_url&#39;</span><span class=p>],</span>
<span class=linenos data-linenos="251 "></span>        <span class=s1>&#39;command&#39;</span><span class=p>:</span> <span class=s1>&#39;training-plan-status&#39;</span>
<span class=linenos data-linenos="252 "></span>    <span class=p>}</span>
<span class=linenos data-linenos="253 "></span>
<span class=linenos data-linenos="254 "></span>    <span class=n>responses</span> <span class=o>=</span> <span class=n>Responses</span><span class=p>([])</span>
<span class=linenos data-linenos="255 "></span>    <span class=n>replied_nodes</span> <span class=o>=</span> <span class=p>[]</span>
<span class=linenos data-linenos="256 "></span>    <span class=n>node_ids</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_data</span><span class=o>.</span><span class=n>node_ids</span><span class=p>()</span>
<span class=linenos data-linenos="257 "></span>
<span class=linenos data-linenos="258 "></span>    <span class=c1># Send message to each node that has been found after dataset search request</span>
<span class=linenos data-linenos="259 "></span>    <span class=k>for</span> <span class=n>cli</span> <span class=ow>in</span> <span class=n>node_ids</span><span class=p>:</span>
<span class=linenos data-linenos="260 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Sending request to node &#39;</span> <span class=o>+</span>
<span class=linenos data-linenos="261 "></span>                    <span class=nb>str</span><span class=p>(</span><span class=n>cli</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&quot; to check model is approved or not&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="262 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_reqs</span><span class=o>.</span><span class=n>send_message</span><span class=p>(</span>
<span class=linenos data-linenos="263 "></span>            <span class=n>message</span><span class=p>,</span>
<span class=linenos data-linenos="264 "></span>            <span class=n>cli</span><span class=p>)</span>
<span class=linenos data-linenos="265 "></span>
<span class=linenos data-linenos="266 "></span>    <span class=c1># Wait for responses</span>
<span class=linenos data-linenos="267 "></span>    <span class=k>for</span> <span class=n>resp</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_reqs</span><span class=o>.</span><span class=n>get_responses</span><span class=p>(</span><span class=n>look_for_commands</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;training-plan-status&#39;</span><span class=p>],</span> <span class=n>only_successful</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<span class=linenos data-linenos="268 "></span>        <span class=n>responses</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>resp</span><span class=p>)</span>
<span class=linenos data-linenos="269 "></span>        <span class=n>replied_nodes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>resp</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;node_id&#39;</span><span class=p>))</span>
<span class=linenos data-linenos="270 "></span>
<span class=linenos data-linenos="271 "></span>        <span class=k>if</span> <span class=n>resp</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;success&#39;</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>True</span><span class=p>:</span>
<span class=linenos data-linenos="272 "></span>            <span class=k>if</span> <span class=n>resp</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;approval_obligation&#39;</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>True</span><span class=p>:</span>
<span class=linenos data-linenos="273 "></span>                <span class=k>if</span> <span class=n>resp</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>)</span> <span class=o>==</span> <span class=n>TrainingPlanApprovalStatus</span><span class=o>.</span><span class=n>APPROVED</span><span class=o>.</span><span class=n>value</span><span class=p>:</span>
<span class=linenos data-linenos="274 "></span>                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Training plan has been approved by the node: </span><span class=si>{</span><span class=n>resp</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;node_id&quot;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="275 "></span>                <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="276 "></span>                    <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Training plan has NOT been approved by the node: </span><span class=si>{</span><span class=n>resp</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;node_id&quot;</span><span class=p>)</span><span class=si>}</span><span class=s1>.&#39;</span> <span class=o>+</span>
<span class=linenos data-linenos="277 "></span>                                   <span class=sa>f</span><span class=s1>&#39;Training plan status : </span><span class=si>{</span><span class=n>resp</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;status&quot;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="278 "></span>            <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="279 "></span>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Training plan approval is not required by the node: </span><span class=si>{</span><span class=n>resp</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;node_id&quot;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="280 "></span>        <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="281 "></span>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Node : </span><span class=si>{</span><span class=n>resp</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;node_id&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2> : </span><span class=si>{</span><span class=n>resp</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;msg&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="282 "></span>
<span class=linenos data-linenos="283 "></span>    <span class=c1># Get the nodes that haven&#39;t replied training-plan-status request</span>
<span class=linenos data-linenos="284 "></span>    <span class=n>non_replied_nodes</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>node_ids</span><span class=p>)</span> <span class=o>-</span> <span class=nb>set</span><span class=p>(</span><span class=n>replied_nodes</span><span class=p>))</span>
<span class=linenos data-linenos="285 "></span>    <span class=k>if</span> <span class=n>non_replied_nodes</span><span class=p>:</span>
<span class=linenos data-linenos="286 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Request for checking training plan status hasn&#39;t been replied </span><span class=se>\</span>
<span class=linenos data-linenos="287 "></span><span class=s2>                         by the nodes: </span><span class=si>{</span><span class=n>non_replied_nodes</span><span class=si>}</span><span class=s2>. You might get error </span><span class=se>\</span>
<span class=linenos data-linenos="288 "></span><span class=s2>                             while running your experiment. &quot;</span><span class=p>)</span>
<span class=linenos data-linenos="289 "></span>
<span class=linenos data-linenos="290 "></span>    <span class=k>return</span> <span class=n>responses</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.job.Job.load_state class="doc doc-heading function"> <div class=highlight><pre><span></span><code><span class=n>load_state</span><span class=p>(</span><span class=n>saved_state</span><span class=p>)</span>
</code></pre></div> </h5> <div class="doc doc-contents "> <p>Load breakpoints state for a Job from a saved state</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>saved_state</code></td> <td> <code><!--typing.Dict[str, typing.Any]--><!--typing.Dict--><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a><!---->[<!--str, typing.Any--><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a><!---->, <!--typing.Any--><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a><!---->]</code> </td> <td><p>breakpoint content</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class="quote source-code"> <summary>Source code in <code>fedbiomed/researcher/job.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="607 "></span><span class=k>def</span> <span class=nf>load_state</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>saved_state</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="608 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Load breakpoints state for a Job from a saved state</span>
<span class=linenos data-linenos="609 "></span>
<span class=linenos data-linenos="610 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="611 "></span><span class=sd>        saved_state: breakpoint content</span>
<span class=linenos data-linenos="612 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="613 "></span>    <span class=c1># Reload the job and researched ids.</span>
<span class=linenos data-linenos="614 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_id</span> <span class=o>=</span> <span class=n>saved_state</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;job_id&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="615 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_researcher_id</span> <span class=o>=</span> <span class=n>saved_state</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;researcher_id&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="616 "></span>    <span class=c1># Upload the latest model parameters. This records the filename and url.</span>
<span class=linenos data-linenos="617 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>update_parameters</span><span class=p>(</span><span class=n>filename</span><span class=o>=</span><span class=n>saved_state</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;model_params_path&quot;</span><span class=p>))</span>
<span class=linenos data-linenos="618 "></span>    <span class=c1># Reloadthe latest training replies.</span>
<span class=linenos data-linenos="619 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_training_replies</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_load_training_replies</span><span class=p>(</span>
<span class=linenos data-linenos="620 "></span>        <span class=n>saved_state</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;training_replies&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="621 "></span>    <span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.job.Job.save_state class="doc doc-heading function"> <div class=highlight><pre><span></span><code><span class=n>save_state</span><span class=p>(</span><span class=n>breakpoint_path</span><span class=p>)</span>
</code></pre></div> </h5> <div class="doc doc-contents "> <p>Creates current state of the job to be included in a breakpoint.</p> <p>Includes creating links to files included in the job state.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>breakpoint_path</code></td> <td> <code><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td><p>path to the existing breakpoint directory</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><!--dict--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></code> </td> <td><p>Job's current state for breakpoint</p></td> </tr> </tbody> </table> <details class="quote source-code"> <summary>Source code in <code>fedbiomed/researcher/job.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="572 "></span><span class=k>def</span> <span class=nf>save_state</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>breakpoint_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
<span class=linenos data-linenos="573 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Creates current state of the job to be included in a breakpoint.</span>
<span class=linenos data-linenos="574 "></span>
<span class=linenos data-linenos="575 "></span><span class=sd>    Includes creating links to files included in the job state.</span>
<span class=linenos data-linenos="576 "></span>
<span class=linenos data-linenos="577 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="578 "></span><span class=sd>        breakpoint_path: path to the existing breakpoint directory</span>
<span class=linenos data-linenos="579 "></span>
<span class=linenos data-linenos="580 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="581 "></span><span class=sd>        Job&#39;s current state for breakpoint</span>
<span class=linenos data-linenos="582 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="583 "></span>
<span class=linenos data-linenos="584 "></span>    <span class=c1># Note: some state is passed to __init__() thus is not managed</span>
<span class=linenos data-linenos="585 "></span>    <span class=c1># as job state but as experiment state in current version</span>
<span class=linenos data-linenos="586 "></span>    <span class=n>state</span> <span class=o>=</span> <span class=p>{</span>
<span class=linenos data-linenos="587 "></span>        <span class=s1>&#39;researcher_id&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_researcher_id</span><span class=p>,</span>
<span class=linenos data-linenos="588 "></span>        <span class=s1>&#39;job_id&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_id</span><span class=p>,</span>
<span class=linenos data-linenos="589 "></span>        <span class=s1>&#39;model_params_path&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model_params_file</span><span class=p>,</span>
<span class=linenos data-linenos="590 "></span>        <span class=s1>&#39;training_replies&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_save_training_replies</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_training_replies</span><span class=p>)</span>
<span class=linenos data-linenos="591 "></span>    <span class=p>}</span>
<span class=linenos data-linenos="592 "></span>
<span class=linenos data-linenos="593 "></span>    <span class=n>state</span><span class=p>[</span><span class=s1>&#39;model_params_path&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>create_unique_link</span><span class=p>(</span>
<span class=linenos data-linenos="594 "></span>        <span class=n>breakpoint_path</span><span class=p>,</span> <span class=s1>&#39;aggregated_params_current&#39;</span><span class=p>,</span> <span class=s1>&#39;.mpk&#39;</span><span class=p>,</span>
<span class=linenos data-linenos="595 "></span>        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=s1>&#39;..&#39;</span><span class=p>,</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=s2>&quot;model_params_path&quot;</span><span class=p>]))</span>
<span class=linenos data-linenos="596 "></span>    <span class=p>)</span>
<span class=linenos data-linenos="597 "></span>
<span class=linenos data-linenos="598 "></span>    <span class=k>for</span> <span class=n>round_replies</span> <span class=ow>in</span> <span class=n>state</span><span class=p>[</span><span class=s1>&#39;training_replies&#39;</span><span class=p>]:</span>
<span class=linenos data-linenos="599 "></span>        <span class=k>for</span> <span class=n>response</span> <span class=ow>in</span> <span class=n>round_replies</span><span class=p>:</span>
<span class=linenos data-linenos="600 "></span>            <span class=n>node_params_path</span> <span class=o>=</span> <span class=n>create_unique_file_link</span><span class=p>(</span>
<span class=linenos data-linenos="601 "></span>                <span class=n>breakpoint_path</span><span class=p>,</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;params_path&#39;</span><span class=p>]</span>
<span class=linenos data-linenos="602 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="603 "></span>            <span class=n>response</span><span class=p>[</span><span class=s1>&#39;params_path&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>node_params_path</span>
<span class=linenos data-linenos="604 "></span>
<span class=linenos data-linenos="605 "></span>    <span class=k>return</span> <span class=n>state</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.job.Job.start_nodes_training_round class="doc doc-heading function"> <div class=highlight><pre><span></span><code><span class=n>start_nodes_training_round</span><span class=p>(</span><span class=n>round_</span><span class=p>,</span> <span class=n>aggregator_args_thr_msg</span><span class=p>,</span> <span class=n>aggregator_args_thr_files</span><span class=p>,</span> <span class=n>secagg_arguments</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>do_training</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div> </h5> <div class="doc doc-contents "> <p>Sends training request to nodes and waits for the responses</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>round_</code></td> <td> <code><!--int--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </td> <td><p>current number of round the algorithm is performing (a round is considered to be all the training steps of a federated model between 2 aggregations).</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>aggregator_args_thr_msg</code></td> <td> <code><!--typing.Dict[str, typing.Dict[str, typing.Any]]--><!--typing.Dict--><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a><!---->[<!--str, typing.Dict[str, typing.Any]--><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a><!---->, <!--typing.Dict[str, typing.Any]--><!--typing.Dict--><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a><!---->[<!--str, typing.Any--><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a><!---->, <!--typing.Any--><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a><!---->]<!---->]</code> </td> <td><p>dictionary containing some metadata about the aggregation strategy, useful to transfer some data when it's required by am aggregator. First key should be the node_id, and sub-dictionary sould be parameters to be sent through MQTT messaging system</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>aggregator_args_thr_files</code></td> <td> <code><!--typing.Dict[str, typing.Dict[str, typing.Any]]--><!--typing.Dict--><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a><!---->[<!--str, typing.Dict[str, typing.Any]--><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a><!---->, <!--typing.Dict[str, typing.Any]--><!--typing.Dict--><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a><!---->[<!--str, typing.Any--><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a><!---->, <!--typing.Any--><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a><!---->]<!---->]</code> </td> <td><p>dictionary containing metadata about aggregation strategy, to be transferred via the Repository's HTTP API, as opposed to the mqtt system. Format is the same as aggregator_args_thr_msg .</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>secagg_arguments</code></td> <td> <code><!--typing.Union[typing.Dict, None]--><!--typing.Union--><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a><!---->[<!--typing.Dict, None--><!--typing.Dict--><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a><!---->, <!---->None<!---->]</code> </td> <td><p>Secure aggregation ServerKey context id</p></td> <td> <code><!---->None</code> </td> </tr> <tr> <td><code>do_training</code></td> <td> <code><!--bool--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </td> <td><p>if False, skip training in this round (do only validation). Defaults to True.</p></td> <td> <code><!---->True</code> </td> </tr> </tbody> </table> <details class="quote source-code"> <summary>Source code in <code>fedbiomed/researcher/job.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="347 "></span><span class=k>def</span> <span class=nf>start_nodes_training_round</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="348 "></span>                               <span class=n>round_</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
<span class=linenos data-linenos="349 "></span>                               <span class=n>aggregator_args_thr_msg</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]],</span>
<span class=linenos data-linenos="350 "></span>                               <span class=n>aggregator_args_thr_files</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]],</span>
<span class=linenos data-linenos="351 "></span>                               <span class=n>secagg_arguments</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="352 "></span>                               <span class=n>do_training</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>):</span>
<span class=linenos data-linenos="353 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot; Sends training request to nodes and waits for the responses</span>
<span class=linenos data-linenos="354 "></span>
<span class=linenos data-linenos="355 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="356 "></span><span class=sd>        round_: current number of round the algorithm is performing (a round is considered to be all the</span>
<span class=linenos data-linenos="357 "></span><span class=sd>            training steps of a federated model between 2 aggregations).</span>
<span class=linenos data-linenos="358 "></span><span class=sd>        aggregator_args_thr_msg: dictionary containing some metadata about the aggregation</span>
<span class=linenos data-linenos="359 "></span><span class=sd>            strategy, useful to transfer some data when it&#39;s required by am aggregator. First key should be the</span>
<span class=linenos data-linenos="360 "></span><span class=sd>            node_id, and sub-dictionary sould be parameters to be sent through MQTT messaging system</span>
<span class=linenos data-linenos="361 "></span><span class=sd>        aggregator_args_thr_files: dictionary containing metadata about aggregation strategy, to be transferred</span>
<span class=linenos data-linenos="362 "></span><span class=sd>            via the Repository&#39;s HTTP API, as opposed to the mqtt system. Format is the same as</span>
<span class=linenos data-linenos="363 "></span><span class=sd>            aggregator_args_thr_msg .</span>
<span class=linenos data-linenos="364 "></span><span class=sd>        secagg_arguments: Secure aggregation ServerKey context id</span>
<span class=linenos data-linenos="365 "></span><span class=sd>        do_training: if False, skip training in this round (do only validation). Defaults to True.</span>
<span class=linenos data-linenos="366 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="367 "></span>
<span class=linenos data-linenos="368 "></span>    <span class=c1># Assign empty dict to secagg arguments if it is None</span>
<span class=linenos data-linenos="369 "></span>    <span class=k>if</span> <span class=n>secagg_arguments</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="370 "></span>        <span class=n>secagg_arguments</span> <span class=o>=</span> <span class=p>{}</span>
<span class=linenos data-linenos="371 "></span>
<span class=linenos data-linenos="372 "></span>    <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;researcher_id&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_researcher_id</span><span class=p>,</span>
<span class=linenos data-linenos="373 "></span>               <span class=s1>&#39;job_id&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_id</span><span class=p>,</span>
<span class=linenos data-linenos="374 "></span>               <span class=s1>&#39;training_args&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span><span class=o>.</span><span class=n>dict</span><span class=p>(),</span>
<span class=linenos data-linenos="375 "></span>               <span class=s1>&#39;training&#39;</span><span class=p>:</span> <span class=n>do_training</span><span class=p>,</span>
<span class=linenos data-linenos="376 "></span>               <span class=s1>&#39;model_args&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_model_args</span><span class=p>,</span>
<span class=linenos data-linenos="377 "></span>               <span class=s1>&#39;round&#39;</span><span class=p>:</span> <span class=n>round_</span><span class=p>,</span>
<span class=linenos data-linenos="378 "></span>               <span class=s1>&#39;secagg_servkey_id&#39;</span><span class=p>:</span> <span class=n>secagg_arguments</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;secagg_servkey_id&#39;</span><span class=p>),</span>
<span class=linenos data-linenos="379 "></span>               <span class=s1>&#39;secagg_biprime_id&#39;</span><span class=p>:</span> <span class=n>secagg_arguments</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;secagg_biprime_id&#39;</span><span class=p>),</span>
<span class=linenos data-linenos="380 "></span>               <span class=s1>&#39;secagg_random&#39;</span><span class=p>:</span> <span class=n>secagg_arguments</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;secagg_random&#39;</span><span class=p>),</span>
<span class=linenos data-linenos="381 "></span>               <span class=s1>&#39;secagg_clipping_range&#39;</span><span class=p>:</span> <span class=n>secagg_arguments</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;secagg_clipping_range&#39;</span><span class=p>),</span>
<span class=linenos data-linenos="382 "></span>               <span class=s1>&#39;command&#39;</span><span class=p>:</span> <span class=s1>&#39;train&#39;</span><span class=p>,</span>
<span class=linenos data-linenos="383 "></span>               <span class=s1>&#39;aggregator_args&#39;</span><span class=p>:</span> <span class=p>{}}</span>
<span class=linenos data-linenos="384 "></span>
<span class=linenos data-linenos="385 "></span>    <span class=n>msg</span> <span class=o>=</span> <span class=p>{</span><span class=o>**</span><span class=n>headers</span><span class=p>,</span> <span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>_repository_args</span><span class=p>}</span>
<span class=linenos data-linenos="386 "></span>    <span class=n>time_start</span> <span class=o>=</span> <span class=p>{}</span>
<span class=linenos data-linenos="387 "></span>
<span class=linenos data-linenos="388 "></span>    <span class=c1># pass heavy aggregator params through file exchange system</span>
<span class=linenos data-linenos="389 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>upload_aggregator_args</span><span class=p>(</span><span class=n>aggregator_args_thr_msg</span><span class=p>,</span> <span class=n>aggregator_args_thr_files</span><span class=p>)</span>
<span class=linenos data-linenos="390 "></span>
<span class=linenos data-linenos="391 "></span>    <span class=k>for</span> <span class=n>cli</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_nodes</span><span class=p>:</span>
<span class=linenos data-linenos="392 "></span>        <span class=n>msg</span><span class=p>[</span><span class=s1>&#39;dataset_id&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_data</span><span class=o>.</span><span class=n>data</span><span class=p>()[</span><span class=n>cli</span><span class=p>][</span><span class=s1>&#39;dataset_id&#39;</span><span class=p>]</span>
<span class=linenos data-linenos="393 "></span>
<span class=linenos data-linenos="394 "></span>        <span class=k>if</span> <span class=n>aggregator_args_thr_msg</span><span class=p>:</span>
<span class=linenos data-linenos="395 "></span>            <span class=c1># add aggregator parameters to message header</span>
<span class=linenos data-linenos="396 "></span>            <span class=n>msg</span><span class=p>[</span><span class=s1>&#39;aggregator_args&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>aggregator_args_thr_msg</span><span class=p>[</span><span class=n>cli</span><span class=p>]</span>
<span class=linenos data-linenos="397 "></span>
<span class=linenos data-linenos="398 "></span>        <span class=k>if</span> <span class=ow>not</span> <span class=n>do_training</span><span class=p>:</span>
<span class=linenos data-linenos="399 "></span>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=se>\033</span><span class=s1>[1mSending request</span><span class=se>\033</span><span class=s1>[0m </span><span class=se>\n</span><span class=s1>&#39;</span>
<span class=linenos data-linenos="400 "></span>                        <span class=sa>f</span><span class=s1>&#39;</span><span class=se>\t\t\t\t\t\033</span><span class=s1>[1m To</span><span class=se>\033</span><span class=s1>[0m: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>cli</span><span class=p>)</span><span class=si>}</span><span class=s1> </span><span class=se>\n</span><span class=s1>&#39;</span>
<span class=linenos data-linenos="401 "></span>                        <span class=sa>f</span><span class=s1>&#39;</span><span class=se>\t\t\t\t\t\033</span><span class=s1>[1m Request: </span><span class=se>\033</span><span class=s1>[0m:Perform final validation on &#39;</span>
<span class=linenos data-linenos="402 "></span>                        <span class=sa>f</span><span class=s1>&#39;aggregated parameters </span><span class=se>\n</span><span class=s1> </span><span class=si>{</span><span class=mi>5</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=s2>&quot;-------------&quot;</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="403 "></span>        <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="404 "></span>            <span class=n>msg_print</span> <span class=o>=</span> <span class=p>{</span><span class=n>key</span><span class=p>:</span> <span class=n>value</span> <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>msg</span><span class=o>.</span><span class=n>items</span><span class=p>()</span>
<span class=linenos data-linenos="405 "></span>                         <span class=k>if</span> <span class=n>key</span> <span class=o>!=</span> <span class=s1>&#39;aggregator_args&#39;</span> <span class=ow>and</span> <span class=n>logger</span><span class=o>.</span><span class=n>level</span> <span class=o>!=</span> <span class=s2>&quot;DEBUG&quot;</span> <span class=p>}</span>
<span class=linenos data-linenos="406 "></span>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=se>\033</span><span class=s1>[1mSending request</span><span class=se>\033</span><span class=s1>[0m </span><span class=se>\n</span><span class=s1>&#39;</span>
<span class=linenos data-linenos="407 "></span>                        <span class=sa>f</span><span class=s1>&#39;</span><span class=se>\t\t\t\t\t\033</span><span class=s1>[1m To</span><span class=se>\033</span><span class=s1>[0m: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>cli</span><span class=p>)</span><span class=si>}</span><span class=s1> </span><span class=se>\n</span><span class=s1>&#39;</span>
<span class=linenos data-linenos="408 "></span>                        <span class=sa>f</span><span class=s1>&#39;</span><span class=se>\t\t\t\t\t\033</span><span class=s1>[1m Request: </span><span class=se>\033</span><span class=s1>[0m: Perform training with the arguments: &#39;</span>
<span class=linenos data-linenos="409 "></span>                        <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>msg_print</span><span class=p>)</span><span class=si>}</span><span class=s1> &#39;</span>
<span class=linenos data-linenos="410 "></span>                        <span class=sa>f</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1> </span><span class=si>{</span><span class=mi>5</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=s2>&quot;-------------&quot;</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="411 "></span>
<span class=linenos data-linenos="412 "></span>        <span class=n>time_start</span><span class=p>[</span><span class=n>cli</span><span class=p>]</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span>
<span class=linenos data-linenos="413 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_reqs</span><span class=o>.</span><span class=n>send_message</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span> <span class=n>cli</span><span class=p>)</span>  <span class=c1># send request to node</span>
<span class=linenos data-linenos="414 "></span>
<span class=linenos data-linenos="415 "></span>    <span class=c1># Recollect models trained</span>
<span class=linenos data-linenos="416 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_training_replies</span><span class=p>[</span><span class=n>round_</span><span class=p>]</span> <span class=o>=</span> <span class=n>Responses</span><span class=p>([])</span>
<span class=linenos data-linenos="417 "></span>    <span class=k>while</span> <span class=bp>self</span><span class=o>.</span><span class=n>waiting_for_nodes</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_training_replies</span><span class=p>[</span><span class=n>round_</span><span class=p>]):</span>
<span class=linenos data-linenos="418 "></span>        <span class=c1># collect nodes responses from researcher request &#39;train&#39;</span>
<span class=linenos data-linenos="419 "></span>        <span class=c1># (wait for all nodes with a ` while true` loop)</span>
<span class=linenos data-linenos="420 "></span>        <span class=c1># models_done = self._reqs.get_responses(look_for_commands=[&#39;train&#39;])</span>
<span class=linenos data-linenos="421 "></span>        <span class=n>models_done</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_reqs</span><span class=o>.</span><span class=n>get_responses</span><span class=p>(</span><span class=n>look_for_commands</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;train&#39;</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>],</span> <span class=n>only_successful</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<span class=linenos data-linenos="422 "></span>        <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>models_done</span><span class=o>.</span><span class=n>data</span><span class=p>():</span>  <span class=c1># retrieve all models</span>
<span class=linenos data-linenos="423 "></span>            <span class=c1># (there should have as many models done as nodes)</span>
<span class=linenos data-linenos="424 "></span>
<span class=linenos data-linenos="425 "></span>            <span class=c1># manage error messages during training</span>
<span class=linenos data-linenos="426 "></span>            <span class=k>if</span> <span class=n>m</span><span class=p>[</span><span class=s1>&#39;command&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;error&#39;</span><span class=p>:</span>
<span class=linenos data-linenos="427 "></span>                <span class=k>if</span> <span class=n>m</span><span class=p>[</span><span class=s1>&#39;extra_msg&#39;</span><span class=p>]:</span>
<span class=linenos data-linenos="428 "></span>                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error message received during training: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>m</span><span class=p>[</span><span class=s1>&#39;errnum&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>value</span><span class=p>)</span><span class=si>}</span><span class=s2> &quot;</span>
<span class=linenos data-linenos="429 "></span>                                <span class=sa>f</span><span class=s2>&quot;- </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>m</span><span class=p>[</span><span class=s1>&#39;extra_msg&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="430 "></span>                <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="431 "></span>                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error message received during training: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>m</span><span class=p>[</span><span class=s1>&#39;errnum&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>value</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="432 "></span>
<span class=linenos data-linenos="433 "></span>                <span class=n>faulty_node</span> <span class=o>=</span> <span class=n>m</span><span class=p>[</span><span class=s1>&#39;node_id&#39;</span><span class=p>]</span>  <span class=c1># remove the faulty node from the list</span>
<span class=linenos data-linenos="434 "></span>
<span class=linenos data-linenos="435 "></span>                <span class=k>if</span> <span class=n>faulty_node</span> <span class=ow>not</span> <span class=ow>in</span> <span class=nb>list</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_nodes</span><span class=p>):</span>
<span class=linenos data-linenos="436 "></span>                    <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error message from </span><span class=si>{</span><span class=n>faulty_node</span><span class=si>}</span><span class=s2> ignored, since this node is not part ot &quot;</span>
<span class=linenos data-linenos="437 "></span>                                   <span class=sa>f</span><span class=s2>&quot;the training any mode&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="438 "></span>                    <span class=k>continue</span>
<span class=linenos data-linenos="439 "></span>
<span class=linenos data-linenos="440 "></span>                <span class=bp>self</span><span class=o>.</span><span class=n>_nodes</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>faulty_node</span><span class=p>)</span>
<span class=linenos data-linenos="441 "></span>                <span class=k>continue</span>
<span class=linenos data-linenos="442 "></span>
<span class=linenos data-linenos="443 "></span>            <span class=c1># only consider replies for our request</span>
<span class=linenos data-linenos="444 "></span>            <span class=k>if</span> <span class=n>m</span><span class=p>[</span><span class=s1>&#39;researcher_id&#39;</span><span class=p>]</span> <span class=o>!=</span> <span class=n>environ</span><span class=p>[</span><span class=s1>&#39;RESEARCHER_ID&#39;</span><span class=p>]</span> <span class=ow>or</span> \
<span class=linenos data-linenos="445 "></span>                    <span class=n>m</span><span class=p>[</span><span class=s1>&#39;job_id&#39;</span><span class=p>]</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_id</span> <span class=ow>or</span> <span class=n>m</span><span class=p>[</span><span class=s1>&#39;node_id&#39;</span><span class=p>]</span> <span class=ow>not</span> <span class=ow>in</span> <span class=nb>list</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_nodes</span><span class=p>):</span>
<span class=linenos data-linenos="446 "></span>                <span class=k>continue</span>
<span class=linenos data-linenos="447 "></span>
<span class=linenos data-linenos="448 "></span>            <span class=c1># manage training failure for this job</span>
<span class=linenos data-linenos="449 "></span>            <span class=k>if</span> <span class=ow>not</span> <span class=n>m</span><span class=p>[</span><span class=s1>&#39;success&#39;</span><span class=p>]:</span>
<span class=linenos data-linenos="450 "></span>                <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Training failed for node </span><span class=si>{</span><span class=n>m</span><span class=p>[</span><span class=s1>&#39;node_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>m</span><span class=p>[</span><span class=s1>&#39;msg&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="451 "></span>                <span class=bp>self</span><span class=o>.</span><span class=n>_nodes</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>m</span><span class=p>[</span><span class=s1>&#39;node_id&#39;</span><span class=p>])</span>  <span class=c1># remove the faulty node from the list</span>
<span class=linenos data-linenos="452 "></span>                <span class=k>continue</span>
<span class=linenos data-linenos="453 "></span>
<span class=linenos data-linenos="454 "></span>            <span class=n>rtime_total</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span> <span class=o>-</span> <span class=n>time_start</span><span class=p>[</span><span class=n>m</span><span class=p>[</span><span class=s1>&#39;node_id&#39;</span><span class=p>]]</span>
<span class=linenos data-linenos="455 "></span>
<span class=linenos data-linenos="456 "></span>            <span class=k>if</span> <span class=n>do_training</span><span class=p>:</span>
<span class=linenos data-linenos="457 "></span>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Downloading model params after training on </span><span class=si>{</span><span class=n>m</span><span class=p>[</span><span class=s1>&#39;node_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> - from </span><span class=si>{</span><span class=n>m</span><span class=p>[</span><span class=s1>&#39;params_url&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="458 "></span>                <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="459 "></span>                    <span class=n>_</span><span class=p>,</span> <span class=n>params_path</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>repo</span><span class=o>.</span><span class=n>download_file</span><span class=p>(</span><span class=n>m</span><span class=p>[</span><span class=s2>&quot;params_url&quot;</span><span class=p>],</span> <span class=sa>f</span><span class=s2>&quot;node_params_</span><span class=si>{</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=si>}</span><span class=s2>.mpk&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="460 "></span>                <span class=k>except</span> <span class=n>FedbiomedRepositoryError</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
<span class=linenos data-linenos="461 "></span>                    <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Cannot download model parameter from node </span><span class=si>{</span><span class=n>m</span><span class=p>[</span><span class=s1>&#39;node_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>, probably because Node&quot;</span>
<span class=linenos data-linenos="462 "></span>                                 <span class=sa>f</span><span class=s2>&quot; stops working (details: </span><span class=si>{</span><span class=n>err</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="463 "></span>                    <span class=k>return</span>
<span class=linenos data-linenos="464 "></span>                <span class=n>results</span> <span class=o>=</span> <span class=n>Serializer</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>params_path</span><span class=p>)</span>
<span class=linenos data-linenos="465 "></span>                <span class=n>params</span> <span class=o>=</span> <span class=n>results</span><span class=p>[</span><span class=s2>&quot;model_weights&quot;</span><span class=p>]</span>
<span class=linenos data-linenos="466 "></span>                <span class=n>optimizer_args</span> <span class=o>=</span> <span class=n>results</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;optimizer_args&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="467 "></span>                <span class=n>encryption_factor</span> <span class=o>=</span> <span class=n>results</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;encryption_factor&#39;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<span class=linenos data-linenos="468 "></span>            <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="469 "></span>                <span class=n>params_path</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="470 "></span>                <span class=n>params</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="471 "></span>                <span class=n>optimizer_args</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="472 "></span>                <span class=n>encryption_factor</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="473 "></span>
<span class=linenos data-linenos="474 "></span>            <span class=c1># TODO: could choose completely different name/structure for</span>
<span class=linenos data-linenos="475 "></span>            <span class=n>timing</span> <span class=o>=</span> <span class=n>m</span><span class=p>[</span><span class=s1>&#39;timing&#39;</span><span class=p>]</span>
<span class=linenos data-linenos="476 "></span>            <span class=n>timing</span><span class=p>[</span><span class=s1>&#39;rtime_total&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>rtime_total</span>
<span class=linenos data-linenos="477 "></span>
<span class=linenos data-linenos="478 "></span>            <span class=n>r</span> <span class=o>=</span> <span class=n>Responses</span><span class=p>({</span><span class=s1>&#39;success&#39;</span><span class=p>:</span> <span class=n>m</span><span class=p>[</span><span class=s1>&#39;success&#39;</span><span class=p>],</span>
<span class=linenos data-linenos="479 "></span>                           <span class=s1>&#39;msg&#39;</span><span class=p>:</span> <span class=n>m</span><span class=p>[</span><span class=s1>&#39;msg&#39;</span><span class=p>],</span>
<span class=linenos data-linenos="480 "></span>                           <span class=s1>&#39;dataset_id&#39;</span><span class=p>:</span> <span class=n>m</span><span class=p>[</span><span class=s1>&#39;dataset_id&#39;</span><span class=p>],</span>
<span class=linenos data-linenos="481 "></span>                           <span class=s1>&#39;node_id&#39;</span><span class=p>:</span> <span class=n>m</span><span class=p>[</span><span class=s1>&#39;node_id&#39;</span><span class=p>],</span>
<span class=linenos data-linenos="482 "></span>                           <span class=s1>&#39;params_path&#39;</span><span class=p>:</span> <span class=n>params_path</span><span class=p>,</span>
<span class=linenos data-linenos="483 "></span>                           <span class=s1>&#39;params&#39;</span><span class=p>:</span> <span class=n>params</span><span class=p>,</span>
<span class=linenos data-linenos="484 "></span>                           <span class=s1>&#39;optimizer_args&#39;</span><span class=p>:</span> <span class=n>optimizer_args</span><span class=p>,</span>
<span class=linenos data-linenos="485 "></span>                           <span class=s1>&#39;sample_size&#39;</span><span class=p>:</span> <span class=n>m</span><span class=p>[</span><span class=s2>&quot;sample_size&quot;</span><span class=p>],</span>
<span class=linenos data-linenos="486 "></span>                           <span class=s1>&#39;encryption_factor&#39;</span><span class=p>:</span> <span class=n>encryption_factor</span><span class=p>,</span>
<span class=linenos data-linenos="487 "></span>                           <span class=s1>&#39;timing&#39;</span><span class=p>:</span> <span class=n>timing</span><span class=p>})</span>
<span class=linenos data-linenos="488 "></span>
<span class=linenos data-linenos="489 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_training_replies</span><span class=p>[</span><span class=n>round_</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>r</span><span class=p>)</span>
<span class=linenos data-linenos="490 "></span>
<span class=linenos data-linenos="491 "></span>    <span class=c1># return the list of nodes which answered because nodes in error have been removed</span>
<span class=linenos data-linenos="492 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_nodes</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.job.Job.update_parameters class="doc doc-heading function"> <div class=highlight><pre><span></span><code><span class=n>update_parameters</span><span class=p>(</span><span class=n>params</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>filename</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</code></pre></div> </h5> <div class="doc doc-contents "> <p>Save and upload global model parameters, optionally after updating them.</p> <p>This method is designed to save and upload the parameters of the wrapped training plan instance. It may also be used to update these parameters prior to their upload, whether based on provided in-memory values or on a pre-exported dump file.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>params</code></td> <td> <code><!--typing.Optional[typing.Dict[str, typing.Any]]--><!--typing.Optional--><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a><!---->[<!--typing.Dict[str, typing.Any]--><!--typing.Dict--><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a><!---->[<!--str, typing.Any--><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a><!---->, <!--typing.Any--><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a><!---->]<!---->]</code> </td> <td><p>data structure containing the new version of the aggregated parameters for this job,</p></td> <td> <code><!---->None</code> </td> </tr> <tr> <td><code>filename</code></td> <td> <code><!--typing.Optional[str]--><!--typing.Optional--><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a><!---->[<!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a><!---->]</code> </td> <td><p>path to the file containing the new version of the aggregated parameters for this job,</p></td> <td> <code><!---->None</code> </td> </tr> <tr> <td><code>is_model_params</code></td> <td> </td> <td><p>whether params are models parameters or another value that must be sent</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>variable_name</code></td> <td> </td> <td><p>name the filename with variable_name. Defaults to 'aggregated_prams'.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>params</code></td> <td> <code><!--typing.Optional[typing.Dict[str, typing.Any]]--><!--typing.Optional--><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a><!---->[<!--typing.Dict[str, typing.Any]--><!--typing.Dict--><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a><!---->[<!--str, typing.Any--><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a><!---->, <!--typing.Any--><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a><!---->]<!---->]</code> </td> <td><p>Optional dict storing new aggregated parameters that are to be assigned to this job's training plan's model. If None, export and upload the current model parameters.</p></td> <td> <code><!---->None</code> </td> </tr> <tr> <td><code>filename</code></td> <td> <code><!--typing.Optional[str]--><!--typing.Optional--><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a><!---->[<!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a><!---->]</code> </td> <td><p>Optional path to a pre-existing file containing the aggregated parameters to load an upload. If <code>params</code> is not None, <code>filename</code> has to be None.</p></td> <td> <code><!---->None</code> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>filename</code></td> <td> <code><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td><p>path to the local parameters file</p></td> </tr> <tr> <td><code>url</code></td> <td> <code><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td><p>url at which the file was uploaded</p></td> </tr> </tbody> </table> <p><strong>Raises:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><!--ValueError--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code> </td> <td><p>if both <code>params</code> and <code>filename</code> are provoided: these parameters are mutually-exclusive.</p></td> </tr> </tbody> </table> <p>!!! info "Notes": * The path to the created and/or uploaded file is stored under the <code>_model_params_file</code> attribute, that is updated by this method. * The url of the uploaded file is stored under the <code>_repository_args["params_url"]</code> attribute, that is also updated by this method.</p> <p>!!! warning "Warning": * The <code>params</code> and <code>filename</code> parameters are mutually-exclusive.</p> <details class="quote source-code"> <summary>Source code in <code>fedbiomed/researcher/job.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="494 "></span><span class=k>def</span> <span class=nf>update_parameters</span><span class=p>(</span>
<span class=linenos data-linenos="495 "></span>    <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="496 "></span>    <span class=n>params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="497 "></span>    <span class=n>filename</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="498 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
<span class=linenos data-linenos="499 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Save and upload global model parameters, optionally after updating them.</span>
<span class=linenos data-linenos="500 "></span>
<span class=linenos data-linenos="501 "></span><span class=sd>    This method is designed to save and upload the parameters of the wrapped</span>
<span class=linenos data-linenos="502 "></span><span class=sd>    training plan instance. It may also be used to update these parameters</span>
<span class=linenos data-linenos="503 "></span><span class=sd>    prior to their upload, whether based on provided in-memory values or on</span>
<span class=linenos data-linenos="504 "></span><span class=sd>    a pre-exported dump file.</span>
<span class=linenos data-linenos="505 "></span>
<span class=linenos data-linenos="506 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="507 "></span><span class=sd>        params: data structure containing the new version of the aggregated parameters for this job,</span>
<span class=linenos data-linenos="508 "></span><span class=sd>        defaults to empty dictionary {}</span>
<span class=linenos data-linenos="509 "></span><span class=sd>        filename: path to the file containing the new version of the aggregated parameters for this job,</span>
<span class=linenos data-linenos="510 "></span><span class=sd>        defaults to None.</span>
<span class=linenos data-linenos="511 "></span><span class=sd>        is_model_params: whether params are models parameters or another value that must be sent</span>
<span class=linenos data-linenos="512 "></span><span class=sd>        through file exchange system. Defaults to True (argument are model parameters).</span>
<span class=linenos data-linenos="513 "></span><span class=sd>        variable_name:  name the filename with variable_name. Defaults to &#39;aggregated_prams&#39;.</span>
<span class=linenos data-linenos="514 "></span>
<span class=linenos data-linenos="515 "></span><span class=sd>        params: Optional dict storing new aggregated parameters that are to</span>
<span class=linenos data-linenos="516 "></span><span class=sd>            be assigned to this job&#39;s training plan&#39;s model.</span>
<span class=linenos data-linenos="517 "></span><span class=sd>            If None, export and upload the current model parameters.</span>
<span class=linenos data-linenos="518 "></span><span class=sd>        filename: Optional path to a pre-existing file containing the</span>
<span class=linenos data-linenos="519 "></span><span class=sd>            aggregated parameters to load an upload.</span>
<span class=linenos data-linenos="520 "></span><span class=sd>            If `params` is not None, `filename` has to be None.</span>
<span class=linenos data-linenos="521 "></span>
<span class=linenos data-linenos="522 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="523 "></span><span class=sd>        filename: path to the local parameters file</span>
<span class=linenos data-linenos="524 "></span><span class=sd>        url: url at which the file was uploaded</span>
<span class=linenos data-linenos="525 "></span>
<span class=linenos data-linenos="526 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="527 "></span><span class=sd>        ValueError: if both `params` and `filename` are provoided: these parameters are mutually-exclusive.</span>
<span class=linenos data-linenos="528 "></span>
<span class=linenos data-linenos="529 "></span><span class=sd>    !!! info &quot;Notes&quot;:</span>
<span class=linenos data-linenos="530 "></span><span class=sd>        * The path to the created and/or uploaded file is stored under the `_model_params_file` attribute,</span>
<span class=linenos data-linenos="531 "></span><span class=sd>          that is updated by this method.</span>
<span class=linenos data-linenos="532 "></span><span class=sd>        * The url of the uploaded file is stored under the `_repository_args[&quot;params_url&quot;]` attribute,</span>
<span class=linenos data-linenos="533 "></span><span class=sd>          that is also updated by this method.</span>
<span class=linenos data-linenos="534 "></span>
<span class=linenos data-linenos="535 "></span><span class=sd>    !!! warning &quot;Warning&quot;:</span>
<span class=linenos data-linenos="536 "></span><span class=sd>        * The `params` and `filename` parameters are mutually-exclusive.</span>
<span class=linenos data-linenos="537 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="538 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="539 "></span>        <span class=k>if</span> <span class=n>params</span> <span class=ow>and</span> <span class=n>filename</span><span class=p>:</span>
<span class=linenos data-linenos="540 "></span>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;&#39;update_parameters&#39; received both filename and params: only one may be used.&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="541 "></span>        <span class=c1># Case when uploading a pre-existing file: load the parameters.</span>
<span class=linenos data-linenos="542 "></span>        <span class=k>if</span> <span class=n>filename</span><span class=p>:</span>
<span class=linenos data-linenos="543 "></span>            <span class=n>params</span> <span class=o>=</span> <span class=n>Serializer</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>filename</span><span class=p>)[</span><span class=s2>&quot;model_weights&quot;</span><span class=p>]</span>
<span class=linenos data-linenos="544 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>set_model_params</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
<span class=linenos data-linenos="545 "></span>        <span class=c1># Case when exporting current parameters: create a local dump file.</span>
<span class=linenos data-linenos="546 "></span>        <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="547 "></span>            <span class=c1># Case when uploading the current parameters: gather them.</span>
<span class=linenos data-linenos="548 "></span>            <span class=k>if</span> <span class=n>params</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="549 "></span>                <span class=n>params</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>get_model_params</span><span class=p>()</span>
<span class=linenos data-linenos="550 "></span>            <span class=c1># Case when uploading a new set of parameters: assign them.</span>
<span class=linenos data-linenos="551 "></span>            <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="552 "></span>                <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>set_model_params</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
<span class=linenos data-linenos="553 "></span>            <span class=c1># At any rate, create a local dump file.</span>
<span class=linenos data-linenos="554 "></span>            <span class=n>filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_keep_files_dir</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;aggregated_params_</span><span class=si>{</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=si>}</span><span class=s2>.mpk&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="555 "></span>            <span class=n>params_dump</span> <span class=o>=</span> <span class=p>{</span>
<span class=linenos data-linenos="556 "></span>                <span class=s2>&quot;researcher_id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_researcher_id</span><span class=p>,</span>
<span class=linenos data-linenos="557 "></span>                <span class=s2>&quot;model_weights&quot;</span><span class=p>:</span> <span class=n>params</span><span class=p>,</span>
<span class=linenos data-linenos="558 "></span>            <span class=p>}</span>
<span class=linenos data-linenos="559 "></span>            <span class=n>Serializer</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>params_dump</span><span class=p>,</span> <span class=n>filename</span><span class=p>)</span>
<span class=linenos data-linenos="560 "></span>        <span class=c1># Upload the file and record its local and remote locations.</span>
<span class=linenos data-linenos="561 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_model_params_file</span> <span class=o>=</span> <span class=n>filename</span>
<span class=linenos data-linenos="562 "></span>        <span class=n>repo_response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>repo</span><span class=o>.</span><span class=n>upload_file</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
<span class=linenos data-linenos="563 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_repository_args</span><span class=p>[</span><span class=s2>&quot;params_url&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>url</span> <span class=o>=</span> <span class=n>repo_response</span><span class=p>[</span><span class=s2>&quot;file&quot;</span><span class=p>]</span>
<span class=linenos data-linenos="564 "></span>        <span class=c1># Return the local path and remote url to the file.</span>
<span class=linenos data-linenos="565 "></span>        <span class=k>return</span> <span class=n>filename</span><span class=p>,</span> <span class=n>url</span>
<span class=linenos data-linenos="566 "></span>    <span class=c1># Log exceptions and trigger a system exit if one is raised.</span>
<span class=linenos data-linenos="567 "></span>    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
<span class=linenos data-linenos="568 "></span>        <span class=n>exc</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>exc_info</span><span class=p>()</span>
<span class=linenos data-linenos="569 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&quot;&#39;Job.update_parameters&#39; failed with error: </span><span class=si>%s</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>exc</span><span class=p>)</span>
<span class=linenos data-linenos="570 "></span>        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.job.Job.upload_aggregator_args class="doc doc-heading function"> <div class=highlight><pre><span></span><code><span class=n>upload_aggregator_args</span><span class=p>(</span><span class=n>args_thr_msg</span><span class=p>,</span> <span class=n>args_thr_files</span><span class=p>)</span>
</code></pre></div> </h5> <div class="doc doc-contents "> <p>Uploads aggregator metadata to the Repository and updates the mqtt message accordingly.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>args_thr_msg</code></td> <td> <code><!--typing.Union[typing.Dict[str, typing.Dict[str, typing.Any]], dict]--><!--typing.Union--><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a><!---->[<!--typing.Dict[str, typing.Dict[str, typing.Any]], dict--><!--typing.Dict[str, typing.Dict[str, typing.Any]]--><!--typing.Dict--><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a><!---->[<!--str, typing.Dict[str, typing.Any]--><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a><!---->, <!--typing.Dict[str, typing.Any]--><!--typing.Dict--><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a><!---->[<!--str, typing.Any--><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a><!---->, <!--typing.Any--><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a><!---->]<!---->]<!---->, <!--dict--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a><!---->]</code> </td> <td><p>dictionary containing metadata about the aggregation strategy, useful to transfer some data when it's required by am aggregator. First key should be the node_id, and sub-dictionary should be parameters to be sent through MQTT messaging system. This dictionary may be modified by this function with additional metadata about other metadata transferred via the Repository.</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>args_thr_files</code></td> <td> <code><!--typing.Union[typing.Dict[str, typing.Dict[str, typing.Any]], dict]--><!--typing.Union--><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a><!---->[<!--typing.Dict[str, typing.Dict[str, typing.Any]], dict--><!--typing.Dict[str, typing.Dict[str, typing.Any]]--><!--typing.Dict--><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a><!---->[<!--str, typing.Dict[str, typing.Any]--><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a><!---->, <!--typing.Dict[str, typing.Any]--><!--typing.Dict--><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a><!---->[<!--str, typing.Any--><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a><!---->, <!--typing.Any--><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a><!---->]<!---->]<!---->, <!--dict--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a><!---->]</code> </td> <td><p>dictionary containing metadata about aggregation strategy, to be transferred via the Repository's HTTP API, as opposed to the mqtt system. Format is the same as aggregator_args_thr_msg .</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><!--typing.Dict[str, typing.Dict[str, typing.Any]]--><!--typing.Dict--><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a><!---->[<!--str, typing.Dict[str, typing.Any]--><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a><!---->, <!--typing.Dict[str, typing.Any]--><!--typing.Dict--><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a><!---->[<!--str, typing.Any--><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a><!---->, <!--typing.Any--><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a><!---->]<!---->]</code> </td> <td><p>The updated dictionary with metadata to be introduced in the mqtt message.</p></td> </tr> </tbody> </table> <details class="quote source-code"> <summary>Source code in <code>fedbiomed/researcher/job.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="311 "></span><span class=k>def</span> <span class=nf>upload_aggregator_args</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="312 "></span>                           <span class=n>args_thr_msg</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]],</span> <span class=nb>dict</span><span class=p>],</span>
<span class=linenos data-linenos="313 "></span>                           <span class=n>args_thr_files</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]],</span> <span class=nb>dict</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<span class=linenos data-linenos="314 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Uploads aggregator metadata to the Repository and updates the mqtt message accordingly.</span>
<span class=linenos data-linenos="315 "></span>
<span class=linenos data-linenos="316 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="317 "></span><span class=sd>        args_thr_msg: dictionary containing metadata about the aggregation</span>
<span class=linenos data-linenos="318 "></span><span class=sd>            strategy, useful to transfer some data when it&#39;s required by am aggregator. First key should be the</span>
<span class=linenos data-linenos="319 "></span><span class=sd>            node_id, and sub-dictionary should be parameters to be sent through MQTT messaging system. This</span>
<span class=linenos data-linenos="320 "></span><span class=sd>            dictionary may be modified by this function with additional metadata about other metadata</span>
<span class=linenos data-linenos="321 "></span><span class=sd>            transferred via the Repository.</span>
<span class=linenos data-linenos="322 "></span><span class=sd>        args_thr_files: dictionary containing metadata about aggregation strategy, to be transferred</span>
<span class=linenos data-linenos="323 "></span><span class=sd>            via the Repository&#39;s HTTP API, as opposed to the mqtt system. Format is the same as</span>
<span class=linenos data-linenos="324 "></span><span class=sd>            aggregator_args_thr_msg .</span>
<span class=linenos data-linenos="325 "></span>
<span class=linenos data-linenos="326 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="327 "></span><span class=sd>        The updated dictionary with metadata to be introduced in the mqtt message.</span>
<span class=linenos data-linenos="328 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="329 "></span>    <span class=k>for</span> <span class=n>node_id</span><span class=p>,</span> <span class=n>aggr_params</span> <span class=ow>in</span> <span class=n>args_thr_files</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<span class=linenos data-linenos="330 "></span>        <span class=k>for</span> <span class=n>arg_name</span><span class=p>,</span> <span class=n>aggr_param</span> <span class=ow>in</span> <span class=n>aggr_params</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<span class=linenos data-linenos="331 "></span>            <span class=k>if</span> <span class=n>arg_name</span> <span class=o>==</span> <span class=s1>&#39;aggregator_name&#39;</span><span class=p>:</span>
<span class=linenos data-linenos="332 "></span>                <span class=k>continue</span>
<span class=linenos data-linenos="333 "></span>            <span class=n>args_thr_msg</span><span class=p>[</span><span class=n>node_id</span><span class=p>][</span><span class=n>arg_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
<span class=linenos data-linenos="334 "></span>            <span class=n>args_thr_msg</span><span class=p>[</span><span class=n>node_id</span><span class=p>][</span><span class=n>arg_name</span><span class=p>][</span><span class=s1>&#39;arg_name&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>arg_name</span>  <span class=c1># name of the argument to look at</span>
<span class=linenos data-linenos="335 "></span>            <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="336 "></span>                <span class=n>filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_keep_files_dir</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>arg_name</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=si>}</span><span class=s2>.mpk&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="337 "></span>                <span class=n>Serializer</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>aggr_param</span><span class=p>,</span> <span class=n>filename</span><span class=p>)</span>
<span class=linenos data-linenos="338 "></span>                <span class=n>url</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>repo</span><span class=o>.</span><span class=n>upload_file</span><span class=p>(</span><span class=n>filename</span><span class=p>)[</span><span class=s2>&quot;file&quot;</span><span class=p>]</span>
<span class=linenos data-linenos="339 "></span>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
<span class=linenos data-linenos="340 "></span>                <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=s2>&quot;Failed to export </span><span class=si>%s</span><span class=s2> to local file and upload it: </span><span class=si>%s</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>arg_name</span><span class=p>,</span> <span class=n>exc</span><span class=p>)</span>
<span class=linenos data-linenos="341 "></span>                <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
<span class=linenos data-linenos="342 "></span>            <span class=n>args_thr_msg</span><span class=p>[</span><span class=n>node_id</span><span class=p>][</span><span class=n>arg_name</span><span class=p>][</span><span class=s1>&#39;filename&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>filename</span>  <span class=c1># path to the file with the parameters</span>
<span class=linenos data-linenos="343 "></span>            <span class=n>args_thr_msg</span><span class=p>[</span><span class=n>node_id</span><span class=p>][</span><span class=n>arg_name</span><span class=p>][</span><span class=s1>&#39;url&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>url</span>
<span class=linenos data-linenos="344 "></span>
<span class=linenos data-linenos="345 "></span>    <span class=k>return</span> <span class=n>args_thr_msg</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.job.Job.validate_minimal_arguments class="doc doc-heading function"> <div class=highlight><pre><span></span><code><span class=n>validate_minimal_arguments</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>fields</span><span class=p>)</span>
</code></pre></div> <span class="doc doc-properties"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h5> <div class="doc doc-contents "> <p>Validates a given dictionary by given mandatory fields.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>obj</code></td> <td> <code><!--dict--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></code> </td> <td><p>Object to be validated</p></td> <td> <em>required</em> </td> </tr> <tr> <td><code>fields</code></td> <td> <code><!--typing.Union[tuple, list]--><!--typing.Union--><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a><!---->[<!--tuple, list--><!--tuple--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a><!---->, <!--list--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a><!---->]</code> </td> <td><p>List of fields that should be present on the obj</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class="quote source-code"> <summary>Source code in <code>fedbiomed/researcher/job.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="181 "></span><span class=nd>@staticmethod</span>
<span class=linenos data-linenos="182 "></span><span class=k>def</span> <span class=nf>validate_minimal_arguments</span><span class=p>(</span><span class=n>obj</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span> <span class=n>fields</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>tuple</span><span class=p>,</span> <span class=nb>list</span><span class=p>]):</span>
<span class=linenos data-linenos="183 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot; Validates a given dictionary by given mandatory fields.</span>
<span class=linenos data-linenos="184 "></span>
<span class=linenos data-linenos="185 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="186 "></span><span class=sd>        obj: Object to be validated</span>
<span class=linenos data-linenos="187 "></span><span class=sd>        fields: List of fields that should be present on the obj</span>
<span class=linenos data-linenos="188 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="189 "></span>    <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>fields</span><span class=p>:</span>
<span class=linenos data-linenos="190 "></span>        <span class=k>assert</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>obj</span><span class=o>.</span><span class=n>keys</span><span class=p>(),</span> <span class=sa>f</span><span class=s1>&#39;Field </span><span class=si>{</span><span class=n>f</span><span class=si>}</span><span class=s1> is required in object </span><span class=si>{</span><span class=n>obj</span><span class=si>}</span><span class=s1>. Was not found.&#39;</span>
<span class=linenos data-linenos="191 "></span>        <span class=k>if</span> <span class=s1>&#39;url&#39;</span> <span class=ow>in</span> <span class=n>f</span><span class=p>:</span>
<span class=linenos data-linenos="192 "></span>            <span class=k>assert</span> <span class=n>validators</span><span class=o>.</span><span class=n>url</span><span class=p>(</span><span class=n>obj</span><span class=p>[</span><span class=n>f</span><span class=p>]),</span> <span class=sa>f</span><span class=s1>&#39;Url not valid: </span><span class=si>{</span><span class=n>f</span><span class=si>}</span><span class=s1>&#39;</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.job.Job.waiting_for_nodes class="doc doc-heading function"> <div class=highlight><pre><span></span><code><span class=n>waiting_for_nodes</span><span class=p>(</span><span class=n>responses</span><span class=p>)</span>
</code></pre></div> </h5> <div class="doc doc-contents "> <p>Verifies if all nodes involved in the job are present and Responding</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>responses</code></td> <td> <code><!--fedbiomed.researcher.responses.Responses--><a class="autorefs autorefs-internal" title="fedbiomed.researcher.responses.Responses" href="../responses/#fedbiomed.researcher.responses.Responses">Responses</a></code> </td> <td><p>contains message answers</p></td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code><!--bool--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </td> <td><p>False if all nodes are present in the Responses object. True if waiting for at least one node.</p></td> </tr> </tbody> </table> <details class="quote source-code"> <summary>Source code in <code>fedbiomed/researcher/job.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="295 "></span><span class=k>def</span> <span class=nf>waiting_for_nodes</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>responses</span><span class=p>:</span> <span class=n>Responses</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=linenos data-linenos="296 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot; Verifies if all nodes involved in the job are present and Responding</span>
<span class=linenos data-linenos="297 "></span>
<span class=linenos data-linenos="298 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="299 "></span><span class=sd>        responses: contains message answers</span>
<span class=linenos data-linenos="300 "></span>
<span class=linenos data-linenos="301 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="302 "></span><span class=sd>        False if all nodes are present in the Responses object. True if waiting for at least one node.</span>
<span class=linenos data-linenos="303 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="304 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="305 "></span>        <span class=n>nodes_done</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>responses</span><span class=o>.</span><span class=n>dataframe</span><span class=p>()[</span><span class=s1>&#39;node_id&#39;</span><span class=p>])</span>
<span class=linenos data-linenos="306 "></span>    <span class=k>except</span> <span class=ne>KeyError</span><span class=p>:</span>
<span class=linenos data-linenos="307 "></span>        <span class=n>nodes_done</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
<span class=linenos data-linenos="308 "></span>
<span class=linenos data-linenos="309 "></span>    <span class=k>return</span> <span class=ow>not</span> <span class=n>nodes_done</span> <span class=o>==</span> <span class=nb>set</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_nodes</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fedbiomed.researcher.job.localJob class="doc doc-heading"> localJob<!--        --> <!--          <code>localJob</code>--> <!--        --> </h3> <div class=main-class-init> <span>CLASS </span> <div class=highlight><pre><span></span><code><span class=n>localJob</span><span class=p>(</span><span class=n>dataset_path</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>training_plan_class</span><span class=o>=</span><span class=s1>&#39;MyTrainingPlan&#39;</span><span class=p>,</span> <span class=n>training_plan_path</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>training_args</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>model_args</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</code></pre></div> </div> <div class="doc doc-contents "> <p>Represents the entity that manage the training part. LocalJob is the version of Job but applied locally on a local dataset (thus not involving any network). It is only used to compare results to a Federated approach, using networks.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>dataset_path</code></td> <td> </td> <td><p>The path where data is stored on local disk.</p></td> <td> <code><!---->None</code> </td> </tr> <tr> <td><code>training_plan_class</code></td> <td> <code><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td><p>Name of the model class to use for training or model class.</p></td> <td> <code><!---->&#39;MyTrainingPlan&#39;</code> </td> </tr> <tr> <td><code>training_plan_path</code></td> <td> <code><!--str--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td><p>path to file containing model code. Defaults to None.</p></td> <td> <code><!---->None</code> </td> </tr> <tr> <td><code>training_args</code></td> <td> <code><!--fedbiomed.common.training_args.TrainingArgs--><a class="autorefs autorefs-internal" title="fedbiomed.common.training_args.TrainingArgs" href="../../common/training_args/#fedbiomed.common.training_args.TrainingArgs">TrainingArgs</a></code> </td> <td><p>contains training parameters: lr, epochs, batch_size...</p></td> <td> <code><!---->None</code> </td> </tr> <tr> <td><code>model_args</code></td> <td> <code><!--dict--><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></code> </td> <td><p>contains output and input feature dimension.</p></td> <td> <code><!---->None</code> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/researcher/job.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="735 "></span><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>dataset_path</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="736 "></span>             <span class=n>training_plan_class</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;MyTrainingPlan&#39;</span><span class=p>,</span>
<span class=linenos data-linenos="737 "></span>             <span class=n>training_plan_path</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="738 "></span>             <span class=n>training_args</span><span class=p>:</span> <span class=n>TrainingArgs</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="739 "></span>             <span class=n>model_args</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
<span class=linenos data-linenos="740 "></span>
<span class=linenos data-linenos="741 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=linenos data-linenos="742 "></span><span class=sd>    Constructor of the class</span>
<span class=linenos data-linenos="743 "></span>
<span class=linenos data-linenos="744 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="745 "></span><span class=sd>        dataset_path : The path where data is stored on local disk.</span>
<span class=linenos data-linenos="746 "></span><span class=sd>        training_plan_class: Name of the model class to use for training or model class.</span>
<span class=linenos data-linenos="747 "></span><span class=sd>        training_plan_path: path to file containing model code. Defaults to None.</span>
<span class=linenos data-linenos="748 "></span><span class=sd>        training_args: contains training parameters: lr, epochs, batch_size...</span>
<span class=linenos data-linenos="749 "></span><span class=sd>        model_args: contains output and input feature dimension.</span>
<span class=linenos data-linenos="750 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="751 "></span>
<span class=linenos data-linenos="752 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
<span class=linenos data-linenos="753 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_repository_args</span> <span class=o>=</span> <span class=p>{}</span>
<span class=linenos data-linenos="754 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_localjob_training_args</span> <span class=o>=</span> <span class=n>training_args</span>
<span class=linenos data-linenos="755 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_model_args</span> <span class=o>=</span> <span class=n>model_args</span>
<span class=linenos data-linenos="756 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span> <span class=o>=</span> <span class=n>TrainingArgs</span><span class=p>(</span><span class=n>training_args</span><span class=p>,</span> <span class=n>only_required</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<span class=linenos data-linenos="757 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>dataset_path</span> <span class=o>=</span> <span class=n>dataset_path</span>
<span class=linenos data-linenos="758 "></span>
<span class=linenos data-linenos="759 "></span>    <span class=k>if</span> <span class=n>training_args</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="760 "></span>        <span class=k>if</span> <span class=n>training_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;test_on_local_updates&#39;</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span> \
<span class=linenos data-linenos="761 "></span>                <span class=ow>or</span> <span class=n>training_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;test_on_global_updates&#39;</span><span class=p>,</span> <span class=kc>False</span><span class=p>):</span>
<span class=linenos data-linenos="762 "></span>            <span class=c1># if user wants to perform validation, display this message</span>
<span class=linenos data-linenos="763 "></span>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;Cannot perform validation, not supported for LocalJob&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="764 "></span>
<span class=linenos data-linenos="765 "></span>    <span class=c1># handle case when model is in a file</span>
<span class=linenos data-linenos="766 "></span>    <span class=k>if</span> <span class=n>training_plan_path</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="767 "></span>        <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="768 "></span>            <span class=n>model_module</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>training_plan_path</span><span class=p>)</span>
<span class=linenos data-linenos="769 "></span>            <span class=n>model_module</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s2>&quot;(.*)\.py$&quot;</span><span class=p>,</span> <span class=n>model_module</span><span class=p>)</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
<span class=linenos data-linenos="770 "></span>            <span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>training_plan_path</span><span class=p>))</span>
<span class=linenos data-linenos="771 "></span>
<span class=linenos data-linenos="772 "></span>            <span class=n>module</span> <span class=o>=</span> <span class=n>importlib</span><span class=o>.</span><span class=n>import_module</span><span class=p>(</span><span class=n>model_module</span><span class=p>)</span>
<span class=linenos data-linenos="773 "></span>            <span class=n>tr_class</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>module</span><span class=p>,</span> <span class=n>training_plan_class</span><span class=p>)</span>
<span class=linenos data-linenos="774 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span> <span class=o>=</span> <span class=n>tr_class</span><span class=p>()</span>
<span class=linenos data-linenos="775 "></span>            <span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
<span class=linenos data-linenos="776 "></span>
<span class=linenos data-linenos="777 "></span>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<span class=linenos data-linenos="778 "></span>            <span class=n>e</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>exc_info</span><span class=p>()</span>
<span class=linenos data-linenos="779 "></span>            <span class=n>logger</span><span class=o>.</span><span class=n>critical</span><span class=p>(</span><span class=s2>&quot;Cannot import class &quot;</span> <span class=o>+</span> <span class=n>training_plan_class</span> <span class=o>+</span> <span class=s2>&quot; from path &quot;</span> <span class=o>+</span>
<span class=linenos data-linenos="780 "></span>                            <span class=n>training_plan_path</span> <span class=o>+</span> <span class=s2>&quot; - Error: &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
<span class=linenos data-linenos="781 "></span>            <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
<span class=linenos data-linenos="782 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="783 "></span>
<span class=linenos data-linenos="784 "></span>        <span class=c1># create/save model instance</span>
<span class=linenos data-linenos="785 "></span>        <span class=k>if</span> <span class=n>inspect</span><span class=o>.</span><span class=n>isclass</span><span class=p>(</span><span class=n>training_plan_class</span><span class=p>):</span>
<span class=linenos data-linenos="786 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span> <span class=o>=</span> <span class=n>training_plan_class</span><span class=p>()</span>
<span class=linenos data-linenos="787 "></span>        <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="788 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span> <span class=o>=</span> <span class=n>training_plan_class</span>
<span class=linenos data-linenos="789 "></span>
<span class=linenos data-linenos="790 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>post_init</span><span class=p>(</span><span class=n>model_args</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_model_args</span><span class=p>,</span>
<span class=linenos data-linenos="791 "></span>                                  <span class=n>training_args</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_training_args</span><span class=p>)</span>
</code></pre></div> </details> <div class="doc doc-children"> <h4 id=fedbiomed.researcher.job.localJob-attributes class=api-section-header>Attributes</h4> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.job.localJob.dataset_path class="doc doc-heading attribute"> dataset_path <span class="doc doc-properties"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> </h5> <div class=highlight><pre><span></span><code><span class=n>dataset_path</span> <span class=o>=</span> <span class=n>dataset_path</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.job.localJob.model class="doc doc-heading attribute"> model <span class="doc doc-properties"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h5> <div class=highlight><pre><span></span><code><span class=n>model</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.job.localJob.training_args class="doc doc-heading attribute"> training_args <span class="doc doc-properties"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h5> <div class=highlight><pre><span></span><code><span class=n>training_args</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <div class="doc doc-object doc-attribute"> <h5 id=fedbiomed.researcher.job.localJob.training_plan class="doc doc-heading attribute"> training_plan <span class="doc doc-properties"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h5> <div class=highlight><pre><span></span><code><span class=n>training_plan</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <h4 id=fedbiomed.researcher.job.localJob-functions class=api-section-header>Functions</h4> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.researcher.job.localJob.start_training class="doc doc-heading function"> <div class=highlight><pre><span></span><code><span class=n>start_training</span><span class=p>()</span>
</code></pre></div> </h5> <div class="doc doc-contents "> <p>Sends training task to nodes and waits for the responses</p> <details class="quote source-code"> <summary>Source code in <code>fedbiomed/researcher/job.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="809 "></span><span class=k>def</span> <span class=nf>start_training</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=linenos data-linenos="810 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Sends training task to nodes and waits for the responses&quot;&quot;&quot;</span>
<span class=linenos data-linenos="811 "></span>    <span class=c1># Run import statements (very unsafely).</span>
<span class=linenos data-linenos="812 "></span>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>_dependencies</span><span class=p>:</span>
<span class=linenos data-linenos="813 "></span>        <span class=n>exec</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=nb>globals</span><span class=p>())</span>
<span class=linenos data-linenos="814 "></span>
<span class=linenos data-linenos="815 "></span>    <span class=c1># Run the training routine.</span>
<span class=linenos data-linenos="816 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="817 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>set_dataset_path</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_path</span><span class=p>)</span>
<span class=linenos data-linenos="818 "></span>        <span class=n>data_manager</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>training_data</span><span class=p>()</span>
<span class=linenos data-linenos="819 "></span>        <span class=n>tp_type</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>type</span><span class=p>()</span>
<span class=linenos data-linenos="820 "></span>        <span class=n>data_manager</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>tp_type</span><span class=o>=</span><span class=n>tp_type</span><span class=p>)</span>
<span class=linenos data-linenos="821 "></span>        <span class=n>train_loader</span><span class=p>,</span> <span class=n>test_loader</span> <span class=o>=</span> <span class=n>data_manager</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>test_ratio</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
<span class=linenos data-linenos="822 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>training_data_loader</span> <span class=o>=</span> <span class=n>train_loader</span>
<span class=linenos data-linenos="823 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>testing_data_loader</span> <span class=o>=</span> <span class=n>test_loader</span>
<span class=linenos data-linenos="824 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>training_routine</span><span class=p>()</span>
<span class=linenos data-linenos="825 "></span>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
<span class=linenos data-linenos="826 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&quot;Cannot train model in job: </span><span class=si>%s</span><span class=s2>&quot;</span><span class=p>,</span> <span class=nb>repr</span><span class=p>(</span><span class=n>exc</span><span class=p>))</span>
<span class=linenos data-linenos="827 "></span>    <span class=c1># Save the current parameters.</span>
<span class=linenos data-linenos="828 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="829 "></span>        <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="830 "></span>            <span class=c1># TODO: should test status code but not yet returned by upload_file</span>
<span class=linenos data-linenos="831 "></span>            <span class=n>path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
<span class=linenos data-linenos="832 "></span>                <span class=n>environ</span><span class=p>[</span><span class=s2>&quot;TMP_DIR&quot;</span><span class=p>],</span> <span class=sa>f</span><span class=s2>&quot;local_params_</span><span class=si>{</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=si>}</span><span class=s2>.mpk&quot;</span>
<span class=linenos data-linenos="833 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="834 "></span>            <span class=n>Serializer</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_training_plan</span><span class=o>.</span><span class=n>get_model_params</span><span class=p>(),</span> <span class=n>path</span><span class=p>)</span>
<span class=linenos data-linenos="835 "></span>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
<span class=linenos data-linenos="836 "></span>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&quot;Cannot write results: </span><span class=si>%s</span><span class=s2>&quot;</span><span class=p>,</span> <span class=nb>repr</span><span class=p>(</span><span class=n>exc</span><span class=p>))</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> <div class=right-col> <div id=right-sidebar class=sidebar-right> <nav class=toc> <!-- Render item list --> <label class=toc-title for=__toc> <span class=toc-icon></span> </label> <ul class=toc-list data-md-component=toc data-md-scrollfix> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job-classes class=md-nav__link> Classes </a> <nav class=toc-nav aria-label=Classes> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job class=md-nav__link> Job </a> <nav class=toc-nav aria-label=Job> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job-attributes class=md-nav__link> Attributes </a> <nav class=toc-nav aria-label=Attributes> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.aggregator_args class=md-nav__link> aggregator_args </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.id class=md-nav__link> id </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.last_msg class=md-nav__link> last_msg </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.nodes class=md-nav__link> nodes </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.repo class=md-nav__link> repo </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.requests class=md-nav__link> requests </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.training_args class=md-nav__link> training_args </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.training_plan class=md-nav__link> training_plan </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.training_plan_file class=md-nav__link> training_plan_file </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.training_plan_name class=md-nav__link> training_plan_name </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.training_replies class=md-nav__link> training_replies </a> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job-functions class=md-nav__link> Functions </a> <nav class=toc-nav aria-label=Functions> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.check_data_quality class=md-nav__link> check_data_quality() </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.check_training_plan_is_approved_by_nodes class=md-nav__link> check_training_plan_is_approved_by_nodes() </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.load_state class=md-nav__link> load_state() </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.save_state class=md-nav__link> save_state() </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.start_nodes_training_round class=md-nav__link> start_nodes_training_round() </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.update_parameters class=md-nav__link> update_parameters() </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.upload_aggregator_args class=md-nav__link> upload_aggregator_args() </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.validate_minimal_arguments class=md-nav__link> validate_minimal_arguments() </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.Job.waiting_for_nodes class=md-nav__link> waiting_for_nodes() </a> </li> </ul> </nav> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.localJob class=md-nav__link> localJob </a> <nav class=toc-nav aria-label=localJob> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.localJob-attributes class=md-nav__link> Attributes </a> <nav class=toc-nav aria-label=Attributes> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.localJob.dataset_path class=md-nav__link> dataset_path </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.localJob.model class=md-nav__link> model </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.localJob.training_args class=md-nav__link> training_args </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.localJob.training_plan class=md-nav__link> training_plan </a> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.localJob-functions class=md-nav__link> Functions </a> <nav class=toc-nav aria-label=Functions> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.researcher.job.localJob.start_training class=md-nav__link> start_training() </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> </div> <!-- News Main Page--> </div> <footer> <div class=container-fluid> <div class=footer-first-inner> <div class=container> <div class=row> <div class=col-md-6> <div class=footer-contact> <strong>Address:</strong> <p>2004 Rte des Lucioles, 06902 Sophia Antipolis</p> <strong>E-mail:</strong> <p>fedbiomed _at_ inria _dot_ fr</p> </div> </div> <div class=col-md-6> <div class=footer-contact> <p>Fed-BioMed © 2022</p> </div> </div> </div> </div> </div> </div> </footer> <!-- JQuery --> <script src=https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js></script> <!-- Latest compiled and minified JavaScript --> <script src=https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=../../../../assets/javascript/lunr.js></script> <script src=../../../../assets/javascript/theme.js></script> </body> </html>