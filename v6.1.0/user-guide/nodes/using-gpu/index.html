<!DOCTYPE html><html> <head><meta charset=UTF-8><meta name=viewport content="width=device-width, initial-scale=1"><meta name=robots context="index, archive"><!--  --><script>
      const versions_json = "../../../../versions.json";
      const search_worker_js = "../../../assets/javascript/search-worker.js";
      const search_index_json = "../../../search/search_index.json";
      const base_url = '../../..';
    </script><!-- Site title --><title>Using GPU - Fed-BioMed</title><link rel=icon type=image/x-icon href=../../../favicon.ico><!-- Page description --><meta name=description content="Open, Transparent and Trusted Collaborative Learning for Real-world Healthcare Applications"><!-- Page keywords --><!-- Page author --><!-- Latest compiled and minified CSS --><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><!-- Bootstrap Icons --><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css><link href=../../../assets/_mkdocstrings.css rel=stylesheet><link href=../../../assets/css/style.css rel=stylesheet></head> <body> <header> <div class="container-fluid top-bar"> <div class=brand> <a href=/ > <img src=../../../assets/img/fedbiomed-logo-small.png> </a> </div> <nav class=top> <ul> <li class> <a href=../../..>Home</a> </li> <li class> <a href=../../../getting-started/what-is-fedbiomed/ >User Documentation</a> </li> <li class> <a href=../../../pages/about-us/ >About</a> </li> <li id=clicker class=has-sub> More <i class="bi bi-chevron-down"></i> <ul class=sub-nav-menu> <li class> <a href=../../../#funding>Funding</a> </li> <li class> <a href=../../../news/ >News</a> </li> <li class> <a href=../../../#contributors>Contributors</a> </li> <li class> <a href=../../../#users>Users</a> </li> <li class> <a href=../../../pages/roadmap/ >Roadmap</a> </li> <li class> <a href=../../../#contact-us>Contact Us</a> </li> </ul> </li> </ul> </nav> </div> <div class="container-fluid top-bar-mobile"> <div class=mobile-bar> <div class=brand> <a href=../../../ > <img src=../../../assets/img/fedbiomed-logo-small.png> </a> </div> <div class=hum-menu> <img class=open src=../../../assets/img/menu.svg> <img class=close style=display:none src=../../../assets/img/cancel.svg> </div> </div> <nav class=top-mobile> <ul> <li class> <a href=../../..>Home</a> </li> <li class> <a href=../../../getting-started/what-is-fedbiomed/ >User Documentation</a> </li> <li class> <a href=../../../pages/about-us/ >About</a> </li> <li id=clicker class=has-sub> More <i class="bi bi-chevron-down"></i> <ul class=sub-nav-menu> <li class> <a href=../../../#funding>Funding</a> </li> <li class> <a href=../../../news/ >News</a> </li> <li class> <a href=../../../#contributors>Contributors</a> </li> <li class> <a href=../../../#users>Users</a> </li> <li class> <a href=../../../pages/roadmap/ >Roadmap</a> </li> <li class> <a href=../../../#contact-us>Contact Us</a> </li> </ul> </li> </ul> </nav> </div> </header> <div class=main> <!-- Home page --> <div class=container-fluid> <div class=doc-row> <div class=left-col> <div class=sidebar-doc> <nav class=sidebar-inner> <ul class="sidebar-menu-left sub"> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Getting Started <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../getting-started/what-is-fedbiomed/ class>What's Fed-BioMed</a> </li> <li class> <a href=../../../getting-started/fedbiomed-architecture/ class>Fedbiomed Architecture</a> </li> <li class> <a href=../../../getting-started/fedbiomed-workflow/ class>Fedbiomed Workflow</a> </li> <li class> <a href=../../../getting-started/installation/ class>Installation</a> </li> <li class> <a href=../../../getting-started/basic-example/ class>Basic Example</a> </li> <li class> <a href=../../../getting-started/configuration/ class>Configuration</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Tutorials <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> PyTorch <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/pytorch/01_PyTorch_MNIST_Single_Node_Tutorial/ class>PyTorch MNIST Basic Example</a> </li> <li class> <a href=../../../tutorials/pytorch/02_Create_Your_Custom_Training_Plan/ class>How to Create Your Custom PyTorch Training Plan</a> </li> <li class> <a href=../../../tutorials/pytorch/03_PyTorch_Used_Cars_Dataset_Example/ class>PyTorch Used Cars Dataset Example</a> </li> <li class> <a href=../../../tutorials/pytorch/04-Aggregation_in_Fed-BioMed/ class>PyTorch aggregation methods in Fed-BioMed</a> </li> <li class> <a href=../../../tutorials/pytorch/05_Transfer-learning_tutorial_usingDenseNet-121/ class>Transfer-learning in Fed-BioMed tutorial</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> MONAI <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/monai/01_monai-2d-image-classification/ class>Federated 2d image classification with MONAI</a> </li> <li class> <a href=../../../tutorials/monai/02_monai-2d-image-registration/ class>Federated 2d XRay registration with MONAI</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Scikit-Learn <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/scikit-learn/01_sklearn_MNIST_classification_tutorial/ class>MNIST classification with Scikit-Learn Classifier (Perceptron)</a> </li> <li class> <a href=../../../tutorials/scikit-learn/02_sklearn_sgd_regressor_tutorial/ class>Fed-BioMed to train a federated SGD regressor model</a> </li> <li class> <a href=../../../tutorials/scikit-learn/03-other-scikit-learn-models/ class>Implementing other Scikit Learn models for Federated Learning</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Optimizers <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/optimizers/01-fedopt-and-scaffold/ class>Advanced optimizers in Fed-BioMed</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> FLamby <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/flamby/flamby/ class>General Concepts</a> </li> <li class> <a href=../../../tutorials/flamby/flamby-integration-into-fedbiomed/ class>FLamby integration in Fed-BioMed</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Advanced <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/advanced/in-depth-experiment-configuration/ class>In Depth Experiment Configuration</a> </li> <li class> <a href=../../../tutorials/advanced/training-with-gpu/ class>PyTorch model training using a GPU</a> </li> <li class> <a href=../../../tutorials/advanced/breakpoints/ class>Breakpoints</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Security <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/security/differential-privacy-with-opacus-on-fedbiomed/ class>Using Differential Privacy with OPACUS on Fed-BioMed</a> </li> <li class> <a href=../../../tutorials/security/non-private-local-central-dp-monai-2d-image-registration/ class>Local and Central DP with Fed-BioMed: MONAI 2d image registration</a> </li> <li class> <a href=../../../tutorials/security/training-with-approved-training-plans/ class>Training Process with Training Plan Management</a> </li> <li class> <a href=../../../tutorials/security/secure-aggregation/ class>Training with Secure Aggregation</a> </li> <li class> <a href=../../../tutorials/concrete-ml/concrete-ml/ class>End-to-end Privacy Preserving Training and Inference on Medical Data</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Biomedical data <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../tutorials/medical/medical-image-segmentation-unet-library/ class>Brain Segmentation</a> </li> </ul> </li> </ul> </li> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> User Guide <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li class> <a href=../../glossary/ class>Glossary</a> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Deployment <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../deployment/deployment/ class>Introduction</a> </li> <li class> <a href=../../deployment/deployment-vpn/ class>VPN Deployment</a> </li> <li class> <a href=../../deployment/matrix/ class>Network matrix</a> </li> <li class> <a href=../../deployment/security-model/ class>Security model</a> </li> </ul> </li> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> Node <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li class> <a href=../configuring-nodes/ class>Configuring Nodes</a> </li> <li class> <a href=../deploying-datasets/ class>Deploying Datasets</a> </li> <li class> <a href=../training-plan-security-manager/ class>Training Plan Management</a> </li> <li class=current> <a href=./ class="link current">Using GPU</a> </li> <li class> <a href=../node-gui/ class>Node GUI</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Researcher <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../researcher/training-plan/ class>Training Plan</a> </li> <li class> <a href=../../researcher/training-data/ class>Training Data</a> </li> <li class> <a href=../../researcher/experiment/ class>Experiment</a> </li> <li class> <a href=../../researcher/aggregation/ class>Aggregation</a> </li> <li class> <a href=../../researcher/listing-datasets-and-selecting-nodes/ class>Listing Datasets and Selecting Nodes</a> </li> <li class> <a href=../../researcher/model-testing-during-federated-training/ class>Model Validation on the Node Side</a> </li> <li class> <a href=../../researcher/tensorboard/ class>Tensorboard</a> </li> </ul> </li> <li class> <a href=../../advanced-optimization/ class>Optimization</a> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Secure Aggregation <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../secagg/introduction/ class>Introduction</a> </li> <li class> <a href=../../secagg/configuration/ class>Configuration</a> </li> <li class> <a href=../../secagg/researcher-interface/ class>Managing Secure Aggregation in Researcher</a> </li> </ul> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Developer <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> API Reference <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Common <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../developer/api/common/certificate_manager/ class>Certificate Manager</a> </li> <li class> <a href=../../../developer/api/common/cli/ class>CLI</a> </li> <li class> <a href=../../../developer/api/common/config/ class>Config</a> </li> <li class> <a href=../../../developer/api/common/constants/ class>Constants</a> </li> <li class> <a href=../../../developer/api/common/data/ class>Data</a> </li> <li class> <a href=../../../developer/api/common/db/ class>DB</a> </li> <li class> <a href=../../../developer/api/common/exceptions/ class>Exceptions</a> </li> <li class> <a href=../../../developer/api/common/ipython/ class>IPython</a> </li> <li class> <a href=../../../developer/api/common/json/ class>Json</a> </li> <li class> <a href=../../../developer/api/common/logger/ class>Logger</a> </li> <li class> <a href=../../../developer/api/common/message/ class>Message</a> </li> <li class> <a href=../../../developer/api/common/metrics/ class>Metrics</a> </li> <li class> <a href=../../../developer/api/common/models/ class>Model</a> </li> <li class> <a class href=../../../developer/api/common/mpc_controller.md>MPC controller</a> </li> <li class> <a href=../../../developer/api/common/optimizers/ class>Optimizers</a> </li> <li class> <a href=../../../developer/api/common/privacy/ class>Privacy</a> </li> <li class> <a href=../../../developer/api/common/secagg/ class>Secagg</a> </li> <li class> <a href=../../../developer/api/common/secagg_manager/ class>Secagg Manager</a> </li> <li class> <a href=../../../developer/api/common/serializer/ class>Serializer</a> </li> <li class> <a href=../../../developer/api/common/singleton/ class>Singleton</a> </li> <li class> <a href=../../../developer/api/common/synchro/ class>Synchro</a> </li> <li class> <a href=../../../developer/api/common/tasks_queue/ class>TasksQueue</a> </li> <li class> <a href=../../../developer/api/common/training_plans/ class>TrainingPlans</a> </li> <li class> <a href=../../../developer/api/common/training_args/ class>TrainingArgs</a> </li> <li class> <a href=../../../developer/api/common/utils/ class>Utils</a> </li> <li class> <a href=../../../developer/api/common/validator/ class>Validator</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Node <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../developer/api/node/cli/ class>CLI</a> </li> <li class> <a href=../../../developer/api/node/cli_utils/ class>CLI Utils</a> </li> <li class> <a href=../../../developer/api/node/config/ class>Config</a> </li> <li class> <a href=../../../developer/api/node/dataset_manager/ class>DatasetManager</a> </li> <li class> <a href=../../../developer/api/node/history_monitor/ class>HistoryMonitor</a> </li> <li class> <a href=../../../developer/api/node/node/ class>Node</a> </li> <li class> <a href=../../../developer/api/node/node_state_manager/ class>NodeStateManager</a> </li> <li class> <a href=../../../developer/api/node/requests/ class>Requests</a> </li> <li class> <a href=../../../developer/api/node/round/ class>Round</a> </li> <li class> <a href=../../../developer/api/node/secagg/ class>Secagg</a> </li> <li class> <a href=../../../developer/api/node/secagg_manager/ class>Secagg Manager</a> </li> <li class> <a href=../../../developer/api/node/training_plan_security_manager/ class>TrainingPlanSecurityManager</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Researcher <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../developer/api/researcher/aggregators/ class>Aggregators</a> </li> <li class> <a href=../../../developer/api/researcher/cli/ class>CLI</a> </li> <li class> <a href=../../../developer/api/researcher/config/ class>Config</a> </li> <li class> <a href=../../../developer/api/researcher/datasets/ class>Datasets</a> </li> <li class> <a href=../../../developer/api/researcher/federated_workflows/ class>Federated Workflows</a> </li> <li class> <a href=../../../developer/api/researcher/filetools/ class>Filetools</a> </li> <li class> <a href=../../../developer/api/researcher/jobs/ class>Jobs</a> </li> <li class> <a href=../../../developer/api/researcher/monitor/ class>Monitor</a> </li> <li class> <a href=../../../developer/api/researcher/node_state_agent/ class>NodeStateAgent</a> </li> <li class> <a href=../../../developer/api/researcher/requests/ class>Requests</a> </li> <li class> <a href=../../../developer/api/researcher/secagg/ class>Secagg</a> </li> <li class> <a href=../../../developer/api/researcher/strategies/ class>Strategies</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Transport <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../developer/api/transport/client/ class>Client</a> </li> <li class> <a href=../../../developer/api/transport/controller/ class>Controller</a> </li> <li class> <a href=../../../developer/api/transport/node_agent/ class>NodeAgent</a> </li> <li class> <a href=../../../developer/api/transport/server/ class>Server</a> </li> </ul> </li> </ul> </li> <li class> <a href=../../../developer/usage_and_tools/ class>Usage and Tools</a> </li> <li class> <a href=../../../developer/ci/ class>Continuous Integration</a> </li> <li class> <a href=../../../developer/definition-of-done/ class>Definition of Done</a> </li> <li class> <a href=../../../developer/development-environment/ class>Development Environment</a> </li> <li class> <a href=../../../developer/testing-in-fedbiomed/ class>Testing in Fed-BioMed</a> </li> <li class> <a href=../../../developer/messaging/ class>RPC Protocol and Messages</a> </li> </ul> </li> <li class> <a href=../../../support/troubleshooting/ class>FAQ & Troubleshooting</a> </li> </ul> </nav> </div> </div> <div class=main-col> <main class=main-docs> <article> <h1 id=using-gpu-accelerator-hardware>Using GPU accelerator hardware</h1> <p>Federated learning often implies intensive computation for model training, aggregation or inference. Dedicated accelerator hardware such as Nvidia GPUs can help speed up these steps, with support from the libraries and frameworks.</p> <p>This page explains GPU support in Fed-BioMed.</p> <h2 id=support-scope>Support scope</h2> <p>Fed-BioMed supports accelerator hardware with the following requirements and limitations :</p> <ul> <li><strong>Nvidia GPU</strong> hardware : basically all models supported by the CUDA interface can be used, but of course the hardware needs to have enough memory for the targeted model.</li> <li><strong>single GPU</strong> on each node : if the host machine has multiple GPUs, only one is used by a Fed-BioMed node</li> <li><strong>PyTorch</strong> framework using the <code>TorchTrainingPlan</code> Fed-BioMed training plan interface ; other frameworks / training plans (scikit-learn / <code>SGDSkLearnModel</code>) can run on a node with a hardware accelerator but don't use it.</li> <li><strong>only training</strong> is accelerated (node side computation), not aggregation (server side computation)</li> <li><strong>no VPN</strong> : VPN in Fed-BioMed is based on running each component in a docker container. Node container images provided by Fed-BioMed are not yet GPU-enabled.</li> </ul> <h2 id=node-side>Node side</h2> <p>To control GPU usage by Fed-BioMed training from the node side, use these options of the <code>fedbiomed node start</code> command :</p> <ul> <li><code>--gpu</code> : Node offers to use a GPU for training, if a GPU is available on the node and if the researcher requests use of a GPU. If no GPU is available, or the training plan is not supported for GPU (scikit-learn), or the researcher does not request use of a GPU, then training occurs in CPU.</li> <li><code>--gpu-num GPU_NUM</code> : Node chooses the device with number <em>GPU_NUM</em> in CUDA instead of the default device. If this device does not exist, node fallbacks to default CUDA device. This option also implicitely sets <code>--gpu</code>.</li> <li><code>--gpu-only</code> : Node enforces use of a GPU for training, if a GPU is available on the node, even if the researcher doesn't request it. If no GPU is available, or the training plan is not supported for GPU (scikit-learn), then training occurs in CPU.</li> </ul> <p><strong>By default (no options), Fed-BioMed training doesn't use GPU.</strong></p> <p>The reason for not using GPU by default is that even if you have a GPU on a node, it may not have enough memory to train the given model. In this case, the training of a correct model fails with an error message (and you don't want a correct model to fail with default options) :</p> <div class=highlight><pre><span></span><code><span class=m>2022</span>-01-13<span class=w> </span><span class=m>08</span>:07:28,737<span class=w> </span>fedbiomed<span class=w> </span>ERROR<span class=w> </span>-<span class=w> </span>Cannot<span class=w> </span>train<span class=w> </span>model<span class=w> </span><span class=k>in</span><span class=w> </span>round:<span class=w> </span>CUDA<span class=w> </span>error:<span class=w> </span>out<span class=w> </span>of<span class=w> </span>memory
</code></pre></div> <p>Example :</p> <ul> <li>launch a node that enforces use of GPU with CUDA device number 2 (the 3rd GPU on this host machine). If there is no GPU with device number 2, use the default GPU. If there is no GPU available or if not using <code>TorchTrainingPlan</code>, do the training in CPU : <div class=highlight><pre><span></span><code>$<span class=w> </span>fedbiomed<span class=w> </span>node<span class=w> </span>start<span class=w> </span>--gpu-only<span class=w> </span>--gpu-num<span class=w> </span><span class=m>2</span>
</code></pre></div></li> <li>if the researcher didn't request for GPU usage, and there is no GPU numbered 2 in CUDA on the node but another GPU is available, and the training plan supports GPU acceleration, then the following warning messages are emitted : <div class=highlight><pre><span></span><code><span class=m>2022</span>-01-21<span class=w> </span><span class=m>12</span>:34:31,992<span class=w> </span>fedbiomed<span class=w> </span>WARNING<span class=w> </span>-<span class=w> </span>Node<span class=w> </span>enforces<span class=w> </span>model<span class=w> </span>training<span class=w> </span>on<span class=w> </span>GPU,<span class=w> </span>though<span class=w> </span>it<span class=w> </span>is<span class=w> </span>not<span class=w> </span>requested<span class=w> </span>by<span class=w> </span>researcher
<span class=m>2022</span>-01-21<span class=w> </span><span class=m>12</span>:34:31,992<span class=w> </span>fedbiomed<span class=w> </span>WARNING<span class=w> </span>-<span class=w> </span>Bad<span class=w> </span>GPU<span class=w> </span>number<span class=w> </span><span class=m>2</span>,<span class=w> </span>using<span class=w> </span>default<span class=w> </span>GPU
</code></pre></div></li> </ul> <h2 id=researcher-side>Researcher side</h2> <p>To control GPU usage for Fed-BioMed training from the researcher side, set the <code>'use_gpu': True</code> key of the <code>training_args</code> dict passed as argument to <code>Experiment</code>.</p> <p>In this example, the researcher requests the nodes participating in the <code>Experiment</code> to use GPU for training, if they have any GPU available and offer to use it : <div class=highlight><pre><span></span><code><span class=c1># Researcher notebook or script code</span>
<span class=nv>training_args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>{</span>
<span class=w>    </span><span class=s1>&#39;use_gpu&#39;</span>:<span class=w> </span>True
<span class=w>    </span><span class=c1>#......</span>
<span class=o>}</span>

<span class=nv>exp</span><span class=w> </span><span class=o>=</span><span class=w> </span>Experiment<span class=o>(</span>
<span class=w>    </span>...
<span class=w>    </span><span class=nv>training_args</span><span class=o>=</span>training_args,
<span class=w>    </span>...<span class=w> </span><span class=o>)</span>
</code></pre></div></p> <p><strong>Node requirements have precedence over researcher requests.</strong> For example, no GPU is used if the node requests it but the nodes does not offer it.</p> <h2 id=how-to-enable-gpu-usage>How to enable GPU usage</h2> <p>Fed-BioMed offers a simplified interface for training with GPU, as described above. This hides from the researcher the complexity of the specific resources and requirements of each node's.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p><strong>Fed-BioMed models and training plans should never try to directly access the CUDA resources on the node.</strong> For example don't use the <code>pytorch.cuda.is_available()</code>, <code>tensor.to()</code>, <code>tensor.cuda()</code> etc. methods. This is not the supported way of using GPUs in Fed-BioMed.</p> </div> <h3 id=option-1-enable-gpu-on-node-and-researcher>Option 1 : enable GPU on node and researcher</h3> <p>In this scenario, the node proposes the use of a GPU and the researcher requests the use of a GPU :</p> <ul> <li> <p>launch node offering GPU usage <div class=highlight><pre><span></span><code>$<span class=w> </span>fedbiomed<span class=w> </span>node<span class=w> </span>start<span class=w> </span>--gpu
</code></pre></div></p> </li> <li> <p>on the researcher, set the <code>training_args</code> of the notebook or script used for training <div class=highlight><pre><span></span><code><span class=c1># Researcher notebook or script code</span>
<span class=nv>training_args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>{</span>
<span class=w>    </span><span class=s1>&#39;use_gpu&#39;</span>:<span class=w> </span>True
<span class=w>    </span><span class=c1># .....</span>
<span class=o>}</span>

<span class=nv>exp</span><span class=w> </span><span class=o>=</span><span class=w> </span>Experiment<span class=o>(</span>
<span class=w>    </span>...
<span class=w>    </span><span class=nv>training_args</span><span class=o>=</span>training_args,
<span class=w>    </span>...<span class=w> </span><span class=o>)</span>
exp.run<span class=o>()</span>
</code></pre></div></p> </li> </ul> <h3 id=option-2-force-gpu-usage-on-node>Option 2 : force GPU usage on node</h3> <p>In this scenario, no action is needed on the researcher side, no code modification is needed. The node enforces use of GPU :</p> <ul> <li> <p>launch node enforcing GPU usage <div class=highlight><pre><span></span><code>$<span class=w> </span>fedbiomed<span class=w> </span>node<span class=w> </span>start<span class=w> </span>--gpu-only
</code></pre></div></p> </li> <li> <p>on the researcher, launch same notebook or script as when using CPU <div class=highlight><pre><span></span><code><span class=c1># Unmodified researcher notebook or script code</span>
<span class=nv>exp</span><span class=w> </span><span class=o>=</span><span class=w> </span>Experiment<span class=o>(</span><span class=w> </span>...<span class=w> </span><span class=o>)</span>
exp.run<span class=o>()</span>
</code></pre></div></p> </li> </ul> <h2 id=remarks>Remarks</h2> <h3 id=heterogeneous-nodes>Heterogeneous nodes</h3> <p>When using multiple nodes, they can have different GPU support and requirements. For example an <code>Experiment</code> can use 4 nodes with :</p> <ul> <li>1 node has no GPU available</li> <li>1 node has GPU available but does not offer GPU</li> <li>1 node has GPU available and offers GPU</li> <li>1 node has GPU available and enforces GPU usage</li> <li>etc.</li> </ul> <h3 id=multiples-nodes-on-the-same-host>Multiples nodes on the same host</h3> <p>When running multiples nodes on a same host machine that has multiple GPUs available, each node can use a different GPU. For example on a node with 2 GPUs numbered 0 and 1 : <div class=highlight><pre><span></span><code><span class=c1># Launch node (in background) offering use of GPU 0</span>
$<span class=w> </span>fedbiomed<span class=w> </span>node<span class=w> </span>start<span class=w> </span>--gpu-num<span class=w> </span><span class=m>0</span><span class=w> </span><span class=p>&amp;</span>
<span class=c1># Launch node offering use of GPU 1</span>
$<span class=w> </span>fedbiomed<span class=w> </span>node<span class=w> </span>start<span class=w> </span>--gpu-num<span class=w> </span><span class=m>1</span>
</code></pre></div></p> <h3 id=security>Security</h3> <div class="admonition warning"> <p class=admonition-title>warning</p> <p>Warning: from a security perspective, a malicious researcher can write a training plan that directly accesses the node's GPU (eg: with <code>tensor.to()</code>) even if not offered by the node. This should be addressed by using training plan approval and conducting proper training plan review.</p> </div> </article> </main> </div> <div class=right-col> <div id=right-sidebar class=sidebar-right> <nav class=toc> <!-- Render item list --> <label class=toc-title for=__toc> <span class=toc-icon></span> </label> <ul class=toc-list data-md-component=toc data-md-scrollfix> <!-- Table of contents item --> <li class=toc-item> <a href=#support-scope class=md-nav__link> Support scope </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#node-side class=md-nav__link> Node side </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#researcher-side class=md-nav__link> Researcher side </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#how-to-enable-gpu-usage class=md-nav__link> How to enable GPU usage </a> <nav class=toc-nav aria-label="How to enable GPU usage"> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#option-1-enable-gpu-on-node-and-researcher class=md-nav__link> Option 1 : enable GPU on node and researcher </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#option-2-force-gpu-usage-on-node class=md-nav__link> Option 2 : force GPU usage on node </a> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#remarks class=md-nav__link> Remarks </a> <nav class=toc-nav aria-label=Remarks> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#heterogeneous-nodes class=md-nav__link> Heterogeneous nodes </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#multiples-nodes-on-the-same-host class=md-nav__link> Multiples nodes on the same host </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#security class=md-nav__link> Security </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> </div> <!-- News Main Page--> </div> <footer> <div class=container-fluid> <div class=footer-first-inner> <div class=container> <div class=row> <div class=col-md-6> <div class=footer-contact> <strong>Address:</strong> <p>2004 Rte des Lucioles, 06902 Sophia Antipolis</p> <strong>E-mail:</strong> <p>fedbiomed _at_ inria _dot_ fr</p> </div> </div> <div class=col-md-6> <div class=footer-contact> <p>Fed-BioMed © 2022</p> </div> </div> </div> </div> </div> </div> </footer> <!-- JQuery --> <script src=https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js></script> <!-- Latest compiled and minified JavaScript --> <script src=https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=../../../assets/javascript/lunr.js></script> <script src=../../../assets/javascript/theme.js></script> <!-- GitHub buttons --> <script async defer src=https://buttons.github.io/buttons.js></script> </body> </html>