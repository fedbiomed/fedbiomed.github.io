<!DOCTYPE html><html> <head><meta charset=UTF-8><meta name=viewport content="width=device-width, initial-scale=1"><meta name=robots context="index, archive"><!--  --><script>
      const versions_json = "../../../../../versions.json";
      const search_worker_js = "../../../../assets/javascript/search-worker.js";
      const search_index_json = "../../../../search/search_index.json";
      const base_url = '../../../..';
    </script><!-- Site title --><title>TrainingPlanSecurityManager - Fed-BioMed</title><link rel=icon type=image/x-icon href=../../../../favicon.ico><!-- Page description --><meta name=description content="Open, Transparent and Trusted Collaborative Learning for Real-world Healthcare Applications"><!-- Page keywords --><!-- Page author --><!-- Latest compiled and minified CSS --><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><!-- Bootstrap Icons --><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css><link href=../../../../assets/_mkdocstrings.css rel=stylesheet><link href=../../../../assets/css/style.css rel=stylesheet></head> <body> <header> <div class="container-fluid top-bar"> <div class=brand> <a href=/ > <img src=../../../../assets/img/fedbiomed-logo-small.png> </a> </div> <nav class=top> <ul> <li class> <a href=../../../..>Home</a> </li> <li class> <a href=../../../../getting-started/what-is-fedbiomed/ >User Documentation</a> </li> <li class> <a href=../../../../pages/about-us/ >About</a> </li> <li id=clicker class=has-sub> More <i class="bi bi-chevron-down"></i> <ul class=sub-nav-menu> <li class> <a href=../../../../#funding>Funding</a> </li> <li class> <a href=../../../../news/ >News</a> </li> <li class> <a href=../../../../#contributors>Contributors</a> </li> <li class> <a href=../../../../#users>Users</a> </li> <li class> <a href=../../../../pages/roadmap/ >Roadmap</a> </li> <li class> <a href=../../../../#contact-us>Contact Us</a> </li> </ul> </li> </ul> </nav> </div> <div class="container-fluid top-bar-mobile"> <div class=mobile-bar> <div class=brand> <a href=../../../../ > <img src=../../../../assets/img/fedbiomed-logo-small.png> </a> </div> <div class=hum-menu> <img class=open src=../../../../assets/img/menu.svg> <img class=close style=display:none src=../../../../assets/img/cancel.svg> </div> </div> <nav class=top-mobile> <ul> <li class> <a href=../../../..>Home</a> </li> <li class> <a href=../../../../getting-started/what-is-fedbiomed/ >User Documentation</a> </li> <li class> <a href=../../../../pages/about-us/ >About</a> </li> <li id=clicker class=has-sub> More <i class="bi bi-chevron-down"></i> <ul class=sub-nav-menu> <li class> <a href=../../../../#funding>Funding</a> </li> <li class> <a href=../../../../news/ >News</a> </li> <li class> <a href=../../../../#contributors>Contributors</a> </li> <li class> <a href=../../../../#users>Users</a> </li> <li class> <a href=../../../../pages/roadmap/ >Roadmap</a> </li> <li class> <a href=../../../../#contact-us>Contact Us</a> </li> </ul> </li> </ul> </nav> </div> </header> <div class=main> <!-- Home page --> <div class=container-fluid> <div class=doc-row> <div class=left-col> <div class=sidebar-doc> <nav class=sidebar-inner> <ul class="sidebar-menu-left sub"> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Getting Started <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../getting-started/what-is-fedbiomed/ class>What's Fed-BioMed</a> </li> <li class> <a href=../../../../getting-started/fedbiomed-architecture/ class>Fedbiomed Architecture</a> </li> <li class> <a href=../../../../getting-started/fedbiomed-workflow/ class>Fedbiomed Workflow</a> </li> <li class> <a href=../../../../getting-started/installation/ class>Installation</a> </li> <li class> <a href=../../../../getting-started/basic-example/ class>Basic Example</a> </li> <li class> <a href=../../../../getting-started/configuration/ class>Configuration</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Tutorials <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> PyTorch <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/pytorch/01_PyTorch_MNIST_Single_Node_Tutorial/ class>PyTorch MNIST Basic Example</a> </li> <li class> <a href=../../../../tutorials/pytorch/02_Create_Your_Custom_Training_Plan/ class>How to Create Your Custom PyTorch Training Plan</a> </li> <li class> <a href=../../../../tutorials/pytorch/03_PyTorch_Used_Cars_Dataset_Example/ class>PyTorch Used Cars Dataset Example</a> </li> <li class> <a href=../../../../tutorials/pytorch/04-Aggregation_in_Fed-BioMed/ class>PyTorch aggregation methods in Fed-BioMed</a> </li> <li class> <a href=../../../../tutorials/pytorch/05_Transfer-learning_tutorial_usingDenseNet-121/ class>Transfer-learning in Fed-BioMed tutorial</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> MONAI <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/monai/01_monai-2d-image-classification/ class>Federated 2d image classification with MONAI</a> </li> <li class> <a href=../../../../tutorials/monai/02_monai-2d-image-registration/ class>Federated 2d XRay registration with MONAI</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Scikit-Learn <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/scikit-learn/01_sklearn_MNIST_classification_tutorial/ class>MNIST classification with Scikit-Learn Classifier (Perceptron)</a> </li> <li class> <a href=../../../../tutorials/scikit-learn/02_sklearn_sgd_regressor_tutorial/ class>Fed-BioMed to train a federated SGD regressor model</a> </li> <li class> <a href=../../../../tutorials/scikit-learn/03-other-scikit-learn-models/ class>Implementing other Scikit Learn models for Federated Learning</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Optimizers <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/optimizers/01-fedopt-and-scaffold/ class>Advanced optimizers in Fed-BioMed</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> FLamby <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/flamby/flamby/ class>General Concepts</a> </li> <li class> <a href=../../../../tutorials/flamby/flamby-integration-into-fedbiomed/ class>FLamby integration in Fed-BioMed</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Advanced <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/advanced/in-depth-experiment-configuration/ class>In Depth Experiment Configuration</a> </li> <li class> <a href=../../../../tutorials/advanced/training-with-gpu/ class>PyTorch model training using a GPU</a> </li> <li class> <a href=../../../../tutorials/advanced/breakpoints/ class>Breakpoints</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Security <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/security/differential-privacy-with-opacus-on-fedbiomed/ class>Using Differential Privacy with OPACUS on Fed-BioMed</a> </li> <li class> <a href=../../../../tutorials/security/non-private-local-central-dp-monai-2d-image-registration/ class>Local and Central DP with Fed-BioMed: MONAI 2d image registration</a> </li> <li class> <a href=../../../../tutorials/security/training-with-approved-training-plans/ class>Training Process with Training Plan Management</a> </li> <li class> <a href=../../../../tutorials/security/secure-aggregation/ class>Training with Secure Aggregation</a> </li> <li class> <a href=../../../../tutorials/concrete-ml/concrete-ml/ class>End-to-end Privacy Preserving Training and Inference on Medical Data</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Biomedical data <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../tutorials/medical/medical-image-segmentation-unet-library/ class>Brain Segmentation</a> </li> </ul> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> User Guide <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/glossary/ class>Glossary</a> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Deployment <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/deployment/deployment/ class>Introduction</a> </li> <li class> <a href=../../../../user-guide/deployment/deployment-vpn/ class>VPN Deployment</a> </li> <li class> <a href=../../../../user-guide/deployment/matrix/ class>Network matrix</a> </li> <li class> <a href=../../../../user-guide/deployment/security-model/ class>Security model</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Node <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/nodes/configuring-nodes/ class>Configuring Nodes</a> </li> <li class> <a href=../../../../user-guide/nodes/deploying-datasets/ class>Deploying Datasets</a> </li> <li class> <a href=../../../../user-guide/nodes/training-plan-security-manager/ class>Training Plan Management</a> </li> <li class> <a href=../../../../user-guide/nodes/using-gpu/ class>Using GPU</a> </li> <li class> <a href=../../../../user-guide/nodes/node-gui/ class>Node GUI</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Researcher <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/researcher/training-plan/ class>Training Plan</a> </li> <li class> <a href=../../../../user-guide/researcher/training-data/ class>Training Data</a> </li> <li class> <a href=../../../../user-guide/researcher/experiment/ class>Experiment</a> </li> <li class> <a href=../../../../user-guide/researcher/aggregation/ class>Aggregation</a> </li> <li class> <a href=../../../../user-guide/researcher/listing-datasets-and-selecting-nodes/ class>Listing Datasets and Selecting Nodes</a> </li> <li class> <a href=../../../../user-guide/researcher/model-testing-during-federated-training/ class>Model Validation on the Node Side</a> </li> <li class> <a href=../../../../user-guide/researcher/tensorboard/ class>Tensorboard</a> </li> </ul> </li> <li class> <a href=../../../../user-guide/advanced-optimization/ class>Optimization</a> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Secure Aggregation <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../../../user-guide/secagg/introduction/ class>Introduction</a> </li> <li class> <a href=../../../../user-guide/secagg/configuration/ class>Configuration</a> </li> <li class> <a href=../../../../user-guide/secagg/researcher-interface/ class>Managing Secure Aggregation in Researcher</a> </li> </ul> </li> </ul> </li> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> Developer <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> API Reference <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Common <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../common/certificate_manager/ class>Certificate Manager</a> </li> <li class> <a href=../../common/cli/ class>CLI</a> </li> <li class> <a href=../../common/config/ class>Config</a> </li> <li class> <a href=../../common/constants/ class>Constants</a> </li> <li class> <a href=../../common/data/ class>Data</a> </li> <li class> <a href=../../common/db/ class>DB</a> </li> <li class> <a href=../../common/exceptions/ class>Exceptions</a> </li> <li class> <a href=../../common/ipython/ class>IPython</a> </li> <li class> <a href=../../common/json/ class>Json</a> </li> <li class> <a href=../../common/logger/ class>Logger</a> </li> <li class> <a href=../../common/message/ class>Message</a> </li> <li class> <a href=../../common/metrics/ class>Metrics</a> </li> <li class> <a href=../../common/models/ class>Model</a> </li> <li class> <a class href=../../common/mpc_controller.md>MPC controller</a> </li> <li class> <a href=../../common/optimizers/ class>Optimizers</a> </li> <li class> <a href=../../common/privacy/ class>Privacy</a> </li> <li class> <a href=../../common/secagg/ class>Secagg</a> </li> <li class> <a href=../../common/secagg_manager/ class>Secagg Manager</a> </li> <li class> <a href=../../common/serializer/ class>Serializer</a> </li> <li class> <a href=../../common/singleton/ class>Singleton</a> </li> <li class> <a href=../../common/synchro/ class>Synchro</a> </li> <li class> <a href=../../common/tasks_queue/ class>TasksQueue</a> </li> <li class> <a href=../../common/training_plans/ class>TrainingPlans</a> </li> <li class> <a href=../../common/training_args/ class>TrainingArgs</a> </li> <li class> <a href=../../common/utils/ class>Utils</a> </li> <li class> <a href=../../common/validator/ class>Validator</a> </li> </ul> </li> <li data-adress=sub-1 class="current has-sub-side"> <div href class="parent-list current "> Node <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub active "> <li class> <a href=../cli/ class>CLI</a> </li> <li class> <a href=../cli_utils/ class>CLI Utils</a> </li> <li class> <a href=../config/ class>Config</a> </li> <li class> <a href=../dataset_manager/ class>DatasetManager</a> </li> <li class> <a href=../history_monitor/ class>HistoryMonitor</a> </li> <li class> <a href=../node/ class>Node</a> </li> <li class> <a href=../node_state_manager/ class>NodeStateManager</a> </li> <li class> <a href=../requests/ class>Requests</a> </li> <li class> <a href=../round/ class>Round</a> </li> <li class> <a href=../secagg/ class>Secagg</a> </li> <li class> <a href=../secagg_manager/ class>Secagg Manager</a> </li> <li class=current> <a href=./ class="link current">TrainingPlanSecurityManager</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Researcher <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../researcher/aggregators/ class>Aggregators</a> </li> <li class> <a href=../../researcher/cli/ class>CLI</a> </li> <li class> <a href=../../researcher/config/ class>Config</a> </li> <li class> <a href=../../researcher/datasets/ class>Datasets</a> </li> <li class> <a href=../../researcher/federated_workflows/ class>Federated Workflows</a> </li> <li class> <a href=../../researcher/filetools/ class>Filetools</a> </li> <li class> <a href=../../researcher/jobs/ class>Jobs</a> </li> <li class> <a href=../../researcher/monitor/ class>Monitor</a> </li> <li class> <a href=../../researcher/node_state_agent/ class>NodeStateAgent</a> </li> <li class> <a href=../../researcher/requests/ class>Requests</a> </li> <li class> <a href=../../researcher/secagg/ class>Secagg</a> </li> <li class> <a href=../../researcher/strategies/ class>Strategies</a> </li> </ul> </li> <li data-adress=sub-1 class=has-sub-side> <div href class="parent-list "> Transport <i class="bi bi-chevron-down"></i> </div> <ul class="sub-sidebar-menu sub "> <li class> <a href=../../transport/client/ class>Client</a> </li> <li class> <a href=../../transport/controller/ class>Controller</a> </li> <li class> <a href=../../transport/node_agent/ class>NodeAgent</a> </li> <li class> <a href=../../transport/server/ class>Server</a> </li> </ul> </li> </ul> </li> <li class> <a href=../../../usage_and_tools/ class>Usage and Tools</a> </li> <li class> <a href=../../../ci/ class>Continuous Integration</a> </li> <li class> <a href=../../../definition-of-done/ class>Definition of Done</a> </li> <li class> <a href=../../../development-environment/ class>Development Environment</a> </li> <li class> <a href=../../../testing-in-fedbiomed/ class>Testing in Fed-BioMed</a> </li> <li class> <a href=../../../messaging/ class>RPC Protocol and Messages</a> </li> </ul> </li> <li class> <a href=../../../../support/troubleshooting/ class>FAQ & Troubleshooting</a> </li> </ul> </nav> </div> </div> <div class=main-col> <main class=main-docs> <h1>TrainingPlanSecurityManager</h1> <article> <div class="doc doc-object doc-module"> <div class="doc doc-contents first"> <p>Manages training plan approval for a node.</p> <div class="doc doc-children"> <h2 id=fedbiomed.node.training_plan_security_manager-attributes>Attributes</h2> <div class="doc doc-object doc-attribute"> <h3 id=fedbiomed.node.training_plan_security_manager.HASH_FUNCTIONS class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">HASH_FUNCTIONS</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small> </span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>HASH_FUNCTIONS</span> <span class=o>=</span> <span class=p>{</span><span class=n>value</span><span class=p>:</span> <span class=n>sha256</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>sha384</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>sha512</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>sha3_256</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>sha3_384</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>sha3_512</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>blake2s</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>blake2s</span><span class=p>}</span>
</code></pre></div> <div class="doc doc-contents "> </div> </div> <h2 id=fedbiomed.node.training_plan_security_manager-classes>Classes</h2> <div class="doc doc-object doc-class"> <h3 id=fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">TrainingPlanSecurityManager</span> </h3> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>TrainingPlanSecurityManager</span><span class=p>(</span><span class=n>db</span><span class=p>,</span> <span class=n>node_id</span><span class=p>,</span> <span class=n>hashing</span><span class=p>,</span> <span class=n>tp_approval</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Manages training plan approval for a node.</p> <p>Creates a DB object for the table named as <code>Training plans</code> and builds a query object to query the database.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>db</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>Path to database file.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>node_id</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>ID of the active node.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>hashing</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>Hashing algorithm</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>tp_approval</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </td> <td> <div class=doc-md-description> <p>True if training plan approval is requested</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/node/training_plan_security_manager.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="50 "></span><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
<span class=linenos data-linenos="51 "></span>    <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="52 "></span>    <span class=n>db</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<span class=linenos data-linenos="53 "></span>    <span class=n>node_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<span class=linenos data-linenos="54 "></span>    <span class=n>hashing</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<span class=linenos data-linenos="55 "></span>    <span class=n>tp_approval</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=linenos data-linenos="56 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="57 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Class constructor for TrainingPlanSecurityManager.</span>
<span class=linenos data-linenos="58 "></span>
<span class=linenos data-linenos="59 "></span><span class=sd>    Creates a DB object for the table named as `Training plans` and builds a query object to query</span>
<span class=linenos data-linenos="60 "></span><span class=sd>    the database.</span>
<span class=linenos data-linenos="61 "></span>
<span class=linenos data-linenos="62 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="63 "></span><span class=sd>        db: Path to database file.</span>
<span class=linenos data-linenos="64 "></span><span class=sd>        node_id: ID of the active node.</span>
<span class=linenos data-linenos="65 "></span><span class=sd>        hashing: Hashing algorithm</span>
<span class=linenos data-linenos="66 "></span><span class=sd>        tp_approval: True if training plan approval is requested</span>
<span class=linenos data-linenos="67 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="68 "></span>
<span class=linenos data-linenos="69 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_node_id</span> <span class=o>=</span> <span class=n>node_id</span>
<span class=linenos data-linenos="70 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_tp_approval</span> <span class=o>=</span> <span class=n>tp_approval</span>
<span class=linenos data-linenos="71 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_default_tps</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>SHARE_DIR</span><span class=p>,</span> <span class=s1>&#39;envs&#39;</span><span class=p>,</span> <span class=s1>&#39;common&#39;</span><span class=p>,</span> <span class=s1>&#39;default_training_plans&#39;</span><span class=p>)</span>
<span class=linenos data-linenos="72 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_tinydb</span> <span class=o>=</span> <span class=n>TinyDB</span><span class=p>(</span><span class=n>db</span><span class=p>)</span>
<span class=linenos data-linenos="73 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_tinydb</span><span class=o>.</span><span class=n>table_class</span> <span class=o>=</span> <span class=n>DBTable</span>
<span class=linenos data-linenos="74 "></span>    <span class=c1># dont use DB read cache for coherence when updating from multiple sources (eg: GUI and CLI)</span>
<span class=linenos data-linenos="75 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_db</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_tinydb</span><span class=o>.</span><span class=n>table</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;TrainingPlans&quot;</span><span class=p>,</span> <span class=n>cache_size</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
<span class=linenos data-linenos="76 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_database</span> <span class=o>=</span> <span class=n>Query</span><span class=p>()</span>
<span class=linenos data-linenos="77 "></span>
<span class=linenos data-linenos="78 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_hashing</span> <span class=o>=</span> <span class=n>hashing</span>
<span class=linenos data-linenos="79 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_tags_to_remove</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;hash&quot;</span><span class=p>,</span> <span class=s2>&quot;date_modified&quot;</span><span class=p>,</span> <span class=s2>&quot;date_created&quot;</span><span class=p>]</span>
</code></pre></div> </details> <div class="doc doc-children"> <h4 id=fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager-functions>Functions</h4> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.approve_training_plan class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">approve_training_plan</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>approve_training_plan</span><span class=p>(</span><span class=n>training_plan_id</span><span class=p>,</span> <span class=n>extra_notes</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Approves a training plan stored into the database given its [<code>training_plan_id</code>]</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>training_plan_id</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>id of the training plan.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>extra_notes</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, None]</code> </td> <td> <div class=doc-md-description> <p>notes detailing why training plan has been approved. Defaults to None.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>True</code> </td> <td> <div class=doc-md-description> <p>Currently always returns True</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/node/training_plan_security_manager.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="948 "></span><span class=k>def</span> <span class=nf>approve_training_plan</span><span class=p>(</span>
<span class=linenos data-linenos="949 "></span>    <span class=bp>self</span><span class=p>,</span> <span class=n>training_plan_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>extra_notes</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="950 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>True</span><span class=p>:</span>
<span class=linenos data-linenos="951 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Approves a training plan stored into the database given its [`training_plan_id`]</span>
<span class=linenos data-linenos="952 "></span>
<span class=linenos data-linenos="953 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="954 "></span><span class=sd>        training_plan_id: id of the training plan.</span>
<span class=linenos data-linenos="955 "></span><span class=sd>        extra_notes: notes detailing why training plan has been approved. Defaults to None.</span>
<span class=linenos data-linenos="956 "></span>
<span class=linenos data-linenos="957 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="958 "></span><span class=sd>        Currently always returns True</span>
<span class=linenos data-linenos="959 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="960 "></span>    <span class=n>res</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_update_training_plan_status</span><span class=p>(</span>
<span class=linenos data-linenos="961 "></span>        <span class=n>training_plan_id</span><span class=p>,</span> <span class=n>TrainingPlanApprovalStatus</span><span class=o>.</span><span class=n>APPROVED</span><span class=p>,</span> <span class=n>extra_notes</span>
<span class=linenos data-linenos="962 "></span>    <span class=p>)</span>
<span class=linenos data-linenos="963 "></span>    <span class=k>return</span> <span class=n>res</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.check_hashes_for_registered_training_plans class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">check_hashes_for_registered_training_plans</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>check_hashes_for_registered_training_plans</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Checks registered training plans (training plans either rejected or approved).</p> <p>Makes sure training plan files exists and hashing algorithm is matched with specified algorithm in the config file.</p> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>cannot update training plan list in database</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/node/training_plan_security_manager.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="296 "></span><span class=k>def</span> <span class=nf>check_hashes_for_registered_training_plans</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=linenos data-linenos="297 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Checks registered training plans (training plans either rejected or approved).</span>
<span class=linenos data-linenos="298 "></span>
<span class=linenos data-linenos="299 "></span><span class=sd>    Makes sure training plan files exists and hashing algorithm is matched with specified</span>
<span class=linenos data-linenos="300 "></span><span class=sd>    algorithm in the config file.</span>
<span class=linenos data-linenos="301 "></span>
<span class=linenos data-linenos="302 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="303 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: cannot update training plan list in database</span>
<span class=linenos data-linenos="304 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="305 "></span>
<span class=linenos data-linenos="306 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="307 "></span>        <span class=n>training_plans</span><span class=p>,</span> <span class=n>docs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>search</span><span class=p>(</span>
<span class=linenos data-linenos="308 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>training_plan_type</span><span class=o>.</span><span class=n>all</span><span class=p>(</span>
<span class=linenos data-linenos="309 "></span>                <span class=n>TrainingPlanStatus</span><span class=o>.</span><span class=n>REGISTERED</span><span class=o>.</span><span class=n>value</span>
<span class=linenos data-linenos="310 "></span>            <span class=p>),</span>
<span class=linenos data-linenos="311 "></span>            <span class=n>add_docs</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
<span class=linenos data-linenos="312 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="313 "></span>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<span class=linenos data-linenos="314 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="315 "></span>            <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span>
<span class=linenos data-linenos="316 "></span>            <span class=o>+</span> <span class=sa>f</span><span class=s2>&quot;database search operation failed, with following error: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="317 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="318 "></span>    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Checking hashes for registered training plans&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="319 "></span>    <span class=k>if</span> <span class=ow>not</span> <span class=n>training_plans</span><span class=p>:</span>
<span class=linenos data-linenos="320 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;There are no training plans registered&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="321 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="322 "></span>        <span class=k>for</span> <span class=n>training_plan</span><span class=p>,</span> <span class=n>doc</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>training_plans</span><span class=p>,</span> <span class=n>docs</span><span class=p>):</span>
<span class=linenos data-linenos="323 "></span>            <span class=c1># If training plan file is exists</span>
<span class=linenos data-linenos="324 "></span>            <span class=k>if</span> <span class=n>training_plan</span><span class=p>[</span><span class=s2>&quot;algorithm&quot;</span><span class=p>]</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_hashing</span><span class=p>:</span>
<span class=linenos data-linenos="325 "></span>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<span class=linenos data-linenos="326 "></span>                    <span class=sa>f</span><span class=s1>&#39;Recreating hashing for : </span><span class=si>{</span><span class=n>training_plan</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span><span class=si>}</span><span class=s1> </span><span class=se>\t</span><span class=s1> </span><span class=si>{</span><span class=n>training_plan</span><span class=p>[</span><span class=s2>&quot;training_plan_id&quot;</span><span class=p>]</span><span class=si>}</span><span class=s1>&#39;</span>
<span class=linenos data-linenos="327 "></span>                <span class=p>)</span>
<span class=linenos data-linenos="328 "></span>                <span class=n>hashing</span><span class=p>,</span> <span class=n>algorithm</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_hash</span><span class=p>(</span>
<span class=linenos data-linenos="329 "></span>                    <span class=n>training_plan</span><span class=p>[</span><span class=s2>&quot;training_plan&quot;</span><span class=p>],</span> <span class=n>from_string</span><span class=o>=</span><span class=kc>True</span>
<span class=linenos data-linenos="330 "></span>                <span class=p>)</span>
<span class=linenos data-linenos="331 "></span>
<span class=linenos data-linenos="332 "></span>                <span class=c1># Verify no such training plan already exists in DB</span>
<span class=linenos data-linenos="333 "></span>                <span class=bp>self</span><span class=o>.</span><span class=n>_check_training_plan_not_existing</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>hashing</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<span class=linenos data-linenos="334 "></span>
<span class=linenos data-linenos="335 "></span>                <span class=n>rtime</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>%d</span><span class=s2>-%m-%Y %H:%M:%S.</span><span class=si>%f</span><span class=s2>&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="336 "></span>                <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="337 "></span>                    <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
<span class=linenos data-linenos="338 "></span>                        <span class=p>{</span>
<span class=linenos data-linenos="339 "></span>                            <span class=s2>&quot;hash&quot;</span><span class=p>:</span> <span class=n>hashing</span><span class=p>,</span>
<span class=linenos data-linenos="340 "></span>                            <span class=s2>&quot;algorithm&quot;</span><span class=p>:</span> <span class=n>algorithm</span><span class=p>,</span>
<span class=linenos data-linenos="341 "></span>                            <span class=s2>&quot;date_last_action&quot;</span><span class=p>:</span> <span class=n>rtime</span><span class=p>,</span>
<span class=linenos data-linenos="342 "></span>                        <span class=p>},</span>
<span class=linenos data-linenos="343 "></span>                        <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>training_plan_id</span><span class=o>.</span><span class=n>all</span><span class=p>(</span>
<span class=linenos data-linenos="344 "></span>                            <span class=n>training_plan</span><span class=p>[</span><span class=s2>&quot;training_plan_id&quot;</span><span class=p>]</span>
<span class=linenos data-linenos="345 "></span>                        <span class=p>),</span>
<span class=linenos data-linenos="346 "></span>                    <span class=p>)</span>
<span class=linenos data-linenos="347 "></span>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
<span class=linenos data-linenos="348 "></span>                    <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="349 "></span>                        <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span>
<span class=linenos data-linenos="350 "></span>                        <span class=o>+</span> <span class=s2>&quot;: database update failed, with error &quot;</span>
<span class=linenos data-linenos="351 "></span>                        <span class=sa>f</span><span class=s2>&quot; </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>err</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="352 "></span>                    <span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.check_training_plan_status class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">check_training_plan_status</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>check_training_plan_status</span><span class=p>(</span><span class=n>training_plan_source</span><span class=p>,</span> <span class=n>state</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Checks whether training plan exists in database and has the specified status.</p> <p>Sends a query to database to search for hash of requested training plan. If the hash matches with one of the training plans hashes in the DB, and if training plan has the specified status {approved, rejected, pending} or training_plan_type {registered, requested, default}.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>training_plan_source</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>The source code of requested training plan</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>state</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-internal" title="fedbiomed.common.constants.TrainingPlanApprovalStatus" href="../../common/constants/#fedbiomed.common.constants.TrainingPlanApprovalStatus">TrainingPlanApprovalStatus</a>, <a class="autorefs autorefs-internal" title="fedbiomed.common.constants.TrainingPlanStatus" href="../../common/constants/#fedbiomed.common.constants.TrainingPlanStatus">TrainingPlanStatus</a>, None]</code> </td> <td> <div class=doc-md-description> <p>training plan status or training plan type, to check against training plan. <code>None</code> accepts any training plan status or type.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a>, <a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]]</code> </td> <td> <div class=doc-md-description> <p>A tuple (is_status, training plan) where</p> <ul> <li>status: Whether training plan exists in database with specified status (returns True) or not (False)</li> <li>training_plan: Dictionary containing fields related to the training plan. If database search request failed, returns None instead.</li> </ul> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>bad argument type or value</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>database access problem</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/node/training_plan_security_manager.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="354 "></span><span class=k>def</span> <span class=nf>check_training_plan_status</span><span class=p>(</span>
<span class=linenos data-linenos="355 "></span>    <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="356 "></span>    <span class=n>training_plan_source</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<span class=linenos data-linenos="357 "></span>    <span class=n>state</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>TrainingPlanApprovalStatus</span><span class=p>,</span> <span class=n>TrainingPlanStatus</span><span class=p>,</span> <span class=kc>None</span><span class=p>],</span>
<span class=linenos data-linenos="358 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<span class=linenos data-linenos="359 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Checks whether training plan exists in database and has the specified status.</span>
<span class=linenos data-linenos="360 "></span>
<span class=linenos data-linenos="361 "></span><span class=sd>    Sends a query to database to search for hash of requested training plan.</span>
<span class=linenos data-linenos="362 "></span><span class=sd>    If the hash matches with one of the</span>
<span class=linenos data-linenos="363 "></span><span class=sd>    training plans hashes in the DB, and if training plan has the specified status {approved, rejected, pending}</span>
<span class=linenos data-linenos="364 "></span><span class=sd>    or training_plan_type {registered, requested, default}.</span>
<span class=linenos data-linenos="365 "></span>
<span class=linenos data-linenos="366 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="367 "></span><span class=sd>        training_plan_source: The source code of requested training plan</span>
<span class=linenos data-linenos="368 "></span><span class=sd>        state: training plan status or training plan type, to check against training plan. `None` accepts</span>
<span class=linenos data-linenos="369 "></span><span class=sd>            any training plan status or type.</span>
<span class=linenos data-linenos="370 "></span>
<span class=linenos data-linenos="371 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="372 "></span><span class=sd>        A tuple (is_status, training plan) where</span>
<span class=linenos data-linenos="373 "></span>
<span class=linenos data-linenos="374 "></span><span class=sd>            - status: Whether training plan exists in database</span>
<span class=linenos data-linenos="375 "></span><span class=sd>                with specified status (returns True) or not (False)</span>
<span class=linenos data-linenos="376 "></span><span class=sd>            - training_plan: Dictionary containing fields</span>
<span class=linenos data-linenos="377 "></span><span class=sd>                related to the training plan. If database search request failed,</span>
<span class=linenos data-linenos="378 "></span><span class=sd>                returns None instead.</span>
<span class=linenos data-linenos="379 "></span>
<span class=linenos data-linenos="380 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="381 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: bad argument type or value</span>
<span class=linenos data-linenos="382 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: database access problem</span>
<span class=linenos data-linenos="383 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="384 "></span>
<span class=linenos data-linenos="385 "></span>    <span class=c1># Create hash for requested training plan</span>
<span class=linenos data-linenos="386 "></span>    <span class=n>req_training_plan_hash</span><span class=p>,</span> <span class=o>*</span><span class=n>_</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_hash</span><span class=p>(</span>
<span class=linenos data-linenos="387 "></span>        <span class=n>training_plan_source</span><span class=p>,</span> <span class=n>from_string</span><span class=o>=</span><span class=kc>True</span>
<span class=linenos data-linenos="388 "></span>    <span class=p>)</span>
<span class=linenos data-linenos="389 "></span>
<span class=linenos data-linenos="390 "></span>    <span class=c1># If node allows defaults training plans search hash for all training plan types</span>
<span class=linenos data-linenos="391 "></span>    <span class=c1># otherwise search only for `registered` training plans</span>
<span class=linenos data-linenos="392 "></span>
<span class=linenos data-linenos="393 "></span>    <span class=k>if</span> <span class=n>state</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="394 "></span>        <span class=n>_all_training_plans_with_status</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="395 "></span>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=n>TrainingPlanApprovalStatus</span><span class=p>):</span>
<span class=linenos data-linenos="396 "></span>        <span class=n>_all_training_plans_with_status</span> <span class=o>=</span> <span class=p>(</span>
<span class=linenos data-linenos="397 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>training_plan_status</span> <span class=o>==</span> <span class=n>state</span><span class=o>.</span><span class=n>value</span>
<span class=linenos data-linenos="398 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="399 "></span>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=n>TrainingPlanStatus</span><span class=p>):</span>
<span class=linenos data-linenos="400 "></span>        <span class=n>_all_training_plans_with_status</span> <span class=o>=</span> <span class=p>(</span>
<span class=linenos data-linenos="401 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>training_plan_type</span> <span class=o>==</span> <span class=n>state</span><span class=o>.</span><span class=n>value</span>
<span class=linenos data-linenos="402 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="403 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="404 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="405 "></span>            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2> + status should be either TrainingPlanApprovalStatus or &quot;</span>
<span class=linenos data-linenos="406 "></span>            <span class=sa>f</span><span class=s2>&quot;TrainingPlanStatus, but got </span><span class=si>{</span><span class=nb>type</span><span class=p>(</span><span class=n>state</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="407 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="408 "></span>    <span class=n>_all_training_plans_which_have_req_hash</span> <span class=o>=</span> <span class=p>(</span>
<span class=linenos data-linenos="409 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>hash</span> <span class=o>==</span> <span class=n>req_training_plan_hash</span>
<span class=linenos data-linenos="410 "></span>    <span class=p>)</span>
<span class=linenos data-linenos="411 "></span>
<span class=linenos data-linenos="412 "></span>    <span class=k>if</span> <span class=n>_all_training_plans_with_status</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="413 "></span>        <span class=c1># check only against hash</span>
<span class=linenos data-linenos="414 "></span>        <span class=n>training_plan</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>_all_training_plans_which_have_req_hash</span><span class=p>)</span>
<span class=linenos data-linenos="415 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="416 "></span>        <span class=c1># check against hash and status</span>
<span class=linenos data-linenos="417 "></span>        <span class=n>training_plan</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
<span class=linenos data-linenos="418 "></span>            <span class=n>_all_training_plans_with_status</span>
<span class=linenos data-linenos="419 "></span>            <span class=o>&amp;</span> <span class=n>_all_training_plans_which_have_req_hash</span>
<span class=linenos data-linenos="420 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="421 "></span>
<span class=linenos data-linenos="422 "></span>    <span class=n>status</span> <span class=o>=</span> <span class=kc>True</span> <span class=k>if</span> <span class=n>training_plan</span> <span class=k>else</span> <span class=kc>False</span>
<span class=linenos data-linenos="423 "></span>
<span class=linenos data-linenos="424 "></span>    <span class=k>return</span> <span class=n>status</span><span class=p>,</span> <span class=n>training_plan</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.delete_training_plan class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">delete_training_plan</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>delete_training_plan</span><span class=p>(</span><span class=n>training_plan_id</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Removes training plan file from database.</p> <p>Only removes <code>registered</code> and <code>requested</code> type of training plans from the database. Does not remove the corresponding training plan file from the disk. Default training plans should be removed from the directory</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>training_plan_id</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>The id of the registered training plan.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>True</code> </td> <td> <div class=doc-md-description> <p>Currently always returns True.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>bad type for parameter</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>cannot read or remove training plan from the database</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>training plan is not a <code>registered</code> training plan (thus a <code>default</code> training plan)</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/node/training_plan_security_manager.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos=" 982 "></span><span class=k>def</span> <span class=nf>delete_training_plan</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>training_plan_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>True</span><span class=p>:</span>
<span class=linenos data-linenos=" 983 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Removes training plan file from database.</span>
<span class=linenos data-linenos=" 984 "></span>
<span class=linenos data-linenos=" 985 "></span><span class=sd>    Only removes `registered` and `requested` type of training plans from the database.</span>
<span class=linenos data-linenos=" 986 "></span><span class=sd>    Does not remove the corresponding training plan file from the disk.</span>
<span class=linenos data-linenos=" 987 "></span><span class=sd>    Default training plans should be removed from the directory</span>
<span class=linenos data-linenos=" 988 "></span>
<span class=linenos data-linenos=" 989 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos=" 990 "></span><span class=sd>        training_plan_id: The id of the registered training plan.</span>
<span class=linenos data-linenos=" 991 "></span>
<span class=linenos data-linenos=" 992 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos=" 993 "></span><span class=sd>        Currently always returns True.</span>
<span class=linenos data-linenos=" 994 "></span>
<span class=linenos data-linenos=" 995 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos=" 996 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: bad type for parameter</span>
<span class=linenos data-linenos=" 997 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: cannot read or remove training plan from the database</span>
<span class=linenos data-linenos=" 998 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: training plan is not a `registered` training plan</span>
<span class=linenos data-linenos=" 999 "></span><span class=sd>            (thus a `default` training plan)</span>
<span class=linenos data-linenos="1000 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="1001 "></span>
<span class=linenos data-linenos="1002 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="1003 "></span>        <span class=n>training_plan</span><span class=p>,</span> <span class=n>doc</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
<span class=linenos data-linenos="1004 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>training_plan_id</span> <span class=o>==</span> <span class=n>training_plan_id</span><span class=p>,</span> <span class=n>add_docs</span><span class=o>=</span><span class=kc>True</span>
<span class=linenos data-linenos="1005 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="1006 "></span>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
<span class=linenos data-linenos="1007 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="1008 "></span>            <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span> <span class=o>+</span> <span class=s2>&quot;: cannot get training plan from database.&quot;</span>
<span class=linenos data-linenos="1009 "></span>            <span class=sa>f</span><span class=s2>&quot;Details: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>err</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="1010 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="1011 "></span>
<span class=linenos data-linenos="1012 "></span>    <span class=k>if</span> <span class=n>training_plan</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="1013 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="1014 "></span>            <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span>
<span class=linenos data-linenos="1015 "></span>            <span class=o>+</span> <span class=sa>f</span><span class=s2>&quot;: training plan </span><span class=si>{</span><span class=n>training_plan_id</span><span class=si>}</span><span class=s2> not in database&quot;</span>
<span class=linenos data-linenos="1016 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="1017 "></span>
<span class=linenos data-linenos="1018 "></span>    <span class=k>if</span> <span class=n>training_plan</span><span class=p>[</span><span class=s2>&quot;training_plan_type&quot;</span><span class=p>]</span> <span class=o>!=</span> <span class=n>TrainingPlanStatus</span><span class=o>.</span><span class=n>DEFAULT</span><span class=o>.</span><span class=n>value</span><span class=p>:</span>
<span class=linenos data-linenos="1019 "></span>        <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="1020 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>doc_ids</span><span class=o>=</span><span class=p>[</span><span class=n>doc</span><span class=o>.</span><span class=n>doc_id</span><span class=p>])</span>
<span class=linenos data-linenos="1021 "></span>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
<span class=linenos data-linenos="1022 "></span>            <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="1023 "></span>                <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span>
<span class=linenos data-linenos="1024 "></span>                <span class=o>+</span> <span class=sa>f</span><span class=s2>&quot;: cannot remove training plan from database. Details: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>err</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="1025 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="1026 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="1027 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="1028 "></span>            <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span>
<span class=linenos data-linenos="1029 "></span>            <span class=o>+</span> <span class=s2>&quot;For default training plans, please remove training plan file from &quot;</span>
<span class=linenos data-linenos="1030 "></span>            <span class=s2>&quot;`default_training_plans` and restart your node&quot;</span>
<span class=linenos data-linenos="1031 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="1032 "></span>
<span class=linenos data-linenos="1033 "></span>    <span class=k>return</span> <span class=kc>True</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.get_training_plan_by_id class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_training_plan_by_id</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>get_training_plan_by_id</span><span class=p>(</span><span class=n>training_plan_id</span><span class=p>,</span> <span class=n>secure</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Get a training plan in database given his <code>training_plan_id</code>.</p> <p>Also add a <code>content</code> key to the returned dictionary. This method is not used within the library source code but it is used for Fed-BioMed GUI.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>training_plan_id</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>id of the training plan to pick from the database</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>secure</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </td> <td> <div class=doc-md-description> <p>if <code>True</code> then strip some security sensitive fields</p> </div> </td> <td> <code>True</code> </td> </tr> <tr class=doc-section-item> <td><code>content</code></td> <td> </td> <td> <div class=doc-md-description> <p>if <code>True</code> add content of training plan in <code>content</code> key of returned training plan. If <code>False</code> then <code>content</code> key value is <code>None</code></p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>], None]</code> </td> <td> <div class=doc-md-description> <p>training plan entry from database through a query based on the training plan_id.</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>], None]</code> </td> <td> <div class=doc-md-description> <p>If there is no training plan matching [<code>training_plan_id</code>], returns None</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>bad argument type</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>database access problem</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/node/training_plan_security_manager.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="472 "></span><span class=k>def</span> <span class=nf>get_training_plan_by_id</span><span class=p>(</span>
<span class=linenos data-linenos="473 "></span>    <span class=bp>self</span><span class=p>,</span> <span class=n>training_plan_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>secure</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>
<span class=linenos data-linenos="474 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=kc>None</span><span class=p>]:</span>
<span class=linenos data-linenos="475 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get a training plan in database given his `training_plan_id`.</span>
<span class=linenos data-linenos="476 "></span>
<span class=linenos data-linenos="477 "></span><span class=sd>    Also add a `content` key to the returned dictionary. This method is not used within the</span>
<span class=linenos data-linenos="478 "></span><span class=sd>    library source code but it is used for Fed-BioMed GUI.</span>
<span class=linenos data-linenos="479 "></span>
<span class=linenos data-linenos="480 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="481 "></span><span class=sd>        training_plan_id: id of the training plan to pick from the database</span>
<span class=linenos data-linenos="482 "></span><span class=sd>        secure: if `True` then strip some security sensitive fields</span>
<span class=linenos data-linenos="483 "></span><span class=sd>        content: if `True` add content of training plan in `content` key of returned training plan. If `False` then</span>
<span class=linenos data-linenos="484 "></span><span class=sd>            `content` key value is `None`</span>
<span class=linenos data-linenos="485 "></span>
<span class=linenos data-linenos="486 "></span>
<span class=linenos data-linenos="487 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="488 "></span><span class=sd>        training plan entry from database through a query based on the training plan_id.</span>
<span class=linenos data-linenos="489 "></span><span class=sd>        If there is no training plan matching [`training_plan_id`], returns None</span>
<span class=linenos data-linenos="490 "></span>
<span class=linenos data-linenos="491 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="492 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: bad argument type</span>
<span class=linenos data-linenos="493 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: database access problem</span>
<span class=linenos data-linenos="494 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="495 "></span>
<span class=linenos data-linenos="496 "></span>    <span class=n>training_plan</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
<span class=linenos data-linenos="497 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>training_plan_id</span> <span class=o>==</span> <span class=n>training_plan_id</span>
<span class=linenos data-linenos="498 "></span>    <span class=p>)</span>
<span class=linenos data-linenos="499 "></span>
<span class=linenos data-linenos="500 "></span>    <span class=k>if</span> <span class=n>training_plan</span> <span class=ow>and</span> <span class=n>secure</span><span class=p>:</span>
<span class=linenos data-linenos="501 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_remove_sensible_keys_from_request</span><span class=p>(</span><span class=n>training_plan</span><span class=p>)</span>
<span class=linenos data-linenos="502 "></span>
<span class=linenos data-linenos="503 "></span>    <span class=k>return</span> <span class=n>training_plan</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.get_training_plan_by_name class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_training_plan_by_name</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>get_training_plan_by_name</span><span class=p>(</span><span class=n>training_plan_name</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Gets training plan from database, by its name</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>training_plan_name</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>name of the training plan entry to search in the database</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>], None]</code> </td> <td> <div class=doc-md-description> <p>training plan entry found in the database matching <code>training_plan_name</code>. Otherwise, returns None.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>bad argument type</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>cannot read database.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/node/training_plan_security_manager.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="426 "></span><span class=k>def</span> <span class=nf>get_training_plan_by_name</span><span class=p>(</span>
<span class=linenos data-linenos="427 "></span>    <span class=bp>self</span><span class=p>,</span> <span class=n>training_plan_name</span><span class=p>:</span> <span class=nb>str</span>
<span class=linenos data-linenos="428 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=kc>None</span><span class=p>]:</span>
<span class=linenos data-linenos="429 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Gets training plan from database, by its name</span>
<span class=linenos data-linenos="430 "></span>
<span class=linenos data-linenos="431 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="432 "></span><span class=sd>        training_plan_name: name of the training plan entry to search in the database</span>
<span class=linenos data-linenos="433 "></span>
<span class=linenos data-linenos="434 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="435 "></span><span class=sd>        training plan entry found in the database matching `training_plan_name`. Otherwise, returns None.</span>
<span class=linenos data-linenos="436 "></span>
<span class=linenos data-linenos="437 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="438 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: bad argument type</span>
<span class=linenos data-linenos="439 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: cannot read database.</span>
<span class=linenos data-linenos="440 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="441 "></span>
<span class=linenos data-linenos="442 "></span>    <span class=n>training_plan</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=n>training_plan_name</span><span class=p>)</span>
<span class=linenos data-linenos="443 "></span>
<span class=linenos data-linenos="444 "></span>    <span class=k>return</span> <span class=n>training_plan</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.get_training_plan_from_database class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_training_plan_from_database</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>get_training_plan_from_database</span><span class=p>(</span><span class=n>training_plan</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Gets training plan from database, by its hash</p> <div class="admonition info"> <p class=admonition-title>Training plan file MUST be a *.txt file.</p> </div> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>training_plan</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>training plan source code, in order to compute its hash.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>], None]</code> </td> <td> <div class=doc-md-description> <p>Training plan entry found in the dataset if query in database succeed. Otherwise, returns</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>], None]</code> </td> <td> <div class=doc-md-description> <p>None.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>bad argument type</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>database access problem</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/node/training_plan_security_manager.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="446 "></span><span class=k>def</span> <span class=nf>get_training_plan_from_database</span><span class=p>(</span>
<span class=linenos data-linenos="447 "></span>    <span class=bp>self</span><span class=p>,</span> <span class=n>training_plan</span><span class=p>:</span> <span class=nb>str</span>
<span class=linenos data-linenos="448 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=kc>None</span><span class=p>]:</span>
<span class=linenos data-linenos="449 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Gets training plan from database, by its hash</span>
<span class=linenos data-linenos="450 "></span>
<span class=linenos data-linenos="451 "></span><span class=sd>    !!! info &quot;Training plan file MUST be a *.txt file.&quot;</span>
<span class=linenos data-linenos="452 "></span>
<span class=linenos data-linenos="453 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="454 "></span><span class=sd>        training_plan: training plan source code, in order to compute its hash.</span>
<span class=linenos data-linenos="455 "></span>
<span class=linenos data-linenos="456 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="457 "></span><span class=sd>        Training plan entry found in the dataset if query in database succeed. Otherwise, returns</span>
<span class=linenos data-linenos="458 "></span><span class=sd>        None.</span>
<span class=linenos data-linenos="459 "></span>
<span class=linenos data-linenos="460 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="461 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: bad argument type</span>
<span class=linenos data-linenos="462 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: database access problem</span>
<span class=linenos data-linenos="463 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="464 "></span>
<span class=linenos data-linenos="465 "></span>    <span class=n>req_training_plan_hash</span><span class=p>,</span> <span class=o>*</span><span class=n>_</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_hash</span><span class=p>(</span><span class=n>training_plan</span><span class=p>,</span> <span class=n>from_string</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=linenos data-linenos="466 "></span>    <span class=n>_all_training_plans_which_have_req_hash</span> <span class=o>=</span> <span class=p>(</span>
<span class=linenos data-linenos="467 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>hash</span> <span class=o>==</span> <span class=n>req_training_plan_hash</span>
<span class=linenos data-linenos="468 "></span>    <span class=p>)</span>
<span class=linenos data-linenos="469 "></span>
<span class=linenos data-linenos="470 "></span>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>_all_training_plans_which_have_req_hash</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.list_training_plans class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">list_training_plans</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>list_training_plans</span><span class=p>(</span><span class=n>sort_by</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>select_status</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>verbose</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>search</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Lists approved training plan files</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>sort_by</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, None]</code> </td> <td> <div class=doc-md-description> <p>when specified, sort results by alphabetical order, provided sort_by is an entry in the database.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>select_status</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[None, <a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-internal" title="fedbiomed.common.constants.TrainingPlanApprovalStatus" href="../../common/constants/#fedbiomed.common.constants.TrainingPlanApprovalStatus">TrainingPlanApprovalStatus</a>]]</code> </td> <td> <div class=doc-md-description> <p>filter list by training plan status or list of training plan statuses</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>verbose</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </td> <td> <div class=doc-md-description> <p>When it is True, print list of training plan in tabular format. Default is True.</p> </div> </td> <td> <code>True</code> </td> </tr> <tr class=doc-section-item> <td><code>search</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>, None]</code> </td> <td> <div class=doc-md-description> <p>Dictionary that contains <code>text</code> property to declare the text that wil be search and <code>by</code> property to declare text will be search on which field</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]]</code> </td> <td> <div class=doc-md-description> <p>A list of training plans that have been found as <code>registered</code>. Each training plan is in fact a dictionary containing fields (note that following fields are removed :'training_plan', 'hash', dates due to privacy reasons).</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>bad type for parameter</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>database access error</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/node/training_plan_security_manager.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="1035 "></span><span class=k>def</span> <span class=nf>list_training_plans</span><span class=p>(</span>
<span class=linenos data-linenos="1036 "></span>    <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="1037 "></span>    <span class=n>sort_by</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="1038 "></span>    <span class=n>select_status</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=kc>None</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=n>TrainingPlanApprovalStatus</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="1039 "></span>    <span class=n>verbose</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
<span class=linenos data-linenos="1040 "></span>    <span class=n>search</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>dict</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="1041 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<span class=linenos data-linenos="1042 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Lists approved training plan files</span>
<span class=linenos data-linenos="1043 "></span>
<span class=linenos data-linenos="1044 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="1045 "></span><span class=sd>        sort_by: when specified, sort results by alphabetical order,</span>
<span class=linenos data-linenos="1046 "></span><span class=sd>            provided sort_by is an entry in the database.</span>
<span class=linenos data-linenos="1047 "></span><span class=sd>        select_status: filter list by training plan status or list of training plan statuses</span>
<span class=linenos data-linenos="1048 "></span><span class=sd>        verbose: When it is True, print list of training plan in tabular format.</span>
<span class=linenos data-linenos="1049 "></span><span class=sd>            Default is True.</span>
<span class=linenos data-linenos="1050 "></span><span class=sd>        search: Dictionary that contains `text` property to declare the text that wil be search and `by`</span>
<span class=linenos data-linenos="1051 "></span><span class=sd>            property to declare text will be search on which field</span>
<span class=linenos data-linenos="1052 "></span>
<span class=linenos data-linenos="1053 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="1054 "></span><span class=sd>        A list of training plans that have</span>
<span class=linenos data-linenos="1055 "></span><span class=sd>            been found as `registered`. Each training plan is in fact a dictionary</span>
<span class=linenos data-linenos="1056 "></span><span class=sd>            containing fields (note that following fields are removed :&#39;training_plan&#39;,</span>
<span class=linenos data-linenos="1057 "></span><span class=sd>            &#39;hash&#39;, dates due to privacy reasons).</span>
<span class=linenos data-linenos="1058 "></span>
<span class=linenos data-linenos="1059 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="1060 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: bad type for parameter</span>
<span class=linenos data-linenos="1061 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: database access error</span>
<span class=linenos data-linenos="1062 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="1063 "></span>
<span class=linenos data-linenos="1064 "></span>    <span class=c1># Selects all</span>
<span class=linenos data-linenos="1065 "></span>    <span class=n>query</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>training_plan_id</span><span class=o>.</span><span class=n>exists</span><span class=p>()</span>
<span class=linenos data-linenos="1066 "></span>
<span class=linenos data-linenos="1067 "></span>    <span class=k>if</span> <span class=n>select_status</span><span class=p>:</span>
<span class=linenos data-linenos="1068 "></span>        <span class=c1># filtering training plan based on their status</span>
<span class=linenos data-linenos="1069 "></span>        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>select_status</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<span class=linenos data-linenos="1070 "></span>            <span class=c1># convert everything into a list</span>
<span class=linenos data-linenos="1071 "></span>            <span class=n>select_status</span> <span class=o>=</span> <span class=p>[</span><span class=n>select_status</span><span class=p>]</span>
<span class=linenos data-linenos="1072 "></span>
<span class=linenos data-linenos="1073 "></span>        <span class=n>select_status</span> <span class=o>=</span> <span class=p>[</span>
<span class=linenos data-linenos="1074 "></span>            <span class=n>x</span><span class=o>.</span><span class=n>value</span>
<span class=linenos data-linenos="1075 "></span>            <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>select_status</span>
<span class=linenos data-linenos="1076 "></span>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>TrainingPlanApprovalStatus</span><span class=p>)</span>
<span class=linenos data-linenos="1077 "></span>        <span class=p>]</span>
<span class=linenos data-linenos="1078 "></span>        <span class=n>query</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>training_plan_status</span><span class=o>.</span><span class=n>one_of</span><span class=p>(</span><span class=n>select_status</span><span class=p>)</span>
<span class=linenos data-linenos="1079 "></span>        <span class=c1># extract value from TrainingPlanApprovalStatus</span>
<span class=linenos data-linenos="1080 "></span>
<span class=linenos data-linenos="1081 "></span>    <span class=k>if</span> <span class=n>search</span><span class=p>:</span>
<span class=linenos data-linenos="1082 "></span>        <span class=n>query</span> <span class=o>=</span> <span class=n>query</span> <span class=o>&amp;</span> <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=p>[</span><span class=n>search</span><span class=p>[</span><span class=s2>&quot;by&quot;</span><span class=p>]]</span><span class=o>.</span><span class=n>matches</span><span class=p>(</span>
<span class=linenos data-linenos="1083 "></span>            <span class=n>search</span><span class=p>[</span><span class=s2>&quot;text&quot;</span><span class=p>],</span> <span class=n>flags</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>IGNORECASE</span>
<span class=linenos data-linenos="1084 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="1085 "></span>
<span class=linenos data-linenos="1086 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="1087 "></span>        <span class=n>training_plans</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
<span class=linenos data-linenos="1088 "></span>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
<span class=linenos data-linenos="1089 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="1090 "></span>            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: request failed when looking for a training plan into database with &quot;</span>
<span class=linenos data-linenos="1091 "></span>            <span class=sa>f</span><span class=s2>&quot;error: </span><span class=si>{</span><span class=n>err</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="1092 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="1093 "></span>
<span class=linenos data-linenos="1094 "></span>    <span class=c1># Drop some keys for security reasons</span>
<span class=linenos data-linenos="1095 "></span>    <span class=k>for</span> <span class=n>doc</span> <span class=ow>in</span> <span class=n>training_plans</span><span class=p>:</span>
<span class=linenos data-linenos="1096 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_remove_sensible_keys_from_request</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
<span class=linenos data-linenos="1097 "></span>
<span class=linenos data-linenos="1098 "></span>    <span class=k>if</span> <span class=n>sort_by</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="1099 "></span>        <span class=c1># sorting training plan fields by column attributes</span>
<span class=linenos data-linenos="1100 "></span>        <span class=n>is_entry_exists</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=p>[</span><span class=n>sort_by</span><span class=p>]</span><span class=o>.</span><span class=n>exists</span><span class=p>())</span>
<span class=linenos data-linenos="1101 "></span>        <span class=k>if</span> <span class=n>is_entry_exists</span> <span class=ow>and</span> <span class=n>sort_by</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_tags_to_remove</span><span class=p>:</span>
<span class=linenos data-linenos="1102 "></span>            <span class=n>training_plans</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span>
<span class=linenos data-linenos="1103 "></span>                <span class=n>training_plans</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=n>sort_by</span><span class=p>]</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>,</span> <span class=n>x</span><span class=p>[</span><span class=n>sort_by</span><span class=p>])</span>
<span class=linenos data-linenos="1104 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="1105 "></span>        <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="1106 "></span>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Field </span><span class=si>{</span><span class=n>sort_by</span><span class=si>}</span><span class=s2> is not available in dataset&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="1107 "></span>
<span class=linenos data-linenos="1108 "></span>    <span class=k>if</span> <span class=n>verbose</span><span class=p>:</span>
<span class=linenos data-linenos="1109 "></span>        <span class=n>training_plans_verbose</span> <span class=o>=</span> <span class=n>training_plans</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
<span class=linenos data-linenos="1110 "></span>        <span class=k>for</span> <span class=n>tp</span> <span class=ow>in</span> <span class=n>training_plans_verbose</span><span class=p>:</span>
<span class=linenos data-linenos="1111 "></span>            <span class=n>tp</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;training_plan&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="1112 "></span>
<span class=linenos data-linenos="1113 "></span>        <span class=nb>print</span><span class=p>(</span><span class=n>tabulate</span><span class=p>(</span><span class=n>training_plans_verbose</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=s2>&quot;keys&quot;</span><span class=p>))</span>
<span class=linenos data-linenos="1114 "></span>
<span class=linenos data-linenos="1115 "></span>    <span class=k>return</span> <span class=n>training_plans</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.register_training_plan class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">register_training_plan</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>register_training_plan</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>description</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>training_plan_type</span><span class=o>=</span><span class=n>TrainingPlanStatus</span><span class=o>.</span><span class=n>REGISTERED</span><span class=o>.</span><span class=n>value</span><span class=p>,</span> <span class=n>training_plan_id</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>researcher_id</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Approves/registers training plan file through CLI.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>name</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>Training plan file name. The name should be unique. Otherwise, methods throws an Exception FedbiomedTrainingPlanSecurityManagerError</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>description</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>Description for training plan file.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>path</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>Exact path for the training plan that will be registered</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>training_plan_type</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>Default is <code>registered</code>. It means that training plan has been registered by a user/hospital. Other value can be <code>default</code> which indicates that training plan is default (training plans for tutorials/examples)</p> </div> </td> <td> <code><span title="fedbiomed.common.constants.TrainingPlanStatus.REGISTERED.value">value</span></code> </td> </tr> <tr class=doc-section-item> <td><code>training_plan_id</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>Pre-defined id for training plan. Default is None. When it is None method creates unique id for the training plan.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td><code>researcher_id</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>ID of the researcher who is owner/requester of the training plan file</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>The ID of registered training plan</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p><code>training_plan_type</code> is not <code>registered</code> or <code>default</code></p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>training plan is already registered into database</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>training plan name is already used for saving another training plan</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>database access problem</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/node/training_plan_security_manager.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="214 "></span><span class=k>def</span> <span class=nf>register_training_plan</span><span class=p>(</span>
<span class=linenos data-linenos="215 "></span>    <span class=bp>self</span><span class=p>,</span>
<span class=linenos data-linenos="216 "></span>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<span class=linenos data-linenos="217 "></span>    <span class=n>description</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<span class=linenos data-linenos="218 "></span>    <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<span class=linenos data-linenos="219 "></span>    <span class=n>training_plan_type</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>TrainingPlanStatus</span><span class=o>.</span><span class=n>REGISTERED</span><span class=o>.</span><span class=n>value</span><span class=p>,</span>
<span class=linenos data-linenos="220 "></span>    <span class=n>training_plan_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="221 "></span>    <span class=n>researcher_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="222 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=linenos data-linenos="223 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Approves/registers training plan file through CLI.</span>
<span class=linenos data-linenos="224 "></span>
<span class=linenos data-linenos="225 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="226 "></span><span class=sd>        name: Training plan file name. The name should be unique. Otherwise, methods</span>
<span class=linenos data-linenos="227 "></span><span class=sd>            throws an Exception FedbiomedTrainingPlanSecurityManagerError</span>
<span class=linenos data-linenos="228 "></span><span class=sd>        description: Description for training plan file.</span>
<span class=linenos data-linenos="229 "></span><span class=sd>        path: Exact path for the training plan that will be registered</span>
<span class=linenos data-linenos="230 "></span><span class=sd>        training_plan_type: Default is `registered`. It means that training plan has been registered</span>
<span class=linenos data-linenos="231 "></span><span class=sd>            by a user/hospital. Other value can be `default` which indicates</span>
<span class=linenos data-linenos="232 "></span><span class=sd>            that training plan is default (training plans for tutorials/examples)</span>
<span class=linenos data-linenos="233 "></span><span class=sd>        training_plan_id: Pre-defined id for training plan. Default is None. When it is None method</span>
<span class=linenos data-linenos="234 "></span><span class=sd>            creates unique id for the training plan.</span>
<span class=linenos data-linenos="235 "></span><span class=sd>        researcher_id: ID of the researcher who is owner/requester of the training plan file</span>
<span class=linenos data-linenos="236 "></span>
<span class=linenos data-linenos="237 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="238 "></span><span class=sd>        The ID of registered training plan</span>
<span class=linenos data-linenos="239 "></span>
<span class=linenos data-linenos="240 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="241 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: `training_plan_type` is not `registered` or `default`</span>
<span class=linenos data-linenos="242 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: training plan is already registered into database</span>
<span class=linenos data-linenos="243 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: training plan name is already used for saving another training plan</span>
<span class=linenos data-linenos="244 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: database access problem</span>
<span class=linenos data-linenos="245 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="246 "></span>
<span class=linenos data-linenos="247 "></span>    <span class=c1># Check training plan type is valid</span>
<span class=linenos data-linenos="248 "></span>    <span class=k>if</span> <span class=n>training_plan_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>TrainingPlanStatus</span><span class=o>.</span><span class=n>list</span><span class=p>():</span>
<span class=linenos data-linenos="249 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="250 "></span>            <span class=sa>f</span><span class=s2>&quot;Unknown training plan (training_plan_type) type: </span><span class=si>{</span><span class=n>training_plan_type</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="251 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="252 "></span>
<span class=linenos data-linenos="253 "></span>    <span class=k>if</span> <span class=ow>not</span> <span class=n>training_plan_id</span><span class=p>:</span>
<span class=linenos data-linenos="254 "></span>        <span class=n>training_plan_id</span> <span class=o>=</span> <span class=s2>&quot;training_plan_&quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
<span class=linenos data-linenos="255 "></span>    <span class=n>training_plan_hash</span><span class=p>,</span> <span class=n>algorithm</span><span class=p>,</span> <span class=n>source</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_hash</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
<span class=linenos data-linenos="256 "></span>
<span class=linenos data-linenos="257 "></span>    <span class=c1># Verify no such training plan is already registered</span>
<span class=linenos data-linenos="258 "></span>    <span class=bp>self</span><span class=o>.</span><span class=n>_check_training_plan_not_existing</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>training_plan_hash</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<span class=linenos data-linenos="259 "></span>
<span class=linenos data-linenos="260 "></span>    <span class=c1># Training plan file creation date</span>
<span class=linenos data-linenos="261 "></span>    <span class=n>ctime</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>getctime</span><span class=p>(</span><span class=n>path</span><span class=p>))</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span>
<span class=linenos data-linenos="262 "></span>        <span class=s2>&quot;</span><span class=si>%d</span><span class=s2>-%m-%Y %H:%M:%S.</span><span class=si>%f</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="263 "></span>    <span class=p>)</span>
<span class=linenos data-linenos="264 "></span>    <span class=c1># Training plan file modification date</span>
<span class=linenos data-linenos="265 "></span>    <span class=n>mtime</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>getmtime</span><span class=p>(</span><span class=n>path</span><span class=p>))</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span>
<span class=linenos data-linenos="266 "></span>        <span class=s2>&quot;</span><span class=si>%d</span><span class=s2>-%m-%Y %H:%M:%S.</span><span class=si>%f</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="267 "></span>    <span class=p>)</span>
<span class=linenos data-linenos="268 "></span>    <span class=c1># Training plan file registration date</span>
<span class=linenos data-linenos="269 "></span>    <span class=n>rtime</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>%d</span><span class=s2>-%m-%Y %H:%M:%S.</span><span class=si>%f</span><span class=s2>&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="270 "></span>
<span class=linenos data-linenos="271 "></span>    <span class=n>training_plan_record</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span>
<span class=linenos data-linenos="272 "></span>        <span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>,</span>
<span class=linenos data-linenos="273 "></span>        <span class=n>description</span><span class=o>=</span><span class=n>description</span><span class=p>,</span>
<span class=linenos data-linenos="274 "></span>        <span class=nb>hash</span><span class=o>=</span><span class=n>training_plan_hash</span><span class=p>,</span>
<span class=linenos data-linenos="275 "></span>        <span class=n>training_plan</span><span class=o>=</span><span class=n>source</span><span class=p>,</span>
<span class=linenos data-linenos="276 "></span>        <span class=n>training_plan_id</span><span class=o>=</span><span class=n>training_plan_id</span><span class=p>,</span>
<span class=linenos data-linenos="277 "></span>        <span class=n>training_plan_type</span><span class=o>=</span><span class=n>training_plan_type</span><span class=p>,</span>
<span class=linenos data-linenos="278 "></span>        <span class=n>training_plan_status</span><span class=o>=</span><span class=n>TrainingPlanApprovalStatus</span><span class=o>.</span><span class=n>APPROVED</span><span class=o>.</span><span class=n>value</span><span class=p>,</span>
<span class=linenos data-linenos="279 "></span>        <span class=n>algorithm</span><span class=o>=</span><span class=n>algorithm</span><span class=p>,</span>
<span class=linenos data-linenos="280 "></span>        <span class=n>researcher_id</span><span class=o>=</span><span class=n>researcher_id</span><span class=p>,</span>
<span class=linenos data-linenos="281 "></span>        <span class=n>date_created</span><span class=o>=</span><span class=n>ctime</span><span class=p>,</span>
<span class=linenos data-linenos="282 "></span>        <span class=n>date_modified</span><span class=o>=</span><span class=n>mtime</span><span class=p>,</span>
<span class=linenos data-linenos="283 "></span>        <span class=n>date_registered</span><span class=o>=</span><span class=n>rtime</span><span class=p>,</span>
<span class=linenos data-linenos="284 "></span>        <span class=n>date_last_action</span><span class=o>=</span><span class=n>rtime</span><span class=p>,</span>
<span class=linenos data-linenos="285 "></span>    <span class=p>)</span>
<span class=linenos data-linenos="286 "></span>
<span class=linenos data-linenos="287 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="288 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>training_plan_record</span><span class=p>)</span>
<span class=linenos data-linenos="289 "></span>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
<span class=linenos data-linenos="290 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="291 "></span>            <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span> <span class=o>+</span> <span class=s2>&quot; : database insertion failed with&quot;</span>
<span class=linenos data-linenos="292 "></span>            <span class=sa>f</span><span class=s2>&quot; following error: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>err</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="293 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="294 "></span>    <span class=k>return</span> <span class=n>training_plan_id</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.register_update_default_training_plans class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">register_update_default_training_plans</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>register_update_default_training_plans</span><span class=p>()</span>
</code></pre></div> <div class="doc doc-contents "> <p>Registers or updates default training plans.</p> <p>Launched when the node is started through CLI, if <code>allow_default_training_plans</code> is enabled. Checks the files saved into <code>default_training_plans</code> directory and update/register them based on following conditions:</p> <ul> <li>Registers if there is a new training plan file which isn't saved into db.</li> <li>Updates if training plan is modified or if hashing algorithm has changed in config file.</li> </ul> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>cannot read or update training plan database</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/node/training_plan_security_manager.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="681 "></span><span class=k>def</span> <span class=nf>register_update_default_training_plans</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=linenos data-linenos="682 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Registers or updates default training plans.</span>
<span class=linenos data-linenos="683 "></span>
<span class=linenos data-linenos="684 "></span><span class=sd>    Launched when the node is started through CLI, if `allow_default_training_plans` is enabled.</span>
<span class=linenos data-linenos="685 "></span><span class=sd>    Checks the files saved into `default_training_plans` directory and update/register them based on following</span>
<span class=linenos data-linenos="686 "></span><span class=sd>    conditions:</span>
<span class=linenos data-linenos="687 "></span>
<span class=linenos data-linenos="688 "></span><span class=sd>    - Registers if there is a new training plan file which isn&#39;t saved into db.</span>
<span class=linenos data-linenos="689 "></span><span class=sd>    - Updates if training plan is modified or if hashing algorithm has changed in config file.</span>
<span class=linenos data-linenos="690 "></span>
<span class=linenos data-linenos="691 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="692 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: cannot read or update training plan database</span>
<span class=linenos data-linenos="693 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="694 "></span>
<span class=linenos data-linenos="695 "></span>    <span class=c1># Get training plan files saved in the directory</span>
<span class=linenos data-linenos="696 "></span>    <span class=n>training_plans_file</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_default_tps</span><span class=p>)</span>
<span class=linenos data-linenos="697 "></span>
<span class=linenos data-linenos="698 "></span>    <span class=c1># Get only default training plans from DB</span>
<span class=linenos data-linenos="699 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="700 "></span>        <span class=n>training_plans</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>search</span><span class=p>(</span>
<span class=linenos data-linenos="701 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>training_plan_type</span> <span class=o>==</span> <span class=s2>&quot;default&quot;</span>
<span class=linenos data-linenos="702 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="703 "></span>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<span class=linenos data-linenos="704 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="705 "></span>            <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span>
<span class=linenos data-linenos="706 "></span>            <span class=o>+</span> <span class=sa>f</span><span class=s2>&quot;database search operation failed, with following error: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="707 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="708 "></span>
<span class=linenos data-linenos="709 "></span>    <span class=c1># Get training plan names from list of training plans</span>
<span class=linenos data-linenos="710 "></span>    <span class=n>training_plans_dict</span> <span class=o>=</span> <span class=p>{</span>
<span class=linenos data-linenos="711 "></span>        <span class=n>training_plan</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;name&quot;</span><span class=p>):</span> <span class=n>training_plan</span> <span class=k>for</span> <span class=n>training_plan</span> <span class=ow>in</span> <span class=n>training_plans</span>
<span class=linenos data-linenos="712 "></span>    <span class=p>}</span>
<span class=linenos data-linenos="713 "></span>    <span class=n>training_plans_name_db</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>training_plans_dict</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>
<span class=linenos data-linenos="714 "></span>    <span class=c1># Default training plans not in database</span>
<span class=linenos data-linenos="715 "></span>    <span class=n>training_plans_not_saved</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span>
<span class=linenos data-linenos="716 "></span>        <span class=nb>set</span><span class=p>(</span><span class=n>training_plans_file</span><span class=p>)</span> <span class=o>-</span> <span class=nb>set</span><span class=p>(</span><span class=n>training_plans_name_db</span><span class=p>)</span>
<span class=linenos data-linenos="717 "></span>    <span class=p>)</span>
<span class=linenos data-linenos="718 "></span>    <span class=c1># Default training plans that have been deleted from file system but not in DB</span>
<span class=linenos data-linenos="719 "></span>    <span class=n>training_plans_deleted</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span>
<span class=linenos data-linenos="720 "></span>        <span class=nb>set</span><span class=p>(</span><span class=n>training_plans_name_db</span><span class=p>)</span> <span class=o>-</span> <span class=nb>set</span><span class=p>(</span><span class=n>training_plans_file</span><span class=p>)</span>
<span class=linenos data-linenos="721 "></span>    <span class=p>)</span>
<span class=linenos data-linenos="722 "></span>    <span class=c1># Training plans have already saved and exist in the database</span>
<span class=linenos data-linenos="723 "></span>    <span class=n>training_plans_exists</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span>
<span class=linenos data-linenos="724 "></span>        <span class=nb>set</span><span class=p>(</span><span class=n>training_plans_file</span><span class=p>)</span> <span class=o>-</span> <span class=nb>set</span><span class=p>(</span><span class=n>training_plans_not_saved</span><span class=p>)</span>
<span class=linenos data-linenos="725 "></span>    <span class=p>)</span>
<span class=linenos data-linenos="726 "></span>
<span class=linenos data-linenos="727 "></span>    <span class=c1># Register new default training plans</span>
<span class=linenos data-linenos="728 "></span>    <span class=k>for</span> <span class=n>training_plan</span> <span class=ow>in</span> <span class=n>training_plans_not_saved</span><span class=p>:</span>
<span class=linenos data-linenos="729 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>register_training_plan</span><span class=p>(</span>
<span class=linenos data-linenos="730 "></span>            <span class=n>name</span><span class=o>=</span><span class=n>training_plan</span><span class=p>,</span>
<span class=linenos data-linenos="731 "></span>            <span class=n>description</span><span class=o>=</span><span class=s2>&quot;Default training plan&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="732 "></span>            <span class=n>path</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_default_tps</span><span class=p>,</span> <span class=n>training_plan</span><span class=p>),</span>
<span class=linenos data-linenos="733 "></span>            <span class=n>training_plan_type</span><span class=o>=</span><span class=s2>&quot;default&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="734 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="735 "></span>
<span class=linenos data-linenos="736 "></span>    <span class=c1># Remove training plans that have been removed from file system</span>
<span class=linenos data-linenos="737 "></span>    <span class=k>for</span> <span class=n>training_plan_name</span> <span class=ow>in</span> <span class=n>training_plans_deleted</span><span class=p>:</span>
<span class=linenos data-linenos="738 "></span>        <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="739 "></span>            <span class=n>_</span><span class=p>,</span> <span class=n>training_plan_doc</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
<span class=linenos data-linenos="740 "></span>                <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=n>training_plan_name</span><span class=p>,</span> <span class=n>add_docs</span><span class=o>=</span><span class=kc>True</span>
<span class=linenos data-linenos="741 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="742 "></span>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<span class=linenos data-linenos="743 "></span>                <span class=s2>&quot;Removed default training plan file has been detected,&quot;</span>
<span class=linenos data-linenos="744 "></span>                <span class=sa>f</span><span class=s2>&quot; it will be removed from DB as well: </span><span class=si>{</span><span class=n>training_plan_name</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="745 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="746 "></span>
<span class=linenos data-linenos="747 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>doc_ids</span><span class=o>=</span><span class=p>[</span><span class=n>training_plan_doc</span><span class=o>.</span><span class=n>doc_id</span><span class=p>])</span>
<span class=linenos data-linenos="748 "></span>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
<span class=linenos data-linenos="749 "></span>            <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="750 "></span>                <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span> <span class=o>+</span> <span class=s2>&quot;: failed to update database, &quot;</span>
<span class=linenos data-linenos="751 "></span>                <span class=sa>f</span><span class=s2>&quot; with error </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>err</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="752 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="753 "></span>    <span class=c1># Update training plans</span>
<span class=linenos data-linenos="754 "></span>    <span class=k>for</span> <span class=n>training_plan</span> <span class=ow>in</span> <span class=n>training_plans_exists</span><span class=p>:</span>
<span class=linenos data-linenos="755 "></span>        <span class=n>path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_default_tps</span><span class=p>,</span> <span class=n>training_plan</span><span class=p>)</span>
<span class=linenos data-linenos="756 "></span>        <span class=n>mtime</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>getmtime</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>
<span class=linenos data-linenos="757 "></span>        <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="758 "></span>            <span class=n>training_plan_info</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=n>training_plan</span><span class=p>)</span>
<span class=linenos data-linenos="759 "></span>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
<span class=linenos data-linenos="760 "></span>            <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="761 "></span>                <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span>
<span class=linenos data-linenos="762 "></span>                <span class=o>+</span> <span class=sa>f</span><span class=s2>&quot;: failed to get training_plan info for training plan </span><span class=si>{</span><span class=n>training_plan</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="763 "></span>                <span class=sa>f</span><span class=s2>&quot;Details : </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>err</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="764 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="765 "></span>
<span class=linenos data-linenos="766 "></span>        <span class=c1># Check if hashing algorithm has changed</span>
<span class=linenos data-linenos="767 "></span>        <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="768 "></span>            <span class=nb>hash</span><span class=p>,</span> <span class=n>algorithm</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_hash</span><span class=p>(</span>
<span class=linenos data-linenos="769 "></span>                <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_default_tps</span><span class=p>,</span> <span class=n>training_plan</span><span class=p>)</span>
<span class=linenos data-linenos="770 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="771 "></span>
<span class=linenos data-linenos="772 "></span>            <span class=k>if</span> <span class=n>training_plan_info</span><span class=p>[</span><span class=s2>&quot;algorithm&quot;</span><span class=p>]</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_hashing</span><span class=p>:</span>
<span class=linenos data-linenos="773 "></span>                <span class=c1># Verify no such training plan already exists in DB</span>
<span class=linenos data-linenos="774 "></span>                <span class=bp>self</span><span class=o>.</span><span class=n>_check_training_plan_not_existing</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=nb>hash</span><span class=p>,</span> <span class=n>algorithm</span><span class=p>)</span>
<span class=linenos data-linenos="775 "></span>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<span class=linenos data-linenos="776 "></span>                    <span class=sa>f</span><span class=s1>&#39;Recreating hashing for : </span><span class=si>{</span><span class=n>training_plan_info</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span><span class=si>}</span><span class=s1> </span><span class=se>\t</span><span class=s1>&#39;</span>
<span class=linenos data-linenos="777 "></span>                    <span class=s1>&#39;</span><span class=si>{training_plan_info[&quot;training_plan_id&quot;]}</span><span class=s1>&#39;</span>
<span class=linenos data-linenos="778 "></span>                <span class=p>)</span>
<span class=linenos data-linenos="779 "></span>
<span class=linenos data-linenos="780 "></span>                <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
<span class=linenos data-linenos="781 "></span>                    <span class=p>{</span>
<span class=linenos data-linenos="782 "></span>                        <span class=s2>&quot;hash&quot;</span><span class=p>:</span> <span class=nb>hash</span><span class=p>,</span>
<span class=linenos data-linenos="783 "></span>                        <span class=s2>&quot;algorithm&quot;</span><span class=p>:</span> <span class=n>algorithm</span><span class=p>,</span>
<span class=linenos data-linenos="784 "></span>                        <span class=s2>&quot;date_last_action&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span>
<span class=linenos data-linenos="785 "></span>                            <span class=s2>&quot;</span><span class=si>%d</span><span class=s2>-%m-%Y %H:%M:%S.</span><span class=si>%f</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="786 "></span>                        <span class=p>),</span>
<span class=linenos data-linenos="787 "></span>                    <span class=p>},</span>
<span class=linenos data-linenos="788 "></span>                    <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>training_plan_id</span>
<span class=linenos data-linenos="789 "></span>                    <span class=o>==</span> <span class=n>training_plan_info</span><span class=p>[</span><span class=s2>&quot;training_plan_id&quot;</span><span class=p>],</span>
<span class=linenos data-linenos="790 "></span>                <span class=p>)</span>
<span class=linenos data-linenos="791 "></span>            <span class=c1># If default training plan file is modified update hashing</span>
<span class=linenos data-linenos="792 "></span>            <span class=k>elif</span> <span class=n>mtime</span> <span class=o>&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>strptime</span><span class=p>(</span>
<span class=linenos data-linenos="793 "></span>                <span class=n>training_plan_info</span><span class=p>[</span><span class=s2>&quot;date_modified&quot;</span><span class=p>],</span> <span class=s2>&quot;</span><span class=si>%d</span><span class=s2>-%m-%Y %H:%M:%S.</span><span class=si>%f</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="794 "></span>            <span class=p>):</span>
<span class=linenos data-linenos="795 "></span>                <span class=c1># only check when hash changes</span>
<span class=linenos data-linenos="796 "></span>                <span class=c1># else we have error because this training plan exists in database with same hash</span>
<span class=linenos data-linenos="797 "></span>                <span class=k>if</span> <span class=nb>hash</span> <span class=o>!=</span> <span class=n>training_plan_info</span><span class=p>[</span><span class=s2>&quot;hash&quot;</span><span class=p>]:</span>
<span class=linenos data-linenos="798 "></span>                    <span class=c1># Verify no such training plan already exists in DB</span>
<span class=linenos data-linenos="799 "></span>                    <span class=bp>self</span><span class=o>.</span><span class=n>_check_training_plan_not_existing</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=nb>hash</span><span class=p>,</span> <span class=n>algorithm</span><span class=p>)</span>
<span class=linenos data-linenos="800 "></span>
<span class=linenos data-linenos="801 "></span>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<span class=linenos data-linenos="802 "></span>                    <span class=s2>&quot;Modified default training plan file has been detected. &quot;</span>
<span class=linenos data-linenos="803 "></span>                    <span class=sa>f</span><span class=s2>&quot;Hashing will be updated for: </span><span class=si>{</span><span class=n>training_plan</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="804 "></span>                <span class=p>)</span>
<span class=linenos data-linenos="805 "></span>
<span class=linenos data-linenos="806 "></span>                <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
<span class=linenos data-linenos="807 "></span>                    <span class=p>{</span>
<span class=linenos data-linenos="808 "></span>                        <span class=s2>&quot;hash&quot;</span><span class=p>:</span> <span class=nb>hash</span><span class=p>,</span>
<span class=linenos data-linenos="809 "></span>                        <span class=s2>&quot;algorithm&quot;</span><span class=p>:</span> <span class=n>algorithm</span><span class=p>,</span>
<span class=linenos data-linenos="810 "></span>                        <span class=s2>&quot;date_modified&quot;</span><span class=p>:</span> <span class=n>mtime</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>%d</span><span class=s2>-%m-%Y %H:%M:%S.</span><span class=si>%f</span><span class=s2>&quot;</span><span class=p>),</span>
<span class=linenos data-linenos="811 "></span>                        <span class=s2>&quot;date_last_action&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span>
<span class=linenos data-linenos="812 "></span>                            <span class=s2>&quot;</span><span class=si>%d</span><span class=s2>-%m-%Y %H:%M:%S.</span><span class=si>%f</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="813 "></span>                        <span class=p>),</span>
<span class=linenos data-linenos="814 "></span>                    <span class=p>},</span>
<span class=linenos data-linenos="815 "></span>                    <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>training_plan_id</span>
<span class=linenos data-linenos="816 "></span>                    <span class=o>==</span> <span class=n>training_plan_info</span><span class=p>[</span><span class=s2>&quot;training_plan_id&quot;</span><span class=p>],</span>
<span class=linenos data-linenos="817 "></span>                <span class=p>)</span>
<span class=linenos data-linenos="818 "></span>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
<span class=linenos data-linenos="819 "></span>            <span class=c1># triggered if database update failed (see `update` method in tinydb code)</span>
<span class=linenos data-linenos="820 "></span>            <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="821 "></span>                <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span>
<span class=linenos data-linenos="822 "></span>                <span class=o>+</span> <span class=s2>&quot;: Failed to update database, with error: &quot;</span>
<span class=linenos data-linenos="823 "></span>                <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>err</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="824 "></span>            <span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.reject_training_plan class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">reject_training_plan</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>reject_training_plan</span><span class=p>(</span><span class=n>training_plan_id</span><span class=p>,</span> <span class=n>extra_notes</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Approves a training plan stored into the database given its [<code>training_plan_id</code>]</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>training_plan_id</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>id of the training plan.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>extra_notes</code></td> <td> <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, None]</code> </td> <td> <div class=doc-md-description> <p>notes detailing why training plan has been rejected. Defaults to None.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>True</code> </td> <td> <div class=doc-md-description> <p>Currently always returns True</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/node/training_plan_security_manager.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="965 "></span><span class=k>def</span> <span class=nf>reject_training_plan</span><span class=p>(</span>
<span class=linenos data-linenos="966 "></span>    <span class=bp>self</span><span class=p>,</span> <span class=n>training_plan_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>extra_notes</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=linenos data-linenos="967 "></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>True</span><span class=p>:</span>
<span class=linenos data-linenos="968 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Approves a training plan stored into the database given its [`training_plan_id`]</span>
<span class=linenos data-linenos="969 "></span>
<span class=linenos data-linenos="970 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="971 "></span><span class=sd>        training_plan_id: id of the training plan.</span>
<span class=linenos data-linenos="972 "></span><span class=sd>        extra_notes: notes detailing why training plan has been rejected. Defaults to None.</span>
<span class=linenos data-linenos="973 "></span>
<span class=linenos data-linenos="974 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="975 "></span><span class=sd>        Currently always returns True</span>
<span class=linenos data-linenos="976 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="977 "></span>    <span class=n>res</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_update_training_plan_status</span><span class=p>(</span>
<span class=linenos data-linenos="978 "></span>        <span class=n>training_plan_id</span><span class=p>,</span> <span class=n>TrainingPlanApprovalStatus</span><span class=o>.</span><span class=n>REJECTED</span><span class=p>,</span> <span class=n>extra_notes</span>
<span class=linenos data-linenos="979 "></span>    <span class=p>)</span>
<span class=linenos data-linenos="980 "></span>    <span class=k>return</span> <span class=n>res</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.reply_training_plan_approval_request class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">reply_training_plan_approval_request</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>reply_training_plan_approval_request</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Submits a training plan file (TrainingPlan) for approval. Needs an action from Node</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>request</code></td> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.message.ApprovalRequest" href="../../common/message/#fedbiomed.common.message.ApprovalRequest">ApprovalRequest</a></code> </td> <td> <div class=doc-md-description> <p>approval request message, received from Researcher</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/node/training_plan_security_manager.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="505 "></span><span class=k>def</span> <span class=nf>reply_training_plan_approval_request</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>:</span> <span class=n>ApprovalRequest</span><span class=p>):</span>
<span class=linenos data-linenos="506 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Submits a training plan file (TrainingPlan) for approval. Needs an action from Node</span>
<span class=linenos data-linenos="507 "></span>
<span class=linenos data-linenos="508 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="509 "></span><span class=sd>        request: approval request message, received from Researcher</span>
<span class=linenos data-linenos="510 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="511 "></span>
<span class=linenos data-linenos="512 "></span>    <span class=n>reply</span> <span class=o>=</span> <span class=p>{</span>
<span class=linenos data-linenos="513 "></span>        <span class=s2>&quot;researcher_id&quot;</span><span class=p>:</span> <span class=n>request</span><span class=o>.</span><span class=n>researcher_id</span><span class=p>,</span>
<span class=linenos data-linenos="514 "></span>        <span class=s2>&quot;request_id&quot;</span><span class=p>:</span> <span class=n>request</span><span class=o>.</span><span class=n>request_id</span><span class=p>,</span>
<span class=linenos data-linenos="515 "></span>        <span class=s2>&quot;node_id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_node_id</span><span class=p>,</span>
<span class=linenos data-linenos="516 "></span>        <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="517 "></span>        <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>  <span class=c1># HTTP status (set by default to 0, non-existing HTTP status code)</span>
<span class=linenos data-linenos="518 "></span>    <span class=p>}</span>
<span class=linenos data-linenos="519 "></span>
<span class=linenos data-linenos="520 "></span>    <span class=n>is_existant</span> <span class=o>=</span> <span class=kc>False</span>
<span class=linenos data-linenos="521 "></span>    <span class=n>training_plan_name</span> <span class=o>=</span> <span class=s2>&quot;training_plan_&quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
<span class=linenos data-linenos="522 "></span>    <span class=n>training_plan</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>training_plan</span>
<span class=linenos data-linenos="523 "></span>    <span class=n>reply</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=s2>&quot;training_plan_id&quot;</span><span class=p>:</span> <span class=n>training_plan_name</span><span class=p>})</span>
<span class=linenos data-linenos="524 "></span>
<span class=linenos data-linenos="525 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="526 "></span>        <span class=c1># check if training plan has already been registered into database</span>
<span class=linenos data-linenos="527 "></span>        <span class=n>is_existant</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>check_training_plan_status</span><span class=p>(</span><span class=n>training_plan</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<span class=linenos data-linenos="528 "></span>
<span class=linenos data-linenos="529 "></span>    <span class=k>except</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span> <span class=k>as</span> <span class=n>exp</span><span class=p>:</span>
<span class=linenos data-linenos="530 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error while training plan approval request </span><span class=si>{</span><span class=n>exp</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="531 "></span>        <span class=n>reply</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
<span class=linenos data-linenos="532 "></span>            <span class=p>{</span>
<span class=linenos data-linenos="533 "></span>                <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;Can not check whether training plan has already be registered or not due to error&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="534 "></span>                <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
<span class=linenos data-linenos="535 "></span>            <span class=p>}</span>
<span class=linenos data-linenos="536 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="537 "></span>
<span class=linenos data-linenos="538 "></span>        <span class=k>return</span> <span class=n>ApprovalReply</span><span class=p>(</span><span class=o>**</span><span class=n>reply</span><span class=p>)</span>
<span class=linenos data-linenos="539 "></span>
<span class=linenos data-linenos="540 "></span>    <span class=k>if</span> <span class=ow>not</span> <span class=n>is_existant</span><span class=p>:</span>
<span class=linenos data-linenos="541 "></span>        <span class=c1># move training plan into corresponding directory</span>
<span class=linenos data-linenos="542 "></span>        <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="543 "></span>            <span class=n>training_plan_hash</span><span class=p>,</span> <span class=n>hash_algo</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_hash</span><span class=p>(</span>
<span class=linenos data-linenos="544 "></span>                <span class=n>training_plan</span><span class=p>,</span> <span class=n>from_string</span><span class=o>=</span><span class=kc>True</span>
<span class=linenos data-linenos="545 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="546 "></span>            <span class=n>ctime</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>%d</span><span class=s2>-%m-%Y %H:%M:%S.</span><span class=si>%f</span><span class=s2>&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="547 "></span>            <span class=n>training_plan_object</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span>
<span class=linenos data-linenos="548 "></span>                <span class=n>name</span><span class=o>=</span><span class=n>training_plan_name</span><span class=p>,</span>
<span class=linenos data-linenos="549 "></span>                <span class=n>description</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>description</span><span class=p>,</span>
<span class=linenos data-linenos="550 "></span>                <span class=nb>hash</span><span class=o>=</span><span class=n>training_plan_hash</span><span class=p>,</span>
<span class=linenos data-linenos="551 "></span>                <span class=n>training_plan</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>training_plan</span><span class=p>,</span>
<span class=linenos data-linenos="552 "></span>                <span class=n>training_plan_id</span><span class=o>=</span><span class=n>training_plan_name</span><span class=p>,</span>
<span class=linenos data-linenos="553 "></span>                <span class=n>training_plan_type</span><span class=o>=</span><span class=n>TrainingPlanStatus</span><span class=o>.</span><span class=n>REQUESTED</span><span class=o>.</span><span class=n>value</span><span class=p>,</span>
<span class=linenos data-linenos="554 "></span>                <span class=n>training_plan_status</span><span class=o>=</span><span class=n>TrainingPlanApprovalStatus</span><span class=o>.</span><span class=n>PENDING</span><span class=o>.</span><span class=n>value</span><span class=p>,</span>
<span class=linenos data-linenos="555 "></span>                <span class=n>algorithm</span><span class=o>=</span><span class=n>hash_algo</span><span class=p>,</span>
<span class=linenos data-linenos="556 "></span>                <span class=n>date_created</span><span class=o>=</span><span class=n>ctime</span><span class=p>,</span>
<span class=linenos data-linenos="557 "></span>                <span class=n>date_modified</span><span class=o>=</span><span class=n>ctime</span><span class=p>,</span>
<span class=linenos data-linenos="558 "></span>                <span class=n>date_registered</span><span class=o>=</span><span class=n>ctime</span><span class=p>,</span>
<span class=linenos data-linenos="559 "></span>                <span class=n>date_last_action</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="560 "></span>                <span class=n>researcher_id</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>researcher_id</span><span class=p>,</span>
<span class=linenos data-linenos="561 "></span>                <span class=n>notes</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="562 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="563 "></span>
<span class=linenos data-linenos="564 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>upsert</span><span class=p>(</span>
<span class=linenos data-linenos="565 "></span>                <span class=n>training_plan_object</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>hash</span> <span class=o>==</span> <span class=n>training_plan_hash</span>
<span class=linenos data-linenos="566 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="567 "></span>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
<span class=linenos data-linenos="568 "></span>
<span class=linenos data-linenos="569 "></span>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
<span class=linenos data-linenos="570 "></span>                <span class=sa>f</span><span class=s2>&quot;Cannot add training plan in database due to error : </span><span class=si>{</span><span class=n>err</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="571 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="572 "></span>            <span class=n>reply</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
<span class=linenos data-linenos="573 "></span>                <span class=p>{</span>
<span class=linenos data-linenos="574 "></span>                    <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;Cannot add training plan into database due to error&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="575 "></span>                    <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
<span class=linenos data-linenos="576 "></span>                <span class=p>}</span>
<span class=linenos data-linenos="577 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="578 "></span>            <span class=k>return</span> <span class=n>ApprovalReply</span><span class=p>(</span><span class=o>**</span><span class=n>reply</span><span class=p>)</span>
<span class=linenos data-linenos="579 "></span>
<span class=linenos data-linenos="580 "></span>        <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="581 "></span>            <span class=n>reply</span><span class=p>[</span><span class=s2>&quot;success&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
<span class=linenos data-linenos="582 "></span>            <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Training plan successfully received by Node for approval&quot;</span><span class=p>)</span>
<span class=linenos data-linenos="583 "></span>
<span class=linenos data-linenos="584 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="585 "></span>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>check_training_plan_status</span><span class=p>(</span>
<span class=linenos data-linenos="586 "></span>            <span class=n>training_plan</span><span class=p>,</span> <span class=n>TrainingPlanApprovalStatus</span><span class=o>.</span><span class=n>PENDING</span>
<span class=linenos data-linenos="587 "></span>        <span class=p>)[</span><span class=mi>0</span><span class=p>]:</span>
<span class=linenos data-linenos="588 "></span>            <span class=n>reply</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
<span class=linenos data-linenos="589 "></span>                <span class=p>{</span>
<span class=linenos data-linenos="590 "></span>                    <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;Training plan already sent for Approval (status Pending). &quot;</span>
<span class=linenos data-linenos="591 "></span>                    <span class=s2>&quot;Please wait for Node approval.&quot;</span>
<span class=linenos data-linenos="592 "></span>                <span class=p>}</span>
<span class=linenos data-linenos="593 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="594 "></span>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>check_training_plan_status</span><span class=p>(</span>
<span class=linenos data-linenos="595 "></span>            <span class=n>training_plan</span><span class=p>,</span> <span class=n>TrainingPlanApprovalStatus</span><span class=o>.</span><span class=n>APPROVED</span>
<span class=linenos data-linenos="596 "></span>        <span class=p>)[</span><span class=mi>0</span><span class=p>]:</span>
<span class=linenos data-linenos="597 "></span>            <span class=n>reply</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
<span class=linenos data-linenos="598 "></span>                <span class=p>{</span>
<span class=linenos data-linenos="599 "></span>                    <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Training plan &#39;</span><span class=si>{</span><span class=n>request</span><span class=o>.</span><span class=n>description</span><span class=si>}</span><span class=s2>&#39; is already Approved. Ready &quot;</span>
<span class=linenos data-linenos="600 "></span>                    <span class=s2>&quot;to train on this training plan.&quot;</span>
<span class=linenos data-linenos="601 "></span>                <span class=p>}</span>
<span class=linenos data-linenos="602 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="603 "></span>        <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="604 "></span>            <span class=n>reply</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
<span class=linenos data-linenos="605 "></span>                <span class=p>{</span><span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;Training plan already exists in database. Aborting&quot;</span><span class=p>}</span>
<span class=linenos data-linenos="606 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="607 "></span>
<span class=linenos data-linenos="608 "></span>        <span class=n>reply</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>})</span>
<span class=linenos data-linenos="609 "></span>
<span class=linenos data-linenos="610 "></span>    <span class=c1># Send training plan approval acknowledge answer to researcher</span>
<span class=linenos data-linenos="611 "></span>    <span class=k>return</span> <span class=n>ApprovalReply</span><span class=p>(</span><span class=o>**</span><span class=n>reply</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.reply_training_plan_status_request class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">reply_training_plan_status_request</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>reply_training_plan_status_request</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Returns requested training plan file status {approved, rejected, pending} and sends TrainingPlanStatusReply to researcher.</p> <p>Called directly from Node.py when it receives TrainingPlanStatusRequest.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>request</code></td> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.message.TrainingPlanStatusRequest" href="../../common/message/#fedbiomed.common.message.TrainingPlanStatusRequest">TrainingPlanStatusRequest</a></code> </td> <td> <div class=doc-md-description> <p>Message that is received from researcher. Formatted as TrainingPlanStatusRequest</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/node/training_plan_security_manager.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="613 "></span><span class=k>def</span> <span class=nf>reply_training_plan_status_request</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>:</span> <span class=n>TrainingPlanStatusRequest</span><span class=p>):</span>
<span class=linenos data-linenos="614 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns requested training plan file status {approved, rejected, pending}</span>
<span class=linenos data-linenos="615 "></span><span class=sd>    and sends TrainingPlanStatusReply to researcher.</span>
<span class=linenos data-linenos="616 "></span>
<span class=linenos data-linenos="617 "></span><span class=sd>    Called directly from Node.py when it receives TrainingPlanStatusRequest.</span>
<span class=linenos data-linenos="618 "></span>
<span class=linenos data-linenos="619 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="620 "></span><span class=sd>        request: Message that is received from researcher.</span>
<span class=linenos data-linenos="621 "></span><span class=sd>            Formatted as TrainingPlanStatusRequest</span>
<span class=linenos data-linenos="622 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="623 "></span>
<span class=linenos data-linenos="624 "></span>    <span class=c1># Main header for the training plan status request</span>
<span class=linenos data-linenos="625 "></span>    <span class=n>reply</span> <span class=o>=</span> <span class=p>{</span>
<span class=linenos data-linenos="626 "></span>        <span class=s2>&quot;researcher_id&quot;</span><span class=p>:</span> <span class=n>request</span><span class=o>.</span><span class=n>researcher_id</span><span class=p>,</span>
<span class=linenos data-linenos="627 "></span>        <span class=s2>&quot;request_id&quot;</span><span class=p>:</span> <span class=n>request</span><span class=o>.</span><span class=n>request_id</span><span class=p>,</span>
<span class=linenos data-linenos="628 "></span>        <span class=s2>&quot;node_id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_node_id</span><span class=p>,</span>
<span class=linenos data-linenos="629 "></span>        <span class=s2>&quot;experiment_id&quot;</span><span class=p>:</span> <span class=n>request</span><span class=o>.</span><span class=n>experiment_id</span><span class=p>,</span>
<span class=linenos data-linenos="630 "></span>        <span class=s2>&quot;approval_obligation&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
<span class=linenos data-linenos="631 "></span>        <span class=s2>&quot;training_plan&quot;</span><span class=p>:</span> <span class=n>request</span><span class=o>.</span><span class=n>training_plan</span><span class=p>,</span>
<span class=linenos data-linenos="632 "></span>        <span class=s2>&quot;training_plan_id&quot;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>
<span class=linenos data-linenos="633 "></span>    <span class=p>}</span>
<span class=linenos data-linenos="634 "></span>
<span class=linenos data-linenos="635 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="636 "></span>        <span class=n>training_plan</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_training_plan_from_database</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>training_plan</span><span class=p>)</span>
<span class=linenos data-linenos="637 "></span>        <span class=k>if</span> <span class=n>training_plan</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<span class=linenos data-linenos="638 "></span>            <span class=n>training_plan_status</span> <span class=o>=</span> <span class=n>training_plan</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
<span class=linenos data-linenos="639 "></span>                <span class=s2>&quot;training_plan_status&quot;</span><span class=p>,</span> <span class=s2>&quot;Not Registered&quot;</span>
<span class=linenos data-linenos="640 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="641 "></span>            <span class=n>reply</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
<span class=linenos data-linenos="642 "></span>                <span class=p>{</span><span class=s2>&quot;training_plan_id&quot;</span><span class=p>:</span> <span class=n>training_plan</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;training_plan_id&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)}</span>
<span class=linenos data-linenos="643 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="644 "></span>        <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="645 "></span>            <span class=n>training_plan_status</span> <span class=o>=</span> <span class=s2>&quot;Not Registered&quot;</span>
<span class=linenos data-linenos="646 "></span>
<span class=linenos data-linenos="647 "></span>        <span class=n>reply</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=n>training_plan_status</span><span class=p>})</span>
<span class=linenos data-linenos="648 "></span>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_tp_approval</span><span class=p>:</span>
<span class=linenos data-linenos="649 "></span>            <span class=k>if</span> <span class=n>training_plan_status</span> <span class=o>==</span> <span class=n>TrainingPlanApprovalStatus</span><span class=o>.</span><span class=n>APPROVED</span><span class=o>.</span><span class=n>value</span><span class=p>:</span>
<span class=linenos data-linenos="650 "></span>                <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;Training plan has been approved by the node, training can start&quot;</span>
<span class=linenos data-linenos="651 "></span>            <span class=k>elif</span> <span class=n>training_plan_status</span> <span class=o>==</span> <span class=n>TrainingPlanApprovalStatus</span><span class=o>.</span><span class=n>PENDING</span><span class=o>.</span><span class=n>value</span><span class=p>:</span>
<span class=linenos data-linenos="652 "></span>                <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;Training plan is pending: waiting for a review&quot;</span>
<span class=linenos data-linenos="653 "></span>            <span class=k>elif</span> <span class=n>training_plan_status</span> <span class=o>==</span> <span class=n>TrainingPlanApprovalStatus</span><span class=o>.</span><span class=n>REJECTED</span><span class=o>.</span><span class=n>value</span><span class=p>:</span>
<span class=linenos data-linenos="654 "></span>                <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;Training plan has been rejected by the node, training is not possible&quot;</span>
<span class=linenos data-linenos="655 "></span>            <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="656 "></span>                <span class=n>msg</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Unknown training plan not in database (status </span><span class=si>{</span><span class=n>training_plan_status</span><span class=si>}</span><span class=s2>)&quot;</span>
<span class=linenos data-linenos="657 "></span>            <span class=n>reply</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=s2>&quot;msg&quot;</span><span class=p>:</span> <span class=n>msg</span><span class=p>})</span>
<span class=linenos data-linenos="658 "></span>
<span class=linenos data-linenos="659 "></span>        <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="660 "></span>            <span class=n>reply</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
<span class=linenos data-linenos="661 "></span>                <span class=p>{</span>
<span class=linenos data-linenos="662 "></span>                    <span class=s2>&quot;approval_obligation&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
<span class=linenos data-linenos="663 "></span>                    <span class=s2>&quot;msg&quot;</span><span class=p>:</span> <span class=s2>&quot;This node does not require training plan approval (maybe for debugging purposes).&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="664 "></span>                <span class=p>}</span>
<span class=linenos data-linenos="665 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="666 "></span>
<span class=linenos data-linenos="667 "></span>    <span class=c1># Catch all exception to be able send reply back to researcher</span>
<span class=linenos data-linenos="668 "></span>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exp</span><span class=p>:</span>
<span class=linenos data-linenos="669 "></span>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=n>exp</span><span class=p>)</span>
<span class=linenos data-linenos="670 "></span>        <span class=n>reply</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
<span class=linenos data-linenos="671 "></span>            <span class=p>{</span>
<span class=linenos data-linenos="672 "></span>                <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
<span class=linenos data-linenos="673 "></span>                <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;Error&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="674 "></span>                <span class=s2>&quot;msg&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>: Cannot check if training plan has been registered due &quot;</span>
<span class=linenos data-linenos="675 "></span>                <span class=s2>&quot;to an internal error&quot;</span><span class=p>,</span>
<span class=linenos data-linenos="676 "></span>            <span class=p>}</span>
<span class=linenos data-linenos="677 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="678 "></span>
<span class=linenos data-linenos="679 "></span>    <span class=k>return</span> <span class=n>TrainingPlanStatusReply</span><span class=p>(</span><span class=o>**</span><span class=n>reply</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.update_training_plan_hash class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">update_training_plan_hash</span> </h5> <div class="doc-signature highlight"><pre><span></span><code><span class=nf>update_training_plan_hash</span><span class=p>(</span><span class=n>training_plan_id</span><span class=p>,</span> <span class=n>path</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Updates an existing training plan entry in training plan database.</p> <p>Training plan entry cannot be a default training plan.</p> <p>The training plan entry to update is indicated by its <code>training_plan_id</code> The new training plan file for the training plan is specified from <code>path</code>.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>training_plan_id</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>id of the training plan to update</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>path</code></td> <td> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code> </td> <td> <div class=doc-md-description> <p>path where new training plan file is stored</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>True</code> </td> <td> <div class=doc-md-description> <p>Currently always returns True.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>try to update a default training plan</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError" href="../../common/exceptions/#fedbiomed.common.exceptions.FedbiomedTrainingPlanSecurityManagerError">FedbiomedTrainingPlanSecurityManagerError</a></code> </td> <td> <div class=doc-md-description> <p>cannot read or update the training plan in database</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fedbiomed/node/training_plan_security_manager.py</code></summary> <div class=highlight><pre><span></span><code><span class=linenos data-linenos="826 "></span><span class=k>def</span> <span class=nf>update_training_plan_hash</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>training_plan_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>True</span><span class=p>:</span>
<span class=linenos data-linenos="827 "></span><span class=w>    </span><span class=sd>&quot;&quot;&quot;Updates an existing training plan entry in training plan database.</span>
<span class=linenos data-linenos="828 "></span>
<span class=linenos data-linenos="829 "></span><span class=sd>    Training plan entry cannot be a default training plan.</span>
<span class=linenos data-linenos="830 "></span>
<span class=linenos data-linenos="831 "></span><span class=sd>    The training plan entry to update is indicated by its `training_plan_id`</span>
<span class=linenos data-linenos="832 "></span><span class=sd>    The new training plan file for the training plan is specified from `path`.</span>
<span class=linenos data-linenos="833 "></span>
<span class=linenos data-linenos="834 "></span><span class=sd>    Args:</span>
<span class=linenos data-linenos="835 "></span><span class=sd>        training_plan_id: id of the training plan to update</span>
<span class=linenos data-linenos="836 "></span><span class=sd>        path: path where new training plan file is stored</span>
<span class=linenos data-linenos="837 "></span>
<span class=linenos data-linenos="838 "></span><span class=sd>    Returns:</span>
<span class=linenos data-linenos="839 "></span><span class=sd>        Currently always returns True.</span>
<span class=linenos data-linenos="840 "></span>
<span class=linenos data-linenos="841 "></span><span class=sd>    Raises:</span>
<span class=linenos data-linenos="842 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: try to update a default training plan</span>
<span class=linenos data-linenos="843 "></span><span class=sd>        FedbiomedTrainingPlanSecurityManagerError: cannot read or update the training plan in database</span>
<span class=linenos data-linenos="844 "></span><span class=sd>    &quot;&quot;&quot;</span>
<span class=linenos data-linenos="845 "></span>
<span class=linenos data-linenos="846 "></span>    <span class=c1># Register training plan</span>
<span class=linenos data-linenos="847 "></span>    <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="848 "></span>        <span class=n>training_plan</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
<span class=linenos data-linenos="849 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>training_plan_id</span> <span class=o>==</span> <span class=n>training_plan_id</span>
<span class=linenos data-linenos="850 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="851 "></span>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
<span class=linenos data-linenos="852 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="853 "></span>            <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span> <span class=o>+</span> <span class=s2>&quot;: get request on database failed.&quot;</span>
<span class=linenos data-linenos="854 "></span>            <span class=sa>f</span><span class=s2>&quot; Details: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>err</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="855 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="856 "></span>    <span class=k>if</span> <span class=n>training_plan</span><span class=p>[</span><span class=s2>&quot;training_plan_type&quot;</span><span class=p>]</span> <span class=o>!=</span> <span class=n>TrainingPlanStatus</span><span class=o>.</span><span class=n>DEFAULT</span><span class=o>.</span><span class=n>value</span><span class=p>:</span>
<span class=linenos data-linenos="857 "></span>        <span class=nb>hash</span><span class=p>,</span> <span class=n>algorithm</span><span class=p>,</span> <span class=n>source</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_hash</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
<span class=linenos data-linenos="858 "></span>        <span class=c1># Verify no such training plan already exists in DB</span>
<span class=linenos data-linenos="859 "></span>        <span class=bp>self</span><span class=o>.</span><span class=n>_check_training_plan_not_existing</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=nb>hash</span><span class=p>,</span> <span class=n>algorithm</span><span class=p>)</span>
<span class=linenos data-linenos="860 "></span>
<span class=linenos data-linenos="861 "></span>        <span class=c1># Get modification date</span>
<span class=linenos data-linenos="862 "></span>        <span class=n>mtime</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>getmtime</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>
<span class=linenos data-linenos="863 "></span>        <span class=c1># Get creation date</span>
<span class=linenos data-linenos="864 "></span>        <span class=n>ctime</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>getctime</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>
<span class=linenos data-linenos="865 "></span>
<span class=linenos data-linenos="866 "></span>        <span class=k>try</span><span class=p>:</span>
<span class=linenos data-linenos="867 "></span>            <span class=bp>self</span><span class=o>.</span><span class=n>_db</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
<span class=linenos data-linenos="868 "></span>                <span class=p>{</span>
<span class=linenos data-linenos="869 "></span>                    <span class=s2>&quot;hash&quot;</span><span class=p>:</span> <span class=nb>hash</span><span class=p>,</span>
<span class=linenos data-linenos="870 "></span>                    <span class=s2>&quot;algorithm&quot;</span><span class=p>:</span> <span class=n>algorithm</span><span class=p>,</span>
<span class=linenos data-linenos="871 "></span>                    <span class=s2>&quot;date_modified&quot;</span><span class=p>:</span> <span class=n>mtime</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>%d</span><span class=s2>-%m-%Y %H:%M:%S.</span><span class=si>%f</span><span class=s2>&quot;</span><span class=p>),</span>
<span class=linenos data-linenos="872 "></span>                    <span class=s2>&quot;date_created&quot;</span><span class=p>:</span> <span class=n>ctime</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>%d</span><span class=s2>-%m-%Y %H:%M:%S.</span><span class=si>%f</span><span class=s2>&quot;</span><span class=p>),</span>
<span class=linenos data-linenos="873 "></span>                    <span class=s2>&quot;date_last_action&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span>
<span class=linenos data-linenos="874 "></span>                        <span class=s2>&quot;</span><span class=si>%d</span><span class=s2>-%m-%Y %H:%M:%S.</span><span class=si>%f</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="875 "></span>                    <span class=p>),</span>
<span class=linenos data-linenos="876 "></span>                    <span class=s2>&quot;training_plan&quot;</span><span class=p>:</span> <span class=n>source</span><span class=p>,</span>
<span class=linenos data-linenos="877 "></span>                <span class=p>},</span>
<span class=linenos data-linenos="878 "></span>                <span class=bp>self</span><span class=o>.</span><span class=n>_database</span><span class=o>.</span><span class=n>training_plan_id</span> <span class=o>==</span> <span class=n>training_plan_id</span><span class=p>,</span>
<span class=linenos data-linenos="879 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="880 "></span>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
<span class=linenos data-linenos="881 "></span>            <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="882 "></span>                <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span> <span class=o>+</span> <span class=s2>&quot;: update database failed. Details :&quot;</span>
<span class=linenos data-linenos="883 "></span>                <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>err</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=linenos data-linenos="884 "></span>            <span class=p>)</span>
<span class=linenos data-linenos="885 "></span>    <span class=k>else</span><span class=p>:</span>
<span class=linenos data-linenos="886 "></span>        <span class=k>raise</span> <span class=n>FedbiomedTrainingPlanSecurityManagerError</span><span class=p>(</span>
<span class=linenos data-linenos="887 "></span>            <span class=n>ErrorNumbers</span><span class=o>.</span><span class=n>FB606</span><span class=o>.</span><span class=n>value</span>
<span class=linenos data-linenos="888 "></span>            <span class=o>+</span> <span class=s2>&quot;You cannot update default training plans. Please &quot;</span>
<span class=linenos data-linenos="889 "></span>            <span class=s2>&quot;update them through their files saved in `default_training_plans` directory &quot;</span>
<span class=linenos data-linenos="890 "></span>            <span class=s2>&quot;and restart your node&quot;</span>
<span class=linenos data-linenos="891 "></span>        <span class=p>)</span>
<span class=linenos data-linenos="892 "></span>
<span class=linenos data-linenos="893 "></span>    <span class=k>return</span> <span class=kc>True</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> </article> </main> </div> <div class=right-col> <div id=right-sidebar class=sidebar-right> <nav class=toc> <!-- Render item list --> <label class=toc-title for=__toc> <span class=toc-icon></span> </label> <ul class=toc-list data-md-component=toc data-md-scrollfix> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager-attributes class=md-nav__link> Attributes </a> <nav class=toc-nav aria-label=Attributes> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.HASH_FUNCTIONS class=md-nav__link> HASH_FUNCTIONS </a> </li> </ul> </nav> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager-classes class=md-nav__link> Classes </a> <nav class=toc-nav aria-label=Classes> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager class=md-nav__link> TrainingPlanSecurityManager </a> <nav class=toc-nav aria-label=TrainingPlanSecurityManager> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager-functions class=md-nav__link> Functions </a> <nav class=toc-nav aria-label=Functions> <ul class=toc-list> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.approve_training_plan class=md-nav__link> approve_training_plan </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.check_hashes_for_registered_training_plans class=md-nav__link> check_hashes_for_registered_training_plans </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.check_training_plan_status class=md-nav__link> check_training_plan_status </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.delete_training_plan class=md-nav__link> delete_training_plan </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.get_training_plan_by_id class=md-nav__link> get_training_plan_by_id </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.get_training_plan_by_name class=md-nav__link> get_training_plan_by_name </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.get_training_plan_from_database class=md-nav__link> get_training_plan_from_database </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.list_training_plans class=md-nav__link> list_training_plans </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.register_training_plan class=md-nav__link> register_training_plan </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.register_update_default_training_plans class=md-nav__link> register_update_default_training_plans </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.reject_training_plan class=md-nav__link> reject_training_plan </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.reply_training_plan_approval_request class=md-nav__link> reply_training_plan_approval_request </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.reply_training_plan_status_request class=md-nav__link> reply_training_plan_status_request </a> </li> <!-- Table of contents item --> <li class=toc-item> <a href=#fedbiomed.node.training_plan_security_manager.TrainingPlanSecurityManager.update_training_plan_hash class=md-nav__link> update_training_plan_hash </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> </div> <!-- News Main Page--> </div> <footer> <div class=container-fluid> <div class=footer-first-inner> <div class=container> <div class=row> <div class=col-md-6> <div class=footer-contact> <strong>Address:</strong> <p>2004 Rte des Lucioles, 06902 Sophia Antipolis</p> <strong>E-mail:</strong> <p>fedbiomed _at_ inria _dot_ fr</p> </div> </div> <div class=col-md-6> <div class=footer-contact> <p>Fed-BioMed  2022</p> </div> </div> </div> </div> </div> </div> </footer> <!-- JQuery --> <script src=https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js></script> <!-- Latest compiled and minified JavaScript --> <script src=https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=../../../../assets/javascript/lunr.js></script> <script src=../../../../assets/javascript/theme.js></script> <!-- GitHub buttons --> <script async defer src=https://buttons.github.io/buttons.js></script> </body> </html>